<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.8.1" data-slug="woocommerce-pdf-invoices" data-type="class" data-id="21078"><head xmlns="http://www.w3.org/1999/xhtml"><title> svg | class | Woocommerce Pdf Invoices | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="SVG, class, plugin, woocommerce-pdf-invoices, 2.8.1" /><meta name="description" content="The WooCommerce PDF Invoices SVG class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6c6668926558a2d9d8ff27d8401daa46' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/svg/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fsvg%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fsvg%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-pdf-invoices-2.8.1-class-svg","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="svg" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-pdf-invoices." href="http://hookr.io/plugins/woocommerce-pdf-invoices/" class="plugin"><span property="name">woocommerce-pdf-invoices</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.1." href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/" class="H_VERSION"><span property="name">2.8.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">svg</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="211"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/all/" title="All">All <span class="count badge">211</span></a></li><li class="" data-id="new" data-count="24"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/new/" title="New">New <span class="count badge">24</span></a></li><li class="" data-id="hooks" data-count="41"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/hooks/" title="Hooks">Hooks <span class="count badge">41</span></a></li><li class="" data-id="action" data-count="13"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/actions/" title="Actions">Actions <span class="count badge">13</span></a></li><li class="" data-id="filter" data-count="28"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/filters/" title="Filters">Filters <span class="count badge">28</span></a></li><li class="active" data-id="class" data-count="63"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/" title="Classes">Classes <span class="count badge">63</span></a></li><li class="" data-id="constant" data-count="66"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/constants/" title="Constants">Constants <span class="count badge">66</span></a></li><li class="" data-id="function" data-count="40"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/functions/" title="Functions">Functions <span class="count badge">40</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>SVG</strong></h1><p>The WooCommerce PDF Invoices <strong>SVG</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/files/vendor-mpdf-mpdf-classes-svg/" class="file">/vendor/mpdf/mpdf/classes/svg.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="33" class="block" start="33"><li><div>class SVG&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_font;  //    array - holds content of SVG fonts defined in image    // mPDF 6&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_gradient; //    array - contient les infos sur les gradient fill du svg class par id du svg&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_shadinglist; //    array - contient les ids des objet shading&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_info;  //    array contenant les infos du svg voulue par l'utilisateur&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_attribs;  //    array - holds all attributes of root &lt;svg&gt; tag&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_style;  //    array contenant les style de groupes du svg&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_string;  //    String contenant le tracage du svg en lui mme.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $txt_data;  //    array - holds string info to write txt to image&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $txt_style;  //     array - current text style&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $mpdf_ref;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $xbase;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $ybase;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $svg_error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $subPathInit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $spxstart;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $spystart;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $kp;  // convert pixels to PDF units&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $pathBBox;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $script2lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $viet;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $pashto;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $urdu;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $persian;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $sindhi;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textlength;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $texttotallength; // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textoutput;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textanchor;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textXorigin;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textYorigin;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $textjuststarted; // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $intext;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct(mPDF $mpdf)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;svg_font = array(); // mPDF 6&nbsp;</div></li><li><div>        $this-&gt;svg_gradient = array();&nbsp;</div></li><li><div>        $this-&gt;svg_shadinglist = array();&nbsp;</div></li><li><div>        $this-&gt;txt_data = array();&nbsp;</div></li><li><div>        $this-&gt;svg_string = '';&nbsp;</div></li><li><div>        $this-&gt;svg_info = array();&nbsp;</div></li><li><div>        $this-&gt;svg_attribs = array();&nbsp;</div></li><li><div>        $this-&gt;xbase = 0;&nbsp;</div></li><li><div>        $this-&gt;ybase = 0;&nbsp;</div></li><li><div>        $this-&gt;svg_error = false;&nbsp;</div></li><li><div>        $this-&gt;subPathInit = false;&nbsp;</div></li><li><div>        $this-&gt;dashesUsed = false;&nbsp;</div></li><li><div>        $this-&gt;mpdf_ref = & $mpdf;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;textlength = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;texttotallength = 0; // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;textoutput = '';  // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;textanchor = 'start'; // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;textXorigin = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;textYorigin = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;textjuststarted = false; // mPDF 5.7.4&nbsp;</div></li><li><div>        $this-&gt;intext = false;   // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;kp = 72 / $mpdf-&gt;img_dpi; // constant To convert pixels to pts/PDF units&nbsp;</div></li><li><div>        $this-&gt;kf = 1;    // constant To convert font size if re-mapped&nbsp;</div></li><li><div>        $this-&gt;pathBBox = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_style = array(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'fill' =&gt; 'black', &nbsp;</div></li><li><div>                'fill-opacity' =&gt; 1, //    remplissage opaque par defaut&nbsp;</div></li><li><div>                'fill-rule' =&gt; 'nonzero', //    mode de remplissage par defaut&nbsp;</div></li><li><div>                'stroke' =&gt; 'none', //    pas de trait par defaut&nbsp;</div></li><li><div>                'stroke-linecap' =&gt; 'butt', //    style de langle par defaut&nbsp;</div></li><li><div>                'stroke-linejoin' =&gt; 'miter', &nbsp;</div></li><li><div>                'stroke-miterlimit' =&gt; 4, //    limite de langle par defaut&nbsp;</div></li><li><div>                'stroke-opacity' =&gt; 1, //    trait opaque par defaut&nbsp;</div></li><li><div>                'stroke-width' =&gt; 1, &nbsp;</div></li><li><div>                'stroke-dasharray' =&gt; 0, &nbsp;</div></li><li><div>                'stroke-dashoffset' =&gt; 0, &nbsp;</div></li><li><div>                'color' =&gt; ''&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;txt_style = array(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'fill' =&gt; 'black', //    pas de remplissage par defaut&nbsp;</div></li><li><div>                'font-family' =&gt; $mpdf-&gt;default_font, &nbsp;</div></li><li><div>                'font-size' =&gt; $mpdf-&gt;default_font_size, //     ****** this is pts&nbsp;</div></li><li><div>                'font-weight' =&gt; 'normal', //    normal | bold&nbsp;</div></li><li><div>                'font-style' =&gt; 'normal', //    italic | normal&nbsp;</div></li><li><div>                'text-anchor' =&gt; 'start', // alignment: start, middle, end&nbsp;</div></li><li><div>                'fill-opacity' =&gt; 1, //    remplissage opaque par defaut&nbsp;</div></li><li><div>                'fill-rule' =&gt; 'nonzero', //    mode de remplissage par defaut&nbsp;</div></li><li><div>                'stroke' =&gt; 'none', //    pas de trait par defaut&nbsp;</div></li><li><div>                'stroke-opacity' =&gt; 1, //    trait opaque par defaut&nbsp;</div></li><li><div>                'stroke-width' =&gt; 1, &nbsp;</div></li><li><div>                'color' =&gt; ''&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // mPDF 5.7.4 Embedded image&nbsp;</div></li><li><div>    function svgImage($attribs)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // x and y are coordinates&nbsp;</div></li><li><div>        $x = (isset($attribs['x']) ? $attribs['x'] : 0);&nbsp;</div></li><li><div>        $y = (isset($attribs['y']) ? $attribs['y'] : 0);&nbsp;</div></li><li><div>        // preserveAspectRatio&nbsp;</div></li><li><div>        $par = (isset($attribs['preserveAspectRatio']) ? $attribs['preserveAspectRatio'] : 'xMidYMid meet');&nbsp;</div></li><li><div>        // width and height are &lt;lengths&gt; - Required attributes&nbsp;</div></li><li><div>        $wset = (isset($attribs['width']) ? $attribs['width'] : 0);&nbsp;</div></li><li><div>        $hset = (isset($attribs['height']) ? $attribs['height'] : 0);&nbsp;</div></li><li><div>        $w = $this-&gt;mpdf_ref-&gt;ConvertSize($wset, $this-&gt;svg_info['w'] * (25.4 / $this-&gt;mpdf_ref-&gt;dpi), $this-&gt;mpdf_ref-&gt;FontSize, false);&nbsp;</div></li><li><div>        $h = $this-&gt;mpdf_ref-&gt;ConvertSize($hset, $this-&gt;svg_info['h'] * (25.4 / $this-&gt;mpdf_ref-&gt;dpi), $this-&gt;mpdf_ref-&gt;FontSize, false);&nbsp;</div></li><li><div>        if ($w == 0 || $h == 0) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Convert to pixels = SVG units&nbsp;</div></li><li><div>        $w *= 1 / (25.4 / $this-&gt;mpdf_ref-&gt;dpi);&nbsp;</div></li><li><div>        $h *= 1 / (25.4 / $this-&gt;mpdf_ref-&gt;dpi);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $srcpath = $attribs['xlink:href'];&nbsp;</div></li><li><div>        $orig_srcpath = '';&nbsp;</div></li><li><div>        if (trim($srcpath) != '' && substr($srcpath, 0, 4) == 'var:') {&nbsp;</div></li><li><div>            $orig_srcpath = $srcpath;&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;GetFullPath($srcpath);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Image file (does not allow vector images i.e. WMF/SVG)&nbsp;</div></li><li><div>        // mPDF 6 Added $this-&gt;mpdf_ref-&gt;interpolateImages&nbsp;</div></li><li><div>        $info = $this-&gt;mpdf_ref-&gt;_getImage($srcpath, true, false, $orig_srcpath, $this-&gt;mpdf_ref-&gt;interpolateImages);&nbsp;</div></li><li><div>        if (!$info)&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // x, y, w, h define the reference rectangle&nbsp;</div></li><li><div>        $img_h = $h;&nbsp;</div></li><li><div>        $img_w = $w;&nbsp;</div></li><li><div>        $img_x = $x;&nbsp;</div></li><li><div>        $img_y = $y;&nbsp;</div></li><li><div>        $meetOrSlice = 'meet';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // preserveAspectRatio&nbsp;</div></li><li><div>        $ar = preg_split('/\s+/', strtolower($par));&nbsp;</div></li><li><div>        if ($ar[0] != 'none') { // If &quot;none&quot; need to do nothing&nbsp;</div></li><li><div>            //  Force uniform scaling&nbsp;</div></li><li><div>            if (isset($ar[1]) && $ar[1] == 'slice') {&nbsp;</div></li><li><div>                $meetOrSlice = 'slice';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $meetOrSlice = 'meet';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($info['h'] / $info['w'] &gt; $h / $w) {&nbsp;</div></li><li><div>                if ($meetOrSlice == 'meet') { // the entire viewBox is visible within the viewport&nbsp;</div></li><li><div>                    $img_w = $img_h * $info['w'] / $info['h'];&nbsp;</div></li><li><div>                } else { // the entire viewport is covered by the viewBox&nbsp;</div></li><li><div>                    $img_h = $img_w * $info['h'] / $info['w'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else if ($info['h'] / $info['w'] &lt; $h / $w) {&nbsp;</div></li><li><div>                if ($meetOrSlice == 'meet') { // the entire viewBox is visible within the viewport&nbsp;</div></li><li><div>                    $img_h = $img_w * $info['h'] / $info['w'];&nbsp;</div></li><li><div>                } else { // the entire viewport is covered by the viewBox&nbsp;</div></li><li><div>                    $img_w = $img_h * $info['w'] / $info['h'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($ar[0] == 'xminymin') {&nbsp;</div></li><li><div>                // do nothing to x&nbsp;</div></li><li><div>                // do nothing to y&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xmidymin') {&nbsp;</div></li><li><div>                $img_x += $w / 2 - $img_w / 2; // xMid&nbsp;</div></li><li><div>                // do nothing to y&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xmaxymin') {&nbsp;</div></li><li><div>                $img_x += $w - $img_w; // xMax&nbsp;</div></li><li><div>                // do nothing to y&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xminymid') {&nbsp;</div></li><li><div>                // do nothing to x&nbsp;</div></li><li><div>                $img_y += $h / 2 - $img_h / 2; // yMid&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xmaxymid') {&nbsp;</div></li><li><div>                $img_x += $w - $img_w; // xMax&nbsp;</div></li><li><div>                $img_y += $h / 2 - $img_h / 2; // yMid&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xminymax') {&nbsp;</div></li><li><div>                // do nothing to x&nbsp;</div></li><li><div>                $img_y += $h - $img_h; // yMax&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xmidymax') {&nbsp;</div></li><li><div>                $img_x += $w / 2 - $img_w / 2; // xMid&nbsp;</div></li><li><div>                $img_y += $h - $img_h; // yMax&nbsp;</div></li><li><div>            } else if ($ar[0] == 'xmaxymax') {&nbsp;</div></li><li><div>                $img_x += $w - $img_w; // xMax&nbsp;</div></li><li><div>                $img_y += $h - $img_h; // yMax&nbsp;</div></li><li><div>            } else { // xMidYMid (the default)&nbsp;</div></li><li><div>                $img_x += $w / 2 - $img_w / 2; // xMid&nbsp;</div></li><li><div>                $img_y += $h / 2 - $img_h / 2; // yMid&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Output&nbsp;</div></li><li><div>        if ($meetOrSlice == 'slice') { // need to add a clipping path to reference rectangle&nbsp;</div></li><li><div>            $s = ' q 0 w '; // Line width=0&nbsp;</div></li><li><div>            $s .= sprintf('%.3F %.3F m ', ($x) * $this-&gt;kp, (-($y + $h)) * $this-&gt;kp); // start point TL before the arc&nbsp;</div></li><li><div>            $s .= sprintf('%.3F %.3F l ', ($x) * $this-&gt;kp, (-($y)) * $this-&gt;kp); // line to BL&nbsp;</div></li><li><div>            $s .= sprintf('%.3F %.3F l ', ($x + $w) * $this-&gt;kp, (-($y)) * $this-&gt;kp); // line to BR&nbsp;</div></li><li><div>            $s .= sprintf('%.3F %.3F l ', ($x + $w) * $this-&gt;kp, (-($y + $h)) * $this-&gt;kp); // line to TR&nbsp;</div></li><li><div>            $s .= sprintf('%.3F %.3F l ', ($x) * $this-&gt;kp, (-($y + $h)) * $this-&gt;kp); // line to TL&nbsp;</div></li><li><div>            $s .= ' W n '; // Ends path no-op & Sets the clipping path&nbsp;</div></li><li><div>            $this-&gt;svgWriteString($s);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $outstring = sprintf(&quot; q %.3F 0 0 %.3F %.3F %.3F cm /I%d Do Q &quot;, $img_w * $this-&gt;kp, $img_h * $this-&gt;kp, $img_x * $this-&gt;kp, -($img_y + $img_h) * $this-&gt;kp, $info['i']);&nbsp;</div></li><li><div>        $this-&gt;svgWriteString($outstring);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($meetOrSlice == 'slice') { // need to end clipping path&nbsp;</div></li><li><div>            $this-&gt;svgWriteString(' Q ');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function svgGradient($gradient_info, $attribs, $element)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $n = count($this-&gt;mpdf_ref-&gt;gradients) + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get bounding dimensions of element&nbsp;</div></li><li><div>        $w = 100;&nbsp;</div></li><li><div>        $h = 100;&nbsp;</div></li><li><div>        $x_offset = 0;&nbsp;</div></li><li><div>        $y_offset = 0;&nbsp;</div></li><li><div>        if ($element == 'rect') {&nbsp;</div></li><li><div>            $w = $attribs['width'];&nbsp;</div></li><li><div>            $h = $attribs['height'];&nbsp;</div></li><li><div>            $x_offset = $attribs['x'];&nbsp;</div></li><li><div>            $y_offset = $attribs['y'];&nbsp;</div></li><li><div>        } else if ($element == 'ellipse') {&nbsp;</div></li><li><div>            $w = $attribs['rx'] * 2;&nbsp;</div></li><li><div>            $h = $attribs['ry'] * 2;&nbsp;</div></li><li><div>            $x_offset = $attribs['cx'] - $attribs['rx'];&nbsp;</div></li><li><div>            $y_offset = $attribs['cy'] - $attribs['ry'];&nbsp;</div></li><li><div>        } else if ($element == 'circle') {&nbsp;</div></li><li><div>            $w = $attribs['r'] * 2;&nbsp;</div></li><li><div>            $h = $attribs['r'] * 2;&nbsp;</div></li><li><div>            $x_offset = $attribs['cx'] - $attribs['r'];&nbsp;</div></li><li><div>            $y_offset = $attribs['cy'] - $attribs['r'];&nbsp;</div></li><li><div>        } else if ($element == 'polygon') {&nbsp;</div></li><li><div>            $pts = preg_split('/[ , ]+/', trim($attribs['points']));&nbsp;</div></li><li><div>            $maxr = $maxb = 0;&nbsp;</div></li><li><div>            $minl = $mint = 999999;&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($pts); $i++) {&nbsp;</div></li><li><div>                if ($i % 2 == 0) { // x values&nbsp;</div></li><li><div>                    $minl = min($minl, $pts[$i]);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $pts[$i]);&nbsp;</div></li><li><div>                } else { // y values&nbsp;</div></li><li><div>                    $mint = min($mint, $pts[$i]);&nbsp;</div></li><li><div>                    $maxb = max($maxb, $pts[$i]);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $maxr - $minl;&nbsp;</div></li><li><div>            $h = $maxb - $mint;&nbsp;</div></li><li><div>            $x_offset = $minl;&nbsp;</div></li><li><div>            $y_offset = $mint;&nbsp;</div></li><li><div>        } else if ($element == 'path') {&nbsp;</div></li><li><div>            if (is_array($this-&gt;pathBBox) && $this-&gt;pathBBox[2] &gt; 0) {&nbsp;</div></li><li><div>                $w = $this-&gt;pathBBox[2];&nbsp;</div></li><li><div>                $h = $this-&gt;pathBBox[3];&nbsp;</div></li><li><div>                $x_offset = $this-&gt;pathBBox[0];&nbsp;</div></li><li><div>                $y_offset = $this-&gt;pathBBox[1];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                preg_match_all('/([a-z]|[A-Z])([ , \-.\d]+)*/', $attribs['d'], $commands, PREG_SET_ORDER);&nbsp;</div></li><li><div>                $maxr = $maxb = 0;&nbsp;</div></li><li><div>                $minl = $mint = 999999;&nbsp;</div></li><li><div>                foreach ($commands as $c) {&nbsp;</div></li><li><div>                    if (count($c) == 3) {&nbsp;</div></li><li><div>                        list($tmp, $cmd, $arg) = $c;&nbsp;</div></li><li><div>                        if ($cmd == 'M' || $cmd == 'L' || $cmd == 'C' || $cmd == 'S' || $cmd == 'Q' || $cmd == 'T') {&nbsp;</div></li><li><div>                            $pts = preg_split('/[ , ]+/', trim($arg));&nbsp;</div></li><li><div>                            for ($i = 0; $i &lt; count($pts); $i++) {&nbsp;</div></li><li><div>                                if ($i % 2 == 0) { // x values&nbsp;</div></li><li><div>                                    $minl = min($minl, $pts[$i]);&nbsp;</div></li><li><div>                                    $maxr = max($maxr, $pts[$i]);&nbsp;</div></li><li><div>                                } else { // y values&nbsp;</div></li><li><div>                                    $mint = min($mint, $pts[$i]);&nbsp;</div></li><li><div>                                    $maxb = max($maxb, $pts[$i]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($cmd == 'H') { // sets new x&nbsp;</div></li><li><div>                            $minl = min($minl, $arg);&nbsp;</div></li><li><div>                            $maxr = max($maxr, $arg);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($cmd == 'V') { // sets new y&nbsp;</div></li><li><div>                            $mint = min($mint, $arg);&nbsp;</div></li><li><div>                            $maxb = max($maxb, $arg);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $w = $maxr - $minl;&nbsp;</div></li><li><div>                $h = $maxb - $mint;&nbsp;</div></li><li><div>                $x_offset = $minl;&nbsp;</div></li><li><div>                $y_offset = $mint;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!$w || $w == -999999) {&nbsp;</div></li><li><div>            $w = 100;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!$h || $h == -999999) {&nbsp;</div></li><li><div>            $h = 100;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($x_offset == 999999) {&nbsp;</div></li><li><div>            $x_offset = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($y_offset == 999999) {&nbsp;</div></li><li><div>            $y_offset = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TRANSFORMATIONS&nbsp;</div></li><li><div>        $transformations = '';&nbsp;</div></li><li><div>        if (isset($gradient_info['transform'])) {&nbsp;</div></li><li><div>            preg_match_all('/(matrix|translate|scale|rotate|skewX|skewY)\((.*?)\)/is', $gradient_info['transform'], $m);&nbsp;</div></li><li><div>            if (count($m[0])) {&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; count($m[0]); $i++) {&nbsp;</div></li><li><div>                    $c = strtolower($m[1][$i]);&nbsp;</div></li><li><div>                    $v = trim($m[2][$i]);&nbsp;</div></li><li><div>                    $vv = preg_split('/[ , ]+/', $v);&nbsp;</div></li><li><div>                    if ($c == 'matrix' && count($vv) == 6) {&nbsp;</div></li><li><div>                        // Note angle of rotation is reversed (from SVG to PDF), so vv[1] and vv[2] are negated&nbsp;</div></li><li><div>                        // cf svgDefineStyle()&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F %.3F %.3F %.3F %.3F %.3F cm ', $vv[0], -$vv[1], -$vv[2], $vv[3], $vv[4] * $this-&gt;kp, -$vv[5] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else if ($c == 'translate' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[4] = $vv[0];&nbsp;</div></li><li><div>                        if (count($vv) == 2) {&nbsp;</div></li><li><div>                            $t_y = -$vv[1];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $t_y = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $tm[5] = $t_y;&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', $tm[4] * $this-&gt;kp, $tm[5] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else if ($c == 'scale' && count($vv)) {&nbsp;</div></li><li><div>                        if (count($vv) == 2) {&nbsp;</div></li><li><div>                            $s_y = $vv[1];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $s_y = $vv[0];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $tm[0] = $vv[0];&nbsp;</div></li><li><div>                        $tm[3] = $s_y;&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F 0 0 %.3F 0 0 cm ', $tm[0], $tm[3]);&nbsp;</div></li><li><div>                    } else if ($c == 'rotate' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[0] = cos(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $tm[1] = sin(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $tm[2] = -$tm[1];&nbsp;</div></li><li><div>                        $tm[3] = $tm[0];&nbsp;</div></li><li><div>                        if (count($vv) == 3) {&nbsp;</div></li><li><div>                            $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', $vv[1] * $this-&gt;kp, -$vv[2] * $this-&gt;kp);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F %.3F %.3F %.3F 0 0 cm ', $tm[0], $tm[1], $tm[2], $tm[3]);&nbsp;</div></li><li><div>                        if (count($vv) == 3) {&nbsp;</div></li><li><div>                            $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', -$vv[1] * $this-&gt;kp, $vv[2] * $this-&gt;kp);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else if ($c == 'skewx' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[2] = tan(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 0 %.3F 1 0 0 cm ', $tm[2]);&nbsp;</div></li><li><div>                    } else if ($c == 'skewy' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[1] = tan(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 %.3F 0 1 0 0 cm ', $tm[1]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'userspaceonuse') {&nbsp;</div></li><li><div>            if ($transformations) {&nbsp;</div></li><li><div>                $return .= $transformations;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $spread = 'P';  // pad&nbsp;</div></li><li><div>        if (isset($gradient_info['spread'])) {&nbsp;</div></li><li><div>            if (strtolower($gradient_info['spread']) == 'reflect') {&nbsp;</div></li><li><div>                $spread = 'F';&nbsp;</div></li><li><div>            } // reflect&nbsp;</div></li><li><div>            else if (strtolower($gradient_info['spread']) == 'repeat') {&nbsp;</div></li><li><div>                $spread = 'R';&nbsp;</div></li><li><div>            } // repeat&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; (count($gradient_info['color'])); $i++) {&nbsp;</div></li><li><div>            if (stristr($gradient_info['color'][$i]['offset'], '%') !== false) {&nbsp;</div></li><li><div>                $gradient_info['color'][$i]['offset'] = ($gradient_info['color'][$i]['offset'] + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['color'][($i + 1)]['offset']) && stristr($gradient_info['color'][($i + 1)]['offset'], '%') !== false) {&nbsp;</div></li><li><div>                $gradient_info['color'][($i + 1)]['offset'] = ($gradient_info['color'][($i + 1)]['offset'] + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($gradient_info['color'][$i]['offset'] &lt; 0) {&nbsp;</div></li><li><div>                $gradient_info['color'][$i]['offset'] = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($gradient_info['color'][$i]['offset'] &gt; 1) {&nbsp;</div></li><li><div>                $gradient_info['color'][$i]['offset'] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($i &gt; 0) {&nbsp;</div></li><li><div>                if ($gradient_info['color'][$i]['offset'] &lt; $gradient_info['color'][($i - 1)]['offset']) {&nbsp;</div></li><li><div>                    $gradient_info['color'][$i]['offset'] = $gradient_info['color'][($i - 1)]['offset'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($gradient_info['color'][0]['offset']) && $gradient_info['color'][0]['offset'] &gt; 0) {&nbsp;</div></li><li><div>            array_unshift($gradient_info['color'], $gradient_info['color'][0]);&nbsp;</div></li><li><div>            $gradient_info['color'][0]['offset'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $ns = count($gradient_info['color']);&nbsp;</div></li><li><div>        if (isset($gradient_info['color'][($ns - 1)]['offset']) && $gradient_info['color'][($ns - 1)]['offset'] &lt; 1) {&nbsp;</div></li><li><div>            $gradient_info['color'][] = $gradient_info['color'][($ns - 1)];&nbsp;</div></li><li><div>            $gradient_info['color'][($ns)]['offset'] = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $ns = count($gradient_info['color']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($gradient_info['type'] == 'linear') {&nbsp;</div></li><li><div>            // mPDF 4.4.003&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'userspaceonuse') {&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['x1'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['x1'] = ($gradient_info['info']['x1'] - $x_offset) / $w;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['y1'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['y1'] = ($gradient_info['info']['y1'] - $y_offset) / $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['x2'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['x2'] = ($gradient_info['info']['x2'] - $x_offset) / $w;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['y2'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['y2'] = ($gradient_info['info']['y2'] - $y_offset) / $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['x1'])) {&nbsp;</div></li><li><div>                $x1 = $gradient_info['info']['x1'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $x1 = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['y1'])) {&nbsp;</div></li><li><div>                $y1 = $gradient_info['info']['y1'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $y1 = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['x2'])) {&nbsp;</div></li><li><div>                $x2 = $gradient_info['info']['x2'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $x2 = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['y2'])) {&nbsp;</div></li><li><div>                $y2 = $gradient_info['info']['y2'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $y2 = 0;&nbsp;</div></li><li><div>            } // mPDF 6&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (stristr($x1, '%') !== false) {&nbsp;</div></li><li><div>                $x1 = ($x1 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($x2, '%') !== false) {&nbsp;</div></li><li><div>                $x2 = ($x2 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($y1, '%') !== false) {&nbsp;</div></li><li><div>                $y1 = ($y1 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($y2, '%') !== false) {&nbsp;</div></li><li><div>                $y2 = ($y2 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.0.042&nbsp;</div></li><li><div>            $bboxw = $w;&nbsp;</div></li><li><div>            $bboxh = $h;&nbsp;</div></li><li><div>            $usex = $x_offset;&nbsp;</div></li><li><div>            $usey = $y_offset;&nbsp;</div></li><li><div>            $usew = $bboxw;&nbsp;</div></li><li><div>            $useh = $bboxh;&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'userspaceonuse') {&nbsp;</div></li><li><div>                $angle = rad2deg(atan2(($gradient_info['info']['y2'] - $gradient_info['info']['y1']), ($gradient_info['info']['x2'] - $gradient_info['info']['x1'])));&nbsp;</div></li><li><div>                if ($angle &lt; 0) {&nbsp;</div></li><li><div>                    $angle += 360;&nbsp;</div></li><li><div>                } else if ($angle &gt; 360) {&nbsp;</div></li><li><div>                    $angle -= 360;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($angle != 0 && $angle != 360 && $angle != 90 && $angle != 180 && $angle != 270) {&nbsp;</div></li><li><div>                    if ($w &gt;= $h) {&nbsp;</div></li><li><div>                        $y1 *= $h / $w;&nbsp;</div></li><li><div>                        $y2 *= $h / $w;&nbsp;</div></li><li><div>                        $usew = $useh = $bboxw;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $x1 *= $w / $h;&nbsp;</div></li><li><div>                        $x2 *= $w / $h;&nbsp;</div></li><li><div>                        $usew = $useh = $bboxh;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $a = $usew;  // width&nbsp;</div></li><li><div>            $d = -$useh; // height&nbsp;</div></li><li><div>            $e = $usex;  // x- offset&nbsp;</div></li><li><div>            $f = -$usey; // -y-offset&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $return .= sprintf('%.3F 0 0 %.3F %.3F %.3F cm ', $a * $this-&gt;kp, $d * $this-&gt;kp, $e * $this-&gt;kp, $f * $this-&gt;kp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'objectboundingbox') {&nbsp;</div></li><li><div>                if ($transformations) {&nbsp;</div></li><li><div>                    $return .= $transformations;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $trans = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($spread == 'R' || $spread == 'F') { // Repeat  /  Reflect&nbsp;</div></li><li><div>                $offs = array();&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ns; $i++) {&nbsp;</div></li><li><div>                    $offs[$i] = $gradient_info['color'][$i]['offset'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $gp = 0;&nbsp;</div></li><li><div>                $inside = true;&nbsp;</div></li><li><div>                while ($inside) {&nbsp;</div></li><li><div>                    $gp++;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $ns; $i++) {&nbsp;</div></li><li><div>                        if ($spread == 'F' && ($gp % 2) == 1) { // Reflect&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)] = $gradient_info['color'][(($ns * ($gp - 1)) + ($ns - $i - 1))];&nbsp;</div></li><li><div>                            $tmp = $gp + (1 - $offs[($ns - $i - 1)]);&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)]['offset'] = $tmp;&nbsp;</div></li><li><div>                        } else { // Reflect&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)] = $gradient_info['color'][$i];&nbsp;</div></li><li><div>                            $tmp = $gp + $offs[$i];&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)]['offset'] = $tmp;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // IF STILL INSIDE BOX OR STILL VALID&nbsp;</div></li><li><div>                        // Point on axis to test&nbsp;</div></li><li><div>                        $px1 = $x1 + ($x2 - $x1) * $tmp;&nbsp;</div></li><li><div>                        $py1 = $y1 + ($y2 - $y1) * $tmp;&nbsp;</div></li><li><div>                        // Get perpendicular axis&nbsp;</div></li><li><div>                        $alpha = atan2($y2 - $y1, $x2 - $x1);&nbsp;</div></li><li><div>                        $alpha += M_PI / 2; // rotate 90 degrees&nbsp;</div></li><li><div>                        // Get arbitrary point to define line perpendicular to axis&nbsp;</div></li><li><div>                        $px2 = $px1 + cos($alpha);&nbsp;</div></li><li><div>                        $py2 = $py1 + sin($alpha);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $res1 = _testIntersect($px1, $py1, $px2, $py2, 0, 0, 0, 1); // $x=0 vert axis&nbsp;</div></li><li><div>                        $res2 = _testIntersect($px1, $py1, $px2, $py2, 1, 0, 1, 1); // $x=1 vert axis&nbsp;</div></li><li><div>                        $res3 = _testIntersect($px1, $py1, $px2, $py2, 0, 0, 1, 0); // $y=0 horiz axis&nbsp;</div></li><li><div>                        $res4 = _testIntersect($px1, $py1, $px2, $py2, 0, 1, 1, 1); // $y=1 horiz axis&nbsp;</div></li><li><div>                        if (!$res1 && !$res2 && !$res3 && !$res4) {&nbsp;</div></li><li><div>                            $inside = false;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $inside = true;&nbsp;</div></li><li><div>                $gp = 0;&nbsp;</div></li><li><div>                while ($inside) {&nbsp;</div></li><li><div>                    $gp++;&nbsp;</div></li><li><div>                    $newarr = array();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $ns; $i++) {&nbsp;</div></li><li><div>                        if ($spread == 'F') { // Reflect&nbsp;</div></li><li><div>                            $newarr[$i] = $gradient_info['color'][($ns - $i - 1)];&nbsp;</div></li><li><div>                            if (($gp % 2) == 1) {&nbsp;</div></li><li><div>                                $tmp = -$gp + (1 - $offs[($ns - $i - 1)]);&nbsp;</div></li><li><div>                                $newarr[$i]['offset'] = $tmp;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $tmp = -$gp + $offs[$i];&nbsp;</div></li><li><div>                                $newarr[$i]['offset'] = $tmp;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else { // Reflect&nbsp;</div></li><li><div>                            $newarr[$i] = $gradient_info['color'][$i];&nbsp;</div></li><li><div>                            $tmp = -$gp + $offs[$i];&nbsp;</div></li><li><div>                            $newarr[$i]['offset'] = $tmp;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // IF STILL INSIDE BOX OR STILL VALID&nbsp;</div></li><li><div>                        // Point on axis to test&nbsp;</div></li><li><div>                        $px1 = $x1 + ($x2 - $x1) * $tmp;&nbsp;</div></li><li><div>                        $py1 = $y1 + ($y2 - $y1) * $tmp;&nbsp;</div></li><li><div>                        // Get perpendicular axis&nbsp;</div></li><li><div>                        $alpha = atan2($y2 - $y1, $x2 - $x1);&nbsp;</div></li><li><div>                        $alpha += M_PI / 2; // rotate 90 degrees&nbsp;</div></li><li><div>                        // Get arbitrary point to define line perpendicular to axis&nbsp;</div></li><li><div>                        $px2 = $px1 + cos($alpha);&nbsp;</div></li><li><div>                        $py2 = $py1 + sin($alpha);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $res1 = _testIntersect($px1, $py1, $px2, $py2, 0, 0, 0, 1); // $x=0 vert axis&nbsp;</div></li><li><div>                        $res2 = _testIntersect($px1, $py1, $px2, $py2, 1, 0, 1, 1); // $x=1 vert axis&nbsp;</div></li><li><div>                        $res3 = _testIntersect($px1, $py1, $px2, $py2, 0, 0, 1, 0); // $y=0 horiz axis&nbsp;</div></li><li><div>                        $res4 = _testIntersect($px1, $py1, $px2, $py2, 0, 1, 1, 1); // $y=1 horiz axis&nbsp;</div></li><li><div>                        if (!$res1 && !$res2 && !$res3 && !$res4) {&nbsp;</div></li><li><div>                            $inside = false;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    for ($i = ($ns - 1); $i &gt;= 0; $i--) {&nbsp;</div></li><li><div>                        if (isset($newarr[$i]['offset']))&nbsp;</div></li><li><div>                            array_unshift($gradient_info['color'], $newarr[$i]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Gradient STOPs&nbsp;</div></li><li><div>            $stops = count($gradient_info['color']);&nbsp;</div></li><li><div>            if ($stops &lt; 2) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $range = $gradient_info['color'][count($gradient_info['color']) - 1]['offset'] - $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $min = $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; ($stops); $i++) {&nbsp;</div></li><li><div>                if (!$gradient_info['color'][$i]['color']) {&nbsp;</div></li><li><div>                    if ($gradient_info['colorspace'] == 'RGB')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '0 0 0';&nbsp;</div></li><li><div>                    else if ($gradient_info['colorspace'] == 'Gray')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '0';&nbsp;</div></li><li><div>                    else if ($gradient_info['colorspace'] == 'CMYK')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '1 1 1 1';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $offset = ($gradient_info['color'][$i]['offset'] - $min) / $range;&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;gradients[$n]['stops'][] = array(&nbsp;</div></li><li><div>                    'col' =&gt; $gradient_info['color'][$i]['color'], &nbsp;</div></li><li><div>                    'opacity' =&gt; $gradient_info['color'][$i]['opacity'], &nbsp;</div></li><li><div>                    'offset' =&gt; $offset);&nbsp;</div></li><li><div>                if ($gradient_info['color'][$i]['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                    $trans = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $grx1 = $x1 + ($x2 - $x1) * $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $gry1 = $y1 + ($y2 - $y1) * $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $grx2 = $x1 + ($x2 - $x1) * $gradient_info['color'][count($gradient_info['color']) - 1]['offset'];&nbsp;</div></li><li><div>            $gry2 = $y1 + ($y2 - $y1) * $gradient_info['color'][count($gradient_info['color']) - 1]['offset'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['coords'] = array($grx1, $gry1, $grx2, $gry2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['colorspace'] = $gradient_info['colorspace'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['type'] = 2;&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['fo'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['extend'] = array('true', 'true');&nbsp;</div></li><li><div>            if ($trans) {&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;gradients[$n]['trans'] = true;&nbsp;</div></li><li><div>                $return .= ' /TGS' . ($n) . ' gs ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $return .= ' /Sh' . ($n) . ' sh ';&nbsp;</div></li><li><div>            $return .= &quot; Q\n&quot;;&nbsp;</div></li><li><div>        } else if ($gradient_info['type'] == 'radial') {&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'userspaceonuse') {&nbsp;</div></li><li><div>                if ($w &gt; $h) {&nbsp;</div></li><li><div>                    $h = $w;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $w = $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['x0'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['x0'] = ($gradient_info['info']['x0'] - $x_offset) / $w;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['y0'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['y0'] = ($gradient_info['info']['y0'] - $y_offset) / $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['x1'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['x1'] = ($gradient_info['info']['x1'] - $x_offset) / $w;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['y1'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['y1'] = ($gradient_info['info']['y1'] - $y_offset) / $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['r'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['rx'] = $gradient_info['info']['r'] / $w;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($gradient_info['info']['r'])) {&nbsp;</div></li><li><div>                    $gradient_info['info']['ry'] = $gradient_info['info']['r'] / $h;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['x0'])) {&nbsp;</div></li><li><div>                $x0 = $gradient_info['info']['x0'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $x0 = 0.5;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['y0'])) {&nbsp;</div></li><li><div>                $y0 = $gradient_info['info']['y0'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $y0 = 0.5;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['rx'])) {&nbsp;</div></li><li><div>                $rx = $gradient_info['info']['rx'];&nbsp;</div></li><li><div>            } else if (isset($gradient_info['info']['r'])) {&nbsp;</div></li><li><div>                $rx = $gradient_info['info']['r'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $rx = 0.5;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['ry'])) {&nbsp;</div></li><li><div>                $ry = $gradient_info['info']['ry'];&nbsp;</div></li><li><div>            } else if (isset($gradient_info['info']['r'])) {&nbsp;</div></li><li><div>                $ry = $gradient_info['info']['r'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $ry = 0.5;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['x1'])) {&nbsp;</div></li><li><div>                $x1 = $gradient_info['info']['x1'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $x1 = $x0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($gradient_info['info']['y1'])) {&nbsp;</div></li><li><div>                $y1 = $gradient_info['info']['y1'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $y1 = $y0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (stristr($x1, '%') !== false) {&nbsp;</div></li><li><div>                $x1 = ($x1 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($x0, '%') !== false) {&nbsp;</div></li><li><div>                $x0 = ($x0 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($y1, '%') !== false) {&nbsp;</div></li><li><div>                $y1 = ($y1 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($y0, '%') !== false) {&nbsp;</div></li><li><div>                $y0 = ($y0 + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($rx, '%') !== false) {&nbsp;</div></li><li><div>                $rx = ($rx + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (stristr($ry, '%') !== false) {&nbsp;</div></li><li><div>                $ry = ($ry + 0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $bboxw = $w;&nbsp;</div></li><li><div>            $bboxh = $h;&nbsp;</div></li><li><div>            $usex = $x_offset;&nbsp;</div></li><li><div>            $usey = $y_offset;&nbsp;</div></li><li><div>            $usew = $bboxw;&nbsp;</div></li><li><div>            $useh = $bboxh;&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'userspaceonuse') {&nbsp;</div></li><li><div>                $angle = rad2deg(atan2(($gradient_info['info']['y0'] - $gradient_info['info']['y1']), ($gradient_info['info']['x0'] - $gradient_info['info']['x1'])));&nbsp;</div></li><li><div>                if ($angle &lt; 0) {&nbsp;</div></li><li><div>                    $angle += 360;&nbsp;</div></li><li><div>                } else if ($angle &gt; 360) {&nbsp;</div></li><li><div>                    $angle -= 360;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($angle != 0 && $angle != 360 && $angle != 90 && $angle != 180 && $angle != 270) {&nbsp;</div></li><li><div>                    if ($w &gt;= $h) {&nbsp;</div></li><li><div>                        $y1 *= $h / $w;&nbsp;</div></li><li><div>                        $y0 *= $h / $w;&nbsp;</div></li><li><div>                        $rx *= $h / $w;&nbsp;</div></li><li><div>                        $ry *= $h / $w;&nbsp;</div></li><li><div>                        $usew = $useh = $bboxw;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $x1 *= $w / $h;&nbsp;</div></li><li><div>                        $x0 *= $w / $h;&nbsp;</div></li><li><div>                        $rx *= $w / $h;&nbsp;</div></li><li><div>                        $ry *= $w / $h;&nbsp;</div></li><li><div>                        $usew = $useh = $bboxh;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $a = $usew;  // width&nbsp;</div></li><li><div>            $d = -$useh; // height&nbsp;</div></li><li><div>            $e = $usex;  // x- offset&nbsp;</div></li><li><div>            $f = -$usey; // -y-offset&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $r = $rx;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $return .= sprintf('%.3F 0 0 %.3F %.3F %.3F cm ', $a * $this-&gt;kp, $d * $this-&gt;kp, $e * $this-&gt;kp, $f * $this-&gt;kp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.0.039&nbsp;</div></li><li><div>            if (isset($gradient_info['units']) && strtolower($gradient_info['units']) == 'objectboundingbox') {&nbsp;</div></li><li><div>                if ($transformations) {&nbsp;</div></li><li><div>                    $return .= $transformations;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.7.4&nbsp;</div></li><li><div>            // x1 and y1 (fx, fy) should be inside the circle defined by x0 y0 (cx, cy)&nbsp;</div></li><li><div>            // &quot;If the point defined by fx and fy lies outside the circle defined by cx, cy and r, then the user agent shall set&nbsp;</div></li><li><div>            // the focal point to the intersection of the line from (cx, cy) to (fx, fy) with the circle defined by cx, cy and r.&quot;&nbsp;</div></li><li><div>            while (pow(($x1 - $x0), 2) + pow(($y1 - $y0), 2) &gt;= pow($r, 2)) {&nbsp;</div></li><li><div>                // Gradually move along fx, fy towards cx, cy in 100'ths until meets criteria&nbsp;</div></li><li><div>                $x1 -= ($x1 - $x0) / 100;&nbsp;</div></li><li><div>                $y1 -= ($y1 - $y0) / 100;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($spread == 'R' || $spread == 'F') { // Repeat  /  Reflect&nbsp;</div></li><li><div>                $offs = array();&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ns; $i++) {&nbsp;</div></li><li><div>                    $offs[$i] = $gradient_info['color'][$i]['offset'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $gp = 0;&nbsp;</div></li><li><div>                $inside = true;&nbsp;</div></li><li><div>                while ($inside) {&nbsp;</div></li><li><div>                    $gp++;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $ns; $i++) {&nbsp;</div></li><li><div>                        if ($spread == 'F' && ($gp % 2) == 1) { // Reflect&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)] = $gradient_info['color'][(($ns * ($gp - 1)) + ($ns - $i - 1))];&nbsp;</div></li><li><div>                            $tmp = $gp + (1 - $offs[($ns - $i - 1)]);&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)]['offset'] = $tmp;&nbsp;</div></li><li><div>                        } else { // Reflect&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)] = $gradient_info['color'][$i];&nbsp;</div></li><li><div>                            $tmp = $gp + $offs[$i];&nbsp;</div></li><li><div>                            $gradient_info['color'][(($ns * $gp) + $i)]['offset'] = $tmp;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // IF STILL INSIDE BOX OR STILL VALID&nbsp;</div></li><li><div>                        // TEST IF circle (perimeter) intersects with&nbsp;</div></li><li><div>                        // or is enclosed&nbsp;</div></li><li><div>                        // Point on axis to test&nbsp;</div></li><li><div>                        $px = $x1 + ($x0 - $x1) * $tmp;&nbsp;</div></li><li><div>                        $py = $y1 + ($y0 - $y1) * $tmp;&nbsp;</div></li><li><div>                        $pr = $r * $tmp;&nbsp;</div></li><li><div>                        $res = _testIntersectCircle($px, $py, $pr);&nbsp;</div></li><li><div>                        if (!$res) {&nbsp;</div></li><li><div>                            $inside = false;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Gradient STOPs&nbsp;</div></li><li><div>            $stops = count($gradient_info['color']);&nbsp;</div></li><li><div>            if ($stops &lt; 2) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $range = $gradient_info['color'][count($gradient_info['color']) - 1]['offset'] - $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $min = $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; ($stops); $i++) {&nbsp;</div></li><li><div>                if (!$gradient_info['color'][$i]['color']) {&nbsp;</div></li><li><div>                    if ($gradient_info['colorspace'] == 'RGB')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '0 0 0';&nbsp;</div></li><li><div>                    else if ($gradient_info['colorspace'] == 'Gray')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '0';&nbsp;</div></li><li><div>                    else if ($gradient_info['colorspace'] == 'CMYK')&nbsp;</div></li><li><div>                        $gradient_info['color'][$i]['color'] = '1 1 1 1';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $offset = ($gradient_info['color'][$i]['offset'] - $min) / $range;&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;gradients[$n]['stops'][] = array(&nbsp;</div></li><li><div>                    'col' =&gt; $gradient_info['color'][$i]['color'], &nbsp;</div></li><li><div>                    'opacity' =&gt; $gradient_info['color'][$i]['opacity'], &nbsp;</div></li><li><div>                    'offset' =&gt; $offset);&nbsp;</div></li><li><div>                if ($gradient_info['color'][$i]['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                    $trans = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $grx1 = $x1 + ($x0 - $x1) * $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $gry1 = $y1 + ($y0 - $y1) * $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $grx2 = $x1 + ($x0 - $x1) * $gradient_info['color'][count($gradient_info['color']) - 1]['offset'];&nbsp;</div></li><li><div>            $gry2 = $y1 + ($y0 - $y1) * $gradient_info['color'][count($gradient_info['color']) - 1]['offset'];&nbsp;</div></li><li><div>            $grir = $r * $gradient_info['color'][0]['offset'];&nbsp;</div></li><li><div>            $grr = $r * $gradient_info['color'][count($gradient_info['color']) - 1]['offset'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['coords'] = array($grx1, $gry1, $grx2, $gry2, abs($grr), abs($grir));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['colorspace'] = $gradient_info['colorspace'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['type'] = 3;&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['fo'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;gradients[$n]['extend'] = array('true', 'true');&nbsp;</div></li><li><div>            if (isset($trans) && $trans) {&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;gradients[$n]['trans'] = true;&nbsp;</div></li><li><div>                $return .= ' /TGS' . ($n) . ' gs ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $return .= ' /Sh' . ($n) . ' sh ';&nbsp;</div></li><li><div>            $return .= &quot; Q\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function svgOffset($attribs)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // save all &lt;svg&gt; tag attributes&nbsp;</div></li><li><div>        $this-&gt;svg_attribs = $attribs;&nbsp;</div></li><li><div>        if (isset($this-&gt;svg_attribs['viewBox'])) {&nbsp;</div></li><li><div>            $vb = preg_split('/\s+/is', trim($this-&gt;svg_attribs['viewBox']));&nbsp;</div></li><li><div>            if (count($vb) == 4) {&nbsp;</div></li><li><div>                $this-&gt;svg_info['x'] = $vb[0];&nbsp;</div></li><li><div>                $this-&gt;svg_info['y'] = $vb[1];&nbsp;</div></li><li><div>                $this-&gt;svg_info['w'] = $vb[2];&nbsp;</div></li><li><div>                $this-&gt;svg_info['h'] = $vb[3];&nbsp;</div></li><li><div>//                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $svg_w = 0;&nbsp;</div></li><li><div>        $svg_h = 0;&nbsp;</div></li><li><div>        if (isset($attribs['width']) && $attribs['width'])&nbsp;</div></li><li><div>            $svg_w = $this-&gt;mpdf_ref-&gt;ConvertSize($attribs['width']); // mm (interprets numbers as pixels)&nbsp;</div></li><li><div>        if (isset($attribs['height']) && $attribs['height'])&nbsp;</div></li><li><div>            $svg_h = $this-&gt;mpdf_ref-&gt;ConvertSize($attribs['height']); // mm&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>///*&nbsp;</div></li><li><div>        // mPDF 5.0.005&nbsp;</div></li><li><div>        if (isset($this-&gt;svg_info['w']) && $this-&gt;svg_info['w']) { // if 'w' set by viewBox&nbsp;</div></li><li><div>            if ($svg_w) { // if width also set, use these values to determine to set size of &quot;pixel&quot;&nbsp;</div></li><li><div>                $this-&gt;kp *= ($svg_w / 0.2645) / $this-&gt;svg_info['w'];&nbsp;</div></li><li><div>                $this-&gt;kf = ($svg_w / 0.2645) / $this-&gt;svg_info['w'];&nbsp;</div></li><li><div>            } else if ($svg_h) {&nbsp;</div></li><li><div>                $this-&gt;kp *= ($svg_h / 0.2645) / $this-&gt;svg_info['h'];&nbsp;</div></li><li><div>                $this-&gt;kf = ($svg_h / 0.2645) / $this-&gt;svg_info['h'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>//*/&nbsp;</div></li><li><div>        // Added to handle file without height or width specified&nbsp;</div></li><li><div>        if (!$svg_w && !$svg_h) {&nbsp;</div></li><li><div>            $svg_w = $svg_h = $this-&gt;mpdf_ref-&gt;blk[$this-&gt;mpdf_ref-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>        } // DEFAULT&nbsp;</div></li><li><div>        if (!$svg_w) {&nbsp;</div></li><li><div>            $svg_w = $svg_h;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!$svg_h) {&nbsp;</div></li><li><div>            $svg_h = $svg_w;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_info['x'] = 0;&nbsp;</div></li><li><div>        $this-&gt;svg_info['y'] = 0;&nbsp;</div></li><li><div>        $this-&gt;svg_info['w'] = $svg_w / 0.2645; // mm-&gt;pixels&nbsp;</div></li><li><div>        $this-&gt;svg_info['h'] = $svg_h / 0.2645; // mm-&gt;pixels&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    // check if points are within svg, if not, set to max&nbsp;</div></li><li><div>    function svg_overflow($x, $y)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $x2 = $x;&nbsp;</div></li><li><div>        $y2 = $y;&nbsp;</div></li><li><div>        if (isset($this-&gt;svg_attribs['overflow'])) {&nbsp;</div></li><li><div>            if ($this-&gt;svg_attribs['overflow'] == 'hidden') {&nbsp;</div></li><li><div>                // Not sure if this is supposed to strip off units, but since I dont use any I will omlt this step&nbsp;</div></li><li><div>                $svg_w = preg_replace(&quot;/([0-9\.]*)(.*)/i&quot;, &quot;$1&quot;, $this-&gt;svg_attribs['width']);&nbsp;</div></li><li><div>                $svg_h = preg_replace(&quot;/([0-9\.]*)(.*)/i&quot;, &quot;$1&quot;, $this-&gt;svg_attribs['height']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // $xmax = floor($this-&gt;svg_attribs['width']);&nbsp;</div></li><li><div>                $xmax = floor($svg_w);&nbsp;</div></li><li><div>                $xmin = 0;&nbsp;</div></li><li><div>                // $ymax = floor(($this-&gt;svg_attribs['height'] * -1));&nbsp;</div></li><li><div>                $ymax = floor(($svg_h * -1));&nbsp;</div></li><li><div>                $ymin = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($x &gt; $xmax)&nbsp;</div></li><li><div>                    $x2 = $xmax; // right edge&nbsp;</div></li><li><div>                if ($x &lt; $xmin)&nbsp;</div></li><li><div>                    $x2 = $xmin; // left edge&nbsp;</div></li><li><div>                if ($y &lt; $ymax)&nbsp;</div></li><li><div>                    $y2 = $ymax; // bottom&nbsp;</div></li><li><div>                if ($y &gt; $ymin)&nbsp;</div></li><li><div>                    $y2 = $ymin; // top&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array('x' =&gt; $x2, 'y' =&gt; $y2);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function svgDefineStyle($critere_style)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tmp = count($this-&gt;svg_style) - 1;&nbsp;</div></li><li><div>        $current_style = $this-&gt;svg_style[$tmp];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset($current_style['transformations']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TRANSFORM SCALE&nbsp;</div></li><li><div>        $transformations = '';&nbsp;</div></li><li><div>        if (isset($critere_style['transform'])) {&nbsp;</div></li><li><div>            preg_match_all('/(matrix|translate|scale|rotate|skewX|skewY)\((.*?)\)/is', $critere_style['transform'], $m);&nbsp;</div></li><li><div>            if (count($m[0])) {&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; count($m[0]); $i++) {&nbsp;</div></li><li><div>                    $c = strtolower($m[1][$i]);&nbsp;</div></li><li><div>                    $v = trim($m[2][$i]);&nbsp;</div></li><li><div>                    $vv = preg_split('/[ , ]+/', $v);&nbsp;</div></li><li><div>                    if ($c == 'matrix' && count($vv) == 6) {&nbsp;</div></li><li><div>                        // mPDF 5.0.039&nbsp;</div></li><li><div>                        // Note angle of rotation is reversed (from SVG to PDF), so vv[1] and vv[2] are negated&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F %.3F %.3F %.3F %.3F %.3F cm ', $vv[0], -$vv[1], -$vv[2], $vv[3], $vv[4] * $this-&gt;kp, -$vv[5] * $this-&gt;kp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        /**&nbsp;</div></li><li><div>                          // The long way of doing this??&nbsp;</div></li><li><div>                          // need to reverse angle of rotation from SVG to PDF&nbsp;</div></li><li><div>                          $sx=sqrt(pow($vv[0], 2)+pow($vv[2], 2));&nbsp;</div></li><li><div>                          if ($vv[0] &lt; 0) { $sx *= -1; } // change sign&nbsp;</div></li><li><div>                          $sy=sqrt(pow($vv[1], 2)+pow($vv[3], 2));&nbsp;</div></li><li><div>                          if ($vv[3] &lt; 0) { $sy *= -1; } // change sign&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                          // rotation angle is&nbsp;</div></li><li><div>                          $t=atan2($vv[1], $vv[3]);&nbsp;</div></li><li><div>                          $t=atan2(-$vv[2], $vv[0]);    // Should be the same value or skew has been applied&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                          // Reverse angle&nbsp;</div></li><li><div>                          $t *= -1;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                          // Rebuild matrix&nbsp;</div></li><li><div>                          $ma = $sx * cos($t);&nbsp;</div></li><li><div>                          $mb = $sy * sin($t);&nbsp;</div></li><li><div>                          $mc = -$sx * sin($t);&nbsp;</div></li><li><div>                          $md = $sy * cos($t);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                          // $transformations .= sprintf(' %.3F %.3F %.3F %.3F %.3F %.3F cm ', $ma, $mb, $mc, $md, $vv[4]*$this-&gt;kp, -$vv[5]*$this-&gt;kp);&nbsp;</div></li><li><div>                         */&nbsp;</div></li><li><div>                    } else if ($c == 'translate' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[4] = $vv[0];&nbsp;</div></li><li><div>                        if (count($vv) == 2) {&nbsp;</div></li><li><div>                            $t_y = -$vv[1];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $t_y = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $tm[5] = $t_y;&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', $tm[4] * $this-&gt;kp, $tm[5] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else if ($c == 'scale' && count($vv)) {&nbsp;</div></li><li><div>                        if (count($vv) == 2) {&nbsp;</div></li><li><div>                            $s_y = $vv[1];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $s_y = $vv[0];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $tm[0] = $vv[0];&nbsp;</div></li><li><div>                        $tm[3] = $s_y;&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F 0 0 %.3F 0 0 cm ', $tm[0], $tm[3]);&nbsp;</div></li><li><div>                    } else if ($c == 'rotate' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[0] = cos(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $tm[1] = sin(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $tm[2] = -$tm[1];&nbsp;</div></li><li><div>                        $tm[3] = $tm[0];&nbsp;</div></li><li><div>                        if (count($vv) == 3) {&nbsp;</div></li><li><div>                            $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', $vv[1] * $this-&gt;kp, -$vv[2] * $this-&gt;kp);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $transformations .= sprintf(' %.3F %.3F %.3F %.3F 0 0 cm ', $tm[0], $tm[1], $tm[2], $tm[3]);&nbsp;</div></li><li><div>                        if (count($vv) == 3) {&nbsp;</div></li><li><div>                            $transformations .= sprintf(' 1 0 0 1 %.3F %.3F cm ', -$vv[1] * $this-&gt;kp, $vv[2] * $this-&gt;kp);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else if ($c == 'skewx' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[2] = tan(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 0 %.3F 1 0 0 cm ', $tm[2]);&nbsp;</div></li><li><div>                    } else if ($c == 'skewy' && count($vv)) {&nbsp;</div></li><li><div>                        $tm[1] = tan(deg2rad(-$vv[0]));&nbsp;</div></li><li><div>                        $transformations .= sprintf(' 1 %.3F 0 1 0 0 cm ', $tm[1]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $current_style['transformations'] = $transformations;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['style'])) {&nbsp;</div></li><li><div>            if (preg_match('/fill:\s*rgb\((\d+), \s*(\d+), \s*(\d+)\)/i', $critere_style['style'], $m)) { // mPDF 5.7.2&nbsp;</div></li><li><div>                $current_style['fill'] = '#' . str_pad(dechex($m[1]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[2]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[3]), 2, &quot;0&quot;, STR_PAD_LEFT);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = preg_replace(&quot;/(.*)fill:\s*([a-z0-9#_()]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>                if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                    $current_style['fill'] = $tmp;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.7.2&nbsp;</div></li><li><div>            if ((preg_match(&quot;/[^-]opacity:\s*([a-z0-9.]*|none)/i&quot;, $critere_style['style'], $m) ||&nbsp;</div></li><li><div>                preg_match(&quot;/^opacity:\s*([a-z0-9.]*|none)/i&quot;, $critere_style['style'], $m)) && $m[1] != 'inherit') {&nbsp;</div></li><li><div>                $current_style['fill-opacity'] = $m[1];&nbsp;</div></li><li><div>                $current_style['stroke-opacity'] = $m[1];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)fill-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['fill-opacity'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)fill-rule:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['fill-rule'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (preg_match('/stroke:\s*rgb\((\d+), \s*(\d+), \s*(\d+)\)/', $critere_style['style'], $m)) {&nbsp;</div></li><li><div>                $current_style['stroke'] = '#' . str_pad(dechex($m[1]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[2]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[3]), 2, &quot;0&quot;, STR_PAD_LEFT);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = preg_replace(&quot;/(.*)stroke:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>                if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                    $current_style['stroke'] = $tmp;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-linecap:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-linecap'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-linejoin:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-linejoin'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-miterlimit:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-miterlimit'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-opacity'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-width:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-width'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-dasharray:\s*([a-z0-9., ]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-dasharray'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-dashoffset:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-dashoffset'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // mPDF 5.7.2&nbsp;</div></li><li><div>        if (isset($critere_style['opacity']) && $critere_style['opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill-opacity'] = $critere_style['opacity'];&nbsp;</div></li><li><div>            $current_style['stroke-opacity'] = $critere_style['opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['fill']) && $critere_style['fill'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill'] = $critere_style['fill'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['fill-opacity']) && $critere_style['fill-opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill-opacity'] = $critere_style['fill-opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['fill-rule']) && $critere_style['fill-rule'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill-rule'] = $critere_style['fill-rule'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke']) && $critere_style['stroke'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke'] = $critere_style['stroke'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-linecap']) && $critere_style['stroke-linecap'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-linecap'] = $critere_style['stroke-linecap'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-linejoin']) && $critere_style['stroke-linejoin'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-linejoin'] = $critere_style['stroke-linejoin'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-miterlimit']) && $critere_style['stroke-miterlimit'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-miterlimit'] = $critere_style['stroke-miterlimit'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-opacity']) && $critere_style['stroke-opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-opacity'] = $critere_style['stroke-opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-width']) && $critere_style['stroke-width'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-width'] = $critere_style['stroke-width'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-dasharray']) && $critere_style['stroke-dasharray'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-dasharray'] = $critere_style['stroke-dasharray'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-dashoffset']) && $critere_style['stroke-dashoffset'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-dashoffset'] = $critere_style['stroke-dashoffset'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Used as indirect setting for currentColor&nbsp;</div></li><li><div>        if (isset($critere_style['color']) && $critere_style['color'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['color'] = $critere_style['color'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $current_style;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    Cette fonction ecrit le style dans le stream svg.&nbsp;</div></li><li><div>    function svgStyle($critere_style, $attribs, $element)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $path_style = '';&nbsp;</div></li><li><div>        $fill_gradient = '';&nbsp;</div></li><li><div>        $w = '';&nbsp;</div></li><li><div>        $style = '';&nbsp;</div></li><li><div>        if (substr_count($critere_style['fill'], 'url') &gt; 0 && $element != 'line') {&nbsp;</div></li><li><div>            //&nbsp;</div></li><li><div>            // couleur degrad&nbsp;</div></li><li><div>            $id_gradient = preg_replace(&quot;/url\(#([\w_]*)\)/i&quot;, &quot;$1&quot;, $critere_style['fill']);&nbsp;</div></li><li><div>            if ($id_gradient != $critere_style['fill']) {&nbsp;</div></li><li><div>                if (isset($this-&gt;svg_gradient[$id_gradient])) {&nbsp;</div></li><li><div>                    $fill_gradient = $this-&gt;svgGradient($this-&gt;svg_gradient[$id_gradient], $attribs, $element);&nbsp;</div></li><li><div>                    if ($fill_gradient) {&nbsp;</div></li><li><div>                        $path_style = &quot;q &quot;;&nbsp;</div></li><li><div>                        $w = &quot;W&quot;;&nbsp;</div></li><li><div>                        $style .= 'N';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Used as indirect setting for currentColor&nbsp;</div></li><li><div>        else if (strtolower($critere_style['fill']) == 'currentcolor' && $element != 'line') {&nbsp;</div></li><li><div>            $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style['color']);&nbsp;</div></li><li><div>            if ($col) {&nbsp;</div></li><li><div>                if ($col{0} == 5) {&nbsp;</div></li><li><div>                    $critere_style['fill-opacity'] = ord($col{4} / 100);&nbsp;</div></li><li><div>                } // RGBa&nbsp;</div></li><li><div>                if ($col{0} == 6) {&nbsp;</div></li><li><div>                    $critere_style['fill-opacity'] = ord($col{5} / 100);&nbsp;</div></li><li><div>                } // CMYKa&nbsp;</div></li><li><div>                $path_style .= $this-&gt;mpdf_ref-&gt;SetFColor($col, true) . ' ';&nbsp;</div></li><li><div>                $style .= 'F';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if ($critere_style['fill'] != 'none' && $element != 'line') {&nbsp;</div></li><li><div>            $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style['fill']);&nbsp;</div></li><li><div>            if ($col) {&nbsp;</div></li><li><div>                if ($col{0} == 5) {&nbsp;</div></li><li><div>                    $critere_style['fill-opacity'] = ord($col{4} / 100);&nbsp;</div></li><li><div>                } // RGBa&nbsp;</div></li><li><div>                if ($col{0} == 6) {&nbsp;</div></li><li><div>                    $critere_style['fill-opacity'] = ord($col{5} / 100);&nbsp;</div></li><li><div>                } // CMYKa&nbsp;</div></li><li><div>                $path_style .= $this-&gt;mpdf_ref-&gt;SetFColor($col, true) . ' ';&nbsp;</div></li><li><div>                $style .= 'F';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (substr_count($critere_style['stroke'], 'url') &gt; 0) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>              // Cannot put a gradient on a &quot;stroke&quot; in PDF?&nbsp;</div></li><li><div>              $id_gradient = preg_replace(&quot;/url\(#([\w_]*)\)/i&quot;, &quot;$1&quot;, $critere_style['stroke']);&nbsp;</div></li><li><div>              if ($id_gradient != $critere_style['stroke']) {&nbsp;</div></li><li><div>              if (isset($this-&gt;svg_gradient[$id_gradient])) {&nbsp;</div></li><li><div>              $fill_gradient = $this-&gt;svgGradient($this-&gt;svg_gradient[$id_gradient], $attribs, $element);&nbsp;</div></li><li><div>              if ($fill_gradient) {&nbsp;</div></li><li><div>              $path_style = &quot;q &quot;;&nbsp;</div></li><li><div>              $w = &quot;W&quot;;&nbsp;</div></li><li><div>              $style .= 'D';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Used as indirect setting for currentColor&nbsp;</div></li><li><div>        else if (strtolower($critere_style['stroke']) == 'currentcolor') {&nbsp;</div></li><li><div>            $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style['color']);&nbsp;</div></li><li><div>            if ($col) {&nbsp;</div></li><li><div>                if ($col{0} == 5) {&nbsp;</div></li><li><div>                    $critere_style['stroke-opacity'] = ord($col{4} / 100);&nbsp;</div></li><li><div>                } // RGBa&nbsp;</div></li><li><div>                if ($col{0} == 6) {&nbsp;</div></li><li><div>                    $critere_style['stroke-opacity'] = ord($col{5} / 100);&nbsp;</div></li><li><div>                } // CMYKa&nbsp;</div></li><li><div>                $path_style .= $this-&gt;mpdf_ref-&gt;SetDColor($col, true) . ' ';&nbsp;</div></li><li><div>                $style .= 'D';&nbsp;</div></li><li><div>                $lw = $this-&gt;ConvertSVGSizePixels($critere_style['stroke-width']);&nbsp;</div></li><li><div>                $path_style .= sprintf('%.3F w ', $lw * $this-&gt;kp);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if ($critere_style['stroke'] != 'none') {&nbsp;</div></li><li><div>            $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style['stroke']);&nbsp;</div></li><li><div>            if ($col) {&nbsp;</div></li><li><div>                // mPDF 5.0.051&nbsp;</div></li><li><div>                // mPDF 5.3.74&nbsp;</div></li><li><div>                if ($col{0} == 5) {&nbsp;</div></li><li><div>                    $critere_style['stroke-opacity'] = ord($col{4} / 100);&nbsp;</div></li><li><div>                } // RGBa&nbsp;</div></li><li><div>                if ($col{0} == 6) {&nbsp;</div></li><li><div>                    $critere_style['stroke-opacity'] = ord($col{5} / 100);&nbsp;</div></li><li><div>                } // CMYKa&nbsp;</div></li><li><div>                $path_style .= $this-&gt;mpdf_ref-&gt;SetDColor($col, true) . ' ';&nbsp;</div></li><li><div>                $style .= 'D';&nbsp;</div></li><li><div>                $lw = $this-&gt;ConvertSVGSizePixels($critere_style['stroke-width']);&nbsp;</div></li><li><div>                $path_style .= sprintf('%.3F w ', $lw * $this-&gt;kp);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($critere_style['stroke'] != 'none') {&nbsp;</div></li><li><div>            if ($critere_style['stroke-linejoin'] == 'miter') {&nbsp;</div></li><li><div>                $path_style .= ' 0 j ';&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-linejoin'] == 'round') {&nbsp;</div></li><li><div>                $path_style .= ' 1 j ';&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-linejoin'] == 'bevel') {&nbsp;</div></li><li><div>                $path_style .= ' 2 j ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($critere_style['stroke-linecap'] == 'butt') {&nbsp;</div></li><li><div>                $path_style .= ' 0 J ';&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-linecap'] == 'round') {&nbsp;</div></li><li><div>                $path_style .= ' 1 J ';&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-linecap'] == 'square') {&nbsp;</div></li><li><div>                $path_style .= ' 2 J ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($critere_style['stroke-miterlimit'])) {&nbsp;</div></li><li><div>                if ($critere_style['stroke-miterlimit'] == 'none') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                } else if (preg_match('/^[\d.]+$/', $critere_style['stroke-miterlimit'])) {&nbsp;</div></li><li><div>                    $path_style .= sprintf('%.2F M ', $critere_style['stroke-miterlimit']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($critere_style['stroke-dasharray'])) {&nbsp;</div></li><li><div>                $off = 0;&nbsp;</div></li><li><div>                $d = preg_split('/[ , ]/', $critere_style['stroke-dasharray']);&nbsp;</div></li><li><div>                if (count($d) == 1 && $d[0] == 0) {&nbsp;</div></li><li><div>                    $path_style .= '[] 0 d ';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if (count($d) % 2 == 1) {&nbsp;</div></li><li><div>                        $d = array_merge($d, $d);&nbsp;</div></li><li><div>                    } // 5, 3, 1 =&gt; 5, 3, 1, 5, 3, 1  OR 3 =&gt; 3, 3&nbsp;</div></li><li><div>                    $arr = '';&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; count($d); $i+=2) {&nbsp;</div></li><li><div>                        $arr .= sprintf('%.3F %.3F ', $d[$i] * $this-&gt;kp, $d[$i + 1] * $this-&gt;kp);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (isset($critere_style['stroke-dashoffset'])) {&nbsp;</div></li><li><div>                        $off = $critere_style['stroke-dashoffset'] + 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $path_style .= sprintf('[%s] %.3F d ', $arr, $off * $this-&gt;kp);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($critere_style['fill-rule'] == 'evenodd') {&nbsp;</div></li><li><div>            $fr = '*';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $fr = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['fill-opacity'])) {&nbsp;</div></li><li><div>            $opacity = 1;&nbsp;</div></li><li><div>            if ($critere_style['fill-opacity'] == 0) {&nbsp;</div></li><li><div>                $opacity = 0;&nbsp;</div></li><li><div>            } else if ($critere_style['fill-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                $opacity = 1;&nbsp;</div></li><li><div>            } else if ($critere_style['fill-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                $opacity = $critere_style['fill-opacity'];&nbsp;</div></li><li><div>            } else if ($critere_style['fill-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                $opacity = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array('ca' =&gt; $opacity, 'BM' =&gt; '/Normal'));&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;extgstates[$gs]['fo'] = true;&nbsp;</div></li><li><div>            $path_style .= sprintf(' /GS%d gs ', $gs);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-opacity'])) {&nbsp;</div></li><li><div>            $opacity = 1;&nbsp;</div></li><li><div>            if ($critere_style['stroke-opacity'] == 0) {&nbsp;</div></li><li><div>                $opacity = 0;&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                $opacity = 1;&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                $opacity = $critere_style['stroke-opacity'];&nbsp;</div></li><li><div>            } else if ($critere_style['stroke-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                $opacity = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array('CA' =&gt; $opacity, 'BM' =&gt; '/Normal'));&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;extgstates[$gs]['fo'] = true;&nbsp;</div></li><li><div>            $path_style .= sprintf(' /GS%d gs ', $gs);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ($style) {&nbsp;</div></li><li><div>            case 'F':&nbsp;</div></li><li><div>                $op = 'f';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'FD':&nbsp;</div></li><li><div>                $op = 'B';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'ND':&nbsp;</div></li><li><div>                $op = 'S';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'D':&nbsp;</div></li><li><div>                $op = 'S';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                $op = 'n';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $prestyle = $path_style . ' ';&nbsp;</div></li><li><div>        $poststyle = $w . ' ' . $op . $fr . ' ' . $fill_gradient . &quot;\n&quot;;&nbsp;</div></li><li><div>        return array($prestyle, $poststyle);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //    fonction retracant les &lt;path /&gt;&nbsp;</div></li><li><div>    function svgPath($command, $arguments)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $path_cmd = '';&nbsp;</div></li><li><div>        $newsubpath = false;&nbsp;</div></li><li><div>        // mPDF 5.0.039&nbsp;</div></li><li><div>        $minl = $this-&gt;pathBBox[0];&nbsp;</div></li><li><div>        $mint = $this-&gt;pathBBox[1];&nbsp;</div></li><li><div>        $maxr = $this-&gt;pathBBox[2] + $this-&gt;pathBBox[0];&nbsp;</div></li><li><div>        $maxb = $this-&gt;pathBBox[3] + $this-&gt;pathBBox[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $start = array($this-&gt;xbase, -$this-&gt;ybase);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        preg_match_all('/[\-^]?[\d.]+(e[\-]?[\d]+) {0, 1}/i', $arguments, $a, PREG_SET_ORDER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //    if the command is a capital letter, the coords go absolute, otherwise relative&nbsp;</div></li><li><div>        if (strtolower($command) == $command)&nbsp;</div></li><li><div>            $relative = true;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $relative = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ile_argumentow = count($a);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //    each command may have different needs for arguments [1 to 8]&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch (strtolower($command)) {&nbsp;</div></li><li><div>            case 'm': // move&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i+=2) {&nbsp;</div></li><li><div>                    $x = $a[$i][0];&nbsp;</div></li><li><div>                    $y = $a[$i + 1][0];&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>                    $minl = min($minl, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $mint = min($mint, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $maxb = max($maxb, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    if ($i == 0)&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F m ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                    // mPDF 4.4.003  Save start points of subpath&nbsp;</div></li><li><div>                    if ($this-&gt;subPathInit) {&nbsp;</div></li><li><div>                        $this-&gt;spxstart = $this-&gt;xbase;&nbsp;</div></li><li><div>                        $this-&gt;spystart = $this-&gt;ybase;&nbsp;</div></li><li><div>                        $this-&gt;subPathInit = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'l': // a simple line&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i+=2) {&nbsp;</div></li><li><div>                    $x = ($a[$i][0]);&nbsp;</div></li><li><div>                    $y = ($a[$i + 1][0]);&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>                    $minl = min($minl, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $mint = min($mint, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $maxb = max($maxb, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'h': // a very simple horizontal line&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i++) {&nbsp;</div></li><li><div>                    $x = ($a[$i][0]);&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $y = 0;&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $y = -$this-&gt;ybase;&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>                    $minl = min($minl, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $mint = min($mint, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $maxb = max($maxb, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'v': // the simplest line, vertical&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i++) {&nbsp;</div></li><li><div>                    $y = ($a[$i][0]);&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $x = 0;&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $x = $this-&gt;xbase;&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>                    $minl = min($minl, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $pdf_pt['x']);&nbsp;</div></li><li><div>                    $mint = min($mint, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $maxb = max($maxb, -$pdf_pt['y']);&nbsp;</div></li><li><div>                    $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 's': // bezier with first vertex equal first control&nbsp;</div></li><li><div>                // mPDF 4.4.003&nbsp;</div></li><li><div>                if (!($this-&gt;lastcommand == 'C' || $this-&gt;lastcommand == 'c' || $this-&gt;lastcommand == 'S' || $this-&gt;lastcommand == 's')) {&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(0, 0);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i += 4) {&nbsp;</div></li><li><div>                    $x1 = $this-&gt;lastcontrolpoints[0];&nbsp;</div></li><li><div>                    $y1 = $this-&gt;lastcontrolpoints[1];&nbsp;</div></li><li><div>                    $x2 = ($a[$i][0]);&nbsp;</div></li><li><div>                    $y2 = ($a[$i + 1][0]);&nbsp;</div></li><li><div>                    $x = ($a[$i + 2][0]);&nbsp;</div></li><li><div>                    $y = ($a[$i + 3][0]);&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + $x1);&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - $y1);&nbsp;</div></li><li><div>                        $pdfx2 = ($this-&gt;xbase + $x2);&nbsp;</div></li><li><div>                        $pdfy2 = ($this-&gt;ybase - $y2);&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx1 = $this-&gt;xbase + $x1;&nbsp;</div></li><li><div>                        $pdfy1 = $this-&gt;ybase - $y1;&nbsp;</div></li><li><div>                        $pdfx2 = $x2;&nbsp;</div></li><li><div>                        $pdfy2 = -$y2;&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(($pdfx - $pdfx2), -($pdfy - $pdfy2)); // mPDF 4.4.003 always relative&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $curves = array($pdfx1, -$pdfy1, $pdfx2, -$pdfy2, $pdfx, -$pdfy);&nbsp;</div></li><li><div>                    $bx = calc_bezier_bbox($start, $curves);&nbsp;</div></li><li><div>                    $minl = min($minl, $bx[0]);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $bx[2]);&nbsp;</div></li><li><div>                    $mint = min($mint, $bx[1]);&nbsp;</div></li><li><div>                    $maxb = max($maxb, $bx[3]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (($pdf_pt['x'] != $pdfx) || ($pdf_pt['y'] != $pdfy)) {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $pdfx1 * $this-&gt;kp, $pdfy1 * $this-&gt;kp, $pdfx2 * $this-&gt;kp, $pdfy2 * $this-&gt;kp, $pdfx * $this-&gt;kp, $pdfy * $this-&gt;kp);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'c': // bezier with second vertex equal second control&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i += 6) {&nbsp;</div></li><li><div>                    $x1 = ($a[$i][0]);&nbsp;</div></li><li><div>                    $y1 = ($a[$i + 1][0]);&nbsp;</div></li><li><div>                    $x2 = ($a[$i + 2][0]);&nbsp;</div></li><li><div>                    $y2 = ($a[$i + 3][0]);&nbsp;</div></li><li><div>                    $x = ($a[$i + 4][0]);&nbsp;</div></li><li><div>                    $y = ($a[$i + 5][0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + $x1);&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - $y1);&nbsp;</div></li><li><div>                        $pdfx2 = ($this-&gt;xbase + $x2);&nbsp;</div></li><li><div>                        $pdfy2 = ($this-&gt;ybase - $y2);&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx1 = $x1;&nbsp;</div></li><li><div>                        $pdfy1 = -$y1;&nbsp;</div></li><li><div>                        $pdfx2 = $x2;&nbsp;</div></li><li><div>                        $pdfy2 = -$y2;&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(($pdfx - $pdfx2), -($pdfy - $pdfy2)); // mPDF 4.4.003 always relative&nbsp;</div></li><li><div>                    // $pdf_pt2 = $this-&gt;svg_overflow($pdfx2, $pdfy2);&nbsp;</div></li><li><div>                    // $pdf_pt1 = $this-&gt;svg_overflow($pdfx1, $pdfy1);&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $curves = array($pdfx1, -$pdfy1, $pdfx2, -$pdfy2, $pdfx, -$pdfy);&nbsp;</div></li><li><div>                    $bx = calc_bezier_bbox($start, $curves);&nbsp;</div></li><li><div>                    $minl = min($minl, $bx[0]);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $bx[2]);&nbsp;</div></li><li><div>                    $mint = min($mint, $bx[1]);&nbsp;</div></li><li><div>                    $maxb = max($maxb, $bx[3]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (($pdf_pt['x'] != $pdfx) || ($pdf_pt['y'] != $pdfy)) {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $pdfx1 * $this-&gt;kp, $pdfy1 * $this-&gt;kp, $pdfx2 * $this-&gt;kp, $pdfy2 * $this-&gt;kp, $pdfx * $this-&gt;kp, $pdfy * $this-&gt;kp);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'q': // bezier quadratic avec point de control&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i += 4) {&nbsp;</div></li><li><div>                    $x1 = ($a[$i][0]);&nbsp;</div></li><li><div>                    $y1 = ($a[$i + 1][0]);&nbsp;</div></li><li><div>                    $x = ($a[$i + 2][0]);&nbsp;</div></li><li><div>                    $y = ($a[$i + 3][0]);&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + ($x1 * 2 / 3));&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - ($y1 * 2 / 3));&nbsp;</div></li><li><div>                        // mPDF 4.4.003&nbsp;</div></li><li><div>                        $pdfx2 = $pdfx1 + 1 / 3 * ($x);&nbsp;</div></li><li><div>                        $pdfy2 = $pdfy1 + 1 / 3 * (-$y);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + (($x1 - $this-&gt;xbase) * 2 / 3));&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - (($y1 + $this-&gt;ybase) * 2 / 3));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pdfx2 = ($x + (($x1 - $x) * 2 / 3));&nbsp;</div></li><li><div>                        $pdfy2 = (-$y - (($y1 - $y) * 2 / 3));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // mPDF 4.4.003&nbsp;</div></li><li><div>                        $pdfx2 = $pdfx1 + 1 / 3 * ($x - $this-&gt;xbase);&nbsp;</div></li><li><div>                        $pdfy2 = $pdfy1 + 1 / 3 * (-$y - $this-&gt;ybase);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(($pdfx - $pdfx2), -($pdfy - $pdfy2)); // mPDF 4.4.003 always relative&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pdf_pt = $this-&gt;svg_overflow($pdfx, $pdfy);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $curves = array($pdfx1, -$pdfy1, $pdfx2, -$pdfy2, $pdfx, -$pdfy);&nbsp;</div></li><li><div>                    $bx = calc_bezier_bbox($start, $curves);&nbsp;</div></li><li><div>                    $minl = min($minl, $bx[0]);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $bx[2]);&nbsp;</div></li><li><div>                    $mint = min($mint, $bx[1]);&nbsp;</div></li><li><div>                    $maxb = max($maxb, $bx[3]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (($pdf_pt['x'] != $pdfx) || ($pdf_pt['y'] != $pdfy)) {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F l ', $pdf_pt['x'] * $this-&gt;kp, $pdf_pt['y'] * $this-&gt;kp);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $pdfx1 * $this-&gt;kp, $pdfy1 * $this-&gt;kp, $pdfx2 * $this-&gt;kp, $pdfy2 * $this-&gt;kp, $pdfx * $this-&gt;kp, $pdfy * $this-&gt;kp);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 't': // bezier quadratic avec point de control simetrique a lancien point de control&nbsp;</div></li><li><div>                if (!($this-&gt;lastcommand == 'Q' || $this-&gt;lastcommand == 'q' || $this-&gt;lastcommand == 'T' || $this-&gt;lastcommand == 't')) {&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(0, 0);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i += 2) {&nbsp;</div></li><li><div>                    $x = ($a[$i][0]);&nbsp;</div></li><li><div>                    $y = ($a[$i + 1][0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $x1 = $this-&gt;lastcontrolpoints[0];&nbsp;</div></li><li><div>                    $y1 = $this-&gt;lastcontrolpoints[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $pdfx = ($this-&gt;xbase + $x);&nbsp;</div></li><li><div>                        $pdfy = ($this-&gt;ybase - $y);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + ($x1));&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - ($y1));&nbsp;</div></li><li><div>                        // mPDF 4.4.003&nbsp;</div></li><li><div>                        $pdfx2 = $pdfx1 + 1 / 3 * ($x);&nbsp;</div></li><li><div>                        $pdfy2 = $pdfy1 + 1 / 3 * (-$y);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;xbase += $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase += -$y;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $pdfx = $x;&nbsp;</div></li><li><div>                        $pdfy = -$y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pdfx1 = ($this-&gt;xbase + ($x1));&nbsp;</div></li><li><div>                        $pdfy1 = ($this-&gt;ybase - ($y1));&nbsp;</div></li><li><div>                        // mPDF 4.4.003&nbsp;</div></li><li><div>                        $pdfx2 = $pdfx1 + 1 / 3 * ($x - $this-&gt;xbase);&nbsp;</div></li><li><div>                        $pdfy2 = $pdfy1 + 1 / 3 * (-$y - $this-&gt;ybase);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;lastcontrolpoints = array(($pdfx - $pdfx2), -($pdfy - $pdfy2)); // mPDF 4.4.003 always relative&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $curves = array($pdfx1, -$pdfy1, $pdfx2, -$pdfy2, $pdfx, -$pdfy);&nbsp;</div></li><li><div>                    $bx = calc_bezier_bbox($start, $curves);&nbsp;</div></li><li><div>                    $minl = min($minl, $bx[0]);&nbsp;</div></li><li><div>                    $maxr = max($maxr, $bx[2]);&nbsp;</div></li><li><div>                    $mint = min($mint, $bx[1]);&nbsp;</div></li><li><div>                    $maxb = max($maxb, $bx[3]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $pdfx1 * $this-&gt;kp, $pdfy1 * $this-&gt;kp, $pdfx2 * $this-&gt;kp, $pdfy2 * $this-&gt;kp, $pdfx * $this-&gt;kp, $pdfy * $this-&gt;kp);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'a': // Elliptical arc&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $ile_argumentow; $i += 7) {&nbsp;</div></li><li><div>                    $rx = ($a[$i][0]);&nbsp;</div></li><li><div>                    $ry = ($a[$i + 1][0]);&nbsp;</div></li><li><div>                    $angle = ($a[$i + 2][0]); //x-axis-rotation&nbsp;</div></li><li><div>                    $largeArcFlag = ($a[$i + 3][0]);&nbsp;</div></li><li><div>                    $sweepFlag = ($a[$i + 4][0]);&nbsp;</div></li><li><div>                    $x2 = ($a[$i + 5][0]);&nbsp;</div></li><li><div>                    $y2 = ($a[$i + 6][0]);&nbsp;</div></li><li><div>                    $x1 = $this-&gt;xbase;&nbsp;</div></li><li><div>                    $y1 = -$this-&gt;ybase;&nbsp;</div></li><li><div>                    if ($relative) {&nbsp;</div></li><li><div>                        $x2 = $this-&gt;xbase + $x2;&nbsp;</div></li><li><div>                        $y2 = -$this-&gt;ybase + $y2;&nbsp;</div></li><li><div>                        $this-&gt;xbase += ($a[$i + 5][0]);&nbsp;</div></li><li><div>                        $this-&gt;ybase += -($a[$i + 6][0]);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $this-&gt;xbase = $x2;&nbsp;</div></li><li><div>                        $this-&gt;ybase = -$y2;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    list($pcmd, $bounds) = $this-&gt;Arcto($x1, $y1, $x2, $y2, $rx, $ry, $angle, $largeArcFlag, $sweepFlag);&nbsp;</div></li><li><div>                    $minl = min($minl, $x2, min($bounds[0]));&nbsp;</div></li><li><div>                    $maxr = max($maxr, $x2, max($bounds[0]));&nbsp;</div></li><li><div>                    $mint = min($mint, $y2, min($bounds[1]));&nbsp;</div></li><li><div>                    $maxb = max($maxb, $y2, max($bounds[1]));&nbsp;</div></li><li><div>                    $path_cmd .= $pcmd;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case'z':&nbsp;</div></li><li><div>                $path_cmd .= 'h ';&nbsp;</div></li><li><div>                $this-&gt;subPathInit = true;&nbsp;</div></li><li><div>                $newsubpath = true;&nbsp;</div></li><li><div>                $this-&gt;xbase = $this-&gt;spxstart;&nbsp;</div></li><li><div>                $this-&gt;ybase = $this-&gt;spystart;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$newsubpath) {&nbsp;</div></li><li><div>            $this-&gt;subPathInit = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;lastcommand = $command;&nbsp;</div></li><li><div>        // mPDF 5.0.039&nbsp;</div></li><li><div>        $this-&gt;pathBBox[0] = $minl;&nbsp;</div></li><li><div>        $this-&gt;pathBBox[1] = $mint;&nbsp;</div></li><li><div>        $this-&gt;pathBBox[2] = $maxr - $this-&gt;pathBBox[0];&nbsp;</div></li><li><div>        $this-&gt;pathBBox[3] = $maxb - $this-&gt;pathBBox[1];&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function Arcto($x1, $y1, $x2, $y2, $rx, $ry, $angle, $largeArcFlag, $sweepFlag)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bounds = array(0 =&gt; array($x1, $x2), 1 =&gt; array($y1, $y2));&nbsp;</div></li><li><div>        // 1. Treat out-of-range parameters as described in&nbsp;</div></li><li><div>        // http://www.w3.org/TR/SVG/implnote.html#ArcImplementationNotes&nbsp;</div></li><li><div>        // If the endpoints (x1, y1) and (x2, y2) are identical, then this&nbsp;</div></li><li><div>        // is equivalent to omitting the elliptical arc segment entirely&nbsp;</div></li><li><div>        if ($x1 == $x2 && $y1 == $y2)&nbsp;</div></li><li><div>            return array('', $bounds); // mPD 5.0.040&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>// If rX = 0 or rY = 0 then this arc is treated as a straight line&nbsp;</div></li><li><div>        // segment (a &quot;lineto&quot;) joining the endpoints.&nbsp;</div></li><li><div>        if ($rx == 0.0 || $ry == 0.0) {&nbsp;</div></li><li><div>            //   return array(Lineto(x2, y2), $bounds);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If rX or rY have negative signs, these are dropped; the absolute&nbsp;</div></li><li><div>        // value is used instead.&nbsp;</div></li><li><div>        if ($rx &lt; 0.0)&nbsp;</div></li><li><div>            $rx = -$rx;&nbsp;</div></li><li><div>        if ($ry &lt; 0.0)&nbsp;</div></li><li><div>            $ry = -$ry;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // 2. convert to center parameterization as shown in&nbsp;</div></li><li><div>        // http://www.w3.org/TR/SVG/implnote.html&nbsp;</div></li><li><div>        $sinPhi = sin(deg2rad($angle));&nbsp;</div></li><li><div>        $cosPhi = cos(deg2rad($angle));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x1dash = $cosPhi * ($x1 - $x2) / 2.0 + $sinPhi * ($y1 - $y2) / 2.0;&nbsp;</div></li><li><div>        $y1dash = -$sinPhi * ($x1 - $x2) / 2.0 + $cosPhi * ($y1 - $y2) / 2.0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $numerator = $rx * $rx * $ry * $ry - $rx * $rx * $y1dash * $y1dash - $ry * $ry * $x1dash * $x1dash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($numerator &lt; 0.0) {&nbsp;</div></li><li><div>            //  If rX , rY and are such that there is no solution (basically, &nbsp;</div></li><li><div>            //  the ellipse is not big enough to reach from (x1, y1) to (x2, &nbsp;</div></li><li><div>            //  y2)) then the ellipse is scaled up uniformly until there is&nbsp;</div></li><li><div>            //  exactly one solution (until the ellipse is just big enough).&nbsp;</div></li><li><div>            // -&gt; find factor s, such that numerator' with rx'=s*rx and&nbsp;</div></li><li><div>            //    ry'=s*ry becomes 0 :&nbsp;</div></li><li><div>            $s = sqrt(1.0 - $numerator / ($rx * $rx * $ry * $ry));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $rx *= $s;&nbsp;</div></li><li><div>            $ry *= $s;&nbsp;</div></li><li><div>            $root = 0.0;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $root = ($largeArcFlag == $sweepFlag ? -1.0 : 1.0) * sqrt($numerator / ($rx * $rx * $y1dash * $y1dash + $ry * $ry * $x1dash * $x1dash));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cxdash = $root * $rx * $y1dash / $ry;&nbsp;</div></li><li><div>        $cydash = -$root * $ry * $x1dash / $rx;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cx = $cosPhi * $cxdash - $sinPhi * $cydash + ($x1 + $x2) / 2.0;&nbsp;</div></li><li><div>        $cy = $sinPhi * $cxdash + $cosPhi * $cydash + ($y1 + $y2) / 2.0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $theta1 = $this-&gt;CalcVectorAngle(1.0, 0.0, ($x1dash - $cxdash) / $rx, ($y1dash - $cydash) / $ry);&nbsp;</div></li><li><div>        $dtheta = $this-&gt;CalcVectorAngle(($x1dash - $cxdash) / $rx, ($y1dash - $cydash) / $ry, (-$x1dash - $cxdash) / $rx, (-$y1dash - $cydash) / $ry);&nbsp;</div></li><li><div>        if (!$sweepFlag && $dtheta &gt; 0)&nbsp;</div></li><li><div>            $dtheta -= 2.0 * M_PI;&nbsp;</div></li><li><div>        else if ($sweepFlag && $dtheta &lt; 0)&nbsp;</div></li><li><div>            $dtheta += 2.0 * M_PI;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // 3. convert into cubic bezier segments &lt;= 90deg&nbsp;</div></li><li><div>        $segments = ceil(abs($dtheta / (M_PI / 2.0)));&nbsp;</div></li><li><div>        $delta = $dtheta / $segments;&nbsp;</div></li><li><div>        $t = 8.0 / 3.0 * sin($delta / 4.0) * sin($delta / 4.0) / sin($delta / 2.0);&nbsp;</div></li><li><div>        $coords = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $segments; $i++) {&nbsp;</div></li><li><div>            $cosTheta1 = cos($theta1);&nbsp;</div></li><li><div>            $sinTheta1 = sin($theta1);&nbsp;</div></li><li><div>            $theta2 = $theta1 + $delta;&nbsp;</div></li><li><div>            $cosTheta2 = cos($theta2);&nbsp;</div></li><li><div>            $sinTheta2 = sin($theta2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // a) calculate endpoint of the segment:&nbsp;</div></li><li><div>            $xe = $cosPhi * $rx * $cosTheta2 - $sinPhi * $ry * $sinTheta2 + $cx;&nbsp;</div></li><li><div>            $ye = $sinPhi * $rx * $cosTheta2 + $cosPhi * $ry * $sinTheta2 + $cy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // b) calculate gradients at start/end points of segment:&nbsp;</div></li><li><div>            $dx1 = $t * ( - $cosPhi * $rx * $sinTheta1 - $sinPhi * $ry * $cosTheta1);&nbsp;</div></li><li><div>            $dy1 = $t * ( - $sinPhi * $rx * $sinTheta1 + $cosPhi * $ry * $cosTheta1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $dxe = $t * ( $cosPhi * $rx * $sinTheta2 + $sinPhi * $ry * $cosTheta2);&nbsp;</div></li><li><div>            $dye = $t * ( $sinPhi * $rx * $sinTheta2 - $cosPhi * $ry * $cosTheta2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // c) draw the cubic bezier:&nbsp;</div></li><li><div>            $coords[$i] = array(($x1 + $dx1), ($y1 + $dy1), ($xe + $dxe), ($ye + $dye), $xe, $ye);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // do next segment&nbsp;</div></li><li><div>            $theta1 = $theta2;&nbsp;</div></li><li><div>            $x1 = $xe;&nbsp;</div></li><li><div>            $y1 = $ye;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $path = ' ';&nbsp;</div></li><li><div>        foreach ($coords AS $c) {&nbsp;</div></li><li><div>            $cpx1 = $c[0];&nbsp;</div></li><li><div>            $cpy1 = $c[1];&nbsp;</div></li><li><div>            $cpx2 = $c[2];&nbsp;</div></li><li><div>            $cpy2 = $c[3];&nbsp;</div></li><li><div>            $x2 = $c[4];&nbsp;</div></li><li><div>            $y2 = $c[5];&nbsp;</div></li><li><div>            $path .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $cpx1 * $this-&gt;kp, -$cpy1 * $this-&gt;kp, $cpx2 * $this-&gt;kp, -$cpy2 * $this-&gt;kp, $x2 * $this-&gt;kp, -$y2 * $this-&gt;kp) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.0.040&nbsp;</div></li><li><div>            $bounds[0][] = $c[4];&nbsp;</div></li><li><div>            $bounds[1][] = $c[5];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return array($path, $bounds); // mPD 5.0.040&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function CalcVectorAngle($ux, $uy, $vx, $vy)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $ta = atan2($uy, $ux);&nbsp;</div></li><li><div>        $tb = atan2($vy, $vx);&nbsp;</div></li><li><div>        if ($tb &gt;= $ta)&nbsp;</div></li><li><div>            return ($tb - $ta);&nbsp;</div></li><li><div>        return (6.28318530718 - ($ta - $tb));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function ConvertSVGSizePixels($size = 5, $maxsize = 'x')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // maxsize in pixels (user units) or 'y' or 'x'&nbsp;</div></li><li><div>        // e.g. $w = $this-&gt;ConvertSVGSizePixels($arguments['w'], $this-&gt;svg_info['w']*(25.4/$this-&gt;mpdf_ref-&gt;dpi));&nbsp;</div></li><li><div>        // usefontsize - setfalse for e.g. margins - will ignore fontsize for % values&nbsp;</div></li><li><div>        // Depends of maxsize value to make % work properly. Usually maxsize == pagewidth&nbsp;</div></li><li><div>        // For text $maxsize = Fontsize&nbsp;</div></li><li><div>        // Setting e.g. margin % will use maxsize (pagewidth) and em will use fontsize&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($maxsize == 'y') {&nbsp;</div></li><li><div>            $maxsize = $this-&gt;svg_info['h'];&nbsp;</div></li><li><div>        } else if ($maxsize == 'x') {&nbsp;</div></li><li><div>            $maxsize = $this-&gt;svg_info['w'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $maxsize *= (25.4 / $this-&gt;mpdf_ref-&gt;dpi); // convert pixels to mm&nbsp;</div></li><li><div>        $fontsize = $this-&gt;mpdf_ref-&gt;FontSize / $this-&gt;kf;&nbsp;</div></li><li><div>        //Return as pixels&nbsp;</div></li><li><div>        $size = $this-&gt;mpdf_ref-&gt;ConvertSize($size, $maxsize, $fontsize, false) * 1 / (25.4 / $this-&gt;mpdf_ref-&gt;dpi);&nbsp;</div></li><li><div>        return $size;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function ConvertSVGSizePts($size = 5)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // usefontsize - setfalse for e.g. margins - will ignore fontsize for % values&nbsp;</div></li><li><div>        // Depends of maxsize value to make % work properly. Usually maxsize == pagewidth&nbsp;</div></li><li><div>        // For text $maxsize = Fontsize&nbsp;</div></li><li><div>        // Setting e.g. margin % will use maxsize (pagewidth) and em will use fontsize&nbsp;</div></li><li><div>        $maxsize = $this-&gt;mpdf_ref-&gt;FontSize;&nbsp;</div></li><li><div>        //Return as pts&nbsp;</div></li><li><div>        $size = $this-&gt;mpdf_ref-&gt;ConvertSize($size, $maxsize, false, true) * 72 / 25.4;&nbsp;</div></li><li><div>        return $size;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    fonction retracant les &lt;rect /&gt;&nbsp;</div></li><li><div>    function svgRect($arguments)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($arguments['h'] == 0 || $arguments['w'] == 0) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x = $this-&gt;ConvertSVGSizePixels($arguments['x'], 'x'); // mPDF 4.4.003&nbsp;</div></li><li><div>        $y = $this-&gt;ConvertSVGSizePixels($arguments['y'], 'y'); // mPDF 4.4.003&nbsp;</div></li><li><div>        $h = $this-&gt;ConvertSVGSizePixels($arguments['h'], 'y'); // mPDF 4.4.003&nbsp;</div></li><li><div>        $w = $this-&gt;ConvertSVGSizePixels($arguments['w'], 'x'); // mPDF 4.4.003&nbsp;</div></li><li><div>        $rx = $this-&gt;ConvertSVGSizePixels($arguments['rx'], 'x'); // mPDF 4.4.003&nbsp;</div></li><li><div>        $ry = $this-&gt;ConvertSVGSizePixels($arguments['ry'], 'y'); // mPDF 4.4.003&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($rx &gt; $w / 2) {&nbsp;</div></li><li><div>            $rx = $w / 2;&nbsp;</div></li><li><div>        } // mPDF 4.4.003&nbsp;</div></li><li><div>        if ($ry &gt; $h / 2) {&nbsp;</div></li><li><div>            $ry = $h / 2;&nbsp;</div></li><li><div>        } // mPDF 4.4.003&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($rx &gt; 0 and $ry == 0) {&nbsp;</div></li><li><div>            $ry = $rx;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($ry &gt; 0 and $rx == 0) {&nbsp;</div></li><li><div>            $rx = $ry;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($rx == 0 and $ry == 0) {&nbsp;</div></li><li><div>            //    trace un rectangle sans angle arrondit&nbsp;</div></li><li><div>            $path_cmd = sprintf('%.3F %.3F m ', ($x * $this-&gt;kp), -($y * $this-&gt;kp));&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', (($x + $w) * $this-&gt;kp), -($y * $this-&gt;kp));&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', (($x + $w) * $this-&gt;kp), -(($y + $h) * $this-&gt;kp));&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', ($x) * $this-&gt;kp, -(($y + $h) * $this-&gt;kp));&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l h ', ($x * $this-&gt;kp), -($y * $this-&gt;kp));&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            //    trace un rectangle avec les arrondit&nbsp;</div></li><li><div>            //    les points de controle du bezier sont deduis grace a la constante kappa&nbsp;</div></li><li><div>            $kappa = 4 * (sqrt(2) - 1) / 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $kx = $kappa * $rx;&nbsp;</div></li><li><div>            $ky = $kappa * $ry;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $path_cmd = sprintf('%.3F %.3F m ', ($x + $rx) * $this-&gt;kp, -$y * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', ($x + ($w - $rx)) * $this-&gt;kp, -$y * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($x + ($w - $rx + $kx)) * $this-&gt;kp, -$y * $this-&gt;kp, ($x + $w) * $this-&gt;kp, (-$y + (-$ry + $ky)) * $this-&gt;kp, ($x + $w) * $this-&gt;kp, (-$y + (-$ry)) * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', ($x + $w) * $this-&gt;kp, (-$y + (-$h + $ry)) * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($x + $w) * $this-&gt;kp, (-$y + (-$h - $ky + $ry)) * $this-&gt;kp, ($x + ($w - $rx + $kx)) * $this-&gt;kp, (-$y + (-$h)) * $this-&gt;kp, ($x + ($w - $rx)) * $this-&gt;kp, (-$y + (-$h)) * $this-&gt;kp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', ($x + $rx) * $this-&gt;kp, (-$y + (-$h)) * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($x + ($rx - $kx)) * $this-&gt;kp, (-$y + (-$h)) * $this-&gt;kp, $x * $this-&gt;kp, (-$y + (-$h - $ky + $ry)) * $this-&gt;kp, $x * $this-&gt;kp, (-$y + (-$h + $ry)) * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', $x * $this-&gt;kp, (-$y + (-$ry)) * $this-&gt;kp);&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c h ', $x * $this-&gt;kp, (-$y + (-$ry + $ky)) * $this-&gt;kp, ($x + ($rx - $kx)) * $this-&gt;kp, -$y * $this-&gt;kp, ($x + $rx) * $this-&gt;kp, -$y * $this-&gt;kp);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    fonction retracant les &lt;ellipse /&gt; et &lt;circle /&gt;&nbsp;</div></li><li><div>    //     le cercle est trac grave a 4 bezier cubic, les poitn de controles&nbsp;</div></li><li><div>    //    sont deduis grace a la constante kappa * rayon&nbsp;</div></li><li><div>    function svgEllipse($arguments)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($arguments['rx'] == 0 || $arguments['ry'] == 0) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $kappa = 4 * (sqrt(2) - 1) / 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cx = $this-&gt;ConvertSVGSizePixels($arguments['cx'], 'x');&nbsp;</div></li><li><div>        $cy = $this-&gt;ConvertSVGSizePixels($arguments['cy'], 'y');&nbsp;</div></li><li><div>        $rx = $this-&gt;ConvertSVGSizePixels($arguments['rx'], 'x');&nbsp;</div></li><li><div>        $ry = $this-&gt;ConvertSVGSizePixels($arguments['ry'], 'y');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x1 = $cx;&nbsp;</div></li><li><div>        $y1 = -$cy + $ry;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x2 = $cx + $rx;&nbsp;</div></li><li><div>        $y2 = -$cy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x3 = $cx;&nbsp;</div></li><li><div>        $y3 = -$cy - $ry;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x4 = $cx - $rx;&nbsp;</div></li><li><div>        $y4 = -$cy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $path_cmd = sprintf('%.3F %.3F m ', $x1 * $this-&gt;kp, $y1 * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($x1 + ($rx * $kappa)) * $this-&gt;kp, $y1 * $this-&gt;kp, $x2 * $this-&gt;kp, ($y2 + ($ry * $kappa)) * $this-&gt;kp, $x2 * $this-&gt;kp, $y2 * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $x2 * $this-&gt;kp, ($y2 - ($ry * $kappa)) * $this-&gt;kp, ($x3 + ($rx * $kappa)) * $this-&gt;kp, $y3 * $this-&gt;kp, $x3 * $this-&gt;kp, $y3 * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($x3 - ($rx * $kappa)) * $this-&gt;kp, $y3 * $this-&gt;kp, $x4 * $this-&gt;kp, ($y4 - ($ry * $kappa)) * $this-&gt;kp, $x4 * $this-&gt;kp, $y4 * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $x4 * $this-&gt;kp, ($y4 + ($ry * $kappa)) * $this-&gt;kp, ($x1 - ($rx * $kappa)) * $this-&gt;kp, $y1 * $this-&gt;kp, $x1 * $this-&gt;kp, $y1 * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= 'h ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    fonction retracant les &lt;polyline /&gt; et les &lt;line /&gt;&nbsp;</div></li><li><div>    function svgPolyline($arguments, $ispolyline = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($ispolyline) {&nbsp;</div></li><li><div>            $xbase = $arguments[0];&nbsp;</div></li><li><div>            $ybase = - $arguments[1];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ($arguments[0] == $arguments[2] && $arguments[1] == $arguments[3]) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            } // Zero length line&nbsp;</div></li><li><div>            $xbase = $this-&gt;ConvertSVGSizePixels($arguments[0], 'x');&nbsp;</div></li><li><div>            $ybase = - $this-&gt;ConvertSVGSizePixels($arguments[1], 'y');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $path_cmd = sprintf('%.3F %.3F m ', $xbase * $this-&gt;kp, $ybase * $this-&gt;kp);&nbsp;</div></li><li><div>        for ($i = 2; $i &lt; count($arguments); $i += 2) {&nbsp;</div></li><li><div>            if ($ispolyline) {&nbsp;</div></li><li><div>                $tmp_x = $arguments[$i];&nbsp;</div></li><li><div>                $tmp_y = - $arguments[($i + 1)];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp_x = $this-&gt;ConvertSVGSizePixels($arguments[$i], 'x');&nbsp;</div></li><li><div>                $tmp_y = - $this-&gt;ConvertSVGSizePixels($arguments[($i + 1)], 'y');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', $tmp_x * $this-&gt;kp, $tmp_y * $this-&gt;kp);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //    $path_cmd .= 'h '; // ?? In error - don't close subpath here&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    fonction retracant les &lt;polygone /&gt;&nbsp;</div></li><li><div>    function svgPolygon($arguments)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $xbase = $arguments[0];&nbsp;</div></li><li><div>        $ybase = - $arguments[1];&nbsp;</div></li><li><div>        $path_cmd = sprintf('%.3F %.3F m ', $xbase * $this-&gt;kp, $ybase * $this-&gt;kp);&nbsp;</div></li><li><div>        for ($i = 2; $i &lt; count($arguments); $i += 2) {&nbsp;</div></li><li><div>            $tmp_x = $arguments[$i];&nbsp;</div></li><li><div>            $tmp_y = - $arguments[($i + 1)];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $path_cmd .= sprintf('%.3F %.3F l ', $tmp_x * $this-&gt;kp, $tmp_y * $this-&gt;kp);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $path_cmd .= sprintf('%.3F %.3F l ', $xbase * $this-&gt;kp, $ybase * $this-&gt;kp);&nbsp;</div></li><li><div>        $path_cmd .= 'h ';&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    write string to image&nbsp;</div></li><li><div>    function svgText()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // $tmp = count($this-&gt;txt_style)-1;&nbsp;</div></li><li><div>        $current_style = $this-&gt;txt_style[count($this-&gt;txt_style) - 1]; // mPDF 5.7.4&nbsp;</div></li><li><div>        $style = '';&nbsp;</div></li><li><div>        $op = '';&nbsp;</div></li><li><div>        $render = -1;&nbsp;</div></li><li><div>        if (isset($this-&gt;txt_data[2])) {&nbsp;</div></li><li><div>            // mPDF 6&nbsp;</div></li><li><div>            // If using SVG Font&nbsp;</div></li><li><div>            if (isset($this-&gt;svg_font[$current_style['font-family']])) {&nbsp;</div></li><li><div>                // select font&nbsp;</div></li><li><div>                $style = 'R';&nbsp;</div></li><li><div>                $style .= (isset($current_style['font-weight']) && $current_style['font-weight'] == 'bold') ? 'B' : '';&nbsp;</div></li><li><div>                $style .= (isset($current_style['font-style']) && $current_style['font-style'] == 'italic') ? 'I' : '';&nbsp;</div></li><li><div>                $style .= (isset($current_style['font-variant']) && $current_style['font-variant'] == 'small-caps') ? 'S' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $fontsize = $current_style['font-size'] * $this-&gt;mpdf_ref-&gt;dpi / 72;&nbsp;</div></li><li><div>                if (isset($this-&gt;svg_font[$current_style['font-family']][$style])) {&nbsp;</div></li><li><div>                    $svg_font = $this-&gt;svg_font[$current_style['font-family']][$style];&nbsp;</div></li><li><div>                } else if (isset($this-&gt;svg_font[$current_style['font-family']]['R'])) {&nbsp;</div></li><li><div>                    $svg_font = $this-&gt;svg_font[$current_style['font-family']]['R'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!isset($svg_font['units-per-em']) || $svg_font['units-per-em'] &lt; 1) {&nbsp;</div></li><li><div>                    $svg_font['units-per-em'] = 1000;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $units_per_em = $svg_font['units-per-em'];&nbsp;</div></li><li><div>                $scale = $fontsize / $units_per_em;&nbsp;</div></li><li><div>                $stroke_width = $current_style['stroke-width'];&nbsp;</div></li><li><div>                $stroke_width /= $scale;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $opacitystr = '';&nbsp;</div></li><li><div>                $fopacity = 1;&nbsp;</div></li><li><div>                if (isset($current_style['fill-opacity'])) {&nbsp;</div></li><li><div>                    if ($current_style['fill-opacity'] == 0) {&nbsp;</div></li><li><div>                        $fopacity = 0;&nbsp;</div></li><li><div>                    } else if ($current_style['fill-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                        $fopacity = 1;&nbsp;</div></li><li><div>                    } else if ($current_style['fill-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                        $fopacity = $current_style['fill-opacity'];&nbsp;</div></li><li><div>                    } else if ($current_style['fill-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                        $fopacity = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $sopacity = 1;&nbsp;</div></li><li><div>                if (isset($current_style['stroke-opacity'])) {&nbsp;</div></li><li><div>                    if ($current_style['stroke-opacity'] == 0) {&nbsp;</div></li><li><div>                        $sopacity = 0;&nbsp;</div></li><li><div>                    } else if ($current_style['stroke-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                        $sopacity = 1;&nbsp;</div></li><li><div>                    } else if ($current_style['stroke-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                        $sopacity = $current_style['stroke-opacity'];&nbsp;</div></li><li><div>                    } else if ($current_style['stroke-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                        $sopacity = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array('ca' =&gt; $fopacity, 'CA' =&gt; $sopacity, 'BM' =&gt; '/Normal'));&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;extgstates[$gs]['fo'] = true;&nbsp;</div></li><li><div>                $opacitystr = sprintf(' /GS%d gs ', $gs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $fillstr = '';&nbsp;</div></li><li><div>                if (isset($current_style['fill']) && $current_style['fill'] != 'none') {&nbsp;</div></li><li><div>                    $col = $this-&gt;mpdf_ref-&gt;ConvertColor($current_style['fill']);&nbsp;</div></li><li><div>                    $fillstr = $this-&gt;mpdf_ref-&gt;SetFColor($col, true);&nbsp;</div></li><li><div>                    $render = &quot;0&quot;; // Fill (only)&nbsp;</div></li><li><div>                    $op = 'f';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $strokestr = '';&nbsp;</div></li><li><div>                if ($stroke_width &gt; 0 && $current_style['stroke'] != 'none') {&nbsp;</div></li><li><div>                    $scol = $this-&gt;mpdf_ref-&gt;ConvertColor($current_style['stroke']);&nbsp;</div></li><li><div>                    if ($scol) {&nbsp;</div></li><li><div>                        $strokestr .= $this-&gt;mpdf_ref-&gt;SetDColor($scol, true) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $linewidth = $this-&gt;ConvertSVGSizePixels($stroke_width);&nbsp;</div></li><li><div>                    if ($linewidth &gt; 0) {&nbsp;</div></li><li><div>                        $strokestr .= sprintf('%.3F w 0 J 0 j ', $linewidth * $this-&gt;kp);&nbsp;</div></li><li><div>                        if ($render == -1) {&nbsp;</div></li><li><div>                            $render = &quot;1&quot;;&nbsp;</div></li><li><div>                        } // stroke only&nbsp;</div></li><li><div>                        else {&nbsp;</div></li><li><div>                            $render = &quot;2&quot;;&nbsp;</div></li><li><div>                        }  // fill and stroke&nbsp;</div></li><li><div>                        $op .= 'S';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($render == -1) {&nbsp;</div></li><li><div>                    return '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($op == 'fS') {&nbsp;</div></li><li><div>                    $op = 'B';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $x = $this-&gt;txt_data[0]; // mPDF 5.7.4&nbsp;</div></li><li><div>                $y = $this-&gt;txt_data[1]; // mPDF 5.7.4&nbsp;</div></li><li><div>                $txt = $this-&gt;txt_data[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $txt = preg_replace('/\f/', '', $txt);&nbsp;</div></li><li><div>                $txt = preg_replace('/\r/', '', $txt);&nbsp;</div></li><li><div>                $txt = preg_replace('/\n/', ' ', $txt);&nbsp;</div></li><li><div>                $txt = preg_replace('/\t/', ' ', $txt);&nbsp;</div></li><li><div>                $txt = preg_replace(&quot;/[ ]+/u&quot;, ' ', $txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;textjuststarted) {&nbsp;</div></li><li><div>                    $txt = ltrim($txt);&nbsp;</div></li><li><div>                }  // mPDF 5.7.4&nbsp;</div></li><li><div>                $this-&gt;textjuststarted = false;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $txt = $this-&gt;mpdf_ref-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>                if ($this-&gt;mpdf_ref-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>                    $txt = $this-&gt;mpdf_ref-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $nb = mb_strlen($txt, 'UTF-8');&nbsp;</div></li><li><div>                $i = 0;&nbsp;</div></li><li><div>                $sw = 0;&nbsp;</div></li><li><div>                $subpath_cmd = '';&nbsp;</div></li><li><div>                while ($i &lt; $nb) {&nbsp;</div></li><li><div>                    //Get next character&nbsp;</div></li><li><div>                    $char = mb_substr($txt, $i, 1, 'UTF-8');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (isset($svg_font['glyphs'][$char])) {&nbsp;</div></li><li><div>                        $d = $svg_font['glyphs'][$char]['d'];&nbsp;</div></li><li><div>                        if (isset($svg_font['glyphs'][$char]['horiz-adv-x'])) {&nbsp;</div></li><li><div>                            $horiz_adv_x = $svg_font['glyphs'][$char]['horiz-adv-x'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $horiz_adv_x = $svg_font['horiz-adv-x'];&nbsp;</div></li><li><div>                        } // missing glyph width&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $d = $svg_font['d'];&nbsp;</div></li><li><div>                        $horiz_adv_x = $svg_font['horiz-adv-x']; // missing glyph width&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    preg_match_all('/([MZLHVCSQTAmzlhvcsqta])([eE , \-.\d]+)*/', $d, $commands, PREG_SET_ORDER);&nbsp;</div></li><li><div>                    $subpath_cmd .= sprintf('q %.4F 0 0 %.4F mPDF-AXS(%.4F) %.4F cm ', $scale, -$scale, ($x + $sw * $scale) * $this-&gt;kp, -$y * $this-&gt;kp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;subPathInit = true;&nbsp;</div></li><li><div>                    $this-&gt;pathBBox = array(999999, 999999, -999999, -999999);&nbsp;</div></li><li><div>                    foreach ($commands as $cmd) {&nbsp;</div></li><li><div>                        if (count($cmd) == 3 || (isset($cmd[2]) && $cmd[2] == '')) {&nbsp;</div></li><li><div>                            list($tmp, $command, $arguments) = $cmd;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            list($tmp, $command) = $cmd;&nbsp;</div></li><li><div>                            $arguments = '';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $subpath_cmd .= $this-&gt;svgPath($command, $arguments);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $subpath_cmd .= $op . ' Q ';&nbsp;</div></li><li><div>                    if ($this-&gt;pathBBox[2] == -1999998) {&nbsp;</div></li><li><div>                        $this-&gt;pathBBox[2] = 100;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($this-&gt;pathBBox[3] == -1999998) {&nbsp;</div></li><li><div>                        $this-&gt;pathBBox[3] = 100;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($this-&gt;pathBBox[0] == 999999) {&nbsp;</div></li><li><div>                        $this-&gt;pathBBox[0] = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($this-&gt;pathBBox[1] == 999999) {&nbsp;</div></li><li><div>                        $this-&gt;pathBBox[1] = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $sw += $horiz_adv_x;&nbsp;</div></li><li><div>                    $i++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $sw *= $scale; // convert stringwidth to units&nbsp;</div></li><li><div>                // mPDF 5.7.4&nbsp;</div></li><li><div>                $this-&gt;textlength = $sw;&nbsp;</div></li><li><div>                $this-&gt;texttotallength += $this-&gt;textlength;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $path_cmd = sprintf('q %s %s Tr %s %s ', $opacitystr, $render, $fillstr, $strokestr);&nbsp;</div></li><li><div>                $path_cmd .= $subpath_cmd;&nbsp;</div></li><li><div>                $path_cmd .= 'Q ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset($this-&gt;txt_data[0], $this-&gt;txt_data[1], $this-&gt;txt_data[2]);&nbsp;</div></li><li><div>                return $path_cmd;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // select font&nbsp;</div></li><li><div>            $style .= ($current_style['font-weight'] == 'bold') ? 'B' : '';&nbsp;</div></li><li><div>            $style .= ($current_style['font-style'] == 'italic') ? 'I' : '';&nbsp;</div></li><li><div>            $size = $current_style['font-size'] * $this-&gt;kf;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $current_style['font-family'] = $this-&gt;mpdf_ref-&gt;SetFont($current_style['font-family'], $style, $size, false);&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;CurrentFont['fo'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $opacitystr = '';&nbsp;</div></li><li><div>            // mPDF 6&nbsp;</div></li><li><div>            $fopacity = 1;&nbsp;</div></li><li><div>            if (isset($current_style['fill-opacity'])) {&nbsp;</div></li><li><div>                if ($current_style['fill-opacity'] == 0) {&nbsp;</div></li><li><div>                    $fopacity = 0;&nbsp;</div></li><li><div>                } else if ($current_style['fill-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                    $fopacity = 1;&nbsp;</div></li><li><div>                } else if ($current_style['fill-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                    $fopacity = $current_style['fill-opacity'];&nbsp;</div></li><li><div>                } else if ($current_style['fill-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                    $fopacity = 0;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sopacity = 1;&nbsp;</div></li><li><div>            if (isset($current_style['stroke-opacity'])) {&nbsp;</div></li><li><div>                if ($current_style['stroke-opacity'] == 0) {&nbsp;</div></li><li><div>                    $sopacity = 0;&nbsp;</div></li><li><div>                } else if ($current_style['stroke-opacity'] &gt; 1) {&nbsp;</div></li><li><div>                    $sopacity = 1;&nbsp;</div></li><li><div>                } else if ($current_style['stroke-opacity'] &gt; 0) {&nbsp;</div></li><li><div>                    $sopacity = $current_style['stroke-opacity'];&nbsp;</div></li><li><div>                } else if ($current_style['stroke-opacity'] &lt; 0) {&nbsp;</div></li><li><div>                    $sopacity = 0;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array('ca' =&gt; $fopacity, 'CA' =&gt; $sopacity, 'BM' =&gt; '/Normal'));&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;extgstates[$gs]['fo'] = true;&nbsp;</div></li><li><div>            $opacitystr = sprintf(' /GS%d gs ', $gs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fillstr = '';&nbsp;</div></li><li><div>            if (isset($current_style['fill']) && $current_style['fill'] != 'none') {&nbsp;</div></li><li><div>                $col = $this-&gt;mpdf_ref-&gt;ConvertColor($current_style['fill']);&nbsp;</div></li><li><div>                $fillstr = $this-&gt;mpdf_ref-&gt;SetFColor($col, true);&nbsp;</div></li><li><div>                $render = &quot;0&quot;; // Fill (only)&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $strokestr = '';&nbsp;</div></li><li><div>            if (isset($current_style['stroke-width']) && $current_style['stroke-width'] &gt; 0 && $current_style['stroke'] != 'none') {&nbsp;</div></li><li><div>                $scol = $this-&gt;mpdf_ref-&gt;ConvertColor($current_style['stroke']);&nbsp;</div></li><li><div>                if ($scol) {&nbsp;</div></li><li><div>                    $strokestr .= $this-&gt;mpdf_ref-&gt;SetDColor($scol, true) . ' ';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $linewidth = $this-&gt;ConvertSVGSizePixels($current_style['stroke-width']);&nbsp;</div></li><li><div>                if ($linewidth &gt; 0) {&nbsp;</div></li><li><div>                    $strokestr .= sprintf('%.3F w 1 J 1 j ', $linewidth * $this-&gt;kp);&nbsp;</div></li><li><div>                    if ($render == -1) {&nbsp;</div></li><li><div>                        $render = &quot;1&quot;;&nbsp;</div></li><li><div>                    } // stroke only&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $render = &quot;2&quot;;&nbsp;</div></li><li><div>                    }  // fill and stroke&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($render == -1) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $x = $this-&gt;txt_data[0]; // mPDF 5.7.4&nbsp;</div></li><li><div>            $y = $this-&gt;txt_data[1]; // mPDF 5.7.4&nbsp;</div></li><li><div>            $txt = $this-&gt;txt_data[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $txt = preg_replace('/\f/', '', $txt);&nbsp;</div></li><li><div>            $txt = preg_replace('/\r/', '', $txt);&nbsp;</div></li><li><div>            $txt = preg_replace('/\n/', ' ', $txt);&nbsp;</div></li><li><div>            $txt = preg_replace('/\t/', ' ', $txt);&nbsp;</div></li><li><div>            $txt = preg_replace(&quot;/[ ]+/u&quot;, ' ', $txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;textjuststarted) {&nbsp;</div></li><li><div>                $txt = ltrim($txt);&nbsp;</div></li><li><div>            }  // mPDF 5.7.4&nbsp;</div></li><li><div>            $this-&gt;textjuststarted = false;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $txt = $this-&gt;mpdf_ref-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>            if ($this-&gt;mpdf_ref-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>                $txt = $this-&gt;mpdf_ref-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;mpdf_ref-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                $txt = mb_convert_encoding($txt, $this-&gt;mpdf_ref-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (preg_match(&quot;/([&quot; . $this-&gt;mpdf_ref-&gt;pregRTLchars . &quot;])/u&quot;, $txt)) {&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;biDirectional = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $textvar = 0;&nbsp;</div></li><li><div>            $save_OTLtags = $this-&gt;mpdf_ref-&gt;OTLtags;&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;OTLtags = array();&nbsp;</div></li><li><div>            if ($this-&gt;mpdf_ref-&gt;useKerning) {&nbsp;</div></li><li><div>                if ($this-&gt;mpdf_ref-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>                    if (isset($this-&gt;mpdf_ref-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                        $this-&gt;mpdf_ref-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $this-&gt;mpdf_ref-&gt;OTLtags['Plus'] = ' kern';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $textvar = ($textvar | FC_KERNING);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Use OTL OpenType Table Layout - GSUB & GPOS&nbsp;</div></li><li><div>            if (isset($this-&gt;mpdf_ref-&gt;CurrentFont['useOTL']) && $this-&gt;mpdf_ref-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                $txt = $this-&gt;mpdf_ref-&gt;otl-&gt;applyOTL($txt, $this-&gt;mpdf_ref-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>                $OTLdata = $this-&gt;mpdf_ref-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;OTLtags = $save_OTLtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;magic_reverse_dir($txt, $this-&gt;mpdf_ref-&gt;directionality, $OTLdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;CurrentFont['used'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sw = $this-&gt;mpdf_ref-&gt;GetStringWidth($txt, true, $OTLdata, $textvar); // also adds characters to subset&nbsp;</div></li><li><div>            // mPDF 5.7.4&nbsp;</div></li><li><div>            $this-&gt;textlength = $sw * 1 / (25.4 / $this-&gt;mpdf_ref-&gt;dpi);&nbsp;</div></li><li><div>            $this-&gt;texttotallength += $this-&gt;textlength;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pdfx = $x * $this-&gt;kp;&nbsp;</div></li><li><div>            $pdfy = -$y * $this-&gt;kp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $aixextra = sprintf(' /F%d %.3F Tf %s %s Tr %s %s ', $this-&gt;mpdf_ref-&gt;CurrentFont['i'], $this-&gt;mpdf_ref-&gt;FontSizePt, $opacitystr, $render, $fillstr, $strokestr);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $path_cmd = 'q 1 0 0 1 mPDF-AXS(0.00) 0 cm '; // Align X-shift&nbsp;</div></li><li><div>            $path_cmd .= $this-&gt;mpdf_ref-&gt;Text($pdfx, $pdfy, $txt, $OTLdata, $textvar, $aixextra, 'SVG', true);&nbsp;</div></li><li><div>            $path_cmd .= &quot; Q\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset($this-&gt;txt_data[0], $this-&gt;txt_data[1], $this-&gt;txt_data[2]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($current_style['font-size-parent'])) {&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;SetFontSize($current_style['font-size-parent']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return ' ';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Reset font    // mPDF 5.7.4&nbsp;</div></li><li><div>        $prev_style = $this-&gt;txt_style[count($this-&gt;txt_style) - 1];&nbsp;</div></li><li><div>        $style = '';&nbsp;</div></li><li><div>        $style .= ($prev_style['font-weight'] == 'bold') ? 'B' : '';&nbsp;</div></li><li><div>        $style .= ($prev_style['font-style'] == 'italic') ? 'I' : '';&nbsp;</div></li><li><div>        $size = $prev_style['font-size'] * $this-&gt;kf;&nbsp;</div></li><li><div>        $this-&gt;mpdf_ref-&gt;SetFont($prev_style['font-family'], $style, $size, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $path_cmd;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function svgDefineTxtStyle($critere_style)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // get copy of current/default txt style, and modify it with supplied attributes&nbsp;</div></li><li><div>        $tmp = count($this-&gt;txt_style) - 1;&nbsp;</div></li><li><div>        $current_style = $this-&gt;txt_style[$tmp];&nbsp;</div></li><li><div>        if (isset($critere_style['style'])) {&nbsp;</div></li><li><div>            if (preg_match('/fill:\s*rgb\((\d+), \s*(\d+), \s*(\d+)\)/', $critere_style['style'], $m)) {&nbsp;</div></li><li><div>                $current_style['fill'] = '#' . str_pad(dechex($m[1]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[2]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[3]), 2, &quot;0&quot;, STR_PAD_LEFT);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = preg_replace(&quot;/(.*)fill:\s*([a-z0-9#_()]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>                if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                    $current_style['fill'] = $tmp;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 6&nbsp;</div></li><li><div>            if (preg_match(&quot;/[^-]opacity:\s*([a-z0-9.]*|none)/i&quot;, $critere_style['style'], $m) ||&nbsp;</div></li><li><div>                preg_match(&quot;/^opacity:\s*([a-z0-9.]*|none)/i&quot;, $critere_style['style'], $m)) {&nbsp;</div></li><li><div>                $current_style['fill-opacity'] = $m[1];&nbsp;</div></li><li><div>                $current_style['stroke-opacity'] = $m[1];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)fill-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['fill-opacity'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)fill-rule:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp != $critere_style['style'] && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['fill-rule'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (preg_match('/stroke:\s*rgb\((\d+), \s*(\d+), \s*(\d+)\)/', $critere_style['style'], $m)) {&nbsp;</div></li><li><div>                $current_style['stroke'] = '#' . str_pad(dechex($m[1]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[2]), 2, &quot;0&quot;, STR_PAD_LEFT) . str_pad(dechex($m[3]), 2, &quot;0&quot;, STR_PAD_LEFT);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = preg_replace(&quot;/(.*)stroke:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>                if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                    $current_style['stroke'] = $tmp;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-linecap:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-linecap'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-linejoin:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-linejoin'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-miterlimit:\s*([a-z0-9#]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-miterlimit'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-opacity'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-width:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-width'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-dasharray:\s*([a-z0-9., ]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-dasharray'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)stroke-dashoffset:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $current_style['stroke-dashoffset'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)font-family:\s*([a-z0-9.\&quot;' , \-]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['font-family'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)font-size:\s*([a-z0-9.]*|none)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['font-size'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)font-weight:\s*([a-z0-9.]*|normal)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['font-weight'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)font-style:\s*([a-z0-9.]*|normal)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['font-style'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)font-variant:\s*([a-z0-9.]*|normal)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['font-variant'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)text-anchor:\s*(start|middle|end)(.*)/i&quot;, &quot;$2&quot;, $critere_style['style']);&nbsp;</div></li><li><div>            if ($tmp && $tmp != 'inherit' && $tmp != $critere_style['style']) {&nbsp;</div></li><li><div>                $critere_style['text-anchor'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['font'])) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // [ [ &lt;'font-style'&gt; || &lt;'font-variant'&gt; || &lt;'font-weight'&gt; ]?&lt;'font-size'&gt; [ / &lt;'line-height'&gt; ]? &lt;'font-family'&gt; ]&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)(italic|oblique)(.*)/i&quot;, &quot;$2&quot;, $critere_style['font']);&nbsp;</div></li><li><div>            if ($tmp != $critere_style['font']) {&nbsp;</div></li><li><div>                if ($tmp == 'oblique') {&nbsp;</div></li><li><div>                    $tmp = 'italic';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $current_style['font-style'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)(bold|bolder)(.*)/i&quot;, &quot;$2&quot;, $critere_style['font']);&nbsp;</div></li><li><div>            if ($tmp != $critere_style['font']) {&nbsp;</div></li><li><div>                if ($tmp == 'bolder') {&nbsp;</div></li><li><div>                    $tmp = 'bold';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $current_style['font-weight'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)(small\-caps)(.*)/i&quot;, &quot;$2&quot;, $critere_style['font']);&nbsp;</div></li><li><div>            if ($tmp != $critere_style['font']) {&nbsp;</div></li><li><div>                $current_style['font-variant'] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // select digits not followed by percent sign nor preceeded by forward slash&nbsp;</div></li><li><div>            $tmp = preg_replace(&quot;/(.*)\b(\d+)[\b|\/](.*)/i&quot;, &quot;$2&quot;, $critere_style['font']);&nbsp;</div></li><li><div>            if ($tmp != $critere_style['font']) {&nbsp;</div></li><li><div>                $current_style['font-size'] = $this-&gt;ConvertSVGSizePts($tmp);&nbsp;</div></li><li><div>                $this-&gt;mpdf_ref-&gt;SetFont('', '', $current_style['font-size'], false);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // mPDF 6&nbsp;</div></li><li><div>        if (isset($critere_style['opacity']) && $critere_style['opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill-opacity'] = $critere_style['opacity'];&nbsp;</div></li><li><div>            $current_style['stroke-opacity'] = $critere_style['opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // mPDF 6&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-opacity']) && $critere_style['stroke-opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-opacity'] = $critere_style['stroke-opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // mPDF 6&nbsp;</div></li><li><div>        if (isset($critere_style['fill-opacity']) && $critere_style['fill-opacity'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill-opacity'] = $critere_style['fill-opacity'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['fill']) && $critere_style['fill'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['fill'] = $critere_style['fill'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['stroke']) && $critere_style['stroke'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke'] = $critere_style['stroke'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['stroke-width']) && $critere_style['stroke-width'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['stroke-width'] = $critere_style['stroke-width'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['font-style']) && $critere_style['font-style'] != 'inherit') {&nbsp;</div></li><li><div>            if (strtolower($critere_style['font-style']) == 'oblique') {&nbsp;</div></li><li><div>                $critere_style['font-style'] = 'italic';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $current_style['font-style'] = $critere_style['font-style'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['font-weight']) && $critere_style['font-weight'] != 'inherit') {&nbsp;</div></li><li><div>            if (strtolower($critere_style['font-weight']) == 'bolder') {&nbsp;</div></li><li><div>                $critere_style['font-weight'] = 'bold';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $current_style['font-weight'] = $critere_style['font-weight'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['font-variant']) && $critere_style['font-variant'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['font-variant'] = $critere_style['font-variant'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['font-size']) && $critere_style['font-size'] != 'inherit') {&nbsp;</div></li><li><div>            if (strpos($critere_style['font-size'], '%') !== false) {&nbsp;</div></li><li><div>                $current_style['font-size-parent'] = $current_style['font-size'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $current_style['font-size'] = $this-&gt;ConvertSVGSizePts($critere_style['font-size']);&nbsp;</div></li><li><div>            $this-&gt;mpdf_ref-&gt;SetFont('', '', $current_style['font-size'], false);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($critere_style['font-family']) && $critere_style['font-family'] != 'inherit') {&nbsp;</div></li><li><div>            $v = $critere_style['font-family'];&nbsp;</div></li><li><div>            $aux_fontlist = explode(&quot;, &quot;, $v);&nbsp;</div></li><li><div>            $found = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $svgfontstyle = 'R';&nbsp;</div></li><li><div>            $svgfontstyle .= (isset($current_style['font-weight']) && $current_style['font-weight'] == 'bold') ? 'B' : '';&nbsp;</div></li><li><div>            $svgfontstyle .= (isset($current_style['font-style']) && $current_style['font-style'] == 'italic') ? 'I' : '';&nbsp;</div></li><li><div>            $svgfontstyle .= (isset($current_style['font-variant']) && $current_style['font-variant'] == 'small-caps') ? 'S' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($aux_fontlist AS $f) {&nbsp;</div></li><li><div>                $fonttype = trim($f);&nbsp;</div></li><li><div>                $fonttype = preg_replace('/[&quot;\']*(.*?)[&quot;\']*/', '\\1', $fonttype);&nbsp;</div></li><li><div>                $fonttype = preg_replace('/ /', '', $fonttype);&nbsp;</div></li><li><div>                $v = strtolower(trim($fonttype));&nbsp;</div></li><li><div>                if (isset($this-&gt;mpdf_ref-&gt;fonttrans[$v]) && $this-&gt;mpdf_ref-&gt;fonttrans[$v]) {&nbsp;</div></li><li><div>                    $v = $this-&gt;mpdf_ref-&gt;fonttrans[$v];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ((!$this-&gt;mpdf_ref-&gt;usingCoreFont && in_array($v, $this-&gt;mpdf_ref-&gt;available_unifonts)) ||&nbsp;</div></li><li><div>                    ($this-&gt;mpdf_ref-&gt;usingCoreFont && in_array($v, array('courier', 'times', 'helvetica', 'arial'))) ||&nbsp;</div></li><li><div>                    in_array($v, array('sjis', 'uhc', 'big5', 'gb')) || isset($this-&gt;svg_font[$v][$svgfontstyle])) { // mPDF 6&nbsp;</div></li><li><div>                    $current_style['font-family'] = $v;&nbsp;</div></li><li><div>                    $found = 1;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!$found) {&nbsp;</div></li><li><div>                foreach ($aux_fontlist AS $f) {&nbsp;</div></li><li><div>                    $fonttype = trim($f);&nbsp;</div></li><li><div>                    $fonttype = preg_replace('/[&quot;\']*(.*?)[&quot;\']*/', '\\1', $fonttype);&nbsp;</div></li><li><div>                    $fonttype = preg_replace('/ /', '', $fonttype);&nbsp;</div></li><li><div>                    $v = strtolower(trim($fonttype));&nbsp;</div></li><li><div>                    if (isset($this-&gt;mpdf_ref-&gt;fonttrans[$v]) && $this-&gt;mpdf_ref-&gt;fonttrans[$v]) {&nbsp;</div></li><li><div>                        $v = $this-&gt;mpdf_ref-&gt;fonttrans[$v];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (in_array($v, $this-&gt;mpdf_ref-&gt;sans_fonts) || in_array($v, $this-&gt;mpdf_ref-&gt;serif_fonts) || in_array($v, $this-&gt;mpdf_ref-&gt;mono_fonts) || isset($this-&gt;svg_font[$v][$svgfontstyle])) {  // mPDF 6&nbsp;</div></li><li><div>                        $current_style['font-family'] = $v;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($critere_style['text-anchor']) && $critere_style['text-anchor'] != 'inherit') {&nbsp;</div></li><li><div>            $current_style['text-anchor'] = $critere_style['text-anchor'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add current style to text style array (will remove it later after writing text to svg_string)&nbsp;</div></li><li><div>        array_push($this-&gt;txt_style, $current_style);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    fonction ajoutant un gradient&nbsp;</div></li><li><div>    function svgAddGradient($id, $array_gradient)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_gradient[$id] = $array_gradient;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    Ajoute une couleur dans le gradient correspondant&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    //    function ecrivant dans le svgstring&nbsp;</div></li><li><div>    function svgWriteString($content)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_string .= $content;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //    analise le svg et renvoie aux fonctions precedente our le traitement&nbsp;</div></li><li><div>    function ImageSVG($data)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Try to clean up the start of the file&nbsp;</div></li><li><div>        // removing DOCTYPE fails with this:&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>          &lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1 Tiny//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd&quot;&nbsp;</div></li><li><div>          [&nbsp;</div></li><li><div>          &lt;!ELEMENT Paragraph (#PCDATA)&gt;&nbsp;</div></li><li><div> ]&gt;&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        //$data = preg_replace('/&lt;!DOCTYPE.*?  &gt;/is', '', $data);&nbsp;</div></li><li><div>        //$data = preg_replace('/&lt;\?xml.*?  &gt;/is', '', $data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = preg_replace('/^.*?&lt;svg([&gt; ])/is', '&lt;svg\\1', $data); // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = preg_replace('/&lt;!--.*?--&gt;/is', '', $data); // mPDF 5.7.4&nbsp;</div></li><li><div>        // Converts &lt; to &lt; when not a tag&nbsp;</div></li><li><div>        $data = preg_replace('/&lt;([^!?\/a-zA-Z_:])/i', '&lt;\\1', $data); // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (_SVG_AUTOFONT) {&nbsp;</div></li><li><div>            $data = $this-&gt;markScriptToLang($data);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_info = array();&nbsp;</div></li><li><div>        $last_gradid = ''; // mPDF 6&nbsp;</div></li><li><div>        $last_svg_fontid = ''; // mPDF 6&nbsp;</div></li><li><div>        $last_svg_fontdefw = ''; // mPDF 6&nbsp;</div></li><li><div>        $last_svg_fontstyle = ''; // mPDF 6&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (preg_match('/&lt;!ENTITY/si', $data)) {&nbsp;</div></li><li><div>            // Get User-defined entities&nbsp;</div></li><li><div>            preg_match_all('/&lt;!ENTITY\s+([a-z]+)\s+\&quot;(.*?)\&quot;&gt;/si', $data, $ent);&nbsp;</div></li><li><div>            // Replace entities&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($ent[0]); $i++) {&nbsp;</div></li><li><div>                $data = preg_replace('/&' . preg_quote($ent[1][$i], '/') . ';/is', $ent[2][$i], $data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (preg_match('/xlink:href\s*=/si', $data)) {&nbsp;</div></li><li><div>            // GRADIENTS&nbsp;</div></li><li><div>            // Get links&nbsp;</div></li><li><div>            preg_match_all('/(&lt;(linearGradient|radialgradient)[^&gt;]*)xlink:href\s*=\s*[&quot;\']#(.*?)[&quot;\'](.*?)\/&gt;/si', $data, $links);&nbsp;</div></li><li><div>            if (count($links[0])) {&nbsp;</div></li><li><div>                $links[5] = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Delete links from data - keeping in $links&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($links[0]); $i++) {&nbsp;</div></li><li><div>                $links[5][$i] = 'tmpLink' . RAND(100000, 9999999);&nbsp;</div></li><li><div>                $data = preg_replace('/' . preg_quote($links[0][$i], '/') . '/is', '&lt;MYLINKS' . $links[5][$i] . '&gt;', $data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Get targets&nbsp;</div></li><li><div>            preg_match_all('/&lt;(linearGradient|radialgradient)([^&gt;]*)id\s*=\s*[&quot;\'](.*?)[&quot;\'](.*?)&gt;(.*?)&lt;\/(linearGradient|radialgradient)&gt;/si', $data, $m);&nbsp;</div></li><li><div>            $targets = array();&nbsp;</div></li><li><div>            $stops = array();&nbsp;</div></li><li><div>            // keeping in $targets&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($m[0]); $i++) {&nbsp;</div></li><li><div>                $stops[$m[3][$i]] = $m[5][$i];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Add back links this time as targets (gradients)&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($links[0]); $i++) {&nbsp;</div></li><li><div>                $def = $links[1][$i] . ' ' . $links[4][$i] . '&gt;' . $stops[$links[3][$i]] . '&lt;/' . $links[2][$i] . '&gt;';&nbsp;</div></li><li><div>                $data = preg_replace('/&lt;MYLINKS' . $links[5][$i] . '&gt;/is', $def, $data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.7.4&nbsp;</div></li><li><div>            // &lt;TREF&gt;&nbsp;</div></li><li><div>            preg_match_all('/&lt;tref ([^&gt;]*)xlink:href\s*=\s*[&quot;\']#([^&gt;]*?)[&quot;\']([^&gt;]*)\/&gt;/si', $data, $links);&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($links[0]); $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Get the item to use from defs&nbsp;</div></li><li><div>                $insert = '';&nbsp;</div></li><li><div>                if (preg_match('/&lt;text [^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\'][^&gt;]*&gt;(.*?)&lt;\/text&gt;/si', $data, $m)) {&nbsp;</div></li><li><div>                    $insert = $m[1];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($insert) {&nbsp;</div></li><li><div>                    $data = preg_replace('/' . preg_quote($links[0][$i], '/') . '/is', $insert, $data);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // mPDF 5.7.2&nbsp;</div></li><li><div>            // &lt;USE&gt;&nbsp;</div></li><li><div>            preg_match_all('/&lt;use ([^&gt;]*)xlink:href\s*=\s*[&quot;\']#([^&gt;]*?)[&quot;\']([^&gt;]*)\/&gt;/si', $data, $links);&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($links[0]); $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Get the item to use from defs&nbsp;</div></li><li><div>                $insert = '';&nbsp;</div></li><li><div>                if (preg_match('/&lt;([a-zA-Z]*) [^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\'][^&gt;]*\/&gt;/si', $data, $m)) {&nbsp;</div></li><li><div>                    $insert = $m[0];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!$insert && preg_match('/&lt;([a-zA-Z]*) [^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\']/si', $data, $m)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (preg_match('/&lt;' . $m[1] . '[^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\'][^&gt;]*&gt;.*?&lt;\/' . $m[1] . '&gt;/si', $data, $m)) {&nbsp;</div></li><li><div>                        $insert = $m[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($insert) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $inners = $links[1][$i] . ' ' . $links[3][$i];&nbsp;</div></li><li><div>                    // Change x, y coords to translate()&nbsp;</div></li><li><div>                    if (preg_match('/y\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                        $y = $m[1];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $y = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match('/x\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                        $x = $m[1];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $x = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($x || $y) {&nbsp;</div></li><li><div>                        $inners = preg_replace('/(y|x)\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', '', $inners);&nbsp;</div></li><li><div>                        if (preg_match('/transform\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                            if (preg_match('/translate\(\s*([0-9\.]+)\s*, \s*([0-9\.]+)\s*\)/', $m[1], $mm)) {&nbsp;</div></li><li><div>                                $transform = $m[1]; // transform=&quot;....&quot;&nbsp;</div></li><li><div>                                $x += $mm[1];&nbsp;</div></li><li><div>                                $y += $mm[2];&nbsp;</div></li><li><div>                                $transform = preg_replace('/' . preg_quote($mm[0], '/') . '/', '', $transform);&nbsp;</div></li><li><div>                                $transform = 'transform=&quot;' . $transform . ' translate(' . $x . ', ' . $y . ')&quot;';&nbsp;</div></li><li><div>                                $inners = preg_replace('/' . preg_quote($m[0], '/') . '/is', $transform, $inners);&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $inners = preg_replace('/' . preg_quote($m[0], '/') . '/is', 'transform=&quot;' . $m[1] . ' translate(' . $x . ', ' . $y . ')&quot;', $inners);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $inners .= ' transform=&quot;translate(' . $x . ', ' . $y . ')&quot;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $replacement = '&lt;g ' . $inners . '&gt;' . $insert . '&lt;/g&gt;';&nbsp;</div></li><li><div>                $data = preg_replace('/' . preg_quote($links[0][$i], '/') . '/is', $replacement, $data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            preg_match_all('/&lt;use ([^&gt;]*)xlink:href\s*=\s*[&quot;\']#([^&gt;]*?)[&quot;\']([^&gt;]*)&gt;\s*&lt;\/use&gt;/si', $data, $links);&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($links[0]); $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Get the item to use from defs&nbsp;</div></li><li><div>                $insert = '';&nbsp;</div></li><li><div>                if (preg_match('/&lt;([a-zA-Z]*) [^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\'][^&gt;]*\/&gt;/si', $data, $m)) {&nbsp;</div></li><li><div>                    $insert = $m[0];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!$insert && preg_match('/&lt;([a-zA-Z]*) [^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\']/si', $data, $m)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (preg_match('/&lt;' . $m[1] . '[^&gt;]*id\s*=\s*[&quot;\']' . $links[2][$i] . '[&quot;\'][^&gt;]*&gt;.*?&lt;\/' . $m[1] . '&gt;/si', $data, $m)) {&nbsp;</div></li><li><div>                        $insert = $m[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($insert) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $inners = $links[1][$i] . ' ' . $links[3][$i];&nbsp;</div></li><li><div>                    // Change x, y coords to translate()&nbsp;</div></li><li><div>                    if (preg_match('/y\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                        $y = $m[1];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $y = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match('/x\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                        $x = $m[1];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $x = 0;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($x || $y) {&nbsp;</div></li><li><div>                        $inners = preg_replace('/(y|x)\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', '', $inners);&nbsp;</div></li><li><div>                        if (preg_match('/transform\s*=\s*[&quot;\']([^&gt;]*?)[&quot;\']/', $inners, $m)) {&nbsp;</div></li><li><div>                            if (preg_match('/translate\(\s*([0-9\.]+)\s*, \s*([0-9\.]+)\s*\)/', $m[1], $mm)) {&nbsp;</div></li><li><div>                                $transform = $m[1]; // transform=&quot;....&quot;&nbsp;</div></li><li><div>                                $x += $mm[1];&nbsp;</div></li><li><div>                                $y += $mm[2];&nbsp;</div></li><li><div>                                $transform = preg_replace('/' . preg_quote($mm[0], '/') . '/', '', $transform);&nbsp;</div></li><li><div>                                $transform = 'transform=&quot;' . $transform . ' translate(' . $x . ', ' . $y . ')&quot;';&nbsp;</div></li><li><div>                                $inners = preg_replace('/' . preg_quote($m[0], '/') . '/is', $transform, $inners);&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $inners = preg_replace('/' . preg_quote($m[0], '/') . '/is', 'transform=&quot;' . $m[1] . ' translate(' . $x . ', ' . $y . ')&quot;', $inners);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $inners .= ' transform=&quot;translate(' . $x . ', ' . $y . ')&quot;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $replacement = '&lt;g ' . $inners . '&gt;' . $insert . '&lt;/g&gt;';&nbsp;</div></li><li><div>                    $data = preg_replace('/' . preg_quote($links[0][$i], '/') . '/is', $replacement, $data);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Removes &lt;pattern&gt;&nbsp;</div></li><li><div>        $data = preg_replace('/&lt;pattern.*?&lt;\/pattern&gt;/is', '', $data);&nbsp;</div></li><li><div>        // Removes &lt;marker&gt;&nbsp;</div></li><li><div>        $data = preg_replace('/&lt;marker.*?&lt;\/marker&gt;/is', '', $data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_info['data'] = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;svg_string = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //&nbsp;</div></li><li><div>        //    chargement unique des fonctions&nbsp;</div></li><li><div>        if (!function_exists(&quot;xml_svg2pdf_start&quot;)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            function xml_svg2pdf_start($parser, $name, $attribs)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                //&nbsp;</div></li><li><div>                //    definition&nbsp;</div></li><li><div>                global $svg_class, $last_gradid, $last_svg_fontid, $last_svg_fontdefw, $last_svg_fontstyle; // mPDF 6&nbsp;</div></li><li><div>                // mPDF 6&nbsp;</div></li><li><div>                if (strtolower($name) == 'font') {&nbsp;</div></li><li><div>                    $last_svg_fontid = '';&nbsp;</div></li><li><div>                    if (isset($attribs['horiz-adv-x']) && $attribs['horiz-adv-x']) {&nbsp;</div></li><li><div>                        $last_svg_fontdefw = $attribs['horiz-adv-x'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // mPDF 6&nbsp;</div></li><li><div>                else if (strtolower($name) == 'font-face') {&nbsp;</div></li><li><div>                    $last_svg_fontstyle = 'R';&nbsp;</div></li><li><div>                    $last_svg_fontstyle .= (isset($attribs['font-weight']) && $attribs['font-weight'] == 'bold') ? 'B' : '';&nbsp;</div></li><li><div>                    $last_svg_fontstyle .= (isset($attribs['font-style']) && $attribs['font-style'] == 'italic') ? 'I' : '';&nbsp;</div></li><li><div>                    $last_svg_fontstyle .= (isset($attribs['font-variant']) && $attribs['font-variant'] == 'small-caps') ? 'S' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (isset($attribs['font-family']) && $attribs['font-family']) {&nbsp;</div></li><li><div>                        $tmp_svg_font = array(&nbsp;</div></li><li><div>                            'units-per-em' =&gt; (isset($attribs['units-per-em']) ? $attribs['units-per-em'] : ''), &nbsp;</div></li><li><div>                            'd' =&gt; '', &nbsp;</div></li><li><div>                            'glyphs' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        $last_svg_fontid = strtolower($attribs['font-family']);&nbsp;</div></li><li><div>                        if ($last_svg_fontdefw) {&nbsp;</div></li><li><div>                            $tmp_svg_font['horiz-adv-x'] = $last_svg_fontdefw;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $tmp_svg_font['horiz-adv-x'] = 500;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_font[$last_svg_fontid][$last_svg_fontstyle] = $tmp_svg_font;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // mPDF 6&nbsp;</div></li><li><div>                else if (strtolower($name) == 'missing-glyph') {&nbsp;</div></li><li><div>                    if ($last_svg_fontid && isset($attribs['horiz-adv-x'])) {&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_font[$last_svg_fontid][$last_svg_fontstyle]['horiz-adv-x'] = (isset($attribs['horiz-adv-x']) ? $attribs['horiz-adv-x'] : '');&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_font[$last_svg_fontid][$last_svg_fontstyle]['d'] = (isset($attribs['d']) ? $attribs['d'] : '');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // mPDF 6&nbsp;</div></li><li><div>                else if (strtolower($name) == 'glyph') {&nbsp;</div></li><li><div>                    if ($last_svg_fontid && isset($attribs['unicode'])) {&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_font[$last_svg_fontid][$last_svg_fontstyle]['glyphs'][$attribs['unicode']] = array(&nbsp;</div></li><li><div>                            'horiz-adv-x' =&gt; (isset($attribs['horiz-adv-x']) ? $attribs['horiz-adv-x'] : $last_svg_fontdefw), &nbsp;</div></li><li><div>                            'd' =&gt; (isset($attribs['d']) ? $attribs['d'] : ''), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // mPDF 5.7.2&nbsp;</div></li><li><div>                else if (strtolower($name) == 'lineargradient') {&nbsp;</div></li><li><div>                    $tmp_gradient = array(&nbsp;</div></li><li><div>                        'type' =&gt; 'linear', &nbsp;</div></li><li><div>                        'transform' =&gt; (isset($attribs['gradientTransform']) ? $attribs['gradientTransform'] : ''), &nbsp;</div></li><li><div>                        'units' =&gt; (isset($attribs['gradientUnits']) ? $attribs['gradientUnits'] : ''), &nbsp;</div></li><li><div>                        'spread' =&gt; (isset($attribs['spreadMethod']) ? $attribs['spreadMethod'] : ''), &nbsp;</div></li><li><div>                        'color' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    if (isset($attribs['x1']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['x1'] = $attribs['x1'];&nbsp;</div></li><li><div>                    if (isset($attribs['y1']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['y1'] = $attribs['y1'];&nbsp;</div></li><li><div>                    if (isset($attribs['x2']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['x2'] = $attribs['x2'];&nbsp;</div></li><li><div>                    if (isset($attribs['y2']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['y2'] = $attribs['y2'];&nbsp;</div></li><li><div>                    $last_gradid = $attribs['id'];&nbsp;</div></li><li><div>                    $svg_class-&gt;svgAddGradient($attribs['id'], $tmp_gradient);&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else if (strtolower($name) == 'radialgradient') {&nbsp;</div></li><li><div>                    $tmp_gradient = array(&nbsp;</div></li><li><div>                        'type' =&gt; 'radial', &nbsp;</div></li><li><div>                        'transform' =&gt; (isset($attribs['gradientTransform']) ? $attribs['gradientTransform'] : ''), &nbsp;</div></li><li><div>                        'units' =&gt; (isset($attribs['gradientUnits']) ? $attribs['gradientUnits'] : ''), &nbsp;</div></li><li><div>                        'spread' =&gt; (isset($attribs['spreadMethod']) ? $attribs['spreadMethod'] : ''), &nbsp;</div></li><li><div>                        'color' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    if (isset($attribs['cx']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['x0'] = $attribs['cx'];&nbsp;</div></li><li><div>                    if (isset($attribs['cy']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['y0'] = $attribs['cy'];&nbsp;</div></li><li><div>                    if (isset($attribs['fx']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['x1'] = $attribs['fx'];&nbsp;</div></li><li><div>                    if (isset($attribs['fy']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['y1'] = $attribs['fy'];&nbsp;</div></li><li><div>                    if (isset($attribs['r']))&nbsp;</div></li><li><div>                        $tmp_gradient['info']['r'] = $attribs['r'];&nbsp;</div></li><li><div>                    $last_gradid = $attribs['id'];&nbsp;</div></li><li><div>                    $svg_class-&gt;svgAddGradient($attribs['id'], $tmp_gradient);&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else if (strtolower($name) == 'stop') {&nbsp;</div></li><li><div>                    if (!$last_gradid)&nbsp;</div></li><li><div>                        return;&nbsp;</div></li><li><div>                    $color = '#000000';&nbsp;</div></li><li><div>                    if (isset($attribs['style']) AND preg_match('/stop-color:\s*([^;]*)/i', $attribs['style'], $m)) {&nbsp;</div></li><li><div>                        $color = trim($m[1]);&nbsp;</div></li><li><div>                    } else if (isset($attribs['stop-color']) && $attribs['stop-color']) {&nbsp;</div></li><li><div>                        $color = $attribs['stop-color'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $col = $svg_class-&gt;mpdf_ref-&gt;ConvertColor($color);&nbsp;</div></li><li><div>                    if (!$col) {&nbsp;</div></li><li><div>                        $col = $svg_class-&gt;mpdf_ref-&gt;ConvertColor('#000000');&nbsp;</div></li><li><div>                    } // In case &quot;transparent&quot; or &quot;inherit&quot; returned&nbsp;</div></li><li><div>                    if ($col{0} == 3 || $col{0} == 5) { // RGB&nbsp;</div></li><li><div>                        $color_final = sprintf('%.3F %.3F %.3F', ord($col{1}) / 255, ord($col{2}) / 255, ord($col{3}) / 255);&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_gradient[$last_gradid]['colorspace'] = 'RGB';&nbsp;</div></li><li><div>                    } else if ($col{0} == 4 || $col{0} == 6) { // CMYK&nbsp;</div></li><li><div>                        $color_final = sprintf('%.3F %.3F %.3F %.3F', ord($col{1}) / 100, ord($col{2}) / 100, ord($col{3}) / 100, ord($col{4}) / 100);&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_gradient[$last_gradid]['colorspace'] = 'CMYK';&nbsp;</div></li><li><div>                    } else if ($col{0} == 1) { // Grayscale&nbsp;</div></li><li><div>                        $color_final = sprintf('%.3F', ord($col{1}) / 255);&nbsp;</div></li><li><div>                        $svg_class-&gt;svg_gradient[$last_gradid]['colorspace'] = 'Gray';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $stop_opacity = 1;&nbsp;</div></li><li><div>                    if (isset($attribs['style']) AND preg_match('/stop-opacity:\s*([0-9.]*)/i', $attribs['style'], $m)) {&nbsp;</div></li><li><div>                        $stop_opacity = $m[1];&nbsp;</div></li><li><div>                    } else if (isset($attribs['stop-opacity'])) {&nbsp;</div></li><li><div>                        $stop_opacity = $attribs['stop-opacity'];&nbsp;</div></li><li><div>                    } else if ($col{0} == 5) { // RGBa&nbsp;</div></li><li><div>                        $stop_opacity = ord($col{4} / 100);&nbsp;</div></li><li><div>                    } else if ($col{0} == 6) { // CMYKa&nbsp;</div></li><li><div>                        $stop_opacity = ord($col{5} / 100);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $tmp_color = array(&nbsp;</div></li><li><div>                        'color' =&gt; $color_final, &nbsp;</div></li><li><div>                        'offset' =&gt; (isset($attribs['offset']) ? $attribs['offset'] : ''), &nbsp;</div></li><li><div>                        'opacity' =&gt; $stop_opacity&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    array_push($svg_class-&gt;svg_gradient[$last_gradid]['color'], $tmp_color);&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($svg_class-&gt;inDefs) {&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $svg_class-&gt;xbase = 0;&nbsp;</div></li><li><div>                $svg_class-&gt;ybase = 0;&nbsp;</div></li><li><div>                switch (strtolower($name)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Don't output stuff inside &lt;defs&gt;&nbsp;</div></li><li><div>                    case 'defs':&nbsp;</div></li><li><div>                        $svg_class-&gt;inDefs = true;&nbsp;</div></li><li><div>                        return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'svg':&nbsp;</div></li><li><div>                        $svg_class-&gt;svgOffset($attribs);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'path':&nbsp;</div></li><li><div>                        $path = $attribs['d'];&nbsp;</div></li><li><div>                        preg_match_all('/([MZLHVCSQTAmzlhvcsqta])([eE , \-.\d]+)*/', $path, $commands, PREG_SET_ORDER);&nbsp;</div></li><li><div>                        $path_cmd = '';&nbsp;</div></li><li><div>                        $svg_class-&gt;subPathInit = true;&nbsp;</div></li><li><div>                        $svg_class-&gt;pathBBox = array(999999, 999999, -999999, -999999);&nbsp;</div></li><li><div>                        foreach ($commands as $c) {&nbsp;</div></li><li><div>                            if ((isset($c) && count($c) == 3) || (isset($c[2]) && $c[2] == '')) {&nbsp;</div></li><li><div>                                list($tmp, $command, $arguments) = $c;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                list($tmp, $command) = $c;&nbsp;</div></li><li><div>                                $arguments = '';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $path_cmd .= $svg_class-&gt;svgPath($command, $arguments);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($svg_class-&gt;pathBBox[2] == -1999998) {&nbsp;</div></li><li><div>                            $svg_class-&gt;pathBBox[2] = 100;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($svg_class-&gt;pathBBox[3] == -1999998) {&nbsp;</div></li><li><div>                            $svg_class-&gt;pathBBox[3] = 100;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($svg_class-&gt;pathBBox[0] == 999999) {&nbsp;</div></li><li><div>                            $svg_class-&gt;pathBBox[0] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($svg_class-&gt;pathBBox[1] == 999999) {&nbsp;</div></li><li><div>                            $svg_class-&gt;pathBBox[1] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['d']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'rect':&nbsp;</div></li><li><div>                        if (!isset($attribs['x'])) {&nbsp;</div></li><li><div>                            $attribs['x'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!isset($attribs['y'])) {&nbsp;</div></li><li><div>                            $attribs['y'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!isset($attribs['rx'])) {&nbsp;</div></li><li><div>                            $attribs['rx'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!isset($attribs['ry'])) {&nbsp;</div></li><li><div>                            $attribs['ry'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        if (isset($attribs['x']))&nbsp;</div></li><li><div>                            $arguments['x'] = $attribs['x'];&nbsp;</div></li><li><div>                        if (isset($attribs['y']))&nbsp;</div></li><li><div>                            $arguments['y'] = $attribs['y'];&nbsp;</div></li><li><div>                        if (isset($attribs['width']))&nbsp;</div></li><li><div>                            $arguments['w'] = $attribs['width'];&nbsp;</div></li><li><div>                        if (isset($attribs['height']))&nbsp;</div></li><li><div>                            $arguments['h'] = $attribs['height'];&nbsp;</div></li><li><div>                        if (isset($attribs['rx']))&nbsp;</div></li><li><div>                            $arguments['rx'] = $attribs['rx'];&nbsp;</div></li><li><div>                        if (isset($attribs['ry']))&nbsp;</div></li><li><div>                            $arguments['ry'] = $attribs['ry'];&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgRect($arguments);&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['x'], $critere_style['y'], $critere_style['rx'], $critere_style['ry'], $critere_style['height'], $critere_style['width']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'circle':&nbsp;</div></li><li><div>                        if (!isset($attribs['cx'])) {&nbsp;</div></li><li><div>                            $attribs['cx'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!isset($attribs['cy'])) {&nbsp;</div></li><li><div>                            $attribs['cy'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        if (isset($attribs['cx']))&nbsp;</div></li><li><div>                            $arguments['cx'] = $attribs['cx'];&nbsp;</div></li><li><div>                        if (isset($attribs['cy']))&nbsp;</div></li><li><div>                            $arguments['cy'] = $attribs['cy'];&nbsp;</div></li><li><div>                        if (isset($attribs['r']))&nbsp;</div></li><li><div>                            $arguments['rx'] = $attribs['r'];&nbsp;</div></li><li><div>                        if (isset($attribs['r']))&nbsp;</div></li><li><div>                            $arguments['ry'] = $attribs['r'];&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgEllipse($arguments);&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['cx'], $critere_style['cy'], $critere_style['r']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'ellipse':&nbsp;</div></li><li><div>                        if (!isset($attribs['cx'])) {&nbsp;</div></li><li><div>                            $attribs['cx'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!isset($attribs['cy'])) {&nbsp;</div></li><li><div>                            $attribs['cy'] = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        if (isset($attribs['cx']))&nbsp;</div></li><li><div>                            $arguments['cx'] = $attribs['cx'];&nbsp;</div></li><li><div>                        if (isset($attribs['cy']))&nbsp;</div></li><li><div>                            $arguments['cy'] = $attribs['cy'];&nbsp;</div></li><li><div>                        if (isset($attribs['rx']))&nbsp;</div></li><li><div>                            $arguments['rx'] = $attribs['rx'];&nbsp;</div></li><li><div>                        if (isset($attribs['ry']))&nbsp;</div></li><li><div>                            $arguments['ry'] = $attribs['ry'];&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgEllipse($arguments);&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['cx'], $critere_style['cy'], $critere_style['rx'], $critere_style['ry']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'line':&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        $arguments[0] = (isset($attribs['x1']) ? $attribs['x1'] : '');&nbsp;</div></li><li><div>                        $arguments[1] = (isset($attribs['y1']) ? $attribs['y1'] : '');&nbsp;</div></li><li><div>                        $arguments[2] = (isset($attribs['x2']) ? $attribs['x2'] : '');&nbsp;</div></li><li><div>                        $arguments[3] = (isset($attribs['y2']) ? $attribs['y2'] : '');&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgPolyline($arguments, false);&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['x1'], $critere_style['y1'], $critere_style['x2'], $critere_style['y2']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'polyline':&nbsp;</div></li><li><div>                        $path = $attribs['points'];&nbsp;</div></li><li><div>                        preg_match_all('/[0-9\-\.]*/', $path, $tmp, PREG_SET_ORDER);&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; count($tmp); $i++) {&nbsp;</div></li><li><div>                            if ($tmp[$i][0] != '') {&nbsp;</div></li><li><div>                                array_push($arguments, $tmp[$i][0]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgPolyline($arguments);&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['points']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'polygon':&nbsp;</div></li><li><div>                        $path = $attribs['points'];&nbsp;</div></li><li><div>                        preg_match_all('/([\-]*[0-9\.]+)/', $path, $tmp);&nbsp;</div></li><li><div>                        $arguments = array();&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; count($tmp[0]); $i++) {&nbsp;</div></li><li><div>                            if ($tmp[0][$i] != '') {&nbsp;</div></li><li><div>                                array_push($arguments, $tmp[0][$i]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgPolygon($arguments);&nbsp;</div></li><li><div>                        //    definition du style de la forme:&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['points']);&nbsp;</div></li><li><div>                        $path_style = $svg_class-&gt;svgDefineStyle($critere_style);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // mPDF 5.7.4 Embedded image&nbsp;</div></li><li><div>                    case 'image':&nbsp;</div></li><li><div>                        if (isset($attribs['xlink:href']) && $attribs['xlink:href']) {&nbsp;</div></li><li><div>                            $svg_class-&gt;svgImage($attribs);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'a':&nbsp;</div></li><li><div>                        if (isset($attribs['xlink:href'])) {&nbsp;</div></li><li><div>                            unset($attribs['xlink:href']); // this should be a hyperlink&nbsp;</div></li><li><div>                            // not handled like a xlink:href in other elements&nbsp;</div></li><li><div>                        }  // then continue like a &lt;g&gt;&nbsp;</div></li><li><div>                    case 'g':&nbsp;</div></li><li><div>                        $array_style = $svg_class-&gt;svgDefineStyle($attribs);&nbsp;</div></li><li><div>                        if (!empty($array_style['transformations'])) {&nbsp;</div></li><li><div>                            // If in the middle of &lt;text&gt; element, add to textoutput, else WriteString&nbsp;</div></li><li><div>                            if ($svg_class-&gt;intext) {&nbsp;</div></li><li><div>                                $svg_class-&gt;textoutput .= ' q ' . $array_style['transformations'];&nbsp;</div></li><li><div>                            } // mPDF 5.7.4&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                $svg_class-&gt;svgWriteString(' q ' . $array_style['transformations']);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_push($svg_class-&gt;svg_style, $array_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;svgDefineTxtStyle($attribs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'text':&nbsp;</div></li><li><div>                        $svg_class-&gt;textlength = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;texttotallength = 0; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textoutput = '';  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textanchor = 'start'; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textXorigin = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textYorigin = 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;intext = true;   // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $styl = '';&nbsp;</div></li><li><div>                        if (_SVG_CLASSES && isset($attribs['class']) && $attribs['class']) {&nbsp;</div></li><li><div>                            $classes = preg_split('/\s+/', trim($attribs['class']));&nbsp;</div></li><li><div>                            foreach ($classes AS $class) {&nbsp;</div></li><li><div>                                if (isset($svg_class-&gt;mpdf_ref-&gt;cssmgr-&gt;CSS['CLASS&gt;&gt;' . strtoupper($class)])) {&nbsp;</div></li><li><div>                                    $c = $svg_class-&gt;mpdf_ref-&gt;cssmgr-&gt;CSS['CLASS&gt;&gt;' . strtoupper($class)];&nbsp;</div></li><li><div>                                    foreach ($c AS $prop =&gt; $val) {&nbsp;</div></li><li><div>                                        $styl .= strtolower($prop) . ':' . $val . ';';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (_SVG_AUTOFONT && isset($attribs['lang']) && $attribs['lang']) {&nbsp;</div></li><li><div>                            if (!$svg_class-&gt;mpdf_ref-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                                if ($attribs['lang'] != $svg_class-&gt;mpdf_ref-&gt;default_lang) {&nbsp;</div></li><li><div>                                    list ($coreSuitable, $mpdf_unifont) = GetLangOpts($attribs['lang'], $svg_class-&gt;mpdf_ref-&gt;useAdobeCJK, $svg_class-&gt;mpdf_ref-&gt;fontdata);&nbsp;</div></li><li><div>                                    if ($mpdf_unifont) {&nbsp;</div></li><li><div>                                        $styl .= 'font-family:' . $mpdf_unifont . ';';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($styl) {&nbsp;</div></li><li><div>                            if (isset($attribs['style'])) {&nbsp;</div></li><li><div>                                $attribs['style'] = $styl . $attribs['style'];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $attribs['style'] = $styl;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $array_style = $svg_class-&gt;svgDefineStyle($attribs);&nbsp;</div></li><li><div>                        if (!empty($array_style['transformations'])) {&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput .= ' q ' . $array_style['transformations']; // mPDF 5.7.4&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_push($svg_class-&gt;svg_style, $array_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;txt_data = array();&nbsp;</div></li><li><div>                        $x = isset($attribs['x']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['x'], 'x') : 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $y = isset($attribs['y']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['y'], 'y') : 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $x += isset($attribs['dx']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['dx'], 'x') : 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $y += isset($attribs['dy']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['dy'], 'y') : 0;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;txt_data[0] = $x; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;txt_data[1] = $y; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $critere_style = $attribs;&nbsp;</div></li><li><div>                        unset($critere_style['x'], $critere_style['y']);&nbsp;</div></li><li><div>                        $svg_class-&gt;svgDefineTxtStyle($critere_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;textanchor = $svg_class-&gt;txt_style[count($svg_class-&gt;txt_style) - 1]['text-anchor']; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textXorigin = $svg_class-&gt;txt_data[0];  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textYorigin = $svg_class-&gt;txt_data[1];  // mPDF 5.7.4&nbsp;</div></li><li><div>                        $svg_class-&gt;textjuststarted = true;  // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // mPDF 5.7.4&nbsp;</div></li><li><div>                    case 'tspan':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // OUTPUT CHUNK(s) UP To NOW (svgText updates $svg_class-&gt;textlength)&nbsp;</div></li><li><div>                        $p_cmd = $svg_class-&gt;svgText();&nbsp;</div></li><li><div>                        $svg_class-&gt;textoutput .= $p_cmd;&nbsp;</div></li><li><div>                        $tmp = count($svg_class-&gt;svg_style) - 1;&nbsp;</div></li><li><div>                        $current_style = $svg_class-&gt;svg_style[$tmp];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $styl = '';&nbsp;</div></li><li><div>                        if (_SVG_CLASSES && isset($attribs['class']) && $attribs['class']) {&nbsp;</div></li><li><div>                            $classes = preg_split('/\s+/', trim($attribs['class']));&nbsp;</div></li><li><div>                            foreach ($classes AS $class) {&nbsp;</div></li><li><div>                                if (isset($svg_class-&gt;mpdf_ref-&gt;cssmgr-&gt;CSS['CLASS&gt;&gt;' . strtoupper($class)])) {&nbsp;</div></li><li><div>                                    $c = $svg_class-&gt;mpdf_ref-&gt;cssmgr-&gt;CSS['CLASS&gt;&gt;' . strtoupper($class)];&nbsp;</div></li><li><div>                                    foreach ($c AS $prop =&gt; $val) {&nbsp;</div></li><li><div>                                        $styl .= strtolower($prop) . ':' . $val . ';';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (_SVG_AUTOFONT && isset($attribs['lang']) && $attribs['lang']) {&nbsp;</div></li><li><div>                            if (!$svg_class-&gt;mpdf_ref-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                                if ($attribs['lang'] != $svg_class-&gt;mpdf_ref-&gt;default_lang) {&nbsp;</div></li><li><div>                                    list ($coreSuitable, $mpdf_unifont) = GetLangOpts($attribs['lang'], $svg_class-&gt;mpdf_ref-&gt;useAdobeCJK, $svg_class-&gt;mpdf_ref-&gt;fontdata);&nbsp;</div></li><li><div>                                    if ($mpdf_unifont) {&nbsp;</div></li><li><div>                                        $styl .= 'font-family:' . $mpdf_unifont . ';';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($styl) {&nbsp;</div></li><li><div>                            if (isset($attribs['style'])) {&nbsp;</div></li><li><div>                                $attribs['style'] = $styl . $attribs['style'];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $attribs['style'] = $styl;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $array_style = $svg_class-&gt;svgDefineStyle($attribs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;txt_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // If absolute position adjustment (x or y), creates new block of text for text-alignment&nbsp;</div></li><li><div>                        if (isset($attribs['x']) || isset($attribs['y'])) {&nbsp;</div></li><li><div>                            // If text-anchor middle|end, adjust&nbsp;</div></li><li><div>                            if ($svg_class-&gt;textanchor == 'end') {&nbsp;</div></li><li><div>                                $tx = -$svg_class-&gt;texttotallength;&nbsp;</div></li><li><div>                            } else if ($svg_class-&gt;textanchor == 'middle') {&nbsp;</div></li><li><div>                                $tx = -$svg_class-&gt;texttotallength / 2;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $tx = 0;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            while (preg_match('/mPDF-AXS\((.*?)\)/', $svg_class-&gt;textoutput, $m)) {&nbsp;</div></li><li><div>                                if ($tx) {&nbsp;</div></li><li><div>                                    $txk = $m[1] + ($tx * $svg_class-&gt;kp);&nbsp;</div></li><li><div>                                    $svg_class-&gt;textoutput = preg_replace('/mPDF-AXS\((.*?)\)/', sprintf('%.4F', $txk), $svg_class-&gt;textoutput, 1);&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $svg_class-&gt;textoutput = preg_replace('/mPDF-AXS\((.*?)\)/', '\\1', $svg_class-&gt;textoutput, 1);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;svgWriteString($svg_class-&gt;textoutput);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;textXorigin += $svg_class-&gt;textlength;&nbsp;</div></li><li><div>                            $currentX = $svg_class-&gt;textXorigin;&nbsp;</div></li><li><div>                            $currentY = $svg_class-&gt;textYorigin;&nbsp;</div></li><li><div>                            $svg_class-&gt;textlength = 0;&nbsp;</div></li><li><div>                            $svg_class-&gt;texttotallength = 0;&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $x = isset($attribs['x']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['x'], 'x') : $currentX;&nbsp;</div></li><li><div>                            $y = isset($attribs['y']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['y'], 'y') : $currentY;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;txt_data[0] = $x;&nbsp;</div></li><li><div>                            $svg_class-&gt;txt_data[1] = $y;&nbsp;</div></li><li><div>                            $critere_style = $attribs;&nbsp;</div></li><li><div>                            unset($critere_style['x'], $critere_style['y']);&nbsp;</div></li><li><div>                            $svg_class-&gt;svgDefineTxtStyle($critere_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;textanchor = $svg_class-&gt;txt_style[count($svg_class-&gt;txt_style) - 1]['text-anchor'];&nbsp;</div></li><li><div>                            $svg_class-&gt;textXorigin = $x;&nbsp;</div></li><li><div>                            $svg_class-&gt;textYorigin = $y;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;textXorigin += $svg_class-&gt;textlength;&nbsp;</div></li><li><div>                            $currentX = $svg_class-&gt;textXorigin;&nbsp;</div></li><li><div>                            $currentY = $svg_class-&gt;textYorigin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $currentX += isset($attribs['dx']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['dx'], 'x') : 0;&nbsp;</div></li><li><div>                            $currentY += isset($attribs['dy']) ? $svg_class-&gt;ConvertSVGSizePixels($attribs['dy'], 'y') : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $svg_class-&gt;txt_data[0] = $currentX;&nbsp;</div></li><li><div>                            $svg_class-&gt;txt_data[1] = $currentY;&nbsp;</div></li><li><div>                            $critere_style = $attribs;&nbsp;</div></li><li><div>                            unset($critere_style['x'], $critere_style['y']);&nbsp;</div></li><li><div>                            $svg_class-&gt;svgDefineTxtStyle($critere_style);&nbsp;</div></li><li><div>                            $svg_class-&gt;textXorigin = $currentX;&nbsp;</div></li><li><div>                            $svg_class-&gt;textYorigin = $currentY;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (!empty($array_style['transformations'])) {&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput .= ' q ' . $array_style['transformations'];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_push($svg_class-&gt;svg_style, $array_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //&nbsp;</div></li><li><div>                //insertion des path et du style dans le flux de donn general.&nbsp;</div></li><li><div>                if (isset($path_cmd) && $path_cmd) {&nbsp;</div></li><li><div>                    // mPDF 5.0&nbsp;</div></li><li><div>                    list($prestyle, $poststyle) = $svg_class-&gt;svgStyle($path_style, $attribs, strtolower($name));&nbsp;</div></li><li><div>                    if (isset($path_style['transformations']) && $path_style['transformations']) { // transformation on an element&nbsp;</div></li><li><div>                        $svg_class-&gt;svgWriteString(&quot; q &quot; . $path_style['transformations'] . $prestyle . $path_cmd . $poststyle . &quot; Q\n&quot;);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $svg_class-&gt;svgWriteString(&quot; q &quot; . $prestyle . $path_cmd . $poststyle . &quot; Q\n&quot;); // mPDF 5.7.4&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            function characterData($parser, $data)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                global $svg_class;&nbsp;</div></li><li><div>                if ($svg_class-&gt;inDefs) {&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }  // mPDF 5.7.2&nbsp;</div></li><li><div>                if (isset($svg_class-&gt;txt_data[2])) {&nbsp;</div></li><li><div>                    $svg_class-&gt;txt_data[2] .= $data;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $svg_class-&gt;txt_data[2] = $data;&nbsp;</div></li><li><div>                    $svg_class-&gt;txt_data[0] = $svg_class-&gt;textXorigin;&nbsp;</div></li><li><div>                    $svg_class-&gt;txt_data[1] = $svg_class-&gt;textYorigin;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            function xml_svg2pdf_end($parser, $name)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                global $svg_class;&nbsp;</div></li><li><div>                // mPDF 5.7.2&nbsp;</div></li><li><div>                // Don't output stuff inside &lt;defs&gt;&nbsp;</div></li><li><div>                if ($name == 'defs') {&nbsp;</div></li><li><div>                    $svg_class-&gt;inDefs = false;&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($svg_class-&gt;inDefs) {&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                switch ($name) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case &quot;g&quot;:&nbsp;</div></li><li><div>                    case &quot;a&quot;:&nbsp;</div></li><li><div>                        if ($svg_class-&gt;intext) {&nbsp;</div></li><li><div>                            $p_cmd = $svg_class-&gt;svgText();&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput .= $p_cmd;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $tmp = count($svg_class-&gt;svg_style) - 1;&nbsp;</div></li><li><div>                        $current_style = $svg_class-&gt;svg_style[$tmp];&nbsp;</div></li><li><div>                        if (!empty($current_style['transformations'])) {&nbsp;</div></li><li><div>                            // If in the middle of &lt;text&gt; element, add to textoutput, else WriteString&nbsp;</div></li><li><div>                            if ($svg_class-&gt;intext) {&nbsp;</div></li><li><div>                                $svg_class-&gt;textoutput .= &quot; Q\n&quot;;&nbsp;</div></li><li><div>                            } // mPDF 5.7.4&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                $svg_class-&gt;svgWriteString(&quot; Q\n&quot;);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;svg_style);&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;txt_style);&nbsp;</div></li><li><div>                        if ($svg_class-&gt;intext) {&nbsp;</div></li><li><div>                            $svg_class-&gt;textXorigin += $svg_class-&gt;textlength;&nbsp;</div></li><li><div>                            $svg_class-&gt;textlength = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'font':&nbsp;</div></li><li><div>                        $last_svg_fontdefw = '';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'font-face':&nbsp;</div></li><li><div>                        $last_svg_fontid = '';&nbsp;</div></li><li><div>                        $last_svg_fontstyle = '';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'radialgradient':&nbsp;</div></li><li><div>                    case 'lineargradient':&nbsp;</div></li><li><div>                        $last_gradid = '';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case &quot;text&quot;:&nbsp;</div></li><li><div>                        $svg_class-&gt;txt_data[2] = rtrim($svg_class-&gt;txt_data[2]); // mPDF 5.7.4&nbsp;</div></li><li><div>                        $path_cmd = $svg_class-&gt;svgText();&nbsp;</div></li><li><div>                        $svg_class-&gt;textoutput .= $path_cmd; // mPDF 5.7.4&nbsp;</div></li><li><div>                        $tmp = count($svg_class-&gt;svg_style) - 1;&nbsp;</div></li><li><div>                        $current_style = $svg_class-&gt;svg_style[$tmp];&nbsp;</div></li><li><div>                        if (!empty($current_style['transformations'])) {&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput .= &quot; Q\n&quot;; // mPDF 5.7.4&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;svg_style);&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;txt_style); // mPDF 5.7.4&nbsp;</div></li><li><div>                        // mPDF 5.7.4&nbsp;</div></li><li><div>                        // If text-anchor middle|end, adjust&nbsp;</div></li><li><div>                        if ($svg_class-&gt;textanchor == 'end') {&nbsp;</div></li><li><div>                            $tx = -$svg_class-&gt;texttotallength;&nbsp;</div></li><li><div>                        } else if ($svg_class-&gt;textanchor == 'middle') {&nbsp;</div></li><li><div>                            $tx = -$svg_class-&gt;texttotallength / 2;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $tx = 0;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        while (preg_match('/mPDF-AXS\((.*?)\)/', $svg_class-&gt;textoutput, $m)) {&nbsp;</div></li><li><div>                            if ($tx) {&nbsp;</div></li><li><div>                                $txk = $m[1] + ($tx * $svg_class-&gt;kp);&nbsp;</div></li><li><div>                                $svg_class-&gt;textoutput = preg_replace('/mPDF-AXS\((.*?)\)/', sprintf('%.4F', $txk), $svg_class-&gt;textoutput, 1);&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $svg_class-&gt;textoutput = preg_replace('/mPDF-AXS\((.*?)\)/', '\\1', $svg_class-&gt;textoutput, 1);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;svgWriteString($svg_class-&gt;textoutput);&nbsp;</div></li><li><div>                        $svg_class-&gt;textlength = 0;&nbsp;</div></li><li><div>                        $svg_class-&gt;texttotallength = 0;&nbsp;</div></li><li><div>                        $svg_class-&gt;textoutput = '';&nbsp;</div></li><li><div>                        $svg_class-&gt;intext = false;   // mPDF 5.7.4&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    // mPDF 5.7.4&nbsp;</div></li><li><div>                    case &quot;tspan&quot;:&nbsp;</div></li><li><div>                        $p_cmd = $svg_class-&gt;svgText();&nbsp;</div></li><li><div>                        $svg_class-&gt;textoutput .= $p_cmd;&nbsp;</div></li><li><div>                        $tmp = count($svg_class-&gt;svg_style) - 1;&nbsp;</div></li><li><div>                        $current_style = $svg_class-&gt;svg_style[$tmp];&nbsp;</div></li><li><div>                        if ($current_style['transformations']) {&nbsp;</div></li><li><div>                            $svg_class-&gt;textoutput .= &quot; Q\n&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;svg_style);&nbsp;</div></li><li><div>                        array_pop($svg_class-&gt;txt_style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $svg_class-&gt;textXorigin += $svg_class-&gt;textlength;&nbsp;</div></li><li><div>                        $svg_class-&gt;textlength = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $svg2pdf_xml = '';&nbsp;</div></li><li><div>        global $svg_class;&nbsp;</div></li><li><div>        $svg_class = $this;&nbsp;</div></li><li><div>        // Don't output stuff inside &lt;defs&gt;&nbsp;</div></li><li><div>        $svg_class-&gt;inDefs = false;&nbsp;</div></li><li><div>        $svg2pdf_xml_parser = xml_parser_create(&quot;utf-8&quot;);&nbsp;</div></li><li><div>        xml_parser_set_option($svg2pdf_xml_parser, XML_OPTION_CASE_FOLDING, false);&nbsp;</div></li><li><div>        xml_set_element_handler($svg2pdf_xml_parser, &quot;xml_svg2pdf_start&quot;, &quot;xml_svg2pdf_end&quot;);&nbsp;</div></li><li><div>        xml_set_character_data_handler($svg2pdf_xml_parser, &quot;characterData&quot;);&nbsp;</div></li><li><div>        xml_parse($svg2pdf_xml_parser, $data);&nbsp;</div></li><li><div>        if ($this-&gt;svg_error) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return array('x' =&gt; $this-&gt;svg_info['x'] * $this-&gt;kp, 'y' =&gt; -$this-&gt;svg_info['y'] * $this-&gt;kp, 'w' =&gt; $this-&gt;svg_info['w'] * $this-&gt;kp, 'h' =&gt; -$this-&gt;svg_info['h'] * $this-&gt;kp, 'data' =&gt; $svg_class-&gt;svg_string);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>// AUTOFONT =========================&nbsp;</div></li><li><div>    function markScriptToLang($html)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;mpdf_ref-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>            return $html;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (empty($this-&gt;script2lang)) {&nbsp;</div></li><li><div>            if (!empty($this-&gt;mpdf_ref-&gt;script2lang)) {&nbsp;</div></li><li><div>                $this-&gt;script2lang = $this-&gt;mpdf_ref-&gt;script2lang;&nbsp;</div></li><li><div>                $this-&gt;viet = $this-&gt;mpdf_ref-&gt;viet;&nbsp;</div></li><li><div>                $this-&gt;pashto = $this-&gt;mpdf_ref-&gt;pashto;&nbsp;</div></li><li><div>                $this-&gt;urdu = $this-&gt;mpdf_ref-&gt;urdu;&nbsp;</div></li><li><div>                $this-&gt;persian = $this-&gt;mpdf_ref-&gt;persian;&nbsp;</div></li><li><div>                $this-&gt;sindhi = $this-&gt;mpdf_ref-&gt;sindhi;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                include(_MPDF_PATH . 'config_script2lang.php');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $n = '';&nbsp;</div></li><li><div>        $a = preg_split('/&lt;(.*?)&gt;/ms', $html, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>        foreach ($a as $i =&gt; $e) {&nbsp;</div></li><li><div>            if ($i % 2 == 0) {&nbsp;</div></li><li><div>                $e = strcode2utf($e);&nbsp;</div></li><li><div>                $e = $this-&gt;mpdf_ref-&gt;lesser_entity_decode($e);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $earr = $this-&gt;mpdf_ref-&gt;UTF8StringToArray($e, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $scriptblock = 0;&nbsp;</div></li><li><div>                $scriptblocks = array();&nbsp;</div></li><li><div>                $scriptblocks[0] = 0;&nbsp;</div></li><li><div>                $chardata = array();&nbsp;</div></li><li><div>                $subchunk = 0;&nbsp;</div></li><li><div>                $charctr = 0;&nbsp;</div></li><li><div>                foreach ($earr as $char) {&nbsp;</div></li><li><div>                    $ucd_record = UCDN::get_ucd_record($char);&nbsp;</div></li><li><div>                    $sbl = $ucd_record[6];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($sbl && $sbl != 40 && $sbl != 102) {&nbsp;</div></li><li><div>                        if ($scriptblock == 0) {&nbsp;</div></li><li><div>                            $scriptblock = $sbl;&nbsp;</div></li><li><div>                            $scriptblocks[$subchunk] = $scriptblock;&nbsp;</div></li><li><div>                        } else if ($scriptblock &gt; 0 && $scriptblock != $sbl) {&nbsp;</div></li><li><div>                            // NEW (non-common) Script encountered in this chunk.&nbsp;</div></li><li><div>                            // Start a new subchunk&nbsp;</div></li><li><div>                            $subchunk++;&nbsp;</div></li><li><div>                            $scriptblock = $sbl;&nbsp;</div></li><li><div>                            $charctr = 0;&nbsp;</div></li><li><div>                            $scriptblocks[$subchunk] = $scriptblock;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $chardata[$subchunk][$charctr]['script'] = $sbl;&nbsp;</div></li><li><div>                    $chardata[$subchunk][$charctr]['uni'] = $char;&nbsp;</div></li><li><div>                    $charctr++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // If scriptblock[x] = common & non-baseScript&nbsp;</div></li><li><div>                // and scriptblock[x+1] = baseScript&nbsp;</div></li><li><div>                // Move common script from end of x to start of x+1&nbsp;</div></li><li><div>                for ($sch = 0; $sch &lt; $subchunk; $sch++) {&nbsp;</div></li><li><div>                    if ($scriptblocks[$sch] &gt; 0 && $scriptblocks[$sch] != $this-&gt;mpdf_ref-&gt;baseScript && $scriptblocks[$sch + 1] == $this-&gt;mpdf_ref-&gt;baseScript) {&nbsp;</div></li><li><div>                        $end = count($chardata[$sch]) - 1;&nbsp;</div></li><li><div>                        while ($chardata[$sch][$end]['script'] == 0 && $end &gt; 1) { // common script&nbsp;</div></li><li><div>                            $tmp = array_pop($chardata[$sch]);&nbsp;</div></li><li><div>                            array_unshift($chardata[$sch + 1], $tmp);&nbsp;</div></li><li><div>                            $end--;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $o = '';&nbsp;</div></li><li><div>                for ($sch = 0; $sch &lt;= $subchunk; $sch++) {&nbsp;</div></li><li><div>                    if (isset($chardata[$sch])) {&nbsp;</div></li><li><div>                        $s = '';&nbsp;</div></li><li><div>                        for ($j = 0; $j &lt; count($chardata[$sch]); $j++) {&nbsp;</div></li><li><div>                            $s.=code2utf($chardata[$sch][$j]['uni']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // ZZZ99 Undo lesser_entity_decode as above - but only for &lt;&gt;&&nbsp;</div></li><li><div>                        $s = str_replace(&quot;&&quot;, &quot;&amp;&quot;, $s);&nbsp;</div></li><li><div>                        $s = str_replace(&quot;&lt;&quot;, &quot;&lt;&quot;, $s);&nbsp;</div></li><li><div>                        $s = str_replace(&quot;&gt;&quot;, &quot;&gt;&quot;, $s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (substr($a[$i - 1], 0, 5) != '&lt;text' && substr($a[$i - 1], 0, 5) != '&lt;tspa') {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        } // &lt;tspan&gt; or &lt;text&gt; only&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $lang = '';&nbsp;</div></li><li><div>                        // Check Vietnamese if Latin script - even if Basescript&nbsp;</div></li><li><div>                        if ($scriptblocks[$sch] == UCDN::SCRIPT_LATIN && $this-&gt;mpdf_ref-&gt;autoVietnamese && preg_match(&quot;/([&quot; . $this-&gt;viet . &quot;])/u&quot;, $s)) {&nbsp;</div></li><li><div>                            $lang = &quot;vi&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Check Arabic for different languages if Arabic script - even if Basescript&nbsp;</div></li><li><div>                        else if ($scriptblocks[$sch] == UCDN::SCRIPT_ARABIC && $this-&gt;mpdf_ref-&gt;autoArabic) {&nbsp;</div></li><li><div>                            if (preg_match(&quot;/[&quot; . $this-&gt;sindhi . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                                $lang = &quot;sd&quot;;&nbsp;</div></li><li><div>                            } else if (preg_match(&quot;/[&quot; . $this-&gt;urdu . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                                $lang = &quot;ur&quot;;&nbsp;</div></li><li><div>                            } else if (preg_match(&quot;/[&quot; . $this-&gt;pashto . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                                $lang = &quot;ps&quot;;&nbsp;</div></li><li><div>                            } else if (preg_match(&quot;/[&quot; . $this-&gt;persian . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                                $lang = &quot;fa&quot;;&nbsp;</div></li><li><div>                            } else if ($this-&gt;mpdf_ref-&gt;baseScript != UCDN::SCRIPT_ARABIC && isset($this-&gt;script2lang[$scriptblocks[$sch]])) {&nbsp;</div></li><li><div>                                $lang = &quot;'.$this-&gt;script2lang[$scriptblocks[$sch]].'&quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Identify Script block if not Basescript, and mark up as language&nbsp;</div></li><li><div>                        else if ($scriptblocks[$sch] &gt; 0 && $scriptblocks[$sch] != $this-&gt;mpdf_ref-&gt;baseScript && isset($this-&gt;script2lang[$scriptblocks[$sch]])) {&nbsp;</div></li><li><div>                            $lang = $this-&gt;script2lang[$scriptblocks[$sch]];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($lang) {&nbsp;</div></li><li><div>                            $o .= '&lt;tspan lang=&quot;' . $lang . '&quot;&gt;' . $s . '&lt;/tspan&gt;';&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $o .= $s;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $a[$i] = $o;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $a[$i] = '&lt;' . $e . '&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $n = implode('', $a);&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/svg/" class="active">2.8.1</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.0/classes/svg/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.3/classes/svg/" class="">2.7.3</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.2/classes/svg/" class="">2.7.2</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.1/classes/svg/" class="">2.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>SVG</li><li><span></span>WooCommerce PDF Invoices</li><li><span></span>2.8.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>