<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.8.1" data-slug="woocommerce-pdf-invoices" data-type="class" data-id="20857"><head xmlns="http://www.w3.org/1999/xhtml"><title> otldump | class | Woocommerce Pdf Invoices | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="OTLdump, class, plugin, woocommerce-pdf-invoices, 2.8.1" /><meta name="description" content="The WooCommerce PDF Invoices OTLdump class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=e6bcb4aeb0a25658b3cbd025307274fb' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/otldump/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fotldump%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fotldump%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-pdf-invoices-2.8.1-class-otldump","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="otldump" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-pdf-invoices." href="http://hookr.io/plugins/woocommerce-pdf-invoices/" class="plugin"><span property="name">woocommerce-pdf-invoices</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.1." href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/" class="H_VERSION"><span property="name">2.8.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">otldump</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="211"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/all/" title="All">All <span class="count badge">211</span></a></li><li class="" data-id="new" data-count="24"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/new/" title="New">New <span class="count badge">24</span></a></li><li class="" data-id="hooks" data-count="41"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/hooks/" title="Hooks">Hooks <span class="count badge">41</span></a></li><li class="" data-id="action" data-count="13"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/actions/" title="Actions">Actions <span class="count badge">13</span></a></li><li class="" data-id="filter" data-count="28"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/filters/" title="Filters">Filters <span class="count badge">28</span></a></li><li class="active" data-id="class" data-count="63"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/" title="Classes">Classes <span class="count badge">63</span></a></li><li class="" data-id="constant" data-count="66"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/constants/" title="Constants">Constants <span class="count badge">66</span></a></li><li class="" data-id="function" data-count="40"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/functions/" title="Functions">Functions <span class="count badge">40</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>OTLdump</strong></h1><p>The WooCommerce PDF Invoices <strong>OTLdump</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/files/vendor-mpdf-mpdf-classes-otl-dump/" class="file">/vendor/mpdf/mpdf/classes/otl_dump.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="39" class="block" start="39"><li><div>class OTLdump&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GPOSFeatures; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GPOSLookups;  // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GPOSScriptLang; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $ignoreStrings; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $MarkAttachmentType; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $MarkGlyphSets; // mPDF 7.5.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GlyphClassMarks; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GlyphClassLigatures; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GlyphClassBases; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GlyphClassComponents; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $GSUBScriptLang; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $rtlPUAstr; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $rtlPUAarr; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $fontkey; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $useOTL; // mPDF 5.7.1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $panose;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $maxUni;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $sFamilyClass;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $sFamilySubClass;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $sipset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $smpset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $_pos;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $numTables;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $searchRange;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $entrySelector;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $rangeShift;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $tables;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $otables;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $fh;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $glyphPos;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $charToGlyph;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $ascent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $descent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $familyName;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $styleName;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $fullName;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $uniqueFontID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $unitsPerEm;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $bbox;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $capHeight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $stemV;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $italicAngle;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $flags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $underlinePosition;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $underlineThickness;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $charWidths;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $defaultWidth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $maxStrLenRead;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $numTTCFonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $TTCFonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $maxUniChar;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $kerninfo;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct(mPDF $mpdf)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;mpdf = $mpdf;&nbsp;</div></li><li><div>        $this-&gt;maxStrLenRead = 200000; // Maximum size of glyf table to read in as string (otherwise reads each glyph from file)&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getMetrics($file, $fontkey, $TTCfontID = 0, $debug = false, $BMPonly = false, $kerninfo = false, $useOTL = 0, $mode)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // mPDF 5.7.1&nbsp;</div></li><li><div>        $this-&gt;mode = $mode;&nbsp;</div></li><li><div>        $this-&gt;useOTL = $useOTL; // mPDF 5.7.1&nbsp;</div></li><li><div>        $this-&gt;fontkey = $fontkey; // mPDF 5.7.1&nbsp;</div></li><li><div>        $this-&gt;filename = $file;&nbsp;</div></li><li><div>        $this-&gt;fh = fopen($file, 'rb');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;fh) {&nbsp;</div></li><li><div>            throw new MpdfException('Can\'t open file ' . $file);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_pos = 0;&nbsp;</div></li><li><div>        $this-&gt;charWidths = '';&nbsp;</div></li><li><div>        $this-&gt;glyphPos = array();&nbsp;</div></li><li><div>        $this-&gt;charToGlyph = array();&nbsp;</div></li><li><div>        $this-&gt;tables = array();&nbsp;</div></li><li><div>        $this-&gt;otables = array();&nbsp;</div></li><li><div>        $this-&gt;kerninfo = array();&nbsp;</div></li><li><div>        $this-&gt;ascent = 0;&nbsp;</div></li><li><div>        $this-&gt;descent = 0;&nbsp;</div></li><li><div>        $this-&gt;numTTCFonts = 0;&nbsp;</div></li><li><div>        $this-&gt;TTCFonts = array();&nbsp;</div></li><li><div>        $this-&gt;version = $version = $this-&gt;read_ulong();&nbsp;</div></li><li><div>        $this-&gt;panose = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($version == 0x4F54544F) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;Postscript outlines are not supported&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($version == 0x74746366 && !$TTCfontID) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;ERROR - You must define the TTCfontID for a TrueType Collection in config_fonts.php (&quot; . $file . &quot;)&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!in_array($version, array(0x00010000, 0x74727565)) && !$TTCfontID) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;Not a TrueType font: version=&quot; . $version);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($TTCfontID &gt; 0) {&nbsp;</div></li><li><div>            $this-&gt;version = $version = $this-&gt;read_ulong(); // TTC Header version now&nbsp;</div></li><li><div>            if (!in_array($version, array(0x00010000, 0x00020000))) {&nbsp;</div></li><li><div>                throw new MpdfException(&quot;ERROR - Error parsing TrueType Collection: version=&quot; . $version . &quot; - &quot; . $file);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;numTTCFonts = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            for ($i = 1; $i &lt;= $this-&gt;numTTCFonts; $i++) {&nbsp;</div></li><li><div>                $this-&gt;TTCFonts[$i]['offset'] = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;seek($this-&gt;TTCFonts[$TTCfontID]['offset']);&nbsp;</div></li><li><div>            $this-&gt;version = $version = $this-&gt;read_ulong(); // TTFont version again now&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;readTableDirectory($debug);&nbsp;</div></li><li><div>        $this-&gt;extractInfo($debug, $BMPonly, $kerninfo, $useOTL);&nbsp;</div></li><li><div>        fclose($this-&gt;fh);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function readTableDirectory($debug = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;numTables = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $this-&gt;searchRange = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $this-&gt;entrySelector = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $this-&gt;rangeShift = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $this-&gt;tables = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $this-&gt;numTables; $i++) {&nbsp;</div></li><li><div>            $record = array();&nbsp;</div></li><li><div>            $record['tag'] = $this-&gt;read_tag();&nbsp;</div></li><li><div>            $record['checksum'] = array($this-&gt;read_ushort(), $this-&gt;read_ushort());&nbsp;</div></li><li><div>            $record['offset'] = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            $record['length'] = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            $this-&gt;tables[$record['tag']] = $record;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($debug)&nbsp;</div></li><li><div>            $this-&gt;checksumTables();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function checksumTables()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Check the checksums for all tables&nbsp;</div></li><li><div>        foreach ($this-&gt;tables AS $t) {&nbsp;</div></li><li><div>            if ($t['length'] &gt; 0 && $t['length'] &lt; $this-&gt;maxStrLenRead) { // 1.02&nbsp;</div></li><li><div>                $table = $this-&gt;get_chunk($t['offset'], $t['length']);&nbsp;</div></li><li><div>                $checksum = $this-&gt;calcChecksum($table);&nbsp;</div></li><li><div>                if ($t['tag'] == 'head') {&nbsp;</div></li><li><div>                    $up = unpack('n*', substr($table, 8, 4));&nbsp;</div></li><li><div>                    $adjustment[0] = $up[1];&nbsp;</div></li><li><div>                    $adjustment[1] = $up[2];&nbsp;</div></li><li><div>                    $checksum = $this-&gt;sub32($checksum, $adjustment);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $xchecksum = $t['checksum'];&nbsp;</div></li><li><div>                if ($xchecksum != $checksum) {&nbsp;</div></li><li><div>                    throw new MpdfException(sprintf('TTF file &quot;%s&quot;: invalid checksum %s table: %s (expected %s)', $this-&gt;filename, dechex($checksum[0]) . dechex($checksum[1]), $t['tag'], dechex($xchecksum[0]) . dechex($xchecksum[1])));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function sub32($x, $y)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $xlo = $x[1];&nbsp;</div></li><li><div>        $xhi = $x[0];&nbsp;</div></li><li><div>        $ylo = $y[1];&nbsp;</div></li><li><div>        $yhi = $y[0];&nbsp;</div></li><li><div>        if ($ylo &gt; $xlo) {&nbsp;</div></li><li><div>            $xlo += 1 &lt;&lt; 16;&nbsp;</div></li><li><div>            $yhi += 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $reslo = $xlo - $ylo;&nbsp;</div></li><li><div>        if ($yhi &gt; $xhi) {&nbsp;</div></li><li><div>            $xhi += 1 &lt;&lt; 16;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $reshi = $xhi - $yhi;&nbsp;</div></li><li><div>        $reshi = $reshi & 0xFFFF;&nbsp;</div></li><li><div>        return array($reshi, $reslo);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function calcChecksum($data)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (strlen($data) % 4) {&nbsp;</div></li><li><div>            $data .= str_repeat(&quot;\0&quot;, (4 - (strlen($data) % 4)));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $len = strlen($data);&nbsp;</div></li><li><div>        $hi = 0x0000;&nbsp;</div></li><li><div>        $lo = 0x0000;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $len; $i+=4) {&nbsp;</div></li><li><div>            $hi += (ord($data[$i]) &lt;&lt; 8) + ord($data[$i + 1]);&nbsp;</div></li><li><div>            $lo += (ord($data[$i + 2]) &lt;&lt; 8) + ord($data[$i + 3]);&nbsp;</div></li><li><div>            $hi += ($lo &gt;&gt; 16) & 0xFFFF;&nbsp;</div></li><li><div>            $lo = $lo & 0xFFFF;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return array($hi, $lo);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_table_pos($tag)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $offset = $this-&gt;tables[$tag]['offset'];&nbsp;</div></li><li><div>        $length = $this-&gt;tables[$tag]['length'];&nbsp;</div></li><li><div>        return array($offset, $length);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function seek($pos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos = $pos;&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $this-&gt;_pos);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function skip($delta)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos = $this-&gt;_pos + $delta;&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $delta, SEEK_CUR);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function seek_table($tag, $offset_in_table = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $tpos = $this-&gt;get_table_pos($tag);&nbsp;</div></li><li><div>        $this-&gt;_pos = $tpos[0] + $offset_in_table;&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $this-&gt;_pos);&nbsp;</div></li><li><div>        return $this-&gt;_pos;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function read_tag()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos += 4;&nbsp;</div></li><li><div>        return fread($this-&gt;fh, 4);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function read_short()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos += 2;&nbsp;</div></li><li><div>        $s = fread($this-&gt;fh, 2);&nbsp;</div></li><li><div>        $a = (ord($s[0]) &lt;&lt; 8) + ord($s[1]);&nbsp;</div></li><li><div>        if ($a & (1 &lt;&lt; 15)) {&nbsp;</div></li><li><div>            $a = ($a - (1 &lt;&lt; 16));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $a;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function unpack_short($s)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $a = (ord($s[0]) &lt;&lt; 8) + ord($s[1]);&nbsp;</div></li><li><div>        if ($a & (1 &lt;&lt; 15)) {&nbsp;</div></li><li><div>            $a = ($a - (1 &lt;&lt; 16));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $a;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function read_ushort()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos += 2;&nbsp;</div></li><li><div>        $s = fread($this-&gt;fh, 2);&nbsp;</div></li><li><div>        return (ord($s[0]) &lt;&lt; 8) + ord($s[1]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function read_ulong()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_pos += 4;&nbsp;</div></li><li><div>        $s = fread($this-&gt;fh, 4);&nbsp;</div></li><li><div>        // if large uInt32 as an integer, PHP converts it to -ve&nbsp;</div></li><li><div>        return (ord($s[0]) * 16777216) + (ord($s[1]) &lt;&lt; 16) + (ord($s[2]) &lt;&lt; 8) + ord($s[3]); //     16777216 = 1&lt;&lt;24&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_ushort($pos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $pos);&nbsp;</div></li><li><div>        $s = fread($this-&gt;fh, 2);&nbsp;</div></li><li><div>        return (ord($s[0]) &lt;&lt; 8) + ord($s[1]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_ulong($pos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $pos);&nbsp;</div></li><li><div>        $s = fread($this-&gt;fh, 4);&nbsp;</div></li><li><div>        // iF large uInt32 as an integer, PHP converts it to -ve&nbsp;</div></li><li><div>        return (ord($s[0]) * 16777216) + (ord($s[1]) &lt;&lt; 16) + (ord($s[2]) &lt;&lt; 8) + ord($s[3]); //     16777216 = 1&lt;&lt;24&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function pack_short($val)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($val &lt; 0) {&nbsp;</div></li><li><div>            $val = abs($val);&nbsp;</div></li><li><div>            $val = ~$val;&nbsp;</div></li><li><div>            $val += 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return pack(&quot;n&quot;, $val);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function splice($stream, $offset, $value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return substr($stream, 0, $offset) . $value . substr($stream, $offset + strlen($value));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _set_ushort($stream, $offset, $value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $up = pack(&quot;n&quot;, $value);&nbsp;</div></li><li><div>        return $this-&gt;splice($stream, $offset, $up);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _set_short($stream, $offset, $val)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($val &lt; 0) {&nbsp;</div></li><li><div>            $val = abs($val);&nbsp;</div></li><li><div>            $val = ~$val;&nbsp;</div></li><li><div>            $val += 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $up = pack(&quot;n&quot;, $val);&nbsp;</div></li><li><div>        return $this-&gt;splice($stream, $offset, $up);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_chunk($pos, $length)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $pos);&nbsp;</div></li><li><div>        if ($length &lt; 1) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (fread($this-&gt;fh, $length));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_table($tag)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        list($pos, $length) = $this-&gt;get_table_pos($tag);&nbsp;</div></li><li><div>        if ($length == 0) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        fseek($this-&gt;fh, $pos);&nbsp;</div></li><li><div>        return (fread($this-&gt;fh, $length));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function add($tag, $data)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($tag == 'head') {&nbsp;</div></li><li><div>            $data = $this-&gt;splice($data, 8, &quot;\0\0\0\0&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;otables[$tag] = $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /////////////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    /////////////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function extractInfo($debug = false, $BMPonly = false, $kerninfo = false, $useOTL = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;panose = array();&nbsp;</div></li><li><div>        $this-&gt;sFamilyClass = 0;&nbsp;</div></li><li><div>        $this-&gt;sFamilySubClass = 0;&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // name - Naming table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $name_offset = $this-&gt;seek_table(&quot;name&quot;);&nbsp;</div></li><li><div>        $format = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        if ($format != 0 && $format != 1) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;Unknown name table format &quot; . $format);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $numRecords = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $string_data_offset = $name_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $names = array(1 =&gt; '', 2 =&gt; '', 3 =&gt; '', 4 =&gt; '', 6 =&gt; '');&nbsp;</div></li><li><div>        $K = array_keys($names);&nbsp;</div></li><li><div>        $nameCount = count($names);&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $numRecords; $i++) {&nbsp;</div></li><li><div>            $platformId = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $encodingId = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $languageId = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $nameId = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $length = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if (!in_array($nameId, $K))&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            $N = '';&nbsp;</div></li><li><div>            if ($platformId == 3 && $encodingId == 1 && $languageId == 0x409) { // Microsoft, Unicode, US English, PS Name&nbsp;</div></li><li><div>                $opos = $this-&gt;_pos;&nbsp;</div></li><li><div>                $this-&gt;seek($string_data_offset + $offset);&nbsp;</div></li><li><div>                if ($length % 2 != 0) {&nbsp;</div></li><li><div>                    throw new MpdfException(&quot;PostScript name is UTF-16BE string of odd length&quot;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $length /= 2;&nbsp;</div></li><li><div>                $N = '';&nbsp;</div></li><li><div>                while ($length &gt; 0) {&nbsp;</div></li><li><div>                    $char = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $N .= (chr($char));&nbsp;</div></li><li><div>                    $length -= 1;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;_pos = $opos;&nbsp;</div></li><li><div>                $this-&gt;seek($opos);&nbsp;</div></li><li><div>            } else if ($platformId == 1 && $encodingId == 0 && $languageId == 0) { // Macintosh, Roman, English, PS Name&nbsp;</div></li><li><div>                $opos = $this-&gt;_pos;&nbsp;</div></li><li><div>                $N = $this-&gt;get_chunk($string_data_offset + $offset, $length);&nbsp;</div></li><li><div>                $this-&gt;_pos = $opos;&nbsp;</div></li><li><div>                $this-&gt;seek($opos);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($N && $names[$nameId] == '') {&nbsp;</div></li><li><div>                $names[$nameId] = $N;&nbsp;</div></li><li><div>                $nameCount -= 1;&nbsp;</div></li><li><div>                if ($nameCount == 0)&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($names[6])&nbsp;</div></li><li><div>            $psName = $names[6];&nbsp;</div></li><li><div>        else if ($names[4])&nbsp;</div></li><li><div>            $psName = preg_replace('/ /', '-', $names[4]);&nbsp;</div></li><li><div>        else if ($names[1])&nbsp;</div></li><li><div>            $psName = preg_replace('/ /', '-', $names[1]);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $psName = '';&nbsp;</div></li><li><div>        if (!$psName) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;Could not find PostScript font name: &quot; . $this-&gt;filename);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($debug) {&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($psName); $i++) {&nbsp;</div></li><li><div>                $c = $psName[$i];&nbsp;</div></li><li><div>                $oc = ord($c);&nbsp;</div></li><li><div>                if ($oc &gt; 126 || strpos(' []() {}&lt;&gt;/%', $c) !== false) {&nbsp;</div></li><li><div>                    throw new MpdfException(&quot;psName=&quot; . $psName . &quot; contains invalid character &quot; . $c . &quot; ie U+&quot; . ord(c));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;name = $psName;&nbsp;</div></li><li><div>        if ($names[1]) {&nbsp;</div></li><li><div>            $this-&gt;familyName = $names[1];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;familyName = $psName;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($names[2]) {&nbsp;</div></li><li><div>            $this-&gt;styleName = $names[2];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;styleName = 'Regular';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($names[4]) {&nbsp;</div></li><li><div>            $this-&gt;fullName = $names[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;fullName = $psName;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($names[3]) {&nbsp;</div></li><li><div>            $this-&gt;uniqueFontID = $names[3];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;uniqueFontID = $psName;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($names[6]) {&nbsp;</div></li><li><div>            $this-&gt;fullName = $names[6];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // head - Font header table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $this-&gt;seek_table(&quot;head&quot;);&nbsp;</div></li><li><div>        if ($debug) {&nbsp;</div></li><li><div>            $ver_maj = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $ver_min = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($ver_maj != 1) {&nbsp;</div></li><li><div>                throw new MpdfException('Unknown head table version ' . $ver_maj . '.' . $ver_min);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;fontRevision = $this-&gt;read_ushort() . $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>            $magic = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            if ($magic != 0x5F0F3CF5) {&nbsp;</div></li><li><div>                throw new MpdfException('Invalid head table magic ' . $magic);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;skip(2);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;skip(18);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;unitsPerEm = $unitsPerEm = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $scale = 1000 / $unitsPerEm;&nbsp;</div></li><li><div>        $this-&gt;skip(16);&nbsp;</div></li><li><div>        $xMin = $this-&gt;read_short();&nbsp;</div></li><li><div>        $yMin = $this-&gt;read_short();&nbsp;</div></li><li><div>        $xMax = $this-&gt;read_short();&nbsp;</div></li><li><div>        $yMax = $this-&gt;read_short();&nbsp;</div></li><li><div>        $this-&gt;bbox = array(($xMin * $scale), ($yMin * $scale), ($xMax * $scale), ($yMax * $scale));&nbsp;</div></li><li><div>        $this-&gt;skip(3 * 2);&nbsp;</div></li><li><div>        $indexToLocFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $glyphDataFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        if ($glyphDataFormat != 0) {&nbsp;</div></li><li><div>            throw new MpdfException('Unknown glyph data format ' . $glyphDataFormat);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // hhea metrics table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // ttf2t1 seems to use this value rather than the one in OS/2 - so put in for compatibility&nbsp;</div></li><li><div>        if (isset($this-&gt;tables[&quot;hhea&quot;])) {&nbsp;</div></li><li><div>            $this-&gt;seek_table(&quot;hhea&quot;);&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>            $hheaAscender = $this-&gt;read_short();&nbsp;</div></li><li><div>            $hheaDescender = $this-&gt;read_short();&nbsp;</div></li><li><div>            $this-&gt;ascent = ($hheaAscender * $scale);&nbsp;</div></li><li><div>            $this-&gt;descent = ($hheaDescender * $scale);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // OS/2 - OS/2 and Windows metrics table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        if (isset($this-&gt;tables[&quot;OS/2&quot;])) {&nbsp;</div></li><li><div>            $this-&gt;seek_table(&quot;OS/2&quot;);&nbsp;</div></li><li><div>            $version = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $this-&gt;skip(2);&nbsp;</div></li><li><div>            $usWeightClass = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $this-&gt;skip(2);&nbsp;</div></li><li><div>            $fsType = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($fsType == 0x0002 || ($fsType & 0x0300) != 0) {&nbsp;</div></li><li><div>                global $overrideTTFFontRestriction;&nbsp;</div></li><li><div>                if (!$overrideTTFFontRestriction) {&nbsp;</div></li><li><div>                    throw new MpdfException('ERROR - Font file ' . $this-&gt;filename . ' cannot be embedded due to copyright restrictions.');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;restrictedUse = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;skip(20);&nbsp;</div></li><li><div>            $sF = $this-&gt;read_short();&nbsp;</div></li><li><div>            $this-&gt;sFamilyClass = ($sF &gt;&gt; 8);&nbsp;</div></li><li><div>            $this-&gt;sFamilySubClass = ($sF & 0xFF);&nbsp;</div></li><li><div>            $this-&gt;_pos += 10;  //PANOSE = 10 byte length&nbsp;</div></li><li><div>            $panose = fread($this-&gt;fh, 10);&nbsp;</div></li><li><div>            $this-&gt;panose = array();&nbsp;</div></li><li><div>            for ($p = 0; $p &lt; strlen($panose); $p++) {&nbsp;</div></li><li><div>                $this-&gt;panose[] = ord($panose[$p]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;skip(26);&nbsp;</div></li><li><div>            $sTypoAscender = $this-&gt;read_short();&nbsp;</div></li><li><div>            $sTypoDescender = $this-&gt;read_short();&nbsp;</div></li><li><div>            if (!$this-&gt;ascent)&nbsp;</div></li><li><div>                $this-&gt;ascent = ($sTypoAscender * $scale);&nbsp;</div></li><li><div>            if (!$this-&gt;descent)&nbsp;</div></li><li><div>                $this-&gt;descent = ($sTypoDescender * $scale);&nbsp;</div></li><li><div>            if ($version &gt; 1) {&nbsp;</div></li><li><div>                $this-&gt;skip(16);&nbsp;</div></li><li><div>                $sCapHeight = $this-&gt;read_short();&nbsp;</div></li><li><div>                $this-&gt;capHeight = ($sCapHeight * $scale);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;capHeight = $this-&gt;ascent;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $usWeightClass = 500;&nbsp;</div></li><li><div>            if (!$this-&gt;ascent)&nbsp;</div></li><li><div>                $this-&gt;ascent = ($yMax * $scale);&nbsp;</div></li><li><div>            if (!$this-&gt;descent)&nbsp;</div></li><li><div>                $this-&gt;descent = ($yMin * $scale);&nbsp;</div></li><li><div>            $this-&gt;capHeight = $this-&gt;ascent;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;stemV = 50 + intval(pow(($usWeightClass / 65.0), 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // post - PostScript table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $this-&gt;seek_table(&quot;post&quot;);&nbsp;</div></li><li><div>        if ($debug) {&nbsp;</div></li><li><div>            $ver_maj = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $ver_min = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($ver_maj &lt; 1 || $ver_maj &gt; 4) {&nbsp;</div></li><li><div>                throw new MpdfException('Unknown post table version ' . $ver_maj);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;italicAngle = $this-&gt;read_short() + $this-&gt;read_ushort() / 65536.0;&nbsp;</div></li><li><div>        $this-&gt;underlinePosition = $this-&gt;read_short() * $scale;&nbsp;</div></li><li><div>        $this-&gt;underlineThickness = $this-&gt;read_short() * $scale;&nbsp;</div></li><li><div>        $isFixedPitch = $this-&gt;read_ulong();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;flags = 4;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;italicAngle != 0)&nbsp;</div></li><li><div>            $this-&gt;flags = $this-&gt;flags | 64;&nbsp;</div></li><li><div>        if ($usWeightClass &gt;= 600)&nbsp;</div></li><li><div>            $this-&gt;flags = $this-&gt;flags | 262144;&nbsp;</div></li><li><div>        if ($isFixedPitch)&nbsp;</div></li><li><div>            $this-&gt;flags = $this-&gt;flags | 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // hhea - Horizontal header table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $this-&gt;seek_table(&quot;hhea&quot;);&nbsp;</div></li><li><div>        if ($debug) {&nbsp;</div></li><li><div>            $ver_maj = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $ver_min = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($ver_maj != 1) {&nbsp;</div></li><li><div>                throw new MpdfException('Unknown hhea table version ' . $ver_maj);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;skip(28);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;skip(32);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $metricDataFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        if ($metricDataFormat != 0) {&nbsp;</div></li><li><div>            throw new MpdfException('Unknown horizontal metric data format ' . $metricDataFormat);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $numberOfHMetrics = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        if ($numberOfHMetrics == 0) {&nbsp;</div></li><li><div>            throw new MpdfException('Number of horizontal metrics is 0');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // maxp - Maximum profile table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $this-&gt;seek_table(&quot;maxp&quot;);&nbsp;</div></li><li><div>        if ($debug) {&nbsp;</div></li><li><div>            $ver_maj = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $ver_min = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($ver_maj != 1) {&nbsp;</div></li><li><div>                throw new MpdfException('Unknown maxp table version ' . $ver_maj);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $numGlyphs = $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // cmap - Character to glyph index mapping table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $cmap_offset = $this-&gt;seek_table(&quot;cmap&quot;);&nbsp;</div></li><li><div>        $this-&gt;skip(2);&nbsp;</div></li><li><div>        $cmapTableCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $unicode_cmap_offset = 0;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $cmapTableCount; $i++) {&nbsp;</div></li><li><div>            $platformID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $encodingID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $offset = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            $save_pos = $this-&gt;_pos;&nbsp;</div></li><li><div>            if (($platformID == 3 && $encodingID == 1) || $platformID == 0) { // Microsoft, Unicode&nbsp;</div></li><li><div>                $format = $this-&gt;get_ushort($cmap_offset + $offset);&nbsp;</div></li><li><div>                if ($format == 4) {&nbsp;</div></li><li><div>                    if (!$unicode_cmap_offset)&nbsp;</div></li><li><div>                        $unicode_cmap_offset = $cmap_offset + $offset;&nbsp;</div></li><li><div>                    if ($BMPonly)&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Microsoft, Unicode Format 12 table HKCS&nbsp;</div></li><li><div>            else if ((($platformID == 3 && $encodingID == 10) || $platformID == 0) && !$BMPonly) {&nbsp;</div></li><li><div>                $format = $this-&gt;get_ushort($cmap_offset + $offset);&nbsp;</div></li><li><div>                if ($format == 12) {&nbsp;</div></li><li><div>                    $unicode_cmap_offset = $cmap_offset + $offset;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;seek($save_pos);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$unicode_cmap_offset) {&nbsp;</div></li><li><div>            throw new MpdfException('Font (' . $this-&gt;filename . ') does not have cmap for Unicode (platform 3, encoding 1, format 4, or platform 0, any encoding, format 4)');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sipset = false;&nbsp;</div></li><li><div>        $smpset = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // mPDF 5.7.1&nbsp;</div></li><li><div>        $this-&gt;GSUBScriptLang = array();&nbsp;</div></li><li><div>        $this-&gt;rtlPUAstr = '';&nbsp;</div></li><li><div>        $this-&gt;rtlPUAarr = array();&nbsp;</div></li><li><div>        $this-&gt;GSUBFeatures = array();&nbsp;</div></li><li><div>        $this-&gt;GSUBLookups = array();&nbsp;</div></li><li><div>        $this-&gt;GPOSScriptLang = array();&nbsp;</div></li><li><div>        $this-&gt;GPOSFeatures = array();&nbsp;</div></li><li><div>        $this-&gt;GPOSLookups = array();&nbsp;</div></li><li><div>        $this-&gt;glyphIDtoUni = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Format 12 CMAP does characters above Unicode BMP i.e. some HKCS characters U+20000 and above&nbsp;</div></li><li><div>        if ($format == 12 && !$BMPonly) {&nbsp;</div></li><li><div>            $this-&gt;maxUniChar = 0;&nbsp;</div></li><li><div>            $this-&gt;seek($unicode_cmap_offset + 4);&nbsp;</div></li><li><div>            $length = $this-&gt;read_ulong();&nbsp;</div></li><li><div>            $limit = $unicode_cmap_offset + $length;&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $nGroups = $this-&gt;read_ulong();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $glyphToChar = array();&nbsp;</div></li><li><div>            $charToGlyph = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $nGroups; $i++) {&nbsp;</div></li><li><div>                $startCharCode = $this-&gt;read_ulong();&nbsp;</div></li><li><div>                $endCharCode = $this-&gt;read_ulong();&nbsp;</div></li><li><div>                $startGlyphCode = $this-&gt;read_ulong();&nbsp;</div></li><li><div>                if ($endCharCode &gt; 0x20000 && $endCharCode &lt; 0x2FFFF) {&nbsp;</div></li><li><div>                    $sipset = true;&nbsp;</div></li><li><div>                } else if ($endCharCode &gt; 0x10000 && $endCharCode &lt; 0x1FFFF) {&nbsp;</div></li><li><div>                    $smpset = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $offset = 0;&nbsp;</div></li><li><div>                for ($unichar = $startCharCode; $unichar &lt;= $endCharCode; $unichar++) {&nbsp;</div></li><li><div>                    $glyph = $startGlyphCode + $offset;&nbsp;</div></li><li><div>                    $offset++;&nbsp;</div></li><li><div>                    if ($unichar &lt; 0x30000) {&nbsp;</div></li><li><div>                        $charToGlyph[$unichar] = $glyph;&nbsp;</div></li><li><div>                        $this-&gt;maxUniChar = max($unichar, $this-&gt;maxUniChar);&nbsp;</div></li><li><div>                        $glyphToChar[$glyph][] = $unichar;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $glyphToChar = array();&nbsp;</div></li><li><div>            $charToGlyph = array();&nbsp;</div></li><li><div>            $this-&gt;getCMAP4($unicode_cmap_offset, $glyphToChar, $charToGlyph);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;sipset = $sipset;&nbsp;</div></li><li><div>        $this-&gt;smpset = $smpset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // mPDF 5.7.1&nbsp;</div></li><li><div>        // Map Unmapped glyphs - from $numGlyphs&nbsp;</div></li><li><div>        if ($this-&gt;useOTL) {&nbsp;</div></li><li><div>            $bctr = 0xE000;&nbsp;</div></li><li><div>            for ($gid = 1; $gid &lt; $numGlyphs; $gid++) {&nbsp;</div></li><li><div>                if (!isset($glyphToChar[$gid])) {&nbsp;</div></li><li><div>                    while (isset($charToGlyph[$bctr])) {&nbsp;</div></li><li><div>                        $bctr++;&nbsp;</div></li><li><div>                    } // Avoid overwriting a glyph already mapped in PUA&nbsp;</div></li><li><div>                    if (($bctr &gt; 0xF8FF) && ($bctr &lt; 0x2CEB0)) {&nbsp;</div></li><li><div>                        if (!$BMPonly) {&nbsp;</div></li><li><div>                            $bctr = 0x2CEB0;  // Use unassigned area 0x2CEB0 to 0x2F7FF (space for 10, 000 characters)&nbsp;</div></li><li><div>                            $this-&gt;sipset = $sipset = true; // forces subsetting; also ensure charwidths are saved&nbsp;</div></li><li><div>                            while (isset($charToGlyph[$bctr])) {&nbsp;</div></li><li><div>                                $bctr++;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            throw new MpdfException($names[1] . &quot; : WARNING - The font does not have enough space to map all (unmapped) included glyphs into Private Use Area U+E000 - U+F8FF&quot;);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $glyphToChar[$gid][] = $bctr;&nbsp;</div></li><li><div>                    $charToGlyph[$bctr] = $gid;&nbsp;</div></li><li><div>                    $this-&gt;maxUniChar = max($bctr, $this-&gt;maxUniChar);&nbsp;</div></li><li><div>                    $bctr++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;glyphToChar = $glyphToChar;&nbsp;</div></li><li><div>        $this-&gt;charToGlyph = $charToGlyph;&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // mPDF 5.7.1    OpenType Layout tables&nbsp;</div></li><li><div>        $this-&gt;GSUBScriptLang = array();&nbsp;</div></li><li><div>        $this-&gt;rtlPUAstr = '';&nbsp;</div></li><li><div>        $this-&gt;rtlPUAarr = array();&nbsp;</div></li><li><div>        if ($useOTL) {&nbsp;</div></li><li><div>            $this-&gt;_getGDEFtables();&nbsp;</div></li><li><div>            list($this-&gt;GSUBScriptLang, $this-&gt;GSUBFeatures, $this-&gt;GSUBLookups, $this-&gt;rtlPUAstr, $this-&gt;rtlPUAarr) = $this-&gt;_getGSUBtables();&nbsp;</div></li><li><div>            list($this-&gt;GPOSScriptLang, $this-&gt;GPOSFeatures, $this-&gt;GPOSLookups) = $this-&gt;_getGPOStables();&nbsp;</div></li><li><div>            $this-&gt;glyphIDtoUni = str_pad('', 256 * 256 * 3, &quot;\x00&quot;);&nbsp;</div></li><li><div>            foreach ($glyphToChar AS $gid =&gt; $arr) {&nbsp;</div></li><li><div>                if (isset($glyphToChar[$gid][0])) {&nbsp;</div></li><li><div>                    $char = $glyphToChar[$gid][0];&nbsp;</div></li><li><div>                    if ($char != 0 && $char != 65535) {&nbsp;</div></li><li><div>                        $this-&gt;glyphIDtoUni[$gid * 3] = chr($char &gt;&gt; 16);&nbsp;</div></li><li><div>                        $this-&gt;glyphIDtoUni[$gid * 3 + 1] = chr(($char &gt;&gt; 8) & 0xFF);&nbsp;</div></li><li><div>                        $this-&gt;glyphIDtoUni[$gid * 3 + 2] = chr($char & 0xFF);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // hmtx - Horizontal metrics table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        $this-&gt;getHMTX($numberOfHMetrics, $numGlyphs, $glyphToChar, $scale);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // kern - Kerning pair table&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        if ($kerninfo) {&nbsp;</div></li><li><div>            // Recognises old form of Kerning table - as required by Windows - Format 0 only&nbsp;</div></li><li><div>            $kern_offset = $this-&gt;seek_table(&quot;kern&quot;);&nbsp;</div></li><li><div>            $version = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $nTables = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            // subtable header&nbsp;</div></li><li><div>            $sversion = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $slength = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $scoverage = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $format = $scoverage &gt;&gt; 8;&nbsp;</div></li><li><div>            if ($kern_offset && $version == 0 && $format == 0) {&nbsp;</div></li><li><div>                // Format 0&nbsp;</div></li><li><div>                $nPairs = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $this-&gt;skip(6);&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $nPairs; $i++) {&nbsp;</div></li><li><div>                    $left = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $right = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $val = $this-&gt;read_short();&nbsp;</div></li><li><div>                    if (count($glyphToChar[$left]) == 1 && count($glyphToChar[$right]) == 1) {&nbsp;</div></li><li><div>                        if ($left != 32 && $right != 32) {&nbsp;</div></li><li><div>                            $this-&gt;kerninfo[$glyphToChar[$left][0]][$glyphToChar[$right][0]] = intval($val * $scale);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /////////////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    function _getGDEFtables()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // GDEF - Glyph Definition&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // http://www.microsoft.com/typography/otspec/gdef.htm&nbsp;</div></li><li><div>        if (isset($this-&gt;tables[&quot;GDEF&quot;])) {&nbsp;</div></li><li><div>            if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;h1&gt;GDEF table&lt;/h1&gt;');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $gdef_offset = $this-&gt;seek_table(&quot;GDEF&quot;);&nbsp;</div></li><li><div>            // ULONG Version of the GDEF table-currently 0x00010000&nbsp;</div></li><li><div>            $ver_maj = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $ver_min = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            // Version 0x00010002 of GDEF header contains additional Offset to a list defining mark glyph set definitions (MarkGlyphSetDef)&nbsp;</div></li><li><div>            $GlyphClassDef_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $AttachList_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $LigCaretList_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $MarkAttachClassDef_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            if ($ver_min == 2) {&nbsp;</div></li><li><div>                $MarkGlyphSetsDef_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // GlyphClassDef&nbsp;</div></li><li><div>            $this-&gt;seek($gdef_offset + $GlyphClassDef_offset);&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>              1    Base glyph (single character, spacing glyph)&nbsp;</div></li><li><div>              2    Ligature glyph (multiple character, spacing glyph)&nbsp;</div></li><li><div>              3    Mark glyph (non-spacing combining glyph)&nbsp;</div></li><li><div>              4    Component glyph (part of single character, spacing glyph)&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $GlyphByClass = $this-&gt;_getClassDefinitionTable();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;h2&gt;Glyph classes&lt;/h2&gt;');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($GlyphByClass[1]) && count($GlyphByClass[1]) &gt; 0) {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassBases = $this-&gt;formatClassArr($GlyphByClass[1]);&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Glyph class 1&lt;/h3&gt;');&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h5&gt;Base glyph (single character, spacing glyph)&lt;/h5&gt;');&nbsp;</div></li><li><div>                    $html = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                    foreach ($GlyphByClass[1] AS $g) {&nbsp;</div></li><li><div>                        $html .= '&#x' . $g . '; ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassBases = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($GlyphByClass[2]) && count($GlyphByClass[2]) &gt; 0) {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassLigatures = $this-&gt;formatClassArr($GlyphByClass[2]);&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Glyph class 2&lt;/h3&gt;');&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h5&gt;Ligature glyph (multiple character, spacing glyph)&lt;/h5&gt;');&nbsp;</div></li><li><div>                    $html = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                    foreach ($GlyphByClass[2] AS $g) {&nbsp;</div></li><li><div>                        $html .= '&#x' . $g . '; ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassLigatures = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($GlyphByClass[3]) && count($GlyphByClass[3]) &gt; 0) {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassMarks = $this-&gt;formatClassArr($GlyphByClass[3]);&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Glyph class 3&lt;/h3&gt;');&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h5&gt;Mark glyph (non-spacing combining glyph)&lt;/h5&gt;');&nbsp;</div></li><li><div>                    $html = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                    foreach ($GlyphByClass[3] AS $g) {&nbsp;</div></li><li><div>                        $html .= '&#x25cc;&#x' . $g . '; ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassMarks = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($GlyphByClass[4]) && count($GlyphByClass[4]) &gt; 0) {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassComponents = $this-&gt;formatClassArr($GlyphByClass[4]);&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Glyph class 4&lt;/h3&gt;');&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h5&gt;Component glyph (part of single character, spacing glyph)&lt;/h5&gt;');&nbsp;</div></li><li><div>                    $html = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                    foreach ($GlyphByClass[4] AS $g) {&nbsp;</div></li><li><div>                        $html .= '&#x' . $g . '; ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;GlyphClassComponents = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $Marks = $GlyphByClass[3]; // to use for MarkAttachmentType&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** Required for GPOS&nbsp;</div></li><li><div>              // Attachment List&nbsp;</div></li><li><div>              if ($AttachList_offset) {&nbsp;</div></li><li><div>              $this-&gt;seek($gdef_offset+$AttachList_offset );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              The Attachment Point List table (AttachmentList) identifies all the attachment points defined in the GPOS table and their associated glyphs so a client can quickly access coordinates for each glyph's attachment points. As a result, the client can cache coordinates for attachment points along with glyph bitmaps and avoid recalculating the attachment points each time it displays a glyph. Without this table, processing speed would be slower because the client would have to decode the GPOS lookups that define attachment points and compile the points in a list.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>              The Attachment List table (AttachList) may be used to cache attachment point coordinates along with glyph bitmaps.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>              The table consists of an offset to a Coverage table (Coverage) listing all glyphs that define attachment points in the GPOS table, a count of the glyphs with attachment points (GlyphCount), and an array of offsets to AttachPoint tables (AttachPoint). The array lists the AttachPoint tables, one for each glyph in the Coverage table, in the same order as the Coverage Index.&nbsp;</div></li><li><div>              AttachList table&nbsp;</div></li><li><div>              Type     Name     Description&nbsp;</div></li><li><div>              Offset     Coverage     Offset to Coverage table - from beginning of AttachList table&nbsp;</div></li><li><div>              uint16     GlyphCount     Number of glyphs with attachment points&nbsp;</div></li><li><div>              Offset     AttachPoint[GlyphCount]     Array of offsets to AttachPoint tables-from beginning of AttachList table-in Coverage Index order&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>              An AttachPoint table consists of a count of the attachment points on a single glyph (PointCount) and an array of contour indices of those points (PointIndex), listed in increasing numerical order.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>              AttachPoint table&nbsp;</div></li><li><div>              Type     Name     Description&nbsp;</div></li><li><div>              uint16     PointCount     Number of attachment points on this glyph&nbsp;</div></li><li><div>              uint16     PointIndex[PointCount]     Array of contour point indices -in increasing numerical order&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>              See Example 3 - http://www.microsoft.com/typography/otspec/gdef.htm&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Ligature Caret List&nbsp;</div></li><li><div>            // The Ligature Caret List table (LigCaretList) defines caret positions for all the ligatures in a font.&nbsp;</div></li><li><div>            // Not required for mDPF&nbsp;</div></li><li><div>            // MarkAttachmentType&nbsp;</div></li><li><div>            if ($MarkAttachClassDef_offset) {&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h1&gt;Mark Attachment Types&lt;/h1&gt;');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;seek($gdef_offset + $MarkAttachClassDef_offset);&nbsp;</div></li><li><div>                $MarkAttachmentTypes = $this-&gt;_getClassDefinitionTable();&nbsp;</div></li><li><div>                foreach ($MarkAttachmentTypes AS $class =&gt; $glyphs) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (is_array($Marks) && count($Marks)) {&nbsp;</div></li><li><div>                        $mat = array_diff($Marks, $MarkAttachmentTypes[$class]);&nbsp;</div></li><li><div>                        sort($mat, SORT_STRING);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $mat = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;MarkAttachmentType[$class] = $this-&gt;formatClassArr($mat);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                        $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Mark Attachment Type: ' . $class . '&lt;/h3&gt;');&nbsp;</div></li><li><div>                        $html = '';&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                        foreach ($glyphs AS $g) {&nbsp;</div></li><li><div>                            $html .= '&#x25cc;&#x' . $g . '; ';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;MarkAttachmentType = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // MarkGlyphSets only in Version 0x00010002 of GDEF&nbsp;</div></li><li><div>            if ($ver_min == 2 && $MarkGlyphSetsDef_offset) {&nbsp;</div></li><li><div>                if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                    $this-&gt;mpdf-&gt;WriteHTML('&lt;h1&gt;Mark Glyph Sets&lt;/h1&gt;');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;seek($gdef_offset + $MarkGlyphSetsDef_offset);&nbsp;</div></li><li><div>                $MarkSetTableFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $MarkSetCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $MarkSetOffset = array();&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $MarkSetCount; $i++) {&nbsp;</div></li><li><div>                    $MarkSetOffset[] = $this-&gt;read_ulong();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $MarkSetCount; $i++) {&nbsp;</div></li><li><div>                    $this-&gt;seek($MarkSetOffset[$i]);&nbsp;</div></li><li><div>                    $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                    $this-&gt;MarkGlyphSets[$i] = $this-&gt;formatClassArr($glyphs);&nbsp;</div></li><li><div>                    if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                        $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;Mark Glyph Set class: ' . $i . '&lt;/h3&gt;');&nbsp;</div></li><li><div>                        $html = '';&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                        foreach ($glyphs AS $g) {&nbsp;</div></li><li><div>                            $html .= '&#x25cc;&#x' . $g . '; ';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;MarkGlyphSets = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;mpdf-&gt;WriteHTML('&lt;div&gt;GDEF table not defined&lt;/div&gt;');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//echo $this-&gt;GlyphClassMarks ; exit;&nbsp;</div></li><li><div>//print_r($GlyphClass); exit;&nbsp;</div></li><li><div>//print_r($GlyphByClass); exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getClassDefinitionTable($offset = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($offset &gt; 0) {&nbsp;</div></li><li><div>            $this-&gt;seek($offset);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // NB Any glyph not included in the range of covered GlyphIDs automatically belongs to Class 0. This is not returned by this function&nbsp;</div></li><li><div>        $ClassFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $GlyphByClass = array();&nbsp;</div></li><li><div>        if ($ClassFormat == 1) {&nbsp;</div></li><li><div>            $StartGlyph = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $GlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $GlyphCount; $i++) {&nbsp;</div></li><li><div>                $gid = $StartGlyph + $i;&nbsp;</div></li><li><div>                $class = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $GlyphByClass[$class][] = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if ($ClassFormat == 2) {&nbsp;</div></li><li><div>            $tableCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $tableCount; $i++) {&nbsp;</div></li><li><div>                $startGlyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $endGlyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $class = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($gid = $startGlyphID; $gid &lt;= $endGlyphID; $gid++) {&nbsp;</div></li><li><div>                    $GlyphByClass[$class][] = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ksort($GlyphByClass);&nbsp;</div></li><li><div>        return $GlyphByClass;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getGSUBtables()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // GSUB - Glyph Substitution&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        if (isset($this-&gt;tables[&quot;GSUB&quot;])) {&nbsp;</div></li><li><div>            $this-&gt;mpdf-&gt;WriteHTML('&lt;h1&gt;GSUB Tables&lt;/h1&gt;');&nbsp;</div></li><li><div>            $ffeats = array();&nbsp;</div></li><li><div>            $gsub_offset = $this-&gt;seek_table(&quot;GSUB&quot;);&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>            $ScriptList_offset = $gsub_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $FeatureList_offset = $gsub_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $LookupList_offset = $gsub_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // ScriptList&nbsp;</div></li><li><div>            $this-&gt;seek($ScriptList_offset);&nbsp;</div></li><li><div>            $ScriptCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $ScriptCount; $i++) {&nbsp;</div></li><li><div>                $ScriptTag = $this-&gt;read_tag(); // = &quot;beng&quot;, &quot;deva&quot; etc.&nbsp;</div></li><li><div>                $ScriptTableOffset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $ffeats[$ScriptTag] = $ScriptList_offset + $ScriptTableOffset;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Script Table&nbsp;</div></li><li><div>            foreach ($ffeats AS $t =&gt; $o) {&nbsp;</div></li><li><div>                $ls = array();&nbsp;</div></li><li><div>                $this-&gt;seek($o);&nbsp;</div></li><li><div>                $DefLangSys_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                if ($DefLangSys_offset &gt; 0) {&nbsp;</div></li><li><div>                    $ls['DFLT'] = $DefLangSys_offset + $o;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $LangSysCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $LangSysCount; $i++) {&nbsp;</div></li><li><div>                    $LangTag = $this-&gt;read_tag(); // =&nbsp;</div></li><li><div>                    $LangTableOffset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $ls[$LangTag] = $o + $LangTableOffset;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $ffeats[$t] = $ls;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>//print_r($ffeats); exit;&nbsp;</div></li><li><div>            // Get FeatureIndexList&nbsp;</div></li><li><div>            // LangSys Table - from first listed langsys&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $o) {&nbsp;</div></li><li><div>                    $FeatureIndex = array();&nbsp;</div></li><li><div>                    $langsystable_offset = $o;&nbsp;</div></li><li><div>                    $this-&gt;seek($langsystable_offset);&nbsp;</div></li><li><div>                    $LookUpOrder = $this-&gt;read_ushort(); //==NULL&nbsp;</div></li><li><div>                    $ReqFeatureIndex = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    if ($ReqFeatureIndex != 0xFFFF) {&nbsp;</div></li><li><div>                        $FeatureIndex[] = $ReqFeatureIndex;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $FeatureCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                        $FeatureIndex[] = $this-&gt;read_ushort(); // = index of feature&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $ffeats[$st][$t] = $FeatureIndex;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>//print_r($ffeats); exit;&nbsp;</div></li><li><div>            // Feauture List =&gt; LookupListIndex es&nbsp;</div></li><li><div>            $this-&gt;seek($FeatureList_offset);&nbsp;</div></li><li><div>            $FeatureCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $Feature = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                $Feature[$i] = array('tag' =&gt; $this-&gt;read_tag());&nbsp;</div></li><li><div>                $Feature[$i]['offset'] = $FeatureList_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                $this-&gt;seek($Feature[$i]['offset']);&nbsp;</div></li><li><div>                $this-&gt;read_ushort(); // null&nbsp;</div></li><li><div>                $Feature[$i]['LookupCount'] = $Lookupcount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Feature[$i]['LookupListIndex'] = array();&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $Lookupcount; $c++) {&nbsp;</div></li><li><div>                    $Feature[$i]['LookupListIndex'][] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $o) {&nbsp;</div></li><li><div>                    $FeatureIndex = $ffeats[$st][$t];&nbsp;</div></li><li><div>                    foreach ($FeatureIndex AS $k =&gt; $fi) {&nbsp;</div></li><li><div>                        $ffeats[$st][$t][$k] = $Feature[$fi];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            $gsub = array();&nbsp;</div></li><li><div>            $GSUBScriptLang = array();&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $langsys) {&nbsp;</div></li><li><div>                    $lg = array();&nbsp;</div></li><li><div>                    foreach ($langsys AS $ft) {&nbsp;</div></li><li><div>                        $lg[$ft['LookupListIndex'][0]] = $ft;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // list of Lookups in order they need to be run i.e. order listed in Lookup table&nbsp;</div></li><li><div>                    ksort($lg);&nbsp;</div></li><li><div>                    foreach ($lg AS $ft) {&nbsp;</div></li><li><div>                        $gsub[$st][$t][$ft['tag']] = $ft['LookupListIndex'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (!isset($GSUBScriptLang[$st])) {&nbsp;</div></li><li><div>                        $GSUBScriptLang[$st] = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $GSUBScriptLang[$st] .= $t . ' ';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//print_r($gsub); exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;GSUB Scripts &amp; Languages&lt;/h3&gt;');&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;div class=&quot;glyphs&quot;&gt;');&nbsp;</div></li><li><div>                $html = '';&nbsp;</div></li><li><div>                if (count($gsub)) {&nbsp;</div></li><li><div>                    foreach ($gsub AS $st =&gt; $g) {&nbsp;</div></li><li><div>                        $html .= '&lt;h5&gt;' . $st . '&lt;/h5&gt;';&nbsp;</div></li><li><div>                        foreach ($g AS $l =&gt; $t) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;&lt;a href=&quot;font_dump_OTL.php?script=' . $st . '&lang=' . $l . '&quot;&gt;' . $l . '&lt;/a&gt;&lt;/b&gt;: ';&nbsp;</div></li><li><div>                            foreach ($t AS $tag =&gt; $o) {&nbsp;</div></li><li><div>                                $html .= $tag . ' ';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $html .= '&lt;div&gt;No entries in GSUB table.&lt;/div&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;/div&gt;');&nbsp;</div></li><li><div>                return 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Get metadata and offsets for whole Lookup List table&nbsp;</div></li><li><div>            $this-&gt;seek($LookupList_offset);&nbsp;</div></li><li><div>            $LookupCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $GSLookup = array();&nbsp;</div></li><li><div>            $Offsets = array();&nbsp;</div></li><li><div>            $SubtableCount = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $Offsets[$i] = $LookupList_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $this-&gt;seek($Offsets[$i]);&nbsp;</div></li><li><div>                $GSLookup[$i]['Type'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $GSLookup[$i]['Flag'] = $flag = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $GSLookup[$i]['SubtableCount'] = $SubtableCount[$i] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $SubtableCount[$i]; $c++) {&nbsp;</div></li><li><div>                    $GSLookup[$i]['Subtables'][$c] = $Offsets[$i] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // MarkFilteringSet = Index (base 0) into GDEF mark glyph sets structure&nbsp;</div></li><li><div>                if (($flag & 0x0010) == 0x0010) {&nbsp;</div></li><li><div>                    $GSLookup[$i]['MarkFilteringSet'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // else { $GSLookup[$i]['MarkFilteringSet'] = ''; }&nbsp;</div></li><li><div>                // Lookup Type 7: Extension&nbsp;</div></li><li><div>                if ($GSLookup[$i]['Type'] == 7) {&nbsp;</div></li><li><div>                    // Overwrites new offset (32-bit) for each subtable, and a new lookup Type&nbsp;</div></li><li><div>                    for ($c = 0; $c &lt; $SubtableCount[$i]; $c++) {&nbsp;</div></li><li><div>                        $this-&gt;seek($GSLookup[$i]['Subtables'][$c]);&nbsp;</div></li><li><div>                        $ExtensionPosFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $type = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $GSLookup[$i]['Subtables'][$c] = $GSLookup[$i]['Subtables'][$c] + $this-&gt;read_ulong();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $GSLookup[$i]['Type'] = $type;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//print_r($GSLookup); exit;&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Process Whole LookupList - Get LuCoverage = Lookup coverage just for first glyph&nbsp;</div></li><li><div>            $this-&gt;GSLuCoverage = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $GSLookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($GSLookup[$i]['Subtables'][$c]);&nbsp;</div></li><li><div>                    $PosFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($GSLookup[$i]['Type'] == 5 && $PosFormat == 3) {&nbsp;</div></li><li><div>                        $this-&gt;skip(4);&nbsp;</div></li><li><div>                    } else if ($GSLookup[$i]['Type'] == 6 && $PosFormat == 3) {&nbsp;</div></li><li><div>                        $BacktrackGlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $this-&gt;skip(2 * $BacktrackGlyphCount + 2);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // NB Coverage only looks at glyphs for position 1 (i.e. 5.3 and 6.3)    // NEEDS TO READ ALL ********************&nbsp;</div></li><li><div>                    $Coverage = $GSLookup[$i]['Subtables'][$c] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $this-&gt;seek($Coverage);&nbsp;</div></li><li><div>                    $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                    $this-&gt;GSLuCoverage[$i][$c] = implode('|', $glyphs);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>// $this-&gt;GSLuCoverage and $GSLookup&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            $s = '&lt;?php&nbsp;</div></li><li><div>$GSLuCoverage = ' . var_export($this-&gt;GSLuCoverage, true) . ';&nbsp;</div></li><li><div>?&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            $s = '&lt;?php&nbsp;</div></li><li><div>$GlyphClassBases = \'' . $this-&gt;GlyphClassBases . '\';&nbsp;</div></li><li><div>$GlyphClassMarks = \'' . $this-&gt;GlyphClassMarks . '\';&nbsp;</div></li><li><div>$GlyphClassLigatures = \'' . $this-&gt;GlyphClassLigatures . '\';&nbsp;</div></li><li><div>$GlyphClassComponents = \'' . $this-&gt;GlyphClassComponents . '\';&nbsp;</div></li><li><div>$MarkGlyphSets = ' . var_export($this-&gt;MarkGlyphSets, true) . ';&nbsp;</div></li><li><div>$MarkAttachmentType = ' . var_export($this-&gt;MarkAttachmentType, true) . ';&nbsp;</div></li><li><div>?&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>// Now repeats as original to get Substitution rules&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Get metadata and offsets for whole Lookup List table&nbsp;</div></li><li><div>            $this-&gt;seek($LookupList_offset);&nbsp;</div></li><li><div>            $LookupCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $Lookup = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $Lookup[$i]['offset'] = $LookupList_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $this-&gt;seek($Lookup[$i]['offset']);&nbsp;</div></li><li><div>                $Lookup[$i]['Type'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Lookup[$i]['Flag'] = $flag = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Lookup[$i]['SubtableCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $Lookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>                    $Lookup[$i]['Subtable'][$c]['Offset'] = $Lookup[$i]['offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // MarkFilteringSet = Index (base 0) into GDEF mark glyph sets structure&nbsp;</div></li><li><div>                if (($flag & 0x0010) == 0x0010) {&nbsp;</div></li><li><div>                    $Lookup[$i]['MarkFilteringSet'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $Lookup[$i]['MarkFilteringSet'] = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Lookup Type 7: Extension&nbsp;</div></li><li><div>                if ($Lookup[$i]['Type'] == 7) {&nbsp;</div></li><li><div>                    // Overwrites new offset (32-bit) for each subtable, and a new lookup Type&nbsp;</div></li><li><div>                    for ($c = 0; $c &lt; $Lookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['Offset']);&nbsp;</div></li><li><div>                        $ExtensionPosFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $type = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['Offset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ulong();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $Lookup[$i]['Type'] = $type;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//print_r($Lookup); exit;&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Process (1) Whole LookupList&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $Lookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($Lookup[$i]['Subtable'][$c]['Offset']);&nbsp;</div></li><li><div>                    $SubstFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $Lookup[$i]['Subtable'][$c]['Format'] = $SubstFormat;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    /**&nbsp;</div></li><li><div>                      Lookup['Type'] Enumeration table for glyph substitution&nbsp;</div></li><li><div>                      Value    Type    Description&nbsp;</div></li><li><div>                      1    Single    Replace one glyph with one glyph&nbsp;</div></li><li><div>                      2    Multiple    Replace one glyph with more than one glyph&nbsp;</div></li><li><div>                      3    Alternate    Replace one glyph with one of many glyphs&nbsp;</div></li><li><div>                      4    Ligature    Replace multiple glyphs with one glyph&nbsp;</div></li><li><div>                      5    Context    Replace one or more glyphs in context&nbsp;</div></li><li><div>                      6    Chaining Context    Replace one or more glyphs in chained context&nbsp;</div></li><li><div>                      7    Extension Substitution    Extension mechanism for other substitutions (i.e. this excludes the Extension type substitution itself)&nbsp;</div></li><li><div>                      8    Reverse chaining context single     Applied in reverse order, replace single glyph in chaining context&nbsp;</div></li><li><div>                     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 1: Single Substitution Subtable&nbsp;</div></li><li><div>                    if ($Lookup[$i]['Type'] == 1) {&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        if ($SubstFormat == 1) { // Calculated output glyph indices&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['DeltaGlyphID'] = $this-&gt;read_short();&nbsp;</div></li><li><div>                        } else if ($SubstFormat == 2) { // Specified output glyph indices&nbsp;</div></li><li><div>                            $GlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $GlyphCount; $g++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['Glyphs'][] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // LookupType 2: Multiple Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 2) {&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['SequenceCount'] = $SequenceCount = $this-&gt;read_short();&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $SequenceCount; $s++) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['Sequences'][$s]['Offset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_short();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $SequenceCount; $s++) {&nbsp;</div></li><li><div>                            // Sequence Tables&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['Sequences'][$s]['Offset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['Sequences'][$s]['GlyphCount'] = $this-&gt;read_short();&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['Sequences'][$s]['GlyphCount']; $g++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['Sequences'][$s]['SubstituteGlyphID'][] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // LookupType 3: Alternate Forms&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 3) {&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['AlternateSetCount'] = $AlternateSetCount = $this-&gt;read_short();&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $AlternateSetCount; $s++) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['AlternateSets'][$s]['Offset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_short();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $AlternateSetCount; $s++) {&nbsp;</div></li><li><div>                            // AlternateSet Tables&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['AlternateSets'][$s]['Offset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['AlternateSets'][$s]['GlyphCount'] = $this-&gt;read_short();&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['AlternateSets'][$s]['GlyphCount']; $g++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['AlternateSets'][$s]['SubstituteGlyphID'][] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // LookupType 4: Ligature Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 4) {&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtable'][$c]['LigSetCount'] = $LigSetCount = $this-&gt;read_short();&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $LigSetCount; $s++) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Offset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_short();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $LigSetCount; $s++) {&nbsp;</div></li><li><div>                            // LigatureSet Tables&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Offset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigCount'] = $this-&gt;read_short();&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigCount']; $g++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigatureOffset'][$g] = $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $LigSetCount; $s++) {&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigCount']; $g++) {&nbsp;</div></li><li><div>                                // Ligature tables&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigatureOffset'][$g]);&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['LigGlyph'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['CompCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                for ($l = 1; $l &lt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['CompCount']; $l++) {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['GlyphID'][$l] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 5: Contextual Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 5) {&nbsp;</div></li><li><div>                        // Format 1: Context Substitution&nbsp;</div></li><li><div>                        if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['SubRuleSetCount'] = $SubRuleSetCount = $this-&gt;read_short();&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $SubRuleSetCount; $s++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['Offset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_short();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $SubRuleSetCount; $s++) {&nbsp;</div></li><li><div>                                // SubRuleSet Tables&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['Offset']);&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleCount'] = $this-&gt;read_short();&nbsp;</div></li><li><div>                                for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleCount']; $g++) {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleOffset'][$g] = $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $SubRuleSetCount; $s++) {&nbsp;</div></li><li><div>                                // SubRule Tables&nbsp;</div></li><li><div>                                for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleCount']; $g++) {&nbsp;</div></li><li><div>                                    // Ligature tables&nbsp;</div></li><li><div>                                    $this-&gt;seek($Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleOffset'][$g]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['GlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['SubstCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    // &quot;Input&quot;::[GlyphCount - 1]::Array of input GlyphIDs-start with second glyph&nbsp;</div></li><li><div>                                    for ($l = 1; $l &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['GlyphCount']; $l++) {&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['Input'][$l] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    // &quot;SubstLookupRecord&quot;::[SubstCount]::Array of SubstLookupRecords-in design order&nbsp;</div></li><li><div>                                    for ($l = 0; $l &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['SubstCount']; $l++) {&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['SubstLookupRecord'][$l]['SequenceIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$g]['SubstLookupRecord'][$l]['LookupListIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 2: Class-based Context Glyph Substitution&nbsp;</div></li><li><div>                        else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['ClassDefOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['SubClassSetCnt'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['SubClassSetCnt']; $b++) {&nbsp;</div></li><li><div>                                $offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                if ($offset == 0x0000) {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][] = 0;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $offset;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Lookup[$i]['Type'] . &quot;, Format &quot; . $SubstFormat . &quot; not supported (ttfontsuni.php).&quot;);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 6: Chaining Contextual Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 6) {&nbsp;</div></li><li><div>                        // Format 1: Simple Chaining Context Glyph Substitution  p255&nbsp;</div></li><li><div>                        if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetCount']; $b++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetOffset'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 2: Class-based Chaining Context Glyph Substitution  p257&nbsp;</div></li><li><div>                        else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageTableOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['BacktrackClassDefOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['InputClassDefOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['LookaheadClassDefOffset'] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['ChainSubClassSetCnt'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['ChainSubClassSetCnt']; $b++) {&nbsp;</div></li><li><div>                                $offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                if ($offset == 0x0000) {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][] = $offset;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $offset;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 3: Coverage-based Chaining Context Glyph Substitution  p259&nbsp;</div></li><li><div>                        else if ($SubstFormat == 3) {&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['BacktrackGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['BacktrackGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageBacktrack'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['InputGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['InputGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageInput'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['LookaheadGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['LookaheadGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageLookahead'][] = $Lookup[$i]['Subtable'][$c]['Offset'] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['SubstCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['SubstCount']; $b++) {&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['SequenceIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['LookupListIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                /**&nbsp;</div></li><li><div>                                  Substitution Lookup Record&nbsp;</div></li><li><div>                                  All contextual substitution subtables specify the substitution data in a Substitution Lookup Record (SubstLookupRecord). Each record contains a SequenceIndex, which indicates the position where the substitution will occur in the glyph sequence. In addition, a LookupListIndex identifies the lookup to be applied at the glyph position specified by the SequenceIndex.&nbsp;</div></li><li><div>                                 */&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;Lookup Type &quot; . $Lookup[$i]['Type'] . &quot; not supported.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>//print_r($Lookup); exit;&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Process (2) Whole LookupList&nbsp;</div></li><li><div>            // Get Coverage tables and prepare preg_replace&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $Lookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>                    $SubstFormat = $Lookup[$i]['Subtable'][$c]['Format'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 1: Single Substitution Subtable 1 =&gt; 1&nbsp;</div></li><li><div>                    if ($Lookup[$i]['Type'] == 1) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage(false);&nbsp;</div></li><li><div>                        for ($g = 0; $g &lt; count($glyphs); $g++) {&nbsp;</div></li><li><div>                            $replace = array();&nbsp;</div></li><li><div>                            $substitute = array();&nbsp;</div></li><li><div>                            $replace[] = unicode_hex($this-&gt;glyphToChar[$glyphs[$g]][0]);&nbsp;</div></li><li><div>                            // Flag = Ignore&nbsp;</div></li><li><div>                            if ($this-&gt;_checkGSUBignore($Lookup[$i]['Flag'], $replace[0], $Lookup[$i]['MarkFilteringSet'])) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if (isset($Lookup[$i]['Subtable'][$c]['DeltaGlyphID'])) { // Format 1&nbsp;</div></li><li><div>                                $substitute[] = unicode_hex($this-&gt;glyphToChar[($glyphs[$g] + $Lookup[$i]['Subtable'][$c]['DeltaGlyphID'])][0]);&nbsp;</div></li><li><div>                            } else { // Format 2&nbsp;</div></li><li><div>                                $substitute[] = unicode_hex($this-&gt;glyphToChar[($Lookup[$i]['Subtable'][$c]['Glyphs'][$g])][0]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['subs'][] = array('Replace' =&gt; $replace, 'substitute' =&gt; $substitute);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 2: Multiple Substitution Subtable 1 =&gt; n&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 2) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                        for ($g = 0; $g &lt; count($glyphs); $g++) {&nbsp;</div></li><li><div>                            $replace = array();&nbsp;</div></li><li><div>                            $substitute = array();&nbsp;</div></li><li><div>                            $replace[] = $glyphs[$g];&nbsp;</div></li><li><div>                            // Flag = Ignore&nbsp;</div></li><li><div>                            if ($this-&gt;_checkGSUBignore($Lookup[$i]['Flag'], $replace[0], $Lookup[$i]['MarkFilteringSet'])) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if (!isset($Lookup[$i]['Subtable'][$c]['Sequences'][$g]['SubstituteGlyphID']) || count($Lookup[$i]['Subtable'][$c]['Sequences'][$g]['SubstituteGlyphID']) == 0) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            } // Illegal for GlyphCount to be 0; either error in font, or something has gone wrong - lets carry on for now!&nbsp;</div></li><li><div>                            foreach ($Lookup[$i]['Subtable'][$c]['Sequences'][$g]['SubstituteGlyphID'] AS $sub) {&nbsp;</div></li><li><div>                                $substitute[] = unicode_hex($this-&gt;glyphToChar[$sub][0]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['subs'][] = array('Replace' =&gt; $replace, 'substitute' =&gt; $substitute);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // LookupType 3: Alternate Forms 1 =&gt; 1 (only first alternate form is used)&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 3) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                        for ($g = 0; $g &lt; count($glyphs); $g++) {&nbsp;</div></li><li><div>                            $replace = array();&nbsp;</div></li><li><div>                            $substitute = array();&nbsp;</div></li><li><div>                            $replace[] = $glyphs[$g];&nbsp;</div></li><li><div>                            // Flag = Ignore&nbsp;</div></li><li><div>                            if ($this-&gt;_checkGSUBignore($Lookup[$i]['Flag'], $replace[0], $Lookup[$i]['MarkFilteringSet'])) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($gl = 0; $gl &lt; $Lookup[$i]['Subtable'][$c]['AlternateSets'][$g]['GlyphCount']; $gl++) {&nbsp;</div></li><li><div>                                $gid = $Lookup[$i]['Subtable'][$c]['AlternateSets'][$g]['SubstituteGlyphID'][$gl];&nbsp;</div></li><li><div>                                $substitute[] = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            //$gid = $Lookup[$i]['Subtable'][$c]['AlternateSets'][$g]['SubstituteGlyphID'][0];&nbsp;</div></li><li><div>                            //$substitute[] = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['subs'][] = array('Replace' =&gt; $replace, 'substitute' =&gt; $substitute);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($i == 166) {&nbsp;</div></li><li><div>                            print_r($Lookup[$i]['Subtable']);&nbsp;</div></li><li><div>                            exit;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // LookupType 4: Ligature Substitution Subtable n =&gt; 1&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 4) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                        $LigSetCount = $Lookup[$i]['Subtable'][$c]['LigSetCount'];&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $LigSetCount; $s++) {&nbsp;</div></li><li><div>                            for ($g = 0; $g &lt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['LigCount']; $g++) {&nbsp;</div></li><li><div>                                $replace = array();&nbsp;</div></li><li><div>                                $substitute = array();&nbsp;</div></li><li><div>                                $replace[] = $glyphs[$s];&nbsp;</div></li><li><div>                                // Flag = Ignore&nbsp;</div></li><li><div>                                if ($this-&gt;_checkGSUBignore($Lookup[$i]['Flag'], $replace[0], $Lookup[$i]['MarkFilteringSet'])) {&nbsp;</div></li><li><div>                                    continue;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                for ($l = 1; $l &lt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['CompCount']; $l++) {&nbsp;</div></li><li><div>                                    $gid = $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['GlyphID'][$l];&nbsp;</div></li><li><div>                                    $rpl = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>                                    // Flag = Ignore&nbsp;</div></li><li><div>                                    if ($this-&gt;_checkGSUBignore($Lookup[$i]['Flag'], $rpl, $Lookup[$i]['MarkFilteringSet'])) {&nbsp;</div></li><li><div>                                        continue 2;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $replace[] = $rpl;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $gid = $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['LigGlyph'];&nbsp;</div></li><li><div>                                $substitute[] = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['subs'][] = array('Replace' =&gt; $replace, 'substitute' =&gt; $substitute, 'CompCount' =&gt; $Lookup[$i]['Subtable'][$c]['LigSet'][$s]['Ligature'][$g]['CompCount']);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 5: Contextual Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 5) {&nbsp;</div></li><li><div>                        // Format 1: Context Substitution&nbsp;</div></li><li><div>                        if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageGlyphs'] = $CoverageGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSetCount']; $s++) {&nbsp;</div></li><li><div>                                $SubRuleSet = $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s];&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['FirstGlyph'] = $CoverageGlyphs[$s];&nbsp;</div></li><li><div>                                for ($r = 0; $r &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRuleCount']; $r++) {&nbsp;</div></li><li><div>                                    $GlyphCount = $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$r]['GlyphCount'];&nbsp;</div></li><li><div>                                    for ($g = 1; $g &lt; $GlyphCount; $g++) {&nbsp;</div></li><li><div>                                        $glyphID = $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$r]['Input'][$g];&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'][$r]['InputGlyphs'][$g] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 2: Class-based Context Glyph Substitution&nbsp;</div></li><li><div>                        else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageGlyphs'] = $CoverageGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $InputClasses = $this-&gt;_getClasses($Lookup[$i]['Subtable'][$c]['ClassDefOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['InputClasses'] = $InputClasses;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['SubClassSetCnt']; $s++) {&nbsp;</div></li><li><div>                                if ($Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][$s] &gt; 0) {&nbsp;</div></li><li><div>                                    $this-&gt;seek($Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][$s]);&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['SubClassSet'][$s]['SubClassRuleCnt'] = $SubClassRuleCnt = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    $SubClassRule = array();&nbsp;</div></li><li><div>                                    for ($b = 0; $b &lt; $SubClassRuleCnt; $b++) {&nbsp;</div></li><li><div>                                        $SubClassRule[$b] = $Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][$s] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubClassSet'][$s]['SubClassRule'][$b] = $SubClassRule[$b];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['SubClassSetCnt']; $s++) {&nbsp;</div></li><li><div>                                $SubClassRuleCnt = $Lookup[$i]['Subtable'][$c]['SubClassSet'][$s]['SubClassRuleCnt'];&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $SubClassRuleCnt; $b++) {&nbsp;</div></li><li><div>                                    if ($Lookup[$i]['Subtable'][$c]['SubClassSetOffset'][$s] &gt; 0) {&nbsp;</div></li><li><div>                                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['SubClassSet'][$s]['SubClassRule'][$b]);&nbsp;</div></li><li><div>                                        $Rule = array();&nbsp;</div></li><li><div>                                        $Rule['InputGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Rule['SubstCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        for ($r = 1; $r &lt; $Rule['InputGlyphCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['Input'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        for ($r = 0; $r &lt; $Rule['SubstCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['SequenceIndex'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                            $Rule['LookupListIndex'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['SubClassSet'][$s]['SubClassRule'][$b] = $Rule;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 3: Coverage-based Context Glyph Substitution&nbsp;</div></li><li><div>                        else if ($SubstFormat == 3) {&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['InputGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageInput'][$b]);&nbsp;</div></li><li><div>                                $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageInputGlyphs'][] = implode(&quot;|&quot;, $glyphs);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            throw new MpdfException(&quot;Lookup Type 5, SubstFormat 3 not tested. Please report this with the name of font used - &quot; . $this-&gt;fontkey);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // LookupType 6: Chaining Contextual Substitution Subtable&nbsp;</div></li><li><div>                    else if ($Lookup[$i]['Type'] == 6) {&nbsp;</div></li><li><div>                        // Format 1: Simple Chaining Context Glyph Substitution  p255&nbsp;</div></li><li><div>                        if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageGlyphs'] = $CoverageGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $ChainSubRuleSetCnt = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetCount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $ChainSubRuleSetCnt; $s++) {&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['ChainSubRuleSetOffset'][$s]);&nbsp;</div></li><li><div>                                $ChainSubRuleCnt = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRuleCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                for ($r = 0; $r &lt; $ChainSubRuleCnt; $r++) {&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRuleOffset'][$r] = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetOffset'][$s] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $ChainSubRuleSetCnt; $s++) {&nbsp;</div></li><li><div>                                $ChainSubRuleCnt = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRuleCount'];&nbsp;</div></li><li><div>                                for ($r = 0; $r &lt; $ChainSubRuleCnt; $r++) {&nbsp;</div></li><li><div>                                    // ChainSubRule&nbsp;</div></li><li><div>                                    $this-&gt;seek($Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRuleOffset'][$r]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $BacktrackGlyphCount = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['BacktrackGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    for ($g = 0; $g &lt; $BacktrackGlyphCount; $g++) {&nbsp;</div></li><li><div>                                        $glyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['BacktrackGlyphs'][$g] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $InputGlyphCount = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['InputGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    for ($g = 1; $g &lt; $InputGlyphCount; $g++) {&nbsp;</div></li><li><div>                                        $glyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['InputGlyphs'][$g] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $LookaheadGlyphCount = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['LookaheadGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    for ($g = 0; $g &lt; $LookaheadGlyphCount; $g++) {&nbsp;</div></li><li><div>                                        $glyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['LookaheadGlyphs'][$g] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $SubstCount = $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['SubstCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    for ($lu = 0; $lu &lt; $SubstCount; $lu++) {&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['SequenceIndex'][$lu] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'][$r]['LookupListIndex'][$lu] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 2: Class-based Chaining Context Glyph Substitution  p257&nbsp;</div></li><li><div>                        else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                            $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageTableOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['CoverageGlyphs'] = $CoverageGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $BacktrackClasses = $this-&gt;_getClasses($Lookup[$i]['Subtable'][$c]['BacktrackClassDefOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['BacktrackClasses'] = $BacktrackClasses;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $InputClasses = $this-&gt;_getClasses($Lookup[$i]['Subtable'][$c]['InputClassDefOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['InputClasses'] = $InputClasses;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $LookaheadClasses = $this-&gt;_getClasses($Lookup[$i]['Subtable'][$c]['LookaheadClassDefOffset']);&nbsp;</div></li><li><div>                            $Lookup[$i]['Subtable'][$c]['LookaheadClasses'] = $LookaheadClasses;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['ChainSubClassSetCnt']; $s++) {&nbsp;</div></li><li><div>                                if ($Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][$s] &gt; 0) {&nbsp;</div></li><li><div>                                    $this-&gt;seek($Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][$s]);&nbsp;</div></li><li><div>                                    $Lookup[$i]['Subtable'][$c]['ChainSubClassSet'][$s]['ChainSubClassRuleCnt'] = $ChainSubClassRuleCnt = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                    $ChainSubClassRule = array();&nbsp;</div></li><li><div>                                    for ($b = 0; $b &lt; $ChainSubClassRuleCnt; $b++) {&nbsp;</div></li><li><div>                                        $ChainSubClassRule[$b] = $Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][$s] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubClassSet'][$s]['ChainSubClassRule'][$b] = $ChainSubClassRule[$b];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['ChainSubClassSetCnt']; $s++) {&nbsp;</div></li><li><div>                                $ChainSubClassRuleCnt = $Lookup[$i]['Subtable'][$c]['ChainSubClassSet'][$s]['ChainSubClassRuleCnt'];&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $ChainSubClassRuleCnt; $b++) {&nbsp;</div></li><li><div>                                    if ($Lookup[$i]['Subtable'][$c]['ChainSubClassSetOffset'][$s] &gt; 0) {&nbsp;</div></li><li><div>                                        $this-&gt;seek($Lookup[$i]['Subtable'][$c]['ChainSubClassSet'][$s]['ChainSubClassRule'][$b]);&nbsp;</div></li><li><div>                                        $Rule = array();&nbsp;</div></li><li><div>                                        $Rule['BacktrackGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        for ($r = 0; $r &lt; $Rule['BacktrackGlyphCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['Backtrack'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $Rule['InputGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        for ($r = 1; $r &lt; $Rule['InputGlyphCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['Input'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $Rule['LookaheadGlyphCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        for ($r = 0; $r &lt; $Rule['LookaheadGlyphCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['Lookahead'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $Rule['SubstCount'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        for ($r = 0; $r &lt; $Rule['SubstCount']; $r++) {&nbsp;</div></li><li><div>                                            $Rule['SequenceIndex'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                            $Rule['LookupListIndex'][$r] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $Lookup[$i]['Subtable'][$c]['ChainSubClassSet'][$s]['ChainSubClassRule'][$b] = $Rule;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Format 3: Coverage-based Chaining Context Glyph Substitution  p259&nbsp;</div></li><li><div>                        else if ($SubstFormat == 3) {&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['BacktrackGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageBacktrack'][$b]);&nbsp;</div></li><li><div>                                $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageBacktrackGlyphs'][] = implode(&quot;|&quot;, $glyphs);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['InputGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageInput'][$b]);&nbsp;</div></li><li><div>                                $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageInputGlyphs'][] = implode(&quot;|&quot;, $glyphs);&nbsp;</div></li><li><div>                                // Don't use above value as these are ordered numerically not as need to process&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['LookaheadGlyphCount']; $b++) {&nbsp;</div></li><li><div>                                $this-&gt;seek($Lookup[$i]['Subtable'][$c]['CoverageLookahead'][$b]);&nbsp;</div></li><li><div>                                $glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                                $Lookup[$i]['Subtable'][$c]['CoverageLookaheadGlyphs'][] = implode(&quot;|&quot;, $glyphs);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $st = $this-&gt;mpdf-&gt;OTLscript;&nbsp;</div></li><li><div>            $t = $this-&gt;mpdf-&gt;OTLlang;&nbsp;</div></li><li><div>            $langsys = $gsub[$st][$t];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lul = array(); // array of LookupListIndexes&nbsp;</div></li><li><div>            $tags = array(); // corresponding array of feature tags e.g. 'ccmp'&nbsp;</div></li><li><div>            foreach ($langsys AS $tag =&gt; $ft) {&nbsp;</div></li><li><div>                foreach ($ft AS $ll) {&nbsp;</div></li><li><div>                    $lul[$ll] = $tag;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ksort($lul); // Order the Lookups in the order they are in the GUSB table, regardless of Feature order&nbsp;</div></li><li><div>            $this-&gt;_getGSUBarray($Lookup, $lul, $st);&nbsp;</div></li><li><div>//print_r($lul); exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>//print_r($Lookup); exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array($GSUBScriptLang, $gsub, $GSLookup, $rtlPUAstr, $rtlPUAarr);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/////////////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    // GSUB functions&nbsp;</div></li><li><div>    function _getGSUBarray(&$Lookup, &$lul, $scripttag, $level = 1, $coverage = '', $exB = '', $exL = '')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Process (3) LookupList for specific Script-LangSys&nbsp;</div></li><li><div>        // Generate preg_replace&nbsp;</div></li><li><div>        $html = '';&nbsp;</div></li><li><div>        if ($level == 1) {&nbsp;</div></li><li><div>            $html .= '&lt;bookmark level=&quot;0&quot; content=&quot;GSUB features&quot;&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($lul AS $i =&gt; $tag) {&nbsp;</div></li><li><div>            $html .= '&lt;div class=&quot;level' . $level . '&quot;&gt;';&nbsp;</div></li><li><div>            $html .= '&lt;h5 class=&quot;level' . $level . '&quot;&gt;';&nbsp;</div></li><li><div>            if ($level == 1) {&nbsp;</div></li><li><div>                $html .= '&lt;bookmark level=&quot;1&quot; content=&quot;' . $tag . ' [#' . $i . ']&quot;&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $html .= 'Lookup #' . $i . ' [tag: &lt;span style=&quot;color:#000066;&quot;&gt;' . $tag . '&lt;/span&gt;]&lt;/h5&gt;';&nbsp;</div></li><li><div>            $ignore = $this-&gt;_getGSUBignoreString($Lookup[$i]['Flag'], $Lookup[$i]['MarkFilteringSet']);&nbsp;</div></li><li><div>            if ($ignore) {&nbsp;</div></li><li><div>                $html .= '&lt;div class=&quot;ignore&quot;&gt;Ignoring: ' . $ignore . '&lt;/div&gt; ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $Type = $Lookup[$i]['Type'];&nbsp;</div></li><li><div>            $Flag = $Lookup[$i]['Flag'];&nbsp;</div></li><li><div>            if (($Flag & 0x0001) == 1) {&nbsp;</div></li><li><div>                $dir = 'RTL';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $dir = 'LTR';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ($c = 0; $c &lt; $Lookup[$i]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>                $html .= '&lt;div class=&quot;subtable&quot;&gt;Subtable #' . $c;&nbsp;</div></li><li><div>                if ($level == 1) {&nbsp;</div></li><li><div>                    $html .= '&lt;bookmark level=&quot;2&quot; content=&quot;Subtable #' . $c . '&quot;&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $SubstFormat = $Lookup[$i]['Subtable'][$c]['Format'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // LookupType 1: Single Substitution Subtable&nbsp;</div></li><li><div>                if ($Lookup[$i]['Type'] == 1) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 1: Single Substitution Subtable&lt;/div&gt;';&nbsp;</div></li><li><div>                    for ($s = 0; $s &lt; count($Lookup[$i]['Subtable'][$c]['subs']); $s++) {&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['subs'][$s]['Replace'];&nbsp;</div></li><li><div>                        $substitute = $Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute'][0];&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($coverage, $inputGlyphs[0]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($inputGlyphs[0]) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($inputGlyphs[0]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;changed&quot;&gt;&nbsp;' . $this-&gt;formatEntity($substitute) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($substitute) . '&lt;/span&gt; ';&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // LookupType 2: Multiple Substitution Subtable&nbsp;</div></li><li><div>                else if ($Lookup[$i]['Type'] == 2) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 2: Multiple Substitution Subtable&lt;/div&gt;';&nbsp;</div></li><li><div>                    for ($s = 0; $s &lt; count($Lookup[$i]['Subtable'][$c]['subs']); $s++) {&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['subs'][$s]['Replace'];&nbsp;</div></li><li><div>                        $substitute = $Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute'];&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($coverage, $inputGlyphs[0]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($inputGlyphs[0]) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($inputGlyphs[0]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;changed&quot;&gt;&nbsp;' . $this-&gt;formatEntityArr($substitute) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniArr($substitute) . '&lt;/span&gt; ';&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // LookupType 3: Alternate Forms&nbsp;</div></li><li><div>                else if ($Lookup[$i]['Type'] == 3) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 3: Alternate Forms&lt;/div&gt;';&nbsp;</div></li><li><div>                    for ($s = 0; $s &lt; count($Lookup[$i]['Subtable'][$c]['subs']); $s++) {&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['subs'][$s]['Replace'];&nbsp;</div></li><li><div>                        $substitute = $Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute'][0];&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($coverage, $inputGlyphs[0]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($inputGlyphs[0]) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($inputGlyphs[0]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;changed&quot;&gt;&nbsp;' . $this-&gt;formatEntity($substitute) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($substitute) . '&lt;/span&gt; ';&nbsp;</div></li><li><div>                        if (count($Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute']) &gt; 1) {&nbsp;</div></li><li><div>                            for ($alt = 1; $alt &lt; count($Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute']); $alt++) {&nbsp;</div></li><li><div>                                $substitute = $Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute'][$alt];&nbsp;</div></li><li><div>                                $html .= '&nbsp; | &nbsp; ALT #' . $alt . ' &nbsp; ';&nbsp;</div></li><li><div>                                $html .= '&lt;span class=&quot;changed&quot;&gt;&nbsp;' . $this-&gt;formatEntity($substitute) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                $html .= '&nbsp; &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($substitute) . '&lt;/span&gt; ';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // LookupType 4: Ligature Substitution Subtable&nbsp;</div></li><li><div>                else if ($Lookup[$i]['Type'] == 4) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 4: Ligature Substitution Subtable&lt;/div&gt;';&nbsp;</div></li><li><div>                    for ($s = 0; $s &lt; count($Lookup[$i]['Subtable'][$c]['subs']); $s++) {&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['subs'][$s]['Replace'];&nbsp;</div></li><li><div>                        $substitute = $Lookup[$i]['Subtable'][$c]['subs'][$s]['substitute'][0];&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($coverage, $inputGlyphs[0]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniArr($inputGlyphs) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityArr($inputGlyphs) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                            $html .= $exB;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;changed&quot;&gt;&nbsp;' . $this-&gt;formatEntity($substitute) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                            $html .= $exL;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&nbsp; &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($substitute) . '&lt;/span&gt; ';&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // LookupType 5: Contextual Substitution Subtable&nbsp;</div></li><li><div>                else if ($Lookup[$i]['Type'] == 5) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 5: Contextual Substitution Subtable&lt;/div&gt;';&nbsp;</div></li><li><div>                    // Format 1: Context Substitution&nbsp;</div></li><li><div>                    if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 1: Context Substitution&lt;/div&gt;';&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['SubRuleSetCount']; $s++) {&nbsp;</div></li><li><div>                            // SubRuleSet&nbsp;</div></li><li><div>                            $subRule = array();&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;rule&quot;&gt;Subrule Set: ' . $s . '&lt;/div&gt;';&nbsp;</div></li><li><div>                            foreach ($Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['SubRule'] AS $rctr =&gt; $rule) {&nbsp;</div></li><li><div>                                // SubRule&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;rule&quot;&gt;SubRule: ' . $rctr . '&lt;/div&gt;';&nbsp;</div></li><li><div>                                $inputGlyphs = array();&nbsp;</div></li><li><div>                                if ($rule['GlyphCount'] &gt; 1) {&nbsp;</div></li><li><div>                                    $inputGlyphs = $rule['InputGlyphs'];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $inputGlyphs[0] = $Lookup[$i]['Subtable'][$c]['SubRuleSet'][$s]['FirstGlyph'];&nbsp;</div></li><li><div>                                ksort($inputGlyphs);&nbsp;</div></li><li><div>                                $nInput = count($inputGlyphs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $exampleI = array();&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                                    $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                    $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $rule['SubstCount']; $b++) {&nbsp;</div></li><li><div>                                    $lup = $rule['SubstLookupRecord'][$b]['LookupListIndex'];&nbsp;</div></li><li><div>                                    $seqIndex = $rule['SubstLookupRecord'][$b]['SequenceIndex'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // GENERATE exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex]&nbsp;</div></li><li><div>                                    $exB = '';&nbsp;</div></li><li><div>                                    $exL = '';&nbsp;</div></li><li><div>                                    if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                            $exB .= $this-&gt;formatEntity($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                            $exL .= $this-&gt;formatEntity($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                                    // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                                    // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                                    // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                                    $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if (count($subRule['rules']))&nbsp;</div></li><li><div>                                    $volt[] = $subRule;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // Format 2: Class-based Context Glyph Substitution&nbsp;</div></li><li><div>                    else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 2: Class-based Context Glyph Substitution&lt;/div&gt;';&nbsp;</div></li><li><div>                        foreach ($Lookup[$i]['Subtable'][$c]['SubClassSet'] AS $inputClass =&gt; $cscs) {&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;rule&quot;&gt;Input Class: ' . $inputClass . '&lt;/div&gt;';&nbsp;</div></li><li><div>                            for ($cscrule = 0; $cscrule &lt; $cscs['SubClassRuleCnt']; $cscrule++) {&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;rule&quot;&gt;Rule: ' . $cscrule . '&lt;/div&gt;';&nbsp;</div></li><li><div>                                $rule = $cscs['SubClassRule'][$cscrule];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $inputGlyphs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $inputGlyphs[0] = $Lookup[$i]['Subtable'][$c]['InputClasses'][$inputClass];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($rule['InputGlyphCount'] &gt; 1) {&nbsp;</div></li><li><div>                                    //  NB starts at 1&nbsp;</div></li><li><div>                                    for ($gcl = 1; $gcl &lt; $rule['InputGlyphCount']; $gcl++) {&nbsp;</div></li><li><div>                                        $classindex = $rule['Input'][$gcl];&nbsp;</div></li><li><div>                                        $inputGlyphs[$gcl] = $Lookup[$i]['Subtable'][$c]['InputClasses'][$classindex];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // Class 0 contains all the glyphs NOT in the other classes&nbsp;</div></li><li><div>                                $class0excl = implode('|', $Lookup[$i]['Subtable'][$c]['InputClasses']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $exampleI = array();&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (!$inputGlyphs[$ff]) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;[NOT ' . $this-&gt;formatEntityStr($class0excl) . ']&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleI[] = '[NOT ' . $this-&gt;formatEntityFirst($class0excl) . ']';&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $rule['SubstCount']; $b++) {&nbsp;</div></li><li><div>                                    $lup = $rule['LookupListIndex'][$b];&nbsp;</div></li><li><div>                                    $seqIndex = $rule['SequenceIndex'][$b];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // GENERATE exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex]&nbsp;</div></li><li><div>                                    $exB = '';&nbsp;</div></li><li><div>                                    $exL = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                            if (!$inputGlyphs[$ip]) {&nbsp;</div></li><li><div>                                                $exB .= '[*]';&nbsp;</div></li><li><div>                                            } else {&nbsp;</div></li><li><div>                                                $exB .= $this-&gt;formatEntityFirst($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                            if (!$inputGlyphs[$ip]) {&nbsp;</div></li><li><div>                                                $exL .= '[*]';&nbsp;</div></li><li><div>                                            } else {&nbsp;</div></li><li><div>                                                $exL .= $this-&gt;formatEntityFirst($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                                    // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                                    // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                                    // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                                    $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                if (count($subRule['rules']))&nbsp;</div></li><li><div>                                    $volt[] = $subRule;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // Format 3: Coverage-based Context Glyph Substitution  p259&nbsp;</div></li><li><div>                    else if ($SubstFormat == 3) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 3: Coverage-based Context Glyph Substitution  &lt;/div&gt;';&nbsp;</div></li><li><div>                        // IgnoreMarks flag set on main Lookup table&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['CoverageInputGlyphs'];&nbsp;</div></li><li><div>                        $CoverageInputGlyphs = implode('|', $inputGlyphs);&nbsp;</div></li><li><div>                        $nInput = $Lookup[$i]['Subtable'][$c]['InputGlyphCount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $exampleI = array();&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                        for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['SubstCount']; $b++) {&nbsp;</div></li><li><div>                            $lup = $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['LookupListIndex'];&nbsp;</div></li><li><div>                            $seqIndex = $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['SequenceIndex'];&nbsp;</div></li><li><div>                            // GENERATE exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex]&nbsp;</div></li><li><div>                            $exB = '';&nbsp;</div></li><li><div>                            $exL = '';&nbsp;</div></li><li><div>                            if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                    $exB .= $exampleI[$ip] . '&#x200d;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                    $exL .= $exampleI[$ip] . '&#x200d;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                            // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                            // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                            // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                            $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (count($subRule['rules']))&nbsp;</div></li><li><div>                            $volt[] = $subRule;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//print_r($Lookup[$i]);&nbsp;</div></li><li><div>//print_r($volt[(count($volt)-1)]); exit;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // LookupType 6: Chaining Contextual Substitution Subtable&nbsp;</div></li><li><div>                else if ($Lookup[$i]['Type'] == 6) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 6: Chaining Contextual Substitution Subtable&lt;/div&gt;';&nbsp;</div></li><li><div>                    // Format 1: Simple Chaining Context Glyph Substitution  p255&nbsp;</div></li><li><div>                    if ($SubstFormat == 1) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 1: Simple Chaining Context Glyph Substitution  &lt;/div&gt;';&nbsp;</div></li><li><div>                        for ($s = 0; $s &lt; $Lookup[$i]['Subtable'][$c]['ChainSubRuleSetCount']; $s++) {&nbsp;</div></li><li><div>                            // ChainSubRuleSet&nbsp;</div></li><li><div>                            $subRule = array();&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;rule&quot;&gt;Subrule Set: ' . $s . '&lt;/div&gt;';&nbsp;</div></li><li><div>                            $firstInputGlyph = $Lookup[$i]['Subtable'][$c]['CoverageGlyphs'][$s]; // First input gyyph&nbsp;</div></li><li><div>                            foreach ($Lookup[$i]['Subtable'][$c]['ChainSubRuleSet'][$s]['ChainSubRule'] AS $rctr =&gt; $rule) {&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;rule&quot;&gt;SubRule: ' . $rctr . '&lt;/div&gt;';&nbsp;</div></li><li><div>                                // ChainSubRule&nbsp;</div></li><li><div>                                $inputGlyphs = array();&nbsp;</div></li><li><div>                                if ($rule['InputGlyphCount'] &gt; 1) {&nbsp;</div></li><li><div>                                    $inputGlyphs = $rule['InputGlyphs'];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $inputGlyphs[0] = $firstInputGlyph;&nbsp;</div></li><li><div>                                ksort($inputGlyphs);&nbsp;</div></li><li><div>                                $nInput = count($inputGlyphs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($rule['BacktrackGlyphCount']) {&nbsp;</div></li><li><div>                                    $backtrackGlyphs = $rule['BacktrackGlyphs'];&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $backtrackGlyphs = array();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($rule['LookaheadGlyphCount']) {&nbsp;</div></li><li><div>                                    $lookaheadGlyphs = $rule['LookaheadGlyphs'];&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $lookaheadGlyphs = array();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $exampleB = array();&nbsp;</div></li><li><div>                                $exampleI = array();&nbsp;</div></li><li><div>                                $exampleL = array();&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                                for ($ff = count($backtrackGlyphs) - 1; $ff &gt;= 0; $ff--) {&nbsp;</div></li><li><div>                                    $html .= '&lt;div&gt;Backtrack #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($backtrackGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                    $exampleB[] = $this-&gt;formatEntityFirst($backtrackGlyphs[$ff]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                                    $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                    $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($lookaheadGlyphs); $ff++) {&nbsp;</div></li><li><div>                                    $html .= '&lt;div&gt;Lookahead #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($lookaheadGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                    $exampleL[] = $this-&gt;formatEntityFirst($lookaheadGlyphs[$ff]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $rule['SubstCount']; $b++) {&nbsp;</div></li><li><div>                                    $lup = $rule['LookupListIndex'][$b];&nbsp;</div></li><li><div>                                    $seqIndex = $rule['SequenceIndex'][$b];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // GENERATE exampleB[n] exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex] exampleL[n]&nbsp;</div></li><li><div>                                    $exB = '';&nbsp;</div></li><li><div>                                    $exL = '';&nbsp;</div></li><li><div>                                    if (count($exampleB)) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;backtrack&quot;&gt;' . implode('&#x200d;', $exampleB) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                            $exB .= $this-&gt;formatEntity($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                            $exL .= $this-&gt;formatEntity($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (count($exampleL)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;lookahead&quot;&gt;' . implode('&#x200d;', $exampleL) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                                    // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                                    // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                                    // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                                    $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if (count($subRule['rules']))&nbsp;</div></li><li><div>                                    $volt[] = $subRule;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // Format 2: Class-based Chaining Context Glyph Substitution  p257&nbsp;</div></li><li><div>                    else if ($SubstFormat == 2) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 2: Class-based Chaining Context Glyph Substitution  &lt;/div&gt;';&nbsp;</div></li><li><div>                        foreach ($Lookup[$i]['Subtable'][$c]['ChainSubClassSet'] AS $inputClass =&gt; $cscs) {&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;rule&quot;&gt;Input Class: ' . $inputClass . '&lt;/div&gt;';&nbsp;</div></li><li><div>                            for ($cscrule = 0; $cscrule &lt; $cscs['ChainSubClassRuleCnt']; $cscrule++) {&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;rule&quot;&gt;Rule: ' . $cscrule . '&lt;/div&gt;';&nbsp;</div></li><li><div>                                $rule = $cscs['ChainSubClassRule'][$cscrule];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // These contain classes of glyphs as strings&nbsp;</div></li><li><div>                                // $Lookup[$i]['Subtable'][$c]['InputClasses'][(class)] e.g. 02E6|02E7|02E8&nbsp;</div></li><li><div>                                // $Lookup[$i]['Subtable'][$c]['LookaheadClasses'][(class)]&nbsp;</div></li><li><div>                                // $Lookup[$i]['Subtable'][$c]['BacktrackClasses'][(class)]&nbsp;</div></li><li><div>                                // These contain arrays of classIndexes&nbsp;</div></li><li><div>                                // [Backtrack] [Lookahead] and [Input] (Input is from the second position only)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $inputGlyphs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $inputGlyphs[0] = $Lookup[$i]['Subtable'][$c]['InputClasses'][$inputClass];&nbsp;</div></li><li><div>                                if ($rule['InputGlyphCount'] &gt; 1) {&nbsp;</div></li><li><div>                                    //  NB starts at 1&nbsp;</div></li><li><div>                                    for ($gcl = 1; $gcl &lt; $rule['InputGlyphCount']; $gcl++) {&nbsp;</div></li><li><div>                                        $classindex = $rule['Input'][$gcl];&nbsp;</div></li><li><div>                                        $inputGlyphs[$gcl] = $Lookup[$i]['Subtable'][$c]['InputClasses'][$classindex];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                // Class 0 contains all the glyphs NOT in the other classes&nbsp;</div></li><li><div>                                $class0excl = implode('|', $Lookup[$i]['Subtable'][$c]['InputClasses']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $nInput = $rule['InputGlyphCount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($rule['BacktrackGlyphCount']) {&nbsp;</div></li><li><div>                                    for ($gcl = 0; $gcl &lt; $rule['BacktrackGlyphCount']; $gcl++) {&nbsp;</div></li><li><div>                                        $classindex = $rule['Backtrack'][$gcl];&nbsp;</div></li><li><div>                                        $backtrackGlyphs[$gcl] = $Lookup[$i]['Subtable'][$c]['BacktrackClasses'][$classindex];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $backtrackGlyphs = array();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($rule['LookaheadGlyphCount']) {&nbsp;</div></li><li><div>                                    for ($gcl = 0; $gcl &lt; $rule['LookaheadGlyphCount']; $gcl++) {&nbsp;</div></li><li><div>                                        $classindex = $rule['Lookahead'][$gcl];&nbsp;</div></li><li><div>                                        $lookaheadGlyphs[$gcl] = $Lookup[$i]['Subtable'][$c]['LookaheadClasses'][$classindex];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $lookaheadGlyphs = array();&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $exampleB = array();&nbsp;</div></li><li><div>                                $exampleI = array();&nbsp;</div></li><li><div>                                $exampleL = array();&nbsp;</div></li><li><div>                                $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                                for ($ff = count($backtrackGlyphs) - 1; $ff &gt;= 0; $ff--) {&nbsp;</div></li><li><div>                                    if (!$backtrackGlyphs[$ff]) {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Backtrack #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;[NOT ' . $this-&gt;formatEntityStr($class0excl) . ']&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleB[] = '[NOT ' . $this-&gt;formatEntityFirst($class0excl) . ']';&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Backtrack #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($backtrackGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleB[] = $this-&gt;formatEntityFirst($backtrackGlyphs[$ff]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                                    if (!$inputGlyphs[$ff]) {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;[NOT ' . $this-&gt;formatEntityStr($class0excl) . ']&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleI[] = '[NOT ' . $this-&gt;formatEntityFirst($class0excl) . ']';&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                for ($ff = 0; $ff &lt; count($lookaheadGlyphs); $ff++) {&nbsp;</div></li><li><div>                                    if (!$lookaheadGlyphs[$ff]) {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Lookahead #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;[NOT ' . $this-&gt;formatEntityStr($class0excl) . ']&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleL[] = '[NOT ' . $this-&gt;formatEntityFirst($class0excl) . ']';&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $html .= '&lt;div&gt;Lookahead #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($lookaheadGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                                        $exampleL[] = $this-&gt;formatEntityFirst($lookaheadGlyphs[$ff]);&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($b = 0; $b &lt; $rule['SubstCount']; $b++) {&nbsp;</div></li><li><div>                                    $lup = $rule['LookupListIndex'][$b];&nbsp;</div></li><li><div>                                    $seqIndex = $rule['SequenceIndex'][$b];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // GENERATE exampleB[n] exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex] exampleL[n]&nbsp;</div></li><li><div>                                    $exB = '';&nbsp;</div></li><li><div>                                    $exL = '';&nbsp;</div></li><li><div>                                    if (count($exampleB)) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;backtrack&quot;&gt;' . implode('&#x200d;', $exampleB) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                        $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                            if (!$inputGlyphs[$ip]) {&nbsp;</div></li><li><div>                                                $exB .= '[*]';&nbsp;</div></li><li><div>                                            } else {&nbsp;</div></li><li><div>                                                $exB .= $this-&gt;formatEntityFirst($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                        for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                            if (!$inputGlyphs[$ip]) {&nbsp;</div></li><li><div>                                                $exL .= '[*]';&nbsp;</div></li><li><div>                                            } else {&nbsp;</div></li><li><div>                                                $exL .= $this-&gt;formatEntityFirst($inputGlyphs[$ip]) . '&#x200d;';&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if (count($exampleL)) {&nbsp;</div></li><li><div>                                        $exL .= '&lt;span class=&quot;lookahead&quot;&gt;' . implode('&#x200d;', $exampleL) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                                    // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                                    // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                                    // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                                    $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//print_r($Lookup[$i]['Subtable'][$c]); exit;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // Format 3: Coverage-based Chaining Context Glyph Substitution  p259&nbsp;</div></li><li><div>                    else if ($SubstFormat == 3) {&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;lookuptypesub&quot;&gt;Format 3: Coverage-based Chaining Context Glyph Substitution  &lt;/div&gt;';&nbsp;</div></li><li><div>                        // IgnoreMarks flag set on main Lookup table&nbsp;</div></li><li><div>                        $inputGlyphs = $Lookup[$i]['Subtable'][$c]['CoverageInputGlyphs'];&nbsp;</div></li><li><div>                        $CoverageInputGlyphs = implode('|', $inputGlyphs);&nbsp;</div></li><li><div>                        $nInput = $Lookup[$i]['Subtable'][$c]['InputGlyphCount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($Lookup[$i]['Subtable'][$c]['BacktrackGlyphCount']) {&nbsp;</div></li><li><div>                            $backtrackGlyphs = $Lookup[$i]['Subtable'][$c]['CoverageBacktrackGlyphs'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $backtrackGlyphs = array();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($Lookup[$i]['Subtable'][$c]['LookaheadGlyphCount']) {&nbsp;</div></li><li><div>                            $lookaheadGlyphs = $Lookup[$i]['Subtable'][$c]['CoverageLookaheadGlyphs'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $lookaheadGlyphs = array();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $exampleB = array();&nbsp;</div></li><li><div>                        $exampleI = array();&nbsp;</div></li><li><div>                        $exampleL = array();&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                        for ($ff = count($backtrackGlyphs) - 1; $ff &gt;= 0; $ff--) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Backtrack #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($backtrackGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleB[] = $this-&gt;formatEntityFirst($backtrackGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($ff = 0; $ff &lt; count($lookaheadGlyphs); $ff++) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Lookahead #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($lookaheadGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleL[] = $this-&gt;formatEntityFirst($lookaheadGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $Lookup[$i]['Subtable'][$c]['SubstCount']; $b++) {&nbsp;</div></li><li><div>                            $lup = $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['LookupListIndex'];&nbsp;</div></li><li><div>                            $seqIndex = $Lookup[$i]['Subtable'][$c]['SubstLookupRecord'][$b]['SequenceIndex'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // GENERATE exampleB[n] exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex] exampleL[n]&nbsp;</div></li><li><div>                            $exB = '';&nbsp;</div></li><li><div>                            $exL = '';&nbsp;</div></li><li><div>                            if (count($exampleB)) {&nbsp;</div></li><li><div>                                $exB .= '&lt;span class=&quot;backtrack&quot;&gt;' . implode('&#x200d;', $exampleB) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                    $exB .= $exampleI[$ip] . '&#x200d;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                    $exL .= $exampleI[$ip] . '&#x200d;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if (count($exampleL)) {&nbsp;</div></li><li><div>                                $exL .= '&lt;span class=&quot;lookahead&quot;&gt;' . implode('&#x200d;', $exampleL) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                            // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                            // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                            // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                            $html .= $this-&gt;_getGSUBarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($level == 1) {&nbsp;</div></li><li><div>            $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $html;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>//print_r($Lookup); exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    // mPDF 5.7.1&nbsp;</div></li><li><div>    function _checkGSUBignore($flag, $glyph, $MarkFilteringSet)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $ignore = false;&nbsp;</div></li><li><div>        // Flag & 0x0008 = Ignore Marks&nbsp;</div></li><li><div>        if ((($flag & 0x0008) == 0x0008) && strpos($this-&gt;GlyphClassMarks, $glyph)) {&nbsp;</div></li><li><div>            $ignore = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ((($flag & 0x0004) == 0x0004) && strpos($this-&gt;GlyphClassLigatures, $glyph)) {&nbsp;</div></li><li><div>            $ignore = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ((($flag & 0x0002) == 0x0002) && strpos($this-&gt;GlyphClassBases, $glyph)) {&nbsp;</div></li><li><div>            $ignore = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Flag & 0xFF?? = MarkAttachmentType&nbsp;</div></li><li><div>        if (($flag & 0xFF00) && strpos($this-&gt;MarkAttachmentType[($flag &gt;&gt; 8)], $glyph)) {&nbsp;</div></li><li><div>            $ignore = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Flag & 0x0010 = UseMarkFilteringSet&nbsp;</div></li><li><div>        if (($flag & 0x0010) && strpos($this-&gt;MarkGlyphSets[$MarkFilteringSet], $glyph)) {&nbsp;</div></li><li><div>            $ignore = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ignore;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getGSUBignoreString($flag, $MarkFilteringSet)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If ignoreFlag set, combine all ignore glyphs into -&gt; &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot;&nbsp;</div></li><li><div>        // else &quot;()&quot;&nbsp;</div></li><li><div>        // for Input - set on secondary Lookup table if in Context, and set Backtrack and Lookahead on Context Lookup&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        $ignoreflag = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Flag & 0xFF?? = MarkAttachmentType&nbsp;</div></li><li><div>        if ($flag & 0xFF00) {&nbsp;</div></li><li><div>            $MarkAttachmentType = $flag &gt;&gt; 8;&nbsp;</div></li><li><div>            $ignoreflag = $flag;&nbsp;</div></li><li><div>            //$str = $this-&gt;MarkAttachmentType[$MarkAttachmentType];&nbsp;</div></li><li><div>            $str = &quot;MarkAttachmentType[&quot; . $MarkAttachmentType . &quot;] &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Flag & 0x0010 = UseMarkFilteringSet&nbsp;</div></li><li><div>        if ($flag & 0x0010) {&nbsp;</div></li><li><div>            throw new MpdfException(&quot;This font &quot; . $this-&gt;fontkey . &quot; contains MarkGlyphSets&quot;);&nbsp;</div></li><li><div>            $str = &quot;Mark Glyph Set: &quot;;&nbsp;</div></li><li><div>            $str .= $this-&gt;MarkGlyphSets[$MarkFilteringSet];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If Ignore Marks set, supercedes any above&nbsp;</div></li><li><div>        // Flag & 0x0008 = Ignore Marks&nbsp;</div></li><li><div>        if (($flag & 0x0008) == 0x0008) {&nbsp;</div></li><li><div>            $ignoreflag = 8;&nbsp;</div></li><li><div>            //$str = $this-&gt;GlyphClassMarks;&nbsp;</div></li><li><div>            $str = &quot;Mark Glyphs &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Flag & 0x0004 = Ignore Ligatures&nbsp;</div></li><li><div>        if (($flag & 0x0004) == 0x0004) {&nbsp;</div></li><li><div>            $ignoreflag += 4;&nbsp;</div></li><li><div>            if ($str) {&nbsp;</div></li><li><div>                $str .= &quot;|&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //$str .= $this-&gt;GlyphClassLigatures;&nbsp;</div></li><li><div>            $str .= &quot;Ligature Glyphs &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Flag & 0x0002 = Ignore BaseGlyphs&nbsp;</div></li><li><div>        if (($flag & 0x0002) == 0x0002) {&nbsp;</div></li><li><div>            $ignoreflag += 2;&nbsp;</div></li><li><div>            if ($str) {&nbsp;</div></li><li><div>                $str .= &quot;|&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //$str .= $this-&gt;GlyphClassBases;&nbsp;</div></li><li><div>            $str .= &quot;Base Glyphs &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($str) {&nbsp;</div></li><li><div>            return $str;&nbsp;</div></li><li><div>        } else&nbsp;</div></li><li><div>            return &quot;&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // GSUB Patterns&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>      BACKTRACK                        INPUT                   LOOKAHEAD&nbsp;</div></li><li><div> ================================== ================== ==================================&nbsp;</div></li><li><div>      (FEEB|FEEC)(ign) (FD12|FD13)(ign) (0612)(ign) (0613)(ign) (FD12|FD13)(ign) (FEEB|FEEC)&nbsp;</div></li><li><div>      ----------------  ----------------  -----  ------------  ---------------   ---------------&nbsp;</div></li><li><div>      Backtrack 1       Backtrack 2     Input 1   Input 2       Lookahead 1      Lookahead 2&nbsp;</div></li><li><div>      --------   ---    ---------  ---    ----   ---   ----   ---   ---------   ---    -------&nbsp;</div></li><li><div>      \${1}  \${2}     \${3}   \${4}                      \${5+}  \${6+}    \${7+}  \${8+}&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      nBacktrack = 2               nInput = 2                 nLookahead = 2&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      nBsubs = 2xnBack          nIsubs = (nBsubs+)    nLsubs = (nBsubs+nIsubs+) 2xnLookahead&nbsp;</div></li><li><div>      &quot;\${1}\${2} &quot;                 (nInput*2)-1               &quot;\${5+} \${6+}&quot;&nbsp;</div></li><li><div>      &quot;REPL&quot;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      \${1}\${2} \${3}\${4} REPL\${5+} \${6+}\${7+} \${8+}&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      INPUT nInput = 5&nbsp;</div></li><li><div> ============================================================&nbsp;</div></li><li><div>      (0612)(ign) (0613)(ign) (0614)(ign) (0615)(ign) (0615)&nbsp;</div></li><li><div>      \${1}  \${2}  \${3}  \${4} \${5} \${6}  \${7} \${8}  \${9} (All backreference numbers are + nBsubs)&nbsp;</div></li><li><div>      -----  ------------ ------------ ------------ ------------&nbsp;</div></li><li><div>      Input 1   Input 2      Input 3      Input 4      Input 5&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      A======  SequenceIndex=1 ; Lookup match nGlyphs=1&nbsp;</div></li><li><div>      B===================  SequenceIndex=1 ; Lookup match nGlyphs=2&nbsp;</div></li><li><div>      C===============================  SequenceIndex=1 ; Lookup match nGlyphs=3&nbsp;</div></li><li><div>      D=======================  SequenceIndex=2 ; Lookup match nGlyphs=2&nbsp;</div></li><li><div>      E=====================================  SequenceIndex=2 ; Lookup match nGlyphs=3&nbsp;</div></li><li><div>      F======================  SequenceIndex=4 ; Lookup match nGlyphs=2&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>      All backreference numbers are + nBsubs&nbsp;</div></li><li><div>      A - &quot;REPL\${2} \${3}\${4} \${5}\${6} \${7}\${8} \${9}&quot;&nbsp;</div></li><li><div>      B - &quot;REPL\${2}\${4} \${5}\${6} \${7}\${8} \${9}&quot;&nbsp;</div></li><li><div>      C - &quot;REPL\${2}\${4}\${6} \${7}\${8} \${9}&quot;&nbsp;</div></li><li><div>      D - &quot;\${1} REPL\${2}\${4}\${6} \${7}\${8} \${9}&quot;&nbsp;</div></li><li><div>      E - &quot;\${1} REPL\${2}\${4}\${6}\${8} \${9}&quot;&nbsp;</div></li><li><div>      F - &quot;\${1}\${2} \${3}\${4} \${5} REPL\${6}\${8}&quot;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _makeGSUBcontextInputMatch($inputGlyphs, $ignore, $lookupGlyphs, $seqIndex)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // $ignore = &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot; or &quot;()&quot;&nbsp;</div></li><li><div>        // Returns e.g. (0612)(ignore) (0613)(ignore) (0614)&nbsp;</div></li><li><div>        // $inputGlyphs = array of glyphs(glyphstrings) making up Input sequence in Context&nbsp;</div></li><li><div>        // $lookupGlyphs = array of glyphs (single Glyphs) making up Lookup Input sequence&nbsp;</div></li><li><div>        $mLen = count($lookupGlyphs);  // nGlyphs in the secondary Lookup match&nbsp;</div></li><li><div>        $nInput = count($inputGlyphs); // nGlyphs in the Primary Input sequence&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $nInput; $i++) {&nbsp;</div></li><li><div>            if ($i &gt; 0) {&nbsp;</div></li><li><div>                $str .= $ignore . &quot; &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($i &gt;= $seqIndex && $i &lt; ($seqIndex + $mLen)) {&nbsp;</div></li><li><div>                $str .= &quot;&quot; . $lookupGlyphs[($i - $seqIndex)] . &quot;&quot;;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $str .= &quot;&quot; . $inputGlyphs[($i)] . &quot;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _makeGSUBinputMatch($inputGlyphs, $ignore)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // $ignore = &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot; or &quot;()&quot;&nbsp;</div></li><li><div>        // Returns e.g. (0612)(ignore) (0613)(ignore) (0614)&nbsp;</div></li><li><div>        // $inputGlyphs = array of glyphs(glyphstrings) making up Input sequence in Context&nbsp;</div></li><li><div>        // $lookupGlyphs = array of glyphs making up Lookup Input sequence - if applicable&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        for ($i = 1; $i &lt;= count($inputGlyphs); $i++) {&nbsp;</div></li><li><div>            if ($i &gt; 1) {&nbsp;</div></li><li><div>                $str .= $ignore . &quot; &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $str .= &quot;&quot; . $inputGlyphs[($i - 1)] . &quot;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _makeGSUBbacktrackMatch($backtrackGlyphs, $ignore)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // $ignore = &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot; or &quot;()&quot;&nbsp;</div></li><li><div>        // Returns e.g. (FEEB|FEEC)(ignore) (FD12|FD13)(ignore) &nbsp;</div></li><li><div>        // $backtrackGlyphs = array of glyphstrings making up Backtrack sequence&nbsp;</div></li><li><div>        // 3  2  1  0&nbsp;</div></li><li><div>        // each item being e.g. E0AD|E0AF|F1FD&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        for ($i = (count($backtrackGlyphs) - 1); $i &gt;= 0; $i--) {&nbsp;</div></li><li><div>            $str .= &quot;&quot; . $backtrackGlyphs[$i] . &quot; &quot; . $ignore . &quot; &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _makeGSUBlookaheadMatch($lookaheadGlyphs, $ignore)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // $ignore = &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot; or &quot;()&quot;&nbsp;</div></li><li><div>        // Returns e.g. (ignore) (FD12|FD13)(ignore) (FEEB|FEEC)&nbsp;</div></li><li><div>        // $lookaheadGlyphs = array of glyphstrings making up Lookahead sequence&nbsp;</div></li><li><div>        // 0  1  2  3&nbsp;</div></li><li><div>        // each item being e.g. E0AD|E0AF|F1FD&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; count($lookaheadGlyphs); $i++) {&nbsp;</div></li><li><div>            $str .= $ignore . &quot; &quot; . $lookaheadGlyphs[$i] . &quot;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _makeGSUBinputReplacement($nInput, $REPL, $ignore, $nBsubs, $mLen, $seqIndex)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Returns e.g. &quot;REPL\${6}\${8}&quot; or &quot;\${1}\${2} \${3} REPL\${4}\${6}\${8} \${9}&quot;&nbsp;</div></li><li><div>        // $nInput    nGlyphs in the Primary Input sequence&nbsp;</div></li><li><div>        // $REPL     replacement glyphs from secondary lookup&nbsp;</div></li><li><div>        // $ignore = &quot;((?:(?: FBA1| FBA2| FBA3))*)&quot; or &quot;()&quot;&nbsp;</div></li><li><div>        // $nBsubs    Number of Backtrack substitutions (= 2x Number of Backtrack glyphs)&nbsp;</div></li><li><div>        // $mLen     nGlyphs in the secondary Lookup match - if no secondary lookup, should=$nInput&nbsp;</div></li><li><div>        // $seqIndex    Sequence Index to apply the secondary match&nbsp;</div></li><li><div>        if ($ignore == &quot;()&quot;) {&nbsp;</div></li><li><div>            $ign = false;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $ign = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $str = &quot;&quot;;&nbsp;</div></li><li><div>        if ($nInput == 1) {&nbsp;</div></li><li><div>            $str = $REPL;&nbsp;</div></li><li><div>        } else if ($nInput &gt; 1) {&nbsp;</div></li><li><div>            if ($mLen == $nInput) { // whole string replaced&nbsp;</div></li><li><div>                $str = $REPL;&nbsp;</div></li><li><div>                if ($ign) {&nbsp;</div></li><li><div>                    // for every nInput over 1, add another replacement backreference, to move IGNORES after replacement&nbsp;</div></li><li><div>                    for ($x = 2; $x &lt;= $nInput; $x++) {&nbsp;</div></li><li><div>                        $str .= '\\' . ($nBsubs + (2 * ($x - 1)));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else { // if only part of string replaced:&nbsp;</div></li><li><div>                for ($x = 1; $x &lt; ($seqIndex + 1); $x++) {&nbsp;</div></li><li><div>                    if ($x == 1) {&nbsp;</div></li><li><div>                        $str .= '\\' . ($nBsubs + 1);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ($ign) {&nbsp;</div></li><li><div>                            $str .= '\\' . ($nBsubs + (2 * ($x - 1)));&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $str .= ' \\' . ($nBsubs + 1 + (2 * ($x - 1)));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                    $str .= &quot; &quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $str .= $REPL;&nbsp;</div></li><li><div>                if ($ign) {&nbsp;</div></li><li><div>                    for ($x = (max(($seqIndex + 1), 2)); $x &lt; ($seqIndex + 1 + $mLen); $x++) { //  move IGNORES after replacement&nbsp;</div></li><li><div>                        $str .= '\\' . ($nBsubs + (2 * ($x - 1)));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                for ($x = ($seqIndex + 1 + $mLen); $x &lt;= $nInput; $x++) {&nbsp;</div></li><li><div>                    if ($ign) {&nbsp;</div></li><li><div>                        $str .= '\\' . ($nBsubs + (2 * ($x - 1)));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $str .= ' \\' . ($nBsubs + 1 + (2 * ($x - 1)));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    function _getCoverage($convert2hex = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $g = array();&nbsp;</div></li><li><div>        $CoverageFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        if ($CoverageFormat == 1) {&nbsp;</div></li><li><div>            $CoverageGlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($gid = 0; $gid &lt; $CoverageGlyphCount; $gid++) {&nbsp;</div></li><li><div>                $glyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                if ($convert2hex) {&nbsp;</div></li><li><div>                    $g[] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $g[] = $glyphID;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($CoverageFormat == 2) {&nbsp;</div></li><li><div>            $RangeCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($r = 0; $r &lt; $RangeCount; $r++) {&nbsp;</div></li><li><div>                $start = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $end = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $StartCoverageIndex = $this-&gt;read_ushort(); // n/a&nbsp;</div></li><li><div>                for ($gid = $start; $gid &lt;= $end; $gid++) {&nbsp;</div></li><li><div>                    $glyphID = $gid;&nbsp;</div></li><li><div>                    if ($convert2hex) {&nbsp;</div></li><li><div>                        $g[] = unicode_hex($this-&gt;glyphToChar[$glyphID][0]);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $g[] = $glyphID;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $g;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    function _getClasses($offset)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;seek($offset);&nbsp;</div></li><li><div>        $ClassFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $GlyphByClass = array();&nbsp;</div></li><li><div>        if ($ClassFormat == 1) {&nbsp;</div></li><li><div>            $StartGlyph = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $GlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $GlyphCount; $i++) {&nbsp;</div></li><li><div>                $startGlyphID = $StartGlyph + $i;&nbsp;</div></li><li><div>                $endGlyphID = $StartGlyph + $i;&nbsp;</div></li><li><div>                $class = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($g = $startGlyphID; $g &lt;= $endGlyphID; $g++) {&nbsp;</div></li><li><div>                    if ($this-&gt;glyphToChar[$g][0]) {&nbsp;</div></li><li><div>                        $GlyphByClass[$class][] = unicode_hex($this-&gt;glyphToChar[$g][0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if ($ClassFormat == 2) {&nbsp;</div></li><li><div>            $tableCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $tableCount; $i++) {&nbsp;</div></li><li><div>                $startGlyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $endGlyphID = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $class = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($g = $startGlyphID; $g &lt;= $endGlyphID; $g++) {&nbsp;</div></li><li><div>                    if ($this-&gt;glyphToChar[$g][0]) {&nbsp;</div></li><li><div>                        $GlyphByClass[$class][] = unicode_hex($this-&gt;glyphToChar[$g][0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $gbc = array();&nbsp;</div></li><li><div>        foreach ($GlyphByClass AS $class =&gt; $garr) {&nbsp;</div></li><li><div>            $gbc[$class] = implode('|', $garr);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $gbc;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    function _getGPOStables()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        // GPOS - Glyph Positioning&nbsp;</div></li><li><div>        ///////////////////////////////////&nbsp;</div></li><li><div>        if (isset($this-&gt;tables[&quot;GPOS&quot;])) {&nbsp;</div></li><li><div>            $this-&gt;mpdf-&gt;WriteHTML('&lt;h1&gt;GPOS Tables&lt;/h1&gt;');&nbsp;</div></li><li><div>            $ffeats = array();&nbsp;</div></li><li><div>            $gpos_offset = $this-&gt;seek_table(&quot;GPOS&quot;);&nbsp;</div></li><li><div>            $this-&gt;skip(4);&nbsp;</div></li><li><div>            $ScriptList_offset = $gpos_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $FeatureList_offset = $gpos_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $LookupList_offset = $gpos_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // ScriptList&nbsp;</div></li><li><div>            $this-&gt;seek($ScriptList_offset);&nbsp;</div></li><li><div>            $ScriptCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $ScriptCount; $i++) {&nbsp;</div></li><li><div>                $ScriptTag = $this-&gt;read_tag(); // = &quot;beng&quot;, &quot;deva&quot; etc.&nbsp;</div></li><li><div>                $ScriptTableOffset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $ffeats[$ScriptTag] = $ScriptList_offset + $ScriptTableOffset;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Script Table&nbsp;</div></li><li><div>            foreach ($ffeats AS $t =&gt; $o) {&nbsp;</div></li><li><div>                $ls = array();&nbsp;</div></li><li><div>                $this-&gt;seek($o);&nbsp;</div></li><li><div>                $DefLangSys_offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                if ($DefLangSys_offset &gt; 0) {&nbsp;</div></li><li><div>                    $ls['DFLT'] = $DefLangSys_offset + $o;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $LangSysCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $LangSysCount; $i++) {&nbsp;</div></li><li><div>                    $LangTag = $this-&gt;read_tag(); // =&nbsp;</div></li><li><div>                    $LangTableOffset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $ls[$LangTag] = $o + $LangTableOffset;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $ffeats[$t] = $ls;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get FeatureIndexList&nbsp;</div></li><li><div>            // LangSys Table - from first listed langsys&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $o) {&nbsp;</div></li><li><div>                    $FeatureIndex = array();&nbsp;</div></li><li><div>                    $langsystable_offset = $o;&nbsp;</div></li><li><div>                    $this-&gt;seek($langsystable_offset);&nbsp;</div></li><li><div>                    $LookUpOrder = $this-&gt;read_ushort(); //==NULL&nbsp;</div></li><li><div>                    $ReqFeatureIndex = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    if ($ReqFeatureIndex != 0xFFFF) {&nbsp;</div></li><li><div>                        $FeatureIndex[] = $ReqFeatureIndex;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $FeatureCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                        $FeatureIndex[] = $this-&gt;read_ushort(); // = index of feature&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $ffeats[$st][$t] = $FeatureIndex;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>//print_r($ffeats); exit;&nbsp;</div></li><li><div>            // Feauture List =&gt; LookupListIndex es&nbsp;</div></li><li><div>            $this-&gt;seek($FeatureList_offset);&nbsp;</div></li><li><div>            $FeatureCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $Feature = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                $Feature[$i] = array('tag' =&gt; $this-&gt;read_tag());&nbsp;</div></li><li><div>                $Feature[$i]['offset'] = $FeatureList_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $FeatureCount; $i++) {&nbsp;</div></li><li><div>                $this-&gt;seek($Feature[$i]['offset']);&nbsp;</div></li><li><div>                $this-&gt;read_ushort(); // null&nbsp;</div></li><li><div>                $Feature[$i]['LookupCount'] = $Lookupcount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Feature[$i]['LookupListIndex'] = array();&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $Lookupcount; $c++) {&nbsp;</div></li><li><div>                    $Feature[$i]['LookupListIndex'][] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $o) {&nbsp;</div></li><li><div>                    $FeatureIndex = $ffeats[$st][$t];&nbsp;</div></li><li><div>                    foreach ($FeatureIndex AS $k =&gt; $fi) {&nbsp;</div></li><li><div>                        $ffeats[$st][$t][$k] = $Feature[$fi];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>//print_r($ffeats); exit;&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            $gpos = array();&nbsp;</div></li><li><div>            $GPOSScriptLang = array();&nbsp;</div></li><li><div>            foreach ($ffeats AS $st =&gt; $scripts) {&nbsp;</div></li><li><div>                foreach ($scripts AS $t =&gt; $langsys) {&nbsp;</div></li><li><div>                    $lg = array();&nbsp;</div></li><li><div>                    foreach ($langsys AS $ft) {&nbsp;</div></li><li><div>                        $lg[$ft['LookupListIndex'][0]] = $ft;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // list of Lookups in order they need to be run i.e. order listed in Lookup table&nbsp;</div></li><li><div>                    ksort($lg);&nbsp;</div></li><li><div>                    foreach ($lg AS $ft) {&nbsp;</div></li><li><div>                        $gpos[$st][$t][$ft['tag']] = $ft['LookupListIndex'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (!isset($GPOSScriptLang[$st])) {&nbsp;</div></li><li><div>                        $GPOSScriptLang[$st] = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $GPOSScriptLang[$st] .= $t . ' ';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($this-&gt;mode == 'summary') {&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;h3&gt;GPOS Scripts &amp; Languages&lt;/h3&gt;');&nbsp;</div></li><li><div>                $html = '';&nbsp;</div></li><li><div>                if (count($gpos)) {&nbsp;</div></li><li><div>                    foreach ($gpos AS $st =&gt; $g) {&nbsp;</div></li><li><div>                        $html .= '&lt;h5&gt;' . $st . '&lt;/h5&gt;';&nbsp;</div></li><li><div>                        foreach ($g AS $l =&gt; $t) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;&lt;a href=&quot;font_dump_OTL.php?script=' . $st . '&lang=' . $l . '&quot;&gt;' . $l . '&lt;/a&gt;&lt;/b&gt;: ';&nbsp;</div></li><li><div>                            foreach ($t AS $tag =&gt; $o) {&nbsp;</div></li><li><div>                                $html .= $tag . ' ';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $html .= '&lt;div&gt;No entries in GPOS table.&lt;/div&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>                $this-&gt;mpdf-&gt;WriteHTML('&lt;/div&gt;');&nbsp;</div></li><li><div>                return 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>            // Get metadata and offsets for whole Lookup List table&nbsp;</div></li><li><div>            $this-&gt;seek($LookupList_offset);&nbsp;</div></li><li><div>            $LookupCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            $Lookup = array();&nbsp;</div></li><li><div>            $Offsets = array();&nbsp;</div></li><li><div>            $SubtableCount = array();&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $Offsets[$i] = $LookupList_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $LookupCount; $i++) {&nbsp;</div></li><li><div>                $this-&gt;seek($Offsets[$i]);&nbsp;</div></li><li><div>                $Lookup[$i]['Type'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Lookup[$i]['Flag'] = $flag = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $Lookup[$i]['SubtableCount'] = $SubtableCount[$i] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                for ($c = 0; $c &lt; $SubtableCount[$i]; $c++) {&nbsp;</div></li><li><div>                    $Lookup[$i]['Subtables'][$c] = $Offsets[$i] + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // MarkFilteringSet = Index (base 0) into GDEF mark glyph sets structure&nbsp;</div></li><li><div>                if (($flag & 0x0010) == 0x0010) {&nbsp;</div></li><li><div>                    $Lookup[$i]['MarkFilteringSet'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // else { $Lookup[$i]['MarkFilteringSet'] = ''; }&nbsp;</div></li><li><div>                // Lookup Type 9: Extension&nbsp;</div></li><li><div>                if ($Lookup[$i]['Type'] == 9) {&nbsp;</div></li><li><div>                    // Overwrites new offset (32-bit) for each subtable, and a new lookup Type&nbsp;</div></li><li><div>                    for ($c = 0; $c &lt; $SubtableCount[$i]; $c++) {&nbsp;</div></li><li><div>                        $this-&gt;seek($Lookup[$i]['Subtables'][$c]);&nbsp;</div></li><li><div>                        $ExtensionPosFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $type = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Lookup[$i]['Subtables'][$c] = $Lookup[$i]['Subtables'][$c] + $this-&gt;read_ulong();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $Lookup[$i]['Type'] = $type;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //=====================================================================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $st = $this-&gt;mpdf-&gt;OTLscript;&nbsp;</div></li><li><div>            $t = $this-&gt;mpdf-&gt;OTLlang;&nbsp;</div></li><li><div>            $langsys = $gpos[$st][$t];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lul = array(); // array of LookupListIndexes&nbsp;</div></li><li><div>            $tags = array(); // corresponding array of feature tags e.g. 'ccmp'&nbsp;</div></li><li><div>            if (count($langsys)) {&nbsp;</div></li><li><div>                foreach ($langsys AS $tag =&gt; $ft) {&nbsp;</div></li><li><div>                    foreach ($ft AS $ll) {&nbsp;</div></li><li><div>                        $lul[$ll] = $tag;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ksort($lul); // Order the Lookups in the order they are in the GUSB table, regardless of Feature order&nbsp;</div></li><li><div>            $this-&gt;_getGPOSarray($Lookup, $lul, $st);&nbsp;</div></li><li><div>//print_r($lul); exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return array($GPOSScriptLang, $gpos, $Lookup);&nbsp;</div></li><li><div>        } // end if GPOS&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>/////////////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    // GPOS functions&nbsp;</div></li><li><div>    function _getGPOSarray(&$Lookup, $lul, $scripttag, $level = 1, $lcoverage = '', $exB = '', $exL = '')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Process (3) LookupList for specific Script-LangSys&nbsp;</div></li><li><div>        $html = '';&nbsp;</div></li><li><div>        if ($level == 1) {&nbsp;</div></li><li><div>            $html .= '&lt;bookmark level=&quot;0&quot; content=&quot;GPOS features&quot;&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($lul AS $luli =&gt; $tag) {&nbsp;</div></li><li><div>            $html .= '&lt;div class=&quot;level' . $level . '&quot;&gt;';&nbsp;</div></li><li><div>            $html .= '&lt;h5 class=&quot;level' . $level . '&quot;&gt;';&nbsp;</div></li><li><div>            if ($level == 1) {&nbsp;</div></li><li><div>                $html .= '&lt;bookmark level=&quot;1&quot; content=&quot;' . $tag . ' [#' . $luli . ']&quot;&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $html .= 'Lookup #' . $luli . ' [tag: &lt;span style=&quot;color:#000066;&quot;&gt;' . $tag . '&lt;/span&gt;]&lt;/h5&gt;';&nbsp;</div></li><li><div>            $ignore = $this-&gt;_getGSUBignoreString($Lookup[$luli]['Flag'], $Lookup[$luli]['MarkFilteringSet']);&nbsp;</div></li><li><div>            if ($ignore) {&nbsp;</div></li><li><div>                $html .= '&lt;div class=&quot;ignore&quot;&gt;Ignoring: ' . $ignore . '&lt;/div&gt; ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $Type = $Lookup[$luli]['Type'];&nbsp;</div></li><li><div>            $Flag = $Lookup[$luli]['Flag'];&nbsp;</div></li><li><div>            if (($Flag & 0x0001) == 1) {&nbsp;</div></li><li><div>                $dir = 'RTL';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $dir = 'LTR';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ($c = 0; $c &lt; $Lookup[$luli]['SubtableCount']; $c++) {&nbsp;</div></li><li><div>                $html .= '&lt;div class=&quot;subtable&quot;&gt;Subtable #' . $c;&nbsp;</div></li><li><div>                if ($level == 1) {&nbsp;</div></li><li><div>                    $html .= '&lt;bookmark level=&quot;2&quot; content=&quot;Subtable #' . $c . '&quot;&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Lets start&nbsp;</div></li><li><div>                $subtable_offset = $Lookup[$luli]['Subtables'][$c];&nbsp;</div></li><li><div>                $this-&gt;seek($subtable_offset);&nbsp;</div></li><li><div>                $PosFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 1: Single adjustment     Adjust position of a single glyph (e.g. SmallCaps/Sups/Subs)&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                if ($Lookup[$luli]['Type'] == 1) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 1: Single adjustment [Format ' . $PosFormat . ']&lt;/div&gt;';&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 1:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    if ($PosFormat == 1) {&nbsp;</div></li><li><div>                        $Coverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $ValueFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Value = $this-&gt;_getValueRecord($ValueFormat);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;seek($Coverage);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage(); // Array of Hex Glyphs&nbsp;</div></li><li><div>                        for ($g = 0; $g &lt; count($glyphs); $g++) {&nbsp;</div></li><li><div>                            if ($level == 2 && strpos($lcoverage, $glyphs[$g]) === false) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($glyphs[$g]) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                            if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                $html .= $exB;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($glyphs[$g]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                $html .= $exL;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                $html .= $exB;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;changed&quot; style=&quot;font-feature-settings:\'' . $tag . '\' 1;&quot;&gt;&nbsp;' . $this-&gt;formatEntity($glyphs[$g]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                $html .= $exL;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= ' &lt;span class=&quot;unicode&quot;&gt;';&nbsp;</div></li><li><div>                            if ($Value['XPlacement']) {&nbsp;</div></li><li><div>                                $html .= ' Xpl: ' . $Value['XPlacement'] . ';';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($Value['YPlacement']) {&nbsp;</div></li><li><div>                                $html .= ' YPl: ' . $Value['YPlacement'] . ';';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($Value['XAdvance']) {&nbsp;</div></li><li><div>                                $html .= ' Xadv: ' . $Value['XAdvance'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 2:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 2) {&nbsp;</div></li><li><div>                        $Coverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $ValueFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $ValueCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Values = array();&nbsp;</div></li><li><div>                        for ($v = 0; $v &lt; $ValueCount; $v++) {&nbsp;</div></li><li><div>                            $Values[] = $this-&gt;_getValueRecord($ValueFormat);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;seek($Coverage);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage(); // Array of Hex Glyphs&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($g = 0; $g &lt; count($glyphs); $g++) {&nbsp;</div></li><li><div>                            if ($level == 2 && strpos($lcoverage, $glyphs[$g]) === false) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $Value = $Values[$g];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($glyphs[$g]) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                            if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                $html .= $exB;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($glyphs[$g]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                $html .= $exL;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                $html .= $exB;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;changed&quot; style=&quot;font-feature-settings:\'' . $tag . '\' 1;&quot;&gt;&nbsp;' . $this-&gt;formatEntity($glyphs[$g]) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                $html .= $exL;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= ' &lt;span class=&quot;unicode&quot;&gt;';&nbsp;</div></li><li><div>                            if ($Value['XPlacement']) {&nbsp;</div></li><li><div>                                $html .= ' Xpl: ' . $Value['XPlacement'] . ';';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($Value['YPlacement']) {&nbsp;</div></li><li><div>                                $html .= ' YPl: ' . $Value['YPlacement'] . ';';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($Value['XAdvance']) {&nbsp;</div></li><li><div>                                $html .= ' Xadv: ' . $Value['XAdvance'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 2: Pair adjustment     Adjust position of a pair of glyphs (Kerning)&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 2) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 2: Pair adjustment e.g. Kerning [Format ' . $PosFormat . ']&lt;/div&gt;';&nbsp;</div></li><li><div>                    $Coverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $ValueFormat1 = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $ValueFormat2 = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 1:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    if ($PosFormat == 1) {&nbsp;</div></li><li><div>                        $PairSetCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $PairSetOffset = array();&nbsp;</div></li><li><div>                        for ($p = 0; $p &lt; $PairSetCount; $p++) {&nbsp;</div></li><li><div>                            $PairSetOffset[] = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $this-&gt;seek($Coverage);&nbsp;</div></li><li><div>                        $glyphs = $this-&gt;_getCoverage(); // Array of Hex Glyphs&nbsp;</div></li><li><div>                        for ($p = 0; $p &lt; $PairSetCount; $p++) {&nbsp;</div></li><li><div>                            if ($level == 2 && strpos($lcoverage, $glyphs[$p]) === false) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;seek($PairSetOffset[$p]);&nbsp;</div></li><li><div>                            // First Glyph = $glyphs[$p]&nbsp;</div></li><li><div>// Takes too long e.g. Calibri font - just list kerning pairs with this:&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                            $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($glyphs[$p]) . ' &lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            //PairSet table&nbsp;</div></li><li><div>                            $PairValueCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            for ($pv = 0; $pv &lt; $PairValueCount; $pv++) {&nbsp;</div></li><li><div>                                //PairValueRecord&nbsp;</div></li><li><div>                                $gid = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                                $SecondGlyph = unicode_hex($this-&gt;glyphToChar[$gid][0]);&nbsp;</div></li><li><div>                                $Value1 = $this-&gt;_getValueRecord($ValueFormat1);&nbsp;</div></li><li><div>                                $Value2 = $this-&gt;_getValueRecord($ValueFormat2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // If RTL pairs, GPOS declares a XPlacement e.g. -180 for an XAdvance of -180 to take&nbsp;</div></li><li><div>                                // account of direction. mPDF does not need the XPlacement adjustment&nbsp;</div></li><li><div>                                if ($dir == 'RTL' && $Value1['XPlacement']) {&nbsp;</div></li><li><div>                                    $Value1['XPlacement'] -= $Value1['XAdvance'];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ($ValueFormat2) {&nbsp;</div></li><li><div>                                    // If RTL pairs, GPOS declares a XPlacement e.g. -180 for an XAdvance of -180 to take&nbsp;</div></li><li><div>                                    // account of direction. mPDF does not need the XPlacement adjustment&nbsp;</div></li><li><div>                                    if ($dir == 'RTL' && $Value2['XPlacement'] && $Value2['XAdvance']) {&nbsp;</div></li><li><div>                                        $Value2['XPlacement'] -= $Value2['XAdvance'];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $html .= ' ' . $this-&gt;formatEntity($SecondGlyph) . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                /**&nbsp;</div></li><li><div>                                  $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                                  $html .= '&lt;span class=&quot;unicode&quot;&gt;'.$this-&gt;formatUni($glyphs[$p]).'&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                                  if ($level==2 && $exB) { $html .= $exB; }&nbsp;</div></li><li><div>                                  $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;'.$this-&gt;formatEntity($glyphs[$p]).$this-&gt;formatEntity($SecondGlyph).'&lt;/span&gt;';&nbsp;</div></li><li><div>                                  if ($level==2 && $exL) { $html .= $exL; }&nbsp;</div></li><li><div>                                  $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                                  if ($level==2 && $exB) { $html .= $exB; }&nbsp;</div></li><li><div>                                  $html .= '&lt;span class=&quot;changed&quot; style=&quot;font-feature-settings:\''.$tag.'\' 1;&quot;&gt;&nbsp;'.$this-&gt;formatEntity($glyphs[$p]).$this-&gt;formatEntity($SecondGlyph).'&lt;/span&gt;';&nbsp;</div></li><li><div>                                  if ($level==2 && $exL) { $html .= $exL; }&nbsp;</div></li><li><div>                                  $html .= ' &lt;span class=&quot;unicode&quot;&gt;';&nbsp;</div></li><li><div>                                  if ($Value1['XPlacement']) { $html .= ' Xpl[1]: '.$Value1['XPlacement'].';'; }&nbsp;</div></li><li><div>                                  if ($Value1['YPlacement']) { $html .= ' YPl[1]: '.$Value1['YPlacement'].';'; }&nbsp;</div></li><li><div>                                  if ($Value1['XAdvance']) { $html .= ' Xadv[1]: '.$Value1['XAdvance']; }&nbsp;</div></li><li><div>                                  if ($Value2['XPlacement']) { $html .= ' Xpl[2]: '.$Value2['XPlacement'].';'; }&nbsp;</div></li><li><div>                                  if ($Value2['YPlacement']) { $html .= ' YPl[2]: '.$Value2['YPlacement'].';'; }&nbsp;</div></li><li><div>                                  if ($Value2['XAdvance']) { $html .= ' Xadv[2]: '.$Value2['XAdvance']; }&nbsp;</div></li><li><div>                                  $html .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                  $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                                 */&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 2:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 2) {&nbsp;</div></li><li><div>                        $ClassDef1 = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $ClassDef2 = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Class1Count = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $Class2Count = $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $sizeOfPair = ( 2 * $this-&gt;count_bits($ValueFormat1) ) + ( 2 * $this-&gt;count_bits($ValueFormat2) );&nbsp;</div></li><li><div>                        $sizeOfValueRecords = $Class1Count * $Class2Count * $sizeOfPair;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // NB Class1Count includes Class 0 even though it is not defined by $ClassDef1&nbsp;</div></li><li><div>                        // i.e. Class1Count = 5; Class1 will contain array(indices 1-4);&nbsp;</div></li><li><div>                        $Class1 = $this-&gt;_getClassDefinitionTable($ClassDef1);&nbsp;</div></li><li><div>                        $Class2 = $this-&gt;_getClassDefinitionTable($ClassDef2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;seek($subtable_offset + 16);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $Class1Count; $i++) {&nbsp;</div></li><li><div>                            for ($j = 0; $j &lt; $Class2Count; $j++) {&nbsp;</div></li><li><div>                                $Value1 = $this-&gt;_getValueRecord($ValueFormat1);&nbsp;</div></li><li><div>                                $Value2 = $this-&gt;_getValueRecord($ValueFormat2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // If RTL pairs, GPOS declares a XPlacement e.g. -180 for an XAdvance of -180&nbsp;</div></li><li><div>                                // of direction. mPDF does not need the XPlacement adjustment&nbsp;</div></li><li><div>                                if ($dir == 'RTL' && $Value1['XPlacement'] && $Value1['XAdvance']) {&nbsp;</div></li><li><div>                                    $Value1['XPlacement'] -= $Value1['XAdvance'];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                if ($ValueFormat2) {&nbsp;</div></li><li><div>                                    if ($dir == 'RTL' && $Value2['XPlacement'] && $Value2['XAdvance']) {&nbsp;</div></li><li><div>                                        $Value2['XPlacement'] -= $Value2['XAdvance'];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($c1 = 0; $c1 &lt; count($Class1[$i]); $c1++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $FirstGlyph = $Class1[$i][$c1];&nbsp;</div></li><li><div>                                    if ($level == 2 && strpos($lcoverage, $FirstGlyph) === false) {&nbsp;</div></li><li><div>                                        continue;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    for ($c2 = 0; $c2 &lt; count($Class2[$j]); $c2++) {&nbsp;</div></li><li><div>                                        $SecondGlyph = $Class2[$j][$c2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        if (!$Value1['XPlacement'] && !$Value1['YPlacement'] && !$Value1['XAdvance'] && !$Value2['XPlacement'] && !$Value2['YPlacement'] && !$Value2['XAdvance']) {&nbsp;</div></li><li><div>                                            continue;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $html .= '&lt;div class=&quot;substitution&quot;&gt;';&nbsp;</div></li><li><div>                                        $html .= '&lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUni($FirstGlyph) . '&nbsp;&lt;/span&gt; ';&nbsp;</div></li><li><div>                                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                            $html .= $exB;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntity($FirstGlyph) . $this-&gt;formatEntity($SecondGlyph) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                            $html .= $exL;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $html .= '&nbsp; &raquo; &raquo; &nbsp;';&nbsp;</div></li><li><div>                                        if ($level == 2 && $exB) {&nbsp;</div></li><li><div>                                            $html .= $exB;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $html .= '&lt;span class=&quot;changed&quot; style=&quot;font-feature-settings:\'' . $tag . '\' 1;&quot;&gt;&nbsp;' . $this-&gt;formatEntity($FirstGlyph) . $this-&gt;formatEntity($SecondGlyph) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                                        if ($level == 2 && $exL) {&nbsp;</div></li><li><div>                                            $html .= $exL;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $html .= ' &lt;span class=&quot;unicode&quot;&gt;';&nbsp;</div></li><li><div>                                        if ($Value1['XPlacement']) {&nbsp;</div></li><li><div>                                            $html .= ' Xpl[1]: ' . $Value1['XPlacement'] . ';';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($Value1['YPlacement']) {&nbsp;</div></li><li><div>                                            $html .= ' YPl[1]: ' . $Value1['YPlacement'] . ';';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($Value1['XAdvance']) {&nbsp;</div></li><li><div>                                            $html .= ' Xadv[1]: ' . $Value1['XAdvance'];&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($Value2['XPlacement']) {&nbsp;</div></li><li><div>                                            $html .= ' Xpl[2]: ' . $Value2['XPlacement'] . ';';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($Value2['YPlacement']) {&nbsp;</div></li><li><div>                                            $html .= ' YPl[2]: ' . $Value2['YPlacement'] . ';';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($Value2['XAdvance']) {&nbsp;</div></li><li><div>                                            $html .= ' Xadv[2]: ' . $Value2['XAdvance'];&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        $html .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 3: Cursive attachment     Attach cursive glyphs&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 3) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 3: Cursive attachment &lt;/div&gt;';&nbsp;</div></li><li><div>                    $Coverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $EntryExitCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $EntryAnchors = array();&nbsp;</div></li><li><div>                    $ExitAnchors = array();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $EntryExitCount; $i++) {&nbsp;</div></li><li><div>                        $EntryAnchors[$i] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $ExitAnchors[$i] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($Coverage);&nbsp;</div></li><li><div>                    $Glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $EntryExitCount; $i++) {&nbsp;</div></li><li><div>                        // Need default XAdvance for glyph&nbsp;</div></li><li><div>                        $pdfWidth = $this-&gt;mpdf-&gt;_getCharWidth($this-&gt;mpdf-&gt;fonts[$this-&gt;fontkey]['cw'], hexdec($Glyphs[$i]));&nbsp;</div></li><li><div>                        $EntryAnchor = $EntryAnchors[$i];&nbsp;</div></li><li><div>                        $ExitAnchor = $ExitAnchors[$i];&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unchanged&quot;&gt;' . $this-&gt;formatEntity($Glyphs[$i]) . ' &lt;/span&gt; ';&nbsp;</div></li><li><div>                        $html .= '&lt;span class=&quot;unicode&quot;&gt; ' . $this-&gt;formatUni($Glyphs[$i]) . ' =&gt; ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($EntryAnchor != 0) {&nbsp;</div></li><li><div>                            $EntryAnchor += $subtable_offset;&nbsp;</div></li><li><div>                            list($x, $y) = $this-&gt;_getAnchorTable($EntryAnchor);&nbsp;</div></li><li><div>                            if ($dir == 'RTL') {&nbsp;</div></li><li><div>                                if (round($pdfWidth) == round($x * 1000 / $this-&gt;mpdf-&gt;fonts[$this-&gt;fontkey]['desc']['unitsPerEm'])) {&nbsp;</div></li><li><div>                                    $x = 0;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $x = $x - ($pdfWidth * $this-&gt;mpdf-&gt;fonts[$this-&gt;fontkey]['desc']['unitsPerEm'] / 1000);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= &quot; Entry X: &quot; . $x . &quot; Y: &quot; . $y . &quot;; &quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($ExitAnchor != 0) {&nbsp;</div></li><li><div>                            $ExitAnchor += $subtable_offset;&nbsp;</div></li><li><div>                            list($x, $y) = $this-&gt;_getAnchorTable($ExitAnchor);&nbsp;</div></li><li><div>                            if ($dir == 'LTR') {&nbsp;</div></li><li><div>                                if (round($pdfWidth) == round($x * 1000 / $this-&gt;mpdf-&gt;fonts[$this-&gt;fontkey]['desc']['unitsPerEm'])) {&nbsp;</div></li><li><div>                                    $x = 0;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $x = $x - ($pdfWidth * $this-&gt;mpdf-&gt;fonts[$this-&gt;fontkey]['desc']['unitsPerEm'] / 1000);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $html .= &quot; Exit X: &quot; . $x . &quot; Y: &quot; . $y . &quot;; &quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 4: MarkToBase attachment     Attach a combining mark to a base glyph&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 4) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 4: MarkToBase attachment &lt;/div&gt;';&nbsp;</div></li><li><div>                    $MarkCoverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $BaseCoverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($MarkCoverage);&nbsp;</div></li><li><div>                    $MarkGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($BaseCoverage);&nbsp;</div></li><li><div>                    $BaseGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $firstMark = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;Marks: ';&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; count($MarkGlyphs); $i++) {&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($lcoverage, $MarkGlyphs[$i]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            if (!$firstMark) {&nbsp;</div></li><li><div>                                $firstMark = $MarkGlyphs[$i];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($MarkGlyphs[$i]) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                    if (!$firstMark) {&nbsp;</div></li><li><div>                        return;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;Bases: ';&nbsp;</div></li><li><div>                    for ($j = 0; $j &lt; count($BaseGlyphs); $j++) {&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($BaseGlyphs[$j]) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Example&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot; style=&quot;font-feature-settings:\'' . $tag . '\' 1;&quot;&gt;Example(s): ';&nbsp;</div></li><li><div>                    for ($j = 0; $j &lt; min(count($BaseGlyphs), 20); $j++) {&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($BaseGlyphs[$j]) . $this-&gt;formatEntity($firstMark, true) . ' &nbsp; ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 5: MarkToLigature attachment     Attach a combining mark to a ligature&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 5) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 5: MarkToLigature attachment &lt;/div&gt;';&nbsp;</div></li><li><div>                    $MarkCoverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    //$MarkCoverage is already set in $lcoverage 00065|00073 etc&nbsp;</div></li><li><div>                    $LigatureCoverage = $subtable_offset + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $ClassCount = $this-&gt;read_ushort(); // Number of classes defined for marks = Number of mark glyphs in the MarkCoverage table&nbsp;</div></li><li><div>                    $MarkArray = $subtable_offset + $this-&gt;read_ushort(); // Offset to MarkArray table&nbsp;</div></li><li><div>                    $LigatureArray = $subtable_offset + $this-&gt;read_ushort(); // Offset to LigatureArray table&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($MarkCoverage);&nbsp;</div></li><li><div>                    $MarkGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                    $this-&gt;seek($LigatureCoverage);&nbsp;</div></li><li><div>                    $LigatureGlyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $firstMark = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;Marks: &lt;span class=&quot;unchanged&quot;&gt;';&nbsp;</div></li><li><div>                    $MarkRecord = array();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; count($MarkGlyphs); $i++) {&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($lcoverage, $MarkGlyphs[$i]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            if (!$firstMark) {&nbsp;</div></li><li><div>                                $firstMark = $MarkGlyphs[$i];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // Get the relevant MarkRecord&nbsp;</div></li><li><div>                        $MarkRecord[$i] = $this-&gt;_getMarkRecord($MarkArray, $i);&nbsp;</div></li><li><div>                        //Mark Class is = $MarkRecord[$i]['Class']&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($MarkGlyphs[$i]) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                    if (!$firstMark) {&nbsp;</div></li><li><div>                        return;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;seek($LigatureArray);&nbsp;</div></li><li><div>                    $LigatureCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                    $LigatureAttach = array();&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;Ligatures: &lt;span class=&quot;unchanged&quot;&gt;';&nbsp;</div></li><li><div>                    for ($j = 0; $j &lt; count($LigatureGlyphs); $j++) {&nbsp;</div></li><li><div>                        // Get the relevant LigatureRecord&nbsp;</div></li><li><div>                        $LigatureAttach[$j] = $LigatureArray + $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($LigatureGlyphs[$j]) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    /**&nbsp;</div></li><li><div>                      for ($i=0;$i&lt;count($MarkGlyphs);$i++) {&nbsp;</div></li><li><div>                      $html .= '&lt;div class=&quot;glyphs&quot;&gt;';&nbsp;</div></li><li><div>                      $html .= '&lt;span class=&quot;unchanged&quot;&gt;'.$this-&gt;formatEntity($MarkGlyphs[$i]).'&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                      for ($j=0;$j&lt;count($LigatureGlyphs);$j++) {&nbsp;</div></li><li><div>                      $this-&gt;seek($LigatureAttach[$j]);&nbsp;</div></li><li><div>                      $ComponentCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                      $html .= '&lt;span class=&quot;unchanged&quot;&gt;'.$this-&gt;formatEntity($LigatureGlyphs[$j]).'&lt;/span&gt;';&nbsp;</div></li><li><div>                      $offsets = array();&nbsp;</div></li><li><div>                      for ($comp=0;$comp&lt;$ComponentCount;$comp++) {&nbsp;</div></li><li><div>                      // ComponentRecords&nbsp;</div></li><li><div>                      for ($class=0;$class&lt;$ClassCount;$class++) {&nbsp;</div></li><li><div>                      $offset = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                      if ($offset!= 0 && $class == $MarkRecord[$i]['Class']) {&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                      $html .= ' ['.$comp.'] ';&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                     */&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 6: MarkToMark attachment     Attach a combining mark to another mark&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 6) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 6: MarkToMark attachment &lt;/div&gt;';&nbsp;</div></li><li><div>                    $Mark1Coverage = $subtable_offset + $this-&gt;read_ushort(); // Combining Mark&nbsp;</div></li><li><div>                    //$Mark1Coverage is already set in $LuCoverage 0065|0073 etc&nbsp;</div></li><li><div>                    $Mark2Coverage = $subtable_offset + $this-&gt;read_ushort(); // Base Mark&nbsp;</div></li><li><div>                    $ClassCount = $this-&gt;read_ushort(); // Number of classes defined for marks = No. of Combining mark1 glyphs in the MarkCoverage table&nbsp;</div></li><li><div>                    $this-&gt;seek($Mark1Coverage);&nbsp;</div></li><li><div>                    $Mark1Glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>                    $this-&gt;seek($Mark2Coverage);&nbsp;</div></li><li><div>                    $Mark2Glyphs = $this-&gt;_getCoverage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $firstMark = '';&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;glyphs&quot;&gt;Marks: &lt;span class=&quot;unchanged&quot;&gt;';&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; count($Mark1Glyphs); $i++) {&nbsp;</div></li><li><div>                        if ($level == 2 && strpos($lcoverage, $Mark1Glyphs[$i]) === false) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            if (!$firstMark) {&nbsp;</div></li><li><div>                                $firstMark = $Mark1Glyphs[$i];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= ' ' . $this-&gt;formatEntity($Mark1Glyphs[$i]) . ' ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($firstMark) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;glyphs&quot;&gt;Bases: &lt;span class=&quot;unchanged&quot;&gt;';&nbsp;</div></li><li><div>                        for ($j = 0; $j &lt; count($Mark2Glyphs); $j++) {&nbsp;</div></li><li><div>                            $html .= ' ' . $this-&gt;formatEntity($Mark2Glyphs[$j]) . ' ';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Example&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;glyphs&quot; style=&quot;font-feature-settings:\'' . $tag . '\' 1;&quot;&gt;Example(s): &lt;span class=&quot;changed&quot;&gt;';&nbsp;</div></li><li><div>                        for ($j = 0; $j &lt; min(count($Mark2Glyphs), 20); $j++) {&nbsp;</div></li><li><div>                            $html .= ' ' . $this-&gt;formatEntity($Mark2Glyphs[$j]) . $this-&gt;formatEntity($firstMark, true) . ' &nbsp; ';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 7: Context positioning     Position one or more glyphs in context&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 7) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 7: Context positioning [Format ' . $PosFormat . ']&lt;/div&gt;';&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 1:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    if ($PosFormat == 1) {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot; Format &quot; . $PosFormat . &quot; not YET TESTED.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 2:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 2) {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot; Format &quot; . $PosFormat . &quot; not YET TESTED.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 3:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 3) {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot; Format &quot; . $PosFormat . &quot; not YET TESTED.&quot;);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot;, Format &quot; . $PosFormat . &quot; not supported.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                // LookupType 8: Chained Context positioning     Position one or more glyphs in chained context&nbsp;</div></li><li><div>                ////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>                else if ($Lookup[$luli]['Type'] == 8) {&nbsp;</div></li><li><div>                    $html .= '&lt;div class=&quot;lookuptype&quot;&gt;LookupType 8: Chained Context positioning [Format ' . $PosFormat . ']&lt;/div&gt;';&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 1:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    if ($PosFormat == 1) {&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot; Format &quot; . $PosFormat . &quot; not TESTED YET.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 2:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 2) {&nbsp;</div></li><li><div>                        $html .= '&lt;div&gt;GPOS Lookup Type 8: Format 2 not yet supported in OTL dump&lt;/div&gt;';&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                        /** NB When developing - cf. GSUB 6.2 */&nbsp;</div></li><li><div>                        throw new MpdfException(&quot;GPOS Lookup Type &quot; . $Type . &quot; Format &quot; . $PosFormat . &quot; not TESTED YET.&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    // Format 3:&nbsp;</div></li><li><div>                    //===========&nbsp;</div></li><li><div>                    else if ($PosFormat == 3) {&nbsp;</div></li><li><div>                        $BacktrackGlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $CoverageBacktrackOffset = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $BacktrackGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $CoverageBacktrackOffset[] = $subtable_offset + $this-&gt;read_ushort(); // in glyph sequence order&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $InputGlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $CoverageInputOffset = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $InputGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $CoverageInputOffset[] = $subtable_offset + $this-&gt;read_ushort(); // in glyph sequence order&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $LookaheadGlyphCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        $CoverageLookaheadOffset = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $LookaheadGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $CoverageLookaheadOffset[] = $subtable_offset + $this-&gt;read_ushort(); // in glyph sequence order&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $PosCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $PosLookupRecord = array();&nbsp;</div></li><li><div>                        for ($p = 0; $p &lt; $PosCount; $p++) {&nbsp;</div></li><li><div>                            // PosLookupRecord&nbsp;</div></li><li><div>                            $PosLookupRecord[$p]['SequenceIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                            $PosLookupRecord[$p]['LookupListIndex'] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $backtrackGlyphs = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $BacktrackGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $this-&gt;seek($CoverageBacktrackOffset[$b]);&nbsp;</div></li><li><div>                            $backtrackGlyphs[$b] = implode('|', $this-&gt;_getCoverage());&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $inputGlyphs = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $InputGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $this-&gt;seek($CoverageInputOffset[$b]);&nbsp;</div></li><li><div>                            $inputGlyphs[$b] = implode('|', $this-&gt;_getCoverage());&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $lookaheadGlyphs = array();&nbsp;</div></li><li><div>                        for ($b = 0; $b &lt; $LookaheadGlyphCount; $b++) {&nbsp;</div></li><li><div>                            $this-&gt;seek($CoverageLookaheadOffset[$b]);&nbsp;</div></li><li><div>                            $lookaheadGlyphs[$b] = implode('|', $this-&gt;_getCoverage());&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $exampleB = array();&nbsp;</div></li><li><div>                        $exampleI = array();&nbsp;</div></li><li><div>                        $exampleL = array();&nbsp;</div></li><li><div>                        $html .= '&lt;div class=&quot;context&quot;&gt;CONTEXT: ';&nbsp;</div></li><li><div>                        for ($ff = count($backtrackGlyphs) - 1; $ff &gt;= 0; $ff--) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Backtrack #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($backtrackGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleB[] = $this-&gt;formatEntityFirst($backtrackGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($ff = 0; $ff &lt; count($inputGlyphs); $ff++) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Input #' . $ff . ': &lt;span class=&quot;unchanged&quot;&gt;&nbsp;' . $this-&gt;formatEntityStr($inputGlyphs[$ff]) . '&nbsp;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleI[] = $this-&gt;formatEntityFirst($inputGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($ff = 0; $ff &lt; count($lookaheadGlyphs); $ff++) {&nbsp;</div></li><li><div>                            $html .= '&lt;div&gt;Lookahead #' . $ff . ': &lt;span class=&quot;unicode&quot;&gt;' . $this-&gt;formatUniStr($lookaheadGlyphs[$ff]) . '&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                            $exampleL[] = $this-&gt;formatEntityFirst($lookaheadGlyphs[$ff]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        for ($p = 0; $p &lt; $PosCount; $p++) {&nbsp;</div></li><li><div>                            $lup = $PosLookupRecord[$p]['LookupListIndex'];&nbsp;</div></li><li><div>                            $seqIndex = $PosLookupRecord[$p]['SequenceIndex'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // GENERATE exampleB[n] exampleI[&lt;seqIndex] .... exampleI[&gt;seqIndex] exampleL[n]&nbsp;</div></li><li><div>                            $exB = '';&nbsp;</div></li><li><div>                            $exL = '';&nbsp;</div></li><li><div>                            if (count($exampleB)) {&nbsp;</div></li><li><div>                                $exB .= '&lt;span class=&quot;backtrack&quot;&gt;' . implode('&#x200d;', $exampleB) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ($seqIndex &gt; 0) {&nbsp;</div></li><li><div>                                $exB .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = 0; $ip &lt; $seqIndex; $ip++) {&nbsp;</div></li><li><div>                                    $exB .= $exampleI[$ip] . '&#x200d;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exB .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if (count($inputGlyphs) &gt; ($seqIndex + 1)) {&nbsp;</div></li><li><div>                                $exL .= '&lt;span class=&quot;inputother&quot;&gt;';&nbsp;</div></li><li><div>                                for ($ip = $seqIndex + 1; $ip &lt; count($inputGlyphs); $ip++) {&nbsp;</div></li><li><div>                                    $exL .= '&#x200d;' . $exampleI[$ip];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $exL .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if (count($exampleL)) {&nbsp;</div></li><li><div>                                $exL .= '&lt;span class=&quot;lookahead&quot;&gt;' . implode('&#x200d;', $exampleL) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $html .= '&lt;div class=&quot;sequenceIndex&quot;&gt;Substitution Position: ' . $seqIndex . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $lul2 = array($lup =&gt; $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Only apply if the (first) 'Replace' glyph from the&nbsp;</div></li><li><div>                            // Lookup list is in the [inputGlyphs] at ['SequenceIndex']&nbsp;</div></li><li><div>                            // Pass $inputGlyphs[$seqIndex] e.g. 00636|00645|00656&nbsp;</div></li><li><div>                            // to level 2 and only apply if first Replace glyph is in this list&nbsp;</div></li><li><div>                            $html .= $this-&gt;_getGPOSarray($Lookup, $lul2, $scripttag, 2, $inputGlyphs[$seqIndex], $exB, $exL);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($level == 1) {&nbsp;</div></li><li><div>            $this-&gt;mpdf-&gt;WriteHTML($html);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $html;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>//print_r($Lookup); exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>    // GPOS FUNCTIONS&nbsp;</div></li><li><div>    //=====================================================================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function count_bits($n)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        for ($c = 0; $n; $c++) {&nbsp;</div></li><li><div>            $n &= $n - 1; // clear the least significant bit set&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $c;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getValueRecord($ValueFormat)&nbsp;</div></li><li><div>    { // Common ValueRecord for GPOS&nbsp;</div></li><li><div>        // Only returns 3 possible: $vra['XPlacement'] $vra['YPlacement'] $vra['XAdvance']&nbsp;</div></li><li><div>        $vra = array();&nbsp;</div></li><li><div>        // Horizontal adjustment for placement-in design units&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0001) == 0x0001) {&nbsp;</div></li><li><div>            $vra['XPlacement'] = $this-&gt;read_short();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Vertical adjustment for placement-in design units&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0002) == 0x0002) {&nbsp;</div></li><li><div>            $vra['YPlacement'] = $this-&gt;read_short();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Horizontal adjustment for advance-in design units (only used for horizontal writing)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0004) == 0x0004) {&nbsp;</div></li><li><div>            $vra['XAdvance'] = $this-&gt;read_short();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Vertical adjustment for advance-in design units (only used for vertical writing)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0008) == 0x0008) {&nbsp;</div></li><li><div>            $this-&gt;read_short();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Offset to Device table for horizontal placement-measured from beginning of PosTable (may be NULL)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0010) == 0x0010) {&nbsp;</div></li><li><div>            $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Offset to Device table for vertical placement-measured from beginning of PosTable (may be NULL)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0020) == 0x0020) {&nbsp;</div></li><li><div>            $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Offset to Device table for horizontal advance-measured from beginning of PosTable (may be NULL)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0040) == 0x0040) {&nbsp;</div></li><li><div>            $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Offset to Device table for vertical advance-measured from beginning of PosTable (may be NULL)&nbsp;</div></li><li><div>        if (($ValueFormat & 0x0080) == 0x0080) {&nbsp;</div></li><li><div>            $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $vra;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getAnchorTable($offset = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($offset) {&nbsp;</div></li><li><div>            $this-&gt;seek($offset);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $AnchorFormat = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $XCoordinate = $this-&gt;read_short();&nbsp;</div></li><li><div>        $YCoordinate = $this-&gt;read_short();&nbsp;</div></li><li><div>        // Format 2 specifies additional link to contour point; Format 3 additional Device table&nbsp;</div></li><li><div>        return array($XCoordinate, $YCoordinate);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _getMarkRecord($offset, $MarkPos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;seek($offset);&nbsp;</div></li><li><div>        $MarkCount = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $this-&gt;skip($MarkPos * 4);&nbsp;</div></li><li><div>        $Class = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $MarkAnchor = $offset + $this-&gt;read_ushort();  // = Offset to anchor table&nbsp;</div></li><li><div>        list($x, $y) = $this-&gt;_getAnchorTable($MarkAnchor);&nbsp;</div></li><li><div>        $MarkRecord = array('Class' =&gt; $Class, 'AnchorX' =&gt; $x, 'AnchorY' =&gt; $y);&nbsp;</div></li><li><div>        return $MarkRecord;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    // Recursively get composite glyph data&nbsp;</div></li><li><div>    function getGlyphData($originalGlyphIdx, &$maxdepth, &$depth, &$points, &$contours)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $depth++;&nbsp;</div></li><li><div>        $maxdepth = max($maxdepth, $depth);&nbsp;</div></li><li><div>        if (count($this-&gt;glyphdata[$originalGlyphIdx]['compGlyphs'])) {&nbsp;</div></li><li><div>            foreach ($this-&gt;glyphdata[$originalGlyphIdx]['compGlyphs'] AS $glyphIdx) {&nbsp;</div></li><li><div>                $this-&gt;getGlyphData($glyphIdx, $maxdepth, $depth, $points, $contours);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if (($this-&gt;glyphdata[$originalGlyphIdx]['nContours'] &gt; 0) && $depth &gt; 0) { // simple&nbsp;</div></li><li><div>            $contours += $this-&gt;glyphdata[$originalGlyphIdx]['nContours'];&nbsp;</div></li><li><div>            $points += $this-&gt;glyphdata[$originalGlyphIdx]['nPoints'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $depth--;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>    // Recursively get composite glyphs&nbsp;</div></li><li><div>    function getGlyphs($originalGlyphIdx, &$start, &$glyphSet, &$subsetglyphs)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $glyphPos = $this-&gt;glyphPos[$originalGlyphIdx];&nbsp;</div></li><li><div>        $glyphLen = $this-&gt;glyphPos[$originalGlyphIdx + 1] - $glyphPos;&nbsp;</div></li><li><div>        if (!$glyphLen) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;seek($start + $glyphPos);&nbsp;</div></li><li><div>        $numberOfContours = $this-&gt;read_short();&nbsp;</div></li><li><div>        if ($numberOfContours &lt; 0) {&nbsp;</div></li><li><div>            $this-&gt;skip(8);&nbsp;</div></li><li><div>            $flags = GF_MORE;&nbsp;</div></li><li><div>            while ($flags & GF_MORE) {&nbsp;</div></li><li><div>                $flags = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $glyphIdx = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                if (!isset($glyphSet[$glyphIdx])) {&nbsp;</div></li><li><div>                    $glyphSet[$glyphIdx] = count($subsetglyphs); // old glyphID to new glyphID&nbsp;</div></li><li><div>                    $subsetglyphs[$glyphIdx] = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $savepos = ftell($this-&gt;fh);&nbsp;</div></li><li><div>                $this-&gt;getGlyphs($glyphIdx, $start, $glyphSet, $subsetglyphs);&nbsp;</div></li><li><div>                $this-&gt;seek($savepos);&nbsp;</div></li><li><div>                if ($flags & GF_WORDS)&nbsp;</div></li><li><div>                    $this-&gt;skip(4);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;skip(2);&nbsp;</div></li><li><div>                if ($flags & GF_SCALE)&nbsp;</div></li><li><div>                    $this-&gt;skip(2);&nbsp;</div></li><li><div>                else if ($flags & GF_XYSCALE)&nbsp;</div></li><li><div>                    $this-&gt;skip(4);&nbsp;</div></li><li><div>                else if ($flags & GF_TWOBYTWO)&nbsp;</div></li><li><div>                    $this-&gt;skip(8);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //////////////////////////////////////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getHMTX($numberOfHMetrics, $numGlyphs, &$glyphToChar, $scale)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $start = $this-&gt;seek_table(&quot;hmtx&quot;);&nbsp;</div></li><li><div>        $aw = 0;&nbsp;</div></li><li><div>        $this-&gt;charWidths = str_pad('', 256 * 256 * 2, &quot;\x00&quot;);&nbsp;</div></li><li><div>        if ($this-&gt;maxUniChar &gt; 65536) {&nbsp;</div></li><li><div>            $this-&gt;charWidths .= str_pad('', 256 * 256 * 2, &quot;\x00&quot;);&nbsp;</div></li><li><div>        } // Plane 1 SMP&nbsp;</div></li><li><div>        if ($this-&gt;maxUniChar &gt; 131072) {&nbsp;</div></li><li><div>            $this-&gt;charWidths .= str_pad('', 256 * 256 * 2, &quot;\x00&quot;);&nbsp;</div></li><li><div>        } // Plane 2 SMP&nbsp;</div></li><li><div>        $nCharWidths = 0;&nbsp;</div></li><li><div>        if (($numberOfHMetrics * 4) &lt; $this-&gt;maxStrLenRead) {&nbsp;</div></li><li><div>            $data = $this-&gt;get_chunk($start, ($numberOfHMetrics * 4));&nbsp;</div></li><li><div>            $arr = unpack(&quot;n*&quot;, $data);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;seek($start);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($glyph = 0; $glyph &lt; $numberOfHMetrics; $glyph++) {&nbsp;</div></li><li><div>            if (($numberOfHMetrics * 4) &lt; $this-&gt;maxStrLenRead) {&nbsp;</div></li><li><div>                $aw = $arr[($glyph * 2) + 1];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $aw = $this-&gt;read_ushort();&nbsp;</div></li><li><div>                $lsb = $this-&gt;read_ushort();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($glyphToChar[$glyph]) || $glyph == 0) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($aw &gt;= (1 &lt;&lt; 15)) {&nbsp;</div></li><li><div>                    $aw = 0;&nbsp;</div></li><li><div>                } // 1.03 Some (arabic) fonts have -ve values for width&nbsp;</div></li><li><div>                // although should be unsigned value - comes out as e.g. 65108 (intended -50)&nbsp;</div></li><li><div>                if ($glyph == 0) {&nbsp;</div></li><li><div>                    $this-&gt;defaultWidth = $scale * $aw;&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                foreach ($glyphToChar[$glyph] AS $char) {&nbsp;</div></li><li><div>                    //$this-&gt;charWidths[$char] = intval(round($scale*$aw));&nbsp;</div></li><li><div>                    if ($char != 0 && $char != 65535) {&nbsp;</div></li><li><div>                        $w = intval(round($scale * $aw));&nbsp;</div></li><li><div>                        if ($w == 0) {&nbsp;</div></li><li><div>                            $w = 65535;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($char &lt; 196608) {&nbsp;</div></li><li><div>                            $this-&gt;charWidths[$char * 2] = chr($w &gt;&gt; 8);&nbsp;</div></li><li><div>                            $this-&gt;charWidths[$char * 2 + 1] = chr($w & 0xFF);&nbsp;</div></li><li><div>                            $nCharWidths++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $data = $this-&gt;get_chunk(($start + $numberOfHMetrics * 4), ($numGlyphs * 2));&nbsp;</div></li><li><div>        $arr = unpack(&quot;n*&quot;, $data);&nbsp;</div></li><li><div>        $diff = $numGlyphs - $numberOfHMetrics;&nbsp;</div></li><li><div>        $w = intval(round($scale * $aw));&nbsp;</div></li><li><div>        if ($w == 0) {&nbsp;</div></li><li><div>            $w = 65535;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($pos = 0; $pos &lt; $diff; $pos++) {&nbsp;</div></li><li><div>            $glyph = $pos + $numberOfHMetrics;&nbsp;</div></li><li><div>            if (isset($glyphToChar[$glyph])) {&nbsp;</div></li><li><div>                foreach ($glyphToChar[$glyph] AS $char) {&nbsp;</div></li><li><div>                    if ($char != 0 && $char != 65535) {&nbsp;</div></li><li><div>                        if ($char &lt; 196608) {&nbsp;</div></li><li><div>                            $this-&gt;charWidths[$char * 2] = chr($w &gt;&gt; 8);&nbsp;</div></li><li><div>                            $this-&gt;charWidths[$char * 2 + 1] = chr($w & 0xFF);&nbsp;</div></li><li><div>                            $nCharWidths++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // NB 65535 is a set width of 0&nbsp;</div></li><li><div>        // First bytes define number of chars in font&nbsp;</div></li><li><div>        $this-&gt;charWidths[0] = chr($nCharWidths &gt;&gt; 8);&nbsp;</div></li><li><div>        $this-&gt;charWidths[1] = chr($nCharWidths & 0xFF);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getHMetric($numberOfHMetrics, $gid)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $start = $this-&gt;seek_table(&quot;hmtx&quot;);&nbsp;</div></li><li><div>        if ($gid &lt; $numberOfHMetrics) {&nbsp;</div></li><li><div>            $this-&gt;seek($start + ($gid * 4));&nbsp;</div></li><li><div>            $hm = fread($this-&gt;fh, 4);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;seek($start + (($numberOfHMetrics - 1) * 4));&nbsp;</div></li><li><div>            $hm = fread($this-&gt;fh, 2);&nbsp;</div></li><li><div>            $this-&gt;seek($start + ($numberOfHMetrics * 2) + ($gid * 2));&nbsp;</div></li><li><div>            $hm .= fread($this-&gt;fh, 2);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $hm;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getLOCA($indexToLocFormat, $numGlyphs)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $start = $this-&gt;seek_table('loca');&nbsp;</div></li><li><div>        $this-&gt;glyphPos = array();&nbsp;</div></li><li><div>        if ($indexToLocFormat == 0) {&nbsp;</div></li><li><div>            $data = $this-&gt;get_chunk($start, ($numGlyphs * 2) + 2);&nbsp;</div></li><li><div>            $arr = unpack(&quot;n*&quot;, $data);&nbsp;</div></li><li><div>            for ($n = 0; $n &lt;= $numGlyphs; $n++) {&nbsp;</div></li><li><div>                $this-&gt;glyphPos[] = ($arr[$n + 1] * 2);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if ($indexToLocFormat == 1) {&nbsp;</div></li><li><div>            $data = $this-&gt;get_chunk($start, ($numGlyphs * 4) + 4);&nbsp;</div></li><li><div>            $arr = unpack(&quot;N*&quot;, $data);&nbsp;</div></li><li><div>            for ($n = 0; $n &lt;= $numGlyphs; $n++) {&nbsp;</div></li><li><div>                $this-&gt;glyphPos[] = ($arr[$n + 1]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new MpdfException('Unknown location table format ' . $indexToLocFormat);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // CMAP Format 4&nbsp;</div></li><li><div>    function getCMAP4($unicode_cmap_offset, &$glyphToChar, &$charToGlyph)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;maxUniChar = 0;&nbsp;</div></li><li><div>        $this-&gt;seek($unicode_cmap_offset + 2);&nbsp;</div></li><li><div>        $length = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        $limit = $unicode_cmap_offset + $length;&nbsp;</div></li><li><div>        $this-&gt;skip(2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $segCount = $this-&gt;read_ushort() / 2;&nbsp;</div></li><li><div>        $this-&gt;skip(6);&nbsp;</div></li><li><div>        $endCount = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $segCount; $i++) {&nbsp;</div></li><li><div>            $endCount[] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;skip(2);&nbsp;</div></li><li><div>        $startCount = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $segCount; $i++) {&nbsp;</div></li><li><div>            $startCount[] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $idDelta = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $segCount; $i++) {&nbsp;</div></li><li><div>            $idDelta[] = $this-&gt;read_short();&nbsp;</div></li><li><div>        }  // ???? was unsigned short&nbsp;</div></li><li><div>        $idRangeOffset_start = $this-&gt;_pos;&nbsp;</div></li><li><div>        $idRangeOffset = array();&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $segCount; $i++) {&nbsp;</div></li><li><div>            $idRangeOffset[] = $this-&gt;read_ushort();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($n = 0; $n &lt; $segCount; $n++) {&nbsp;</div></li><li><div>            $endpoint = ($endCount[$n] + 1);&nbsp;</div></li><li><div>            for ($unichar = $startCount[$n]; $unichar &lt; $endpoint; $unichar++) {&nbsp;</div></li><li><div>                if ($idRangeOffset[$n] == 0)&nbsp;</div></li><li><div>                    $glyph = ($unichar + $idDelta[$n]) & 0xFFFF;&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $offset = ($unichar - $startCount[$n]) * 2 + $idRangeOffset[$n];&nbsp;</div></li><li><div>                    $offset = $idRangeOffset_start + 2 * $n + $offset;&nbsp;</div></li><li><div>                    if ($offset &gt;= $limit)&nbsp;</div></li><li><div>                        $glyph = 0;&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $glyph = $this-&gt;get_ushort($offset);&nbsp;</div></li><li><div>                        if ($glyph != 0)&nbsp;</div></li><li><div>                            $glyph = ($glyph + $idDelta[$n]) & 0xFFFF;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $charToGlyph[$unichar] = $glyph;&nbsp;</div></li><li><div>                if ($unichar &lt; 196608) {&nbsp;</div></li><li><div>                    $this-&gt;maxUniChar = max($unichar, $this-&gt;maxUniChar);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $glyphToChar[$glyph][] = $unichar;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatUni($char)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $x = preg_replace('/^[0]*/', '', $char);&nbsp;</div></li><li><div>        $x = str_pad($x, 4, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>        $d = hexdec($x);&nbsp;</div></li><li><div>        if (($d &gt; 57343 && $d &lt; 63744) || ($d &gt; 122879 && $d &lt; 126977)) {&nbsp;</div></li><li><div>            $id = 'M';&nbsp;</div></li><li><div>        } // E000 - F8FF, 1E000-1F000&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $id = 'U';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $id . '+' . $x;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatEntity($char, $allowjoining = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $char = preg_replace('/^[0]/', '', $char);&nbsp;</div></li><li><div>        $x = '&#x' . $char . ';';&nbsp;</div></li><li><div>        if (strpos($this-&gt;GlyphClassMarks, $char) !== false) {&nbsp;</div></li><li><div>            if (!$allowjoining) {&nbsp;</div></li><li><div>                $x = '&#x25cc;' . $x;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $x;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatUniArr($arr)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $s = array();&nbsp;</div></li><li><div>        foreach ($arr AS $c) {&nbsp;</div></li><li><div>            $x = preg_replace('/^[0]*/', '', $c);&nbsp;</div></li><li><div>            $d = hexdec($x);&nbsp;</div></li><li><div>            if (($d &gt; 57343 && $d &lt; 63744) || ($d &gt; 122879 && $d &lt; 126977)) {&nbsp;</div></li><li><div>                $id = 'M';&nbsp;</div></li><li><div>            } // E000 - F8FF, 1E000-1F000&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $id = 'U';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $s[] = $id . '+' . str_pad($x, 4, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode(', ', $s);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatEntityArr($arr)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $s = array();&nbsp;</div></li><li><div>        foreach ($arr AS $c) {&nbsp;</div></li><li><div>            $c = preg_replace('/^[0]/', '', $c);&nbsp;</div></li><li><div>            $x = '&#x' . $c . ';';&nbsp;</div></li><li><div>            if (strpos($this-&gt;GlyphClassMarks, $c) !== false) {&nbsp;</div></li><li><div>                $x = '&#x25cc;' . $x;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $s[] = $x;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode(' ', $s); // ZWNJ? &#x200d;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatClassArr($arr)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $s = array();&nbsp;</div></li><li><div>        foreach ($arr AS $c) {&nbsp;</div></li><li><div>            $x = preg_replace('/^[0]*/', '', $c);&nbsp;</div></li><li><div>            $d = hexdec($x);&nbsp;</div></li><li><div>            if (($d &gt; 57343 && $d &lt; 63744) || ($d &gt; 122879 && $d &lt; 126977)) {&nbsp;</div></li><li><div>                $id = 'M';&nbsp;</div></li><li><div>            } // E000 - F8FF, 1E000-1F000&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $id = 'U';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $s[] = $id . '+' . str_pad($x, 4, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode(', ', $s);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatUniStr($str)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $s = array();&nbsp;</div></li><li><div>        $arr = explode('|', $str);&nbsp;</div></li><li><div>        foreach ($arr AS $c) {&nbsp;</div></li><li><div>            $x = preg_replace('/^[0]*/', '', $c);&nbsp;</div></li><li><div>            $d = hexdec($x);&nbsp;</div></li><li><div>            if (($d &gt; 57343 && $d &lt; 63744) || ($d &gt; 122879 && $d &lt; 126977)) {&nbsp;</div></li><li><div>                $id = 'M';&nbsp;</div></li><li><div>            } // E000 - F8FF, 1E000-1F000&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $id = 'U';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $s[] = $id . '+' . str_pad($x, 4, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode(', ', $s);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatEntityStr($str)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $s = array();&nbsp;</div></li><li><div>        $arr = explode('|', $str);&nbsp;</div></li><li><div>        foreach ($arr AS $c) {&nbsp;</div></li><li><div>            $c = preg_replace('/^[0]/', '', $c);&nbsp;</div></li><li><div>            $x = '&#x' . $c . ';';&nbsp;</div></li><li><div>            if (strpos($this-&gt;GlyphClassMarks, $c) !== false) {&nbsp;</div></li><li><div>                $x = '&#x25cc;' . $x;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $s[] = $x;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode(' ', $s); // ZWNJ? &#x200d;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatEntityFirst($str)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $arr = explode('|', $str);&nbsp;</div></li><li><div>        $char = preg_replace('/^[0]/', '', $arr[0]);&nbsp;</div></li><li><div>        $x = '&#x' . $char . ';';&nbsp;</div></li><li><div>        if (strpos($this-&gt;GlyphClassMarks, $char) !== false) {&nbsp;</div></li><li><div>            $x = '&#x25cc;' . $x;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $x;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.1/classes/otldump/" class="active">2.8.1</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.8.0/classes/otldump/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.3/classes/otldump/" class="">2.7.3</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.2/classes/otldump/" class="">2.7.2</a></li><li><a href="http://hookr.io/plugins/woocommerce-pdf-invoices/2.7.1/classes/otldump/" class="">2.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>OTLdump</li><li><span></span>WooCommerce PDF Invoices</li><li><span></span>2.8.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>