<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.9.14.22" data-slug="gravity-forms" data-type="class" data-id="72809"><head xmlns="http://www.w3.org/1999/xhtml"><title> gfnotification | class | Gravity Forms | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="GFNotification, class, plugin, gravity-forms, 1.9.14.22" /><meta name="description" content="The Gravity Forms GFNotification class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=874b75cf43cf9bfa3312835ba00a2e8d' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/gfnotification/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgfnotification%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgfnotification%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-gravity-forms-1.9.14.22-class-gfnotification","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="gfnotification" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-forms." href="http://hookr.io/plugins/gravity-forms/" class="plugin"><span property="name">gravity-forms</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.9.14.22." href="http://hookr.io/plugins/gravity-forms/1.9.14.22/" class="H_VERSION"><span property="name">1.9.14.22</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/gravity-forms/1.9.14.22/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">gfnotification</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="793"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/all/" title="All">All <span class="count badge">793</span></a></li><li class="" data-id="new" data-count="458"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/new/" title="New">New <span class="count badge">458</span></a></li><li class="" data-id="hooks" data-count="603"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/hooks/" title="Hooks">Hooks <span class="count badge">603</span></a></li><li class="" data-id="action" data-count="198"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/actions/" title="Actions">Actions <span class="count badge">198</span></a></li><li class="" data-id="filter" data-count="405"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/filters/" title="Filters">Filters <span class="count badge">405</span></a></li><li class="active" data-id="class" data-count="107"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/classes/" title="Classes">Classes <span class="count badge">107</span></a></li><li class="" data-id="constant" data-count="48"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/constants/" title="Constants">Constants <span class="count badge">48</span></a></li><li class="" data-id="function" data-count="33"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/functions/" title="Functions">Functions <span class="count badge">33</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>GFNotification</strong></h1><p>The Gravity Forms <strong>GFNotification</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/files/notification/" class="file">/notification.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="7" class="block" start="7"><li><div>Class GFNotification {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static $supported_fields = array(&nbsp;</div></li><li><div>        'checkbox', 'radio', 'select', 'text', 'website', 'textarea', 'email', 'hidden', 'number', 'phone', 'multiselect', 'post_title', &nbsp;</div></li><li><div>        'post_tags', 'post_custom_field', 'post_content', 'post_excerpt', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function get_notification( $form, $notification_id ) {&nbsp;</div></li><li><div>        foreach ( $form['notifications'] as $id =&gt; $notification ) {&nbsp;</div></li><li><div>            if ( $id == $notification_id ) {&nbsp;</div></li><li><div>                return $notification;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function notification_page() {&nbsp;</div></li><li><div>        $form_id = rgget( 'id' );&nbsp;</div></li><li><div>        $notification_id = rgget( 'nid' );&nbsp;</div></li><li><div>        if ( ! rgblank( $notification_id ) ) {&nbsp;</div></li><li><div>            self::notification_edit_page( $form_id, $notification_id );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            self::notification_list_page( $form_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function notification_edit_page( $form_id, $notification_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! rgempty( 'gform_notification_id' ) ) {&nbsp;</div></li><li><div>            $notification_id = rgpost( 'gform_notification_id' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = RGFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = gf_apply_filters( array( 'gform_form_notification_page', $form_id ), $form, $notification_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $notification = ! $notification_id ? array() : self::get_notification( $form, $notification_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // added second condition to account for new notifications with errors as notification ID will&nbsp;</div></li><li><div>        // be available in $_POST but the notification has not actually been saved yet&nbsp;</div></li><li><div>        $is_new_notification = empty( $notification_id ) || empty( $notification );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_valid = true;&nbsp;</div></li><li><div>        $is_update = false;&nbsp;</div></li><li><div>        if ( rgpost( 'save' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            check_admin_referer( 'gforms_save_notification', 'gforms_save_notification' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //clear out notification because it could have legacy data populated&nbsp;</div></li><li><div>            $notification = array( 'isActive' =&gt; isset( $notification['isActive'] ) ? rgar( $notification, 'isActive' ) : true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $is_update = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $is_new_notification ) {&nbsp;</div></li><li><div>                $notification_id = uniqid();&nbsp;</div></li><li><div>                $notification['id'] = $notification_id;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $notification['id'] = $notification_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['name'] = sanitize_text_field( rgpost( 'gform_notification_name' ) );&nbsp;</div></li><li><div>            $notification['event'] = sanitize_text_field( rgpost( 'gform_notification_event' ) );&nbsp;</div></li><li><div>            $notification['to'] = rgpost( 'gform_notification_to_type' ) == 'field' ? rgpost( 'gform_notification_to_field' ) : rgpost( 'gform_notification_to_email' );&nbsp;</div></li><li><div>            $to_type = rgpost( 'gform_notification_to_type' );&nbsp;</div></li><li><div>            if ( ! in_array( $to_type, array( 'email', 'field', 'routing', 'hidden' ) ) ) {&nbsp;</div></li><li><div>                $to_type = 'email';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $notification['toType'] = $to_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['bcc'] = rgpost( 'gform_notification_bcc' );&nbsp;</div></li><li><div>            $notification['subject'] = sanitize_text_field( rgpost( 'gform_notification_subject' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['message'] = rgpost( 'gform_notification_message' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['from'] = sanitize_text_field( rgpost( 'gform_notification_from' ) );&nbsp;</div></li><li><div>            $notification['fromName'] = sanitize_text_field( rgpost( 'gform_notification_from_name' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['replyTo'] = rgpost( 'gform_notification_reply_to' );&nbsp;</div></li><li><div>            $routing = ! rgempty( 'gform_routing_meta' ) ? GFCommon::json_decode( rgpost( 'gform_routing_meta' ), true ) : null;&nbsp;</div></li><li><div>            if ( ! empty ( $routing ) ) {&nbsp;</div></li><li><div>                $routing_logic = array( 'rules' =&gt; $routing );&nbsp;</div></li><li><div>                $routing_logic = GFFormsModel::sanitize_conditional_logic( $routing_logic );&nbsp;</div></li><li><div>                $notification['routing'] = $routing_logic['rules'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['routing'] = $routing;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $conditional_logic = ! rgempty( 'gform_conditional_logic_meta' ) ? GFCommon::json_decode( rgpost( 'gform_conditional_logic_meta' ), true ) : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['conditionalLogic'] = GFFormsModel::sanitize_conditional_logic( $conditional_logic );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notification['disableAutoformat'] = (bool) rgpost( 'gform_notification_disable_autoformat' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( rgpost( 'gform_is_default' ) ) {&nbsp;</div></li><li><div>                $notification['isDefault'] = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $notification = gf_apply_filters( array( 'gform_pre_notification_save', $form_id ), $notification, $form, $is_new_notification );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //validating input...&nbsp;</div></li><li><div>            $is_valid = self::validate_notification();&nbsp;</div></li><li><div>            if ( $is_valid ) {&nbsp;</div></li><li><div>                //input valid, updating...&nbsp;</div></li><li><div>                //emptying notification email if it is supposed to be disabled&nbsp;</div></li><li><div>                if ( $_POST['gform_notification_to_type'] == 'routing' ) {&nbsp;</div></li><li><div>                    $notification['to'] = '';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $notification['routing'] = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // trim values&nbsp;</div></li><li><div>                $notification = GFFormsModel::trim_conditional_logic_values_from_element( $notification, $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $form['notifications'][ $notification_id ] = $notification;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                RGFormsModel::save_form_notifications( $form_id, $form['notifications'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $is_update && $is_valid ) {&nbsp;</div></li><li><div>            $url = remove_query_arg( 'nid' );&nbsp;</div></li><li><div>            GFCommon::add_message( sprintf( esc_html__( 'Notification saved successfully. %sBack to notifications.%s', 'gravityforms' ), '&lt;a href=&quot;' . esc_url( $url ) . '&quot;&gt;', '&lt;/a&gt;' ) );&nbsp;</div></li><li><div>        } else if ( $is_update && ! $is_valid ) {&nbsp;</div></li><li><div>            GFCommon::add_error_message( esc_html__( 'Notification could not be updated. Please enter all required information below.', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // moved page header loading here so the admin messages can be set upon saving and available for the header to print out&nbsp;</div></li><li><div>        GFFormSettings::page_header( esc_html__( 'Notifications', 'gravityforms' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $notification_ui_settings = self::get_notification_ui_settings( $notification );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $min = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG || isset( $_GET['gform_debug'] ) ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;?php echo GFCommon::get_base_url() ?&gt;/css/admin&lt;?php echo $min; ?&gt;.css?ver=&lt;?php echo GFCommon::$version ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        var gform_has_unsaved_changes = false;&nbsp;</div></li><li><div>        jQuery(document).ready(function () {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            jQuery(&quot;#entry_form input, #entry_form textarea, #entry_form select&quot;).change(function () {&nbsp;</div></li><li><div>                gform_has_unsaved_changes = true;&nbsp;</div></li><li><div>            });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            window.onbeforeunload = function () {&nbsp;</div></li><li><div>                if (gform_has_unsaved_changes) {&nbsp;</div></li><li><div>                    return &quot;You have unsaved changes.&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            };&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            ToggleConditionalLogic(true, 'notification');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            jQuery(document).on('change', '.gfield_routing_value_dropdown', function () {&nbsp;</div></li><li><div>                SetRoutingValueDropDown(jQuery(this));&nbsp;</div></li><li><div>            });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        gform.addFilter(&quot;gform_merge_tags&quot;, &quot;MaybeAddSaveLinkMergeTag&quot;);&nbsp;</div></li><li><div>        function MaybeAddSaveLinkMergeTag(mergeTags, elementId, hideAllFields, excludeFieldTypes, isPrepop, option) {&nbsp;</div></li><li><div>            var event = document.getElementById('gform_notification_event').value;&nbsp;</div></li><li><div>            if ( event == 'form_saved' || event == 'form_save_email_requested' ) {&nbsp;</div></li><li><div>                mergeTags[&quot;other&quot;].tags.push({ tag: '{save_link}', label: &lt;?php echo json_encode( esc_html__( 'Save & Continue Link', 'gravityforms' ) ); ?&gt; });&nbsp;</div></li><li><div>                mergeTags[&quot;other&quot;].tags.push({ tag: '{save_token}', label: &lt;?php echo json_encode( esc_html__( 'Save & Continue Token', 'gravityforms' ) ); ?&gt; });&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return mergeTags;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        if ( empty( $form['notifications'] ) ) {&nbsp;</div></li><li><div>            $form['notifications'] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry_meta = GFFormsModel::get_entry_meta( $form_id );&nbsp;</div></li><li><div>        $entry_meta = apply_filters( 'gform_entry_meta_conditional_logic_notifications', $entry_meta, $form, $notification_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        var form = &lt;?php echo json_encode( $form ) ?&gt;;&nbsp;</div></li><li><div>        var current_notification = &lt;?php echo GFCommon::json_encode( $notification ) ?&gt;;&nbsp;</div></li><li><div>        var entry_meta = &lt;?php echo GFCommon::json_encode( $entry_meta ) ?&gt;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function SetRoutingValueDropDown(element) {&nbsp;</div></li><li><div>            //parsing ID to get routing Index&nbsp;</div></li><li><div>            var index = element.attr(&quot;id&quot;).replace(&quot;routing_value_&quot;, '');&nbsp;</div></li><li><div>            SetRouting(index);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function CreateRouting(routings) {&nbsp;</div></li><li><div>            var str = '';&nbsp;</div></li><li><div>            for (var i = 0; i &lt; routings.length; i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                var isSelected = routings[i].operator == 'is' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var isNotSelected = routings[i].operator == 'isnot' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var greaterThanSelected = routings[i].operator == '&gt;' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var lessThanSelected = routings[i].operator == '&lt;' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var containsSelected = routings[i].operator == 'contains' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var startsWithSelected = routings[i].operator == 'starts_with' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var endsWithSelected = routings[i].operator == 'ends_with' ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                var email = routings[i][&quot;email&quot;] ? routings[i][&quot;email&quot;] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                str += &quot;&lt;div style='width:99%'&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'Send to', 'gravityforms' ) ); ?&gt; + &quot; &lt;input type='text' id='routing_email_&quot; + i + &quot;' value='&quot; + email + &quot;' onkeyup='SetRouting(&quot; + i + &quot;);'/&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot; &quot; + &lt;?php echo json_encode( esc_html__( 'if', 'gravityforms' ) ); ?&gt; + &quot; &quot; + GetRoutingFields(i, routings[i].fieldId);&nbsp;</div></li><li><div>                str += &quot;&lt;select id='routing_operator_&quot; + i + &quot;' onchange='SetRouting(&quot; + i + &quot;);' class='gform_routing_operator'&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='is' &quot; + isSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'is', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='isnot' &quot; + isNotSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'is not', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='&gt;' &quot; + greaterThanSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'greater than', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='&lt;' &quot; + lessThanSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'less than', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='contains' &quot; + containsSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'contains', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='starts_with' &quot; + startsWithSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'starts with', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;option value='ends_with' &quot; + endsWithSelected + &quot;&gt;&quot; + &lt;?php echo json_encode( esc_html__( 'ends with', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                str += &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>                str += GetRoutingValues(i, routings[i].fieldId, routings[i].value);&nbsp;</div></li><li><div>                str += &quot;&lt;a class='gf_insert_field_choice' title='add another rule' onclick=\&quot;InsertRouting(&quot; + (i + 1) + &quot;);\&quot;&gt;&lt;i class='gficon-add'&gt;&lt;/i&gt;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>                if (routings.length &gt; 1)&nbsp;</div></li><li><div>                    str += &quot;&lt;a class='gf_delete_field_choice' title='remove this rule' onclick=\&quot;DeleteRouting(&quot; + i + &quot;);\&quot;&gt;&lt;i class='gficon-subtract'&gt;&lt;/i&gt;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                str += &quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            jQuery(&quot;#gform_notification_to_routing_rules&quot;).html(str);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function GetRoutingValues(index, fieldId, selectedValue) {&nbsp;</div></li><li><div>            var str = GetFieldValues(index, fieldId, selectedValue, 16);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return str;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function GetRoutingFields(index, selectedItem) {&nbsp;</div></li><li><div>            var str = &quot;&lt;select id='routing_field_id_&quot; + index + &quot;' class='gfield_routing_select' onchange='jQuery(\&quot;#routing_value_&quot; + index + &quot;\&quot;).replaceWith(GetRoutingValues(&quot; + index + &quot;, jQuery(this).val())); SetRouting(&quot; + index + &quot;); '&gt;&quot;;&nbsp;</div></li><li><div>            str += GetSelectableFields(selectedItem, 16);&nbsp;</div></li><li><div>            str += &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return str;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //---------------------- generic ---------------&nbsp;</div></li><li><div>        function GetSelectableFields(selectedFieldId, labelMaxCharacters) {&nbsp;</div></li><li><div>            var str = &quot;&quot;;&nbsp;</div></li><li><div>            var inputType;&nbsp;</div></li><li><div>            for (var i = 0; i &lt; form.fields.length; i++) {&nbsp;</div></li><li><div>                inputType = form.fields[i].inputType ? form.fields[i].inputType : form.fields[i].type;&nbsp;</div></li><li><div>                //see if this field type can be used for conditionals&nbsp;</div></li><li><div>                if (IsNotificationConditionalLogicField(form.fields[i])) {&nbsp;</div></li><li><div>                    var selected = form.fields[i].id == selectedFieldId ? &quot;selected='selected'&quot; : &quot;&quot;;&nbsp;</div></li><li><div>                    str += &quot;&lt;option value='&quot; + form.fields[i].id + &quot;' &quot; + selected + &quot;&gt;&quot; + form.fields[i].label + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return str;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function IsNotificationConditionalLogicField(field) {&nbsp;</div></li><li><div>            //this function is a duplicate of IsConditionalLogicField from form_editor.js&nbsp;</div></li><li><div>            inputType = field.inputType ? field.inputType : field.type;&nbsp;</div></li><li><div>            var supported_fields = ['checkbox', 'radio', 'select', 'text', 'website', 'textarea', 'email', 'hidden', 'number', 'phone', 'multiselect', 'post_title', &nbsp;</div></li><li><div>                'post_tags', 'post_custom_field', 'post_content', 'post_excerpt'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            var index = jQuery.inArray(inputType, supported_fields);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return index &gt;= 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function GetFirstSelectableField() {&nbsp;</div></li><li><div>            var inputType;&nbsp;</div></li><li><div>            for (var i = 0; i &lt; form.fields.length; i++) {&nbsp;</div></li><li><div>                inputType = form.fields[i].inputType ? form.fields[i].inputType : form.fields[i].type;&nbsp;</div></li><li><div>                if (IsNotificationConditionalLogicField(form.fields[i])) {&nbsp;</div></li><li><div>                    return form.fields[i].id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function TruncateMiddle(text, maxCharacters) {&nbsp;</div></li><li><div>            if (!text)&nbsp;</div></li><li><div>                return &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (text.length &lt;= maxCharacters)&nbsp;</div></li><li><div>                return text;&nbsp;</div></li><li><div>            var middle = parseInt(maxCharacters / 2);&nbsp;</div></li><li><div>            return text.substr(0, middle) + &quot;...&quot; + text.substr(text.length - middle, middle);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function GetFieldValues(index, fieldId, selectedValue, labelMaxCharacters) {&nbsp;</div></li><li><div>            if (!fieldId)&nbsp;</div></li><li><div>                fieldId = GetFirstSelectableField();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!fieldId)&nbsp;</div></li><li><div>                return &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            var str = '';&nbsp;</div></li><li><div>            var field = GetFieldById(fieldId);&nbsp;</div></li><li><div>            var isAnySelected = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!field)&nbsp;</div></li><li><div>                return &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (field[&quot;type&quot;] == 'post_category' && field[&quot;displayAllCategories&quot;]) {&nbsp;</div></li><li><div>                var dropdown_id = 'routing_value_' + index;&nbsp;</div></li><li><div>                var dropdown = jQuery('#' + dropdown_id + &quot;.gfield_category_dropdown&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //don't load category drop down if it already exists (to avoid unecessary ajax requests)&nbsp;</div></li><li><div>                if (dropdown.length &gt; 0) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    var options = dropdown.html();&nbsp;</div></li><li><div>                    options = options.replace(&quot;value=\&quot;&quot; + selectedValue + &quot;\&quot;&quot;, &quot;value=\&quot;&quot; + selectedValue + &quot;\&quot; selected=\&quot;selected\&quot;&quot;);&nbsp;</div></li><li><div>                    str = &quot;&lt;select id='&quot; + dropdown_id + &quot;' class='gfield_routing_select gfield_category_dropdown gfield_routing_value_dropdown'&gt;&quot; + options + &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    //loading categories via AJAX&nbsp;</div></li><li><div>                    jQuery.post(ajaxurl, {   action: &quot;gf_get_notification_post_categories&quot;, &nbsp;</div></li><li><div>                            ruleIndex              : index, &nbsp;</div></li><li><div>                            selectedValue          : selectedValue}, &nbsp;</div></li><li><div>                        function (dropdown_string) {&nbsp;</div></li><li><div>                            if (dropdown_string) {&nbsp;</div></li><li><div>                                jQuery('#gfield_ajax_placeholder_' + index).replaceWith(dropdown_string.trim());&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    //will be replaced by real drop down during the ajax callback&nbsp;</div></li><li><div>                    str = &quot;&lt;select id='gfield_ajax_placeholder_&quot; + index + &quot;' class='gfield_routing_select'&gt;&lt;option&gt;&quot; + &lt;?php json_encode( esc_html__( 'Loading...', 'gravityforms' ) ); ?&gt; + &quot;&lt;/option&gt;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else if (field.choices) {&nbsp;</div></li><li><div>                //create a drop down for fields that have choices (i.e. drop down, radio, checkboxes, etc...)&nbsp;</div></li><li><div>                str = &quot;&lt;select class='gfield_routing_select gfield_routing_value_dropdown' id='routing_value_&quot; + index + &quot;'&gt;&quot;;&nbsp;</div></li><li><div>                for (var i = 0; i &lt; field.choices.length; i++) {&nbsp;</div></li><li><div>                    var choiceValue = field.choices[i].value ? field.choices[i].value : field.choices[i].text;&nbsp;</div></li><li><div>                    var isSelected = choiceValue == selectedValue;&nbsp;</div></li><li><div>                    var selected = isSelected ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                    if (isSelected)&nbsp;</div></li><li><div>                        isAnySelected = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    str += &quot;&lt;option value='&quot; + choiceValue.replace(/'/g, &quot;&#039;&quot;) + &quot;' &quot; + selected + &quot;&gt;&quot; + field.choices[i].text + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!isAnySelected && selectedValue) {&nbsp;</div></li><li><div>                    str += &quot;&lt;option value='&quot; + selectedValue.replace(/'/g, &quot;&#039;&quot;) + &quot;' selected='selected'&gt;&quot; + selectedValue + &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                str += &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                selectedValue = selectedValue ? selectedValue.replace(/'/g, &quot;&#039;&quot;) : &quot;&quot;;&nbsp;</div></li><li><div>                //create a text field for fields that don't have choices (i.e text, textarea, number, email, etc...)&nbsp;</div></li><li><div>                str = &quot;&lt;input type='text' placeholder='&quot; + &lt;?php echo json_encode( esc_html__( 'Enter value', 'gravityforms' ) ); ?&gt; +&quot;' class='gfield_routing_select' id='routing_value_&quot; + index + &quot;' value='&quot; + selectedValue.replace(/'/g, &quot;&#039;&quot;) + &quot;' onchange='SetRouting(&quot; + index + &quot;);' onkeyup='SetRouting(&quot; + index + &quot;);'&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return str;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function GetFieldById(fieldId) {&nbsp;</div></li><li><div>            for (var i = 0; i &lt; form.fields.length; i++) {&nbsp;</div></li><li><div>                if (form.fields[i].id == fieldId)&nbsp;</div></li><li><div>                    return form.fields[i];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        //---------------------------------------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function InsertRouting(index) {&nbsp;</div></li><li><div>            var routings = current_notification.routing;&nbsp;</div></li><li><div>            routings.splice(index, 0, new ConditionalRule());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            CreateRouting(routings);&nbsp;</div></li><li><div>            SetRouting(index);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function SetRouting(ruleIndex) {&nbsp;</div></li><li><div>            if (!current_notification.routing && ruleIndex == 0)&nbsp;</div></li><li><div>                current_notification.routing = [new ConditionalRule()];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            current_notification.routing[ruleIndex][&quot;email&quot;] = jQuery(&quot;#routing_email_&quot; + ruleIndex).val();&nbsp;</div></li><li><div>            current_notification.routing[ruleIndex][&quot;fieldId&quot;] = jQuery(&quot;#routing_field_id_&quot; + ruleIndex).val();&nbsp;</div></li><li><div>            current_notification.routing[ruleIndex][&quot;operator&quot;] = jQuery(&quot;#routing_operator_&quot; + ruleIndex).val();&nbsp;</div></li><li><div>            current_notification.routing[ruleIndex][&quot;value&quot;] = jQuery(&quot;#routing_value_&quot; + ruleIndex).val();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            var json = jQuery.toJSON(current_notification.routing);&nbsp;</div></li><li><div>            jQuery('#gform_routing_meta').val(json);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function DeleteRouting(ruleIndex) {&nbsp;</div></li><li><div>            current_notification.routing.splice(ruleIndex, 1);&nbsp;</div></li><li><div>            CreateRouting(current_notification.routing);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function SetConditionalLogic(isChecked) {&nbsp;</div></li><li><div>            current_notification.conditionalLogic = isChecked ? new ConditionalLogic() : null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function SaveJSMeta() {&nbsp;</div></li><li><div>            jQuery('#gform_routing_meta').val(jQuery.toJSON(current_notification.routing));&nbsp;</div></li><li><div>            jQuery('#gform_conditional_logic_meta').val(jQuery.toJSON(current_notification.conditionalLogic));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php GFFormSettings::output_field_scripts() ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;form method=&quot;post&quot; id=&quot;gform_notification_form&quot; onsubmit=&quot;gform_has_unsaved_changes = false; SaveJSMeta();&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php wp_nonce_field( 'gforms_save_notification', 'gforms_save_notification' ) ?&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            if ( rgar( $notification, 'isDefault' ) ) {&nbsp;</div></li><li><div>                echo '&lt;input type=&quot;hidden&quot; id=&quot;gform_is_default&quot; name=&quot;gform_is_default&quot; value=&quot;1&quot;/&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;gform_routing_meta&quot; name=&quot;gform_routing_meta&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;gform_conditional_logic_meta&quot; name=&quot;gform_conditional_logic_meta&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;gform_notification_id&quot; name=&quot;gform_notification_id&quot; value=&quot;&lt;?php echo esc_attr( $notification_id ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;table class=&quot;form-table gform_nofification_edit&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php array_map( array( 'GFFormSettings', 'output' ), $notification_ui_settings ); ?&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                $button_label = $is_new_notification ? __( 'Save Notification', 'gravityforms' ) : __( 'Update Notification', 'gravityforms' );&nbsp;</div></li><li><div>                $notification_button = '&lt;input class=&quot;button-primary&quot; type=&quot;submit&quot; value=&quot;' . esc_attr( $button_label ) . '&quot; name=&quot;save&quot;/&gt;';&nbsp;</div></li><li><div>                echo apply_filters( 'gform_save_notification_button', $notification_button );&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/p&gt;&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        GFFormSettings::page_footer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function notification_list_page( $form_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // handle form actions&nbsp;</div></li><li><div>        self::maybe_process_notification_list_action();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = RGFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        GFFormSettings::page_header( esc_html__( 'Notifications', 'gravityforms' ) );&nbsp;</div></li><li><div>        $add_new_url = add_query_arg( array( 'nid' =&gt; 0 ) );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;h3&gt;&lt;span&gt;&lt;i class=&quot;fa fa-envelope-o&quot;&gt;&lt;/i&gt; &lt;?php esc_html_e( 'Notifications', 'gravityforms' ) ?&gt;&nbsp;</div></li><li><div>                &lt;a id=&quot;add-new-confirmation&quot; class=&quot;add-new-h2&quot; href=&quot;&lt;?php echo esc_url( $add_new_url ) ?&gt;&quot;&gt;&lt;?php esc_html_e( 'Add New', 'gravityforms' ) ?&gt;&lt;/a&gt;&lt;/span&gt;&nbsp;</div></li><li><div>        &lt;/h3&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>            function ToggleActive(img, notification_id) {&nbsp;</div></li><li><div>                var is_active = img.src.indexOf(&quot;active1.png&quot;) &gt;= 0&nbsp;</div></li><li><div>                if (is_active) {&nbsp;</div></li><li><div>                    img.src = img.src.replace(&quot;active1.png&quot;, &quot;active0.png&quot;);&nbsp;</div></li><li><div>                    jQuery(img).attr('title', &lt;?php echo json_encode( esc_html__( 'Inactive', 'gravityforms' ) ); ?&gt;).attr('alt', &lt;?php echo json_encode( esc_html__( 'Inactive', 'gravityforms' ) );  ?&gt;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    img.src = img.src.replace(&quot;active0.png&quot;, &quot;active1.png&quot;);&nbsp;</div></li><li><div>                    jQuery(img).attr('title', &lt;?php echo json_encode( esc_html__( 'Active', 'gravityforms' ) ); ?&gt;).attr('alt', &lt;?php echo json_encode( esc_html__( 'Active', 'gravityforms' ) ); ?&gt;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                var mysack = new sack(&quot;&lt;?php echo admin_url( 'admin-ajax.php' )?&gt;&quot;);&nbsp;</div></li><li><div>                mysack.execute = 1;&nbsp;</div></li><li><div>                mysack.method = 'POST';&nbsp;</div></li><li><div>                mysack.setVar(&quot;action&quot;, &quot;rg_update_notification_active&quot;);&nbsp;</div></li><li><div>                mysack.setVar(&quot;rg_update_notification_active&quot;, &quot;&lt;?php echo wp_create_nonce( 'rg_update_notification_active' ) ?&gt;&quot;);&nbsp;</div></li><li><div>                mysack.setVar(&quot;form_id&quot;, &lt;?php echo intval( $form_id ) ?&gt;);&nbsp;</div></li><li><div>                mysack.setVar(&quot;notification_id&quot;, notification_id);&nbsp;</div></li><li><div>                mysack.setVar(&quot;is_active&quot;, is_active ? 0 : 1);&nbsp;</div></li><li><div>                mysack.onError = function () {&nbsp;</div></li><li><div>                    alert(&lt;?php echo json_encode( esc_html__( 'Ajax error while updating notification', 'gravityforms' ) ) ?&gt;)&nbsp;</div></li><li><div>                };&nbsp;</div></li><li><div>                mysack.runAJAX();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $notification_table = new GFNotificationTable( $form );&nbsp;</div></li><li><div>        $notification_table-&gt;prepare_items();&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;form id=&quot;notification_list_form&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php $notification_table-&gt;display(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;input id=&quot;action_argument&quot; name=&quot;action_argument&quot; type=&quot;hidden&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input id=&quot;action&quot; name=&quot;action&quot; type=&quot;hidden&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php wp_nonce_field( 'gform_notification_list_action', 'gform_notification_list_action' ) ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        GFFormSettings::page_footer();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function maybe_process_notification_list_action() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $_POST ) || ! check_admin_referer( 'gform_notification_list_action', 'gform_notification_list_action' ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $action = rgpost( 'action' );&nbsp;</div></li><li><div>        $object_id = rgpost( 'action_argument' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $action ) {&nbsp;</div></li><li><div>            case 'delete':&nbsp;</div></li><li><div>                $notification_deleted = GFNotification::delete_notification( $object_id, rgget( 'id' ) );&nbsp;</div></li><li><div>                if ( $notification_deleted ) {&nbsp;</div></li><li><div>                    GFCommon::add_message( esc_html__( 'Notification deleted.', 'gravityforms' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    GFCommon::add_error_message( esc_html__( 'There was an issue deleting this notification.', 'gravityforms' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'duplicate':&nbsp;</div></li><li><div>                $notification_duplicated = GFNotification::duplicate_notification( $object_id, rgget( 'id' ) );&nbsp;</div></li><li><div>                if ( $notification_duplicated ) {&nbsp;</div></li><li><div>                    GFCommon::add_message( esc_html__( 'Notification duplicates.', 'gravityforms' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    GFCommon::add_error_message( esc_html__( 'There was an issue duplicating this notification.', 'gravityforms' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function get_notification_ui_settings( $notification ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * These variables are used to convenient &quot;wrap&quot; child form settings in the appropriate HTML.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $subsetting_open = '&nbsp;</div></li><li><div>            &lt;td colspan=&quot;2&quot; class=&quot;gf_sub_settings_cell&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;gf_animate_sub_settings&quot;&gt;&nbsp;</div></li><li><div>                    &lt;table&gt;&nbsp;</div></li><li><div>                        &lt;tr&gt;';&nbsp;</div></li><li><div>        $subsetting_close = '&nbsp;</div></li><li><div>                        &lt;/tr&gt;&nbsp;</div></li><li><div>                    &lt;/table&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ui_settings = array();&nbsp;</div></li><li><div>        $form_id = rgget( 'id' );&nbsp;</div></li><li><div>        $form = RGFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>        $form = gf_apply_filters( array( 'gform_admin_pre_render', $form_id ), $form );&nbsp;</div></li><li><div>        $is_valid = empty( GFCommon::$errors );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ob_start(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; &lt;?php echo rgar( $notification, 'isDefault' ) ? &quot;style='display:none'&quot; : '' ?&gt; &gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_name&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Name', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_name' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; class=&quot;fieldwidth-2&quot; name=&quot;gform_notification_name&quot; id=&quot;gform_notification_name&quot; value=&quot;&lt;?php echo esc_attr( rgget( 'name', $notification ) ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / name --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_name'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $notification_events = array( 'form_submission' =&gt; esc_html__( 'Form is submitted', 'gravityforms' ) );&nbsp;</div></li><li><div>        if ( rgars( $form, 'save/enabled' ) ) {&nbsp;</div></li><li><div>            $notification_events['form_saved'] = esc_html__( 'Form is saved', 'gravityforms' );&nbsp;</div></li><li><div>            $notification_events['form_save_email_requested'] = esc_html__( 'Save and continue email is requested', 'gravityforms' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $notification_events = apply_filters( 'gform_notification_events', $notification_events, $form );&nbsp;</div></li><li><div>        $event_style = count( $notification_events ) == 1 || rgar( $notification, 'isDefault' ) ? &quot;style='display:none'&quot; : '';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; &lt;?php echo $event_style ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_event&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Event', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_event' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;select name=&quot;gform_notification_event&quot; id=&quot;gform_notification_event&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    foreach ( $notification_events as $code =&gt; $label ) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;option value=&quot;&lt;?php echo esc_attr( $code ) ?&gt;&quot; &lt;?php selected( rgar( $notification, 'event' ), $code ) ?&gt;&gt;&lt;?php echo esc_html( $label ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                &lt;/select&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / event --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_event'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $notification_to_type = ! rgempty( 'gform_notification_to_type' ) ? rgpost( 'gform_notification_to_type' ) : rgar( $notification, 'toType' );&nbsp;</div></li><li><div>        if ( empty( $notification_to_type ) ) {&nbsp;</div></li><li><div>            $notification_to_type = 'email';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_invalid_email_to = ! $is_valid && ! self::is_valid_notification_to();&nbsp;</div></li><li><div>        $send_to_class = $is_invalid_email_to ? 'gfield_error' : '';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; class='&lt;?php echo esc_attr( $send_to_class ) ?&gt;' &lt;?php echo $notification_to_type == 'hidden' ? 'style=&quot;display:none;&quot;': ''; ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_to_email&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Send To', 'gravityforms' ); ?&gt;&lt;span class=&quot;gfield_required&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_send_to_email' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;radio&quot; id=&quot;gform_notification_to_type_email&quot; name=&quot;gform_notification_to_type&quot; &lt;?php checked( 'email', $notification_to_type ); ?&gt; value=&quot;email&quot; onclick=&quot;jQuery('.notification_to_container').hide(); jQuery('#gform_notification_to_email_container').show('slow');&quot; /&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_to_type_email&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Enter Email', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>                &nbsp;&nbsp;&nbsp;</div></li><li><div>                &lt;input type=&quot;radio&quot; id=&quot;gform_notification_to_type_field&quot; name=&quot;gform_notification_to_type&quot; &lt;?php checked( 'field', $notification_to_type ); ?&gt; value=&quot;field&quot; onclick=&quot;jQuery('.notification_to_container').hide(); jQuery('#gform_notification_to_field_container').show('slow');&quot; /&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_to_type_field&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Select a Field', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>                &nbsp;&nbsp;&nbsp;</div></li><li><div>                &lt;input type=&quot;radio&quot; id=&quot;gform_notification_to_type_routing&quot; name=&quot;gform_notification_to_type&quot; &lt;?php checked( 'routing', $notification_to_type ); ?&gt; value=&quot;routing&quot; onclick=&quot;jQuery('.notification_to_container').hide(); jQuery('#gform_notification_to_routing_container').show('slow');&quot; /&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_to_type_routing&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Configure Routing', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_send_to_routing' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / to email type --&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $ui_settings['notification_to_email_type'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean();&nbsp;</div></li><li><div>        if ( $notification_to_type == 'hidden' ) {&nbsp;</div></li><li><div>            $ui_settings['notification_to_email_type'] = '&lt;input type=&quot;hidden&quot; name=&quot;gform_notification_to_type&quot; value=&quot;hidden&quot; /&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr id=&quot;gform_notification_to_email_container&quot; class=&quot;notification_to_container &lt;?php echo esc_attr( $send_to_class ) ?&gt;&quot; &lt;?php echo $notification_to_type != 'email' ? &quot;style='display:none';&quot; : '' ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_open; ?&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&lt;?php esc_html_e( 'Send to Email', 'gravityforms' ) ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                $to_email = rgget( 'toType', $notification ) == 'email' ? rgget( 'to', $notification ) : '';&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; name=&quot;gform_notification_to_email&quot; id=&quot;gform_notification_to_email&quot; value=&quot;&lt;?php echo esc_attr( $to_email ) ?&gt;&quot; class=&quot;fieldwidth-1&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php if ( rgpost( 'gform_notification_to_type' ) == 'email' && $is_invalid_email_to ) { ?&gt;&nbsp;</div></li><li><div>                    &lt;span class=&quot;validation_message&quot;&gt;&lt;?php esc_html_e( 'Please enter a valid email address', 'gravityforms' ) ?&gt;.&lt;/span&gt;&nbsp;</div></li><li><div>                &lt;?php } ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_close; ?&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / to email --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_to_email'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php $email_fields = gf_apply_filters( array( 'gform_email_fields_notification_admin', $form['id'] ), GFCommon::get_email_fields( $form ), $form ); ?&gt;&nbsp;</div></li><li><div>        &lt;tr id=&quot;gform_notification_to_field_container&quot; class=&quot;notification_to_container &lt;?php echo esc_attr( $send_to_class ) ?&gt;&quot; &lt;?php echo $notification_to_type != 'field' ? &quot;style='display:none';&quot; : '' ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_open; ?&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&lt;?php esc_html_e( 'Send to Field', 'gravityforms' ) ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                if ( ! empty( $email_fields ) ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;select name=&quot;gform_notification_to_field&quot; id=&quot;gform_notification_to_field&quot;&gt;&nbsp;</div></li><li><div>                        &lt;option value=&quot;&quot;&gt;&lt;?php esc_html_e( 'Select an email field', 'gravityforms' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $to_field = rgget( 'toType', $notification ) == 'field' ? rgget( 'to', $notification ) : '';&nbsp;</div></li><li><div>                        foreach ( $email_fields as $field ) {&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;option value=&quot;&lt;?php echo esc_attr( $field-&gt;id ) ?&gt;&quot; &lt;?php echo selected( $field-&gt;id, $to_field ) ?&gt;&gt;&lt;?php echo GFCommon::get_label( $field ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/select&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;error_base&quot;&gt;&nbsp;</div></li><li><div>                        &lt;p&gt;&lt;?php esc_html_e( 'Your form does not have an email field. Add an email field to your form and try again.', 'gravityforms' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_close; ?&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / to email field --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_to_email_field'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr id=&quot;gform_notification_to_routing_container&quot; class=&quot;notification_to_container &lt;?php echo esc_attr( $send_to_class ) ?&gt;&quot; &lt;?php echo $notification_to_type != 'routing' ? &quot;style='display:none';&quot; : '' ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_open; ?&gt;&nbsp;</div></li><li><div>            &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;gform_notification_to_routing_rules&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    $routing_fields = self::get_routing_fields( $form, '0' );&nbsp;</div></li><li><div>                    if ( empty( $routing_fields ) ) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;gold_notice&quot;&gt;&nbsp;</div></li><li><div>                            &lt;p&gt;&lt;?php esc_html_e( 'To use notification routing, your form must have a field supported by conditional logic.', 'gravityforms' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ( empty( $notification['routing'] ) ) {&nbsp;</div></li><li><div>                            $notification['routing'] = array( array() );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $count = sizeof( $notification['routing'] );&nbsp;</div></li><li><div>                        $routing_list = ', ';&nbsp;</div></li><li><div>                        for ( $i = 0; $i &lt; $count; $i ++ ) {&nbsp;</div></li><li><div>                            $routing_list .= $i . ', ';&nbsp;</div></li><li><div>                            $routing = $notification['routing'][ $i ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $is_invalid_rule = ! $is_valid && $_POST['gform_notification_to_type'] == 'routing' && ! self::is_valid_notification_email( rgar( $routing, 'email' ) );&nbsp;</div></li><li><div>                            $class = $is_invalid_rule ? &quot;class='grouting_rule_error'&quot; : '';&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;div style='width:99%' &lt;?php echo $class ?&gt;&gt;&nbsp;</div></li><li><div>                                &lt;?php esc_html_e( 'Send to', 'gravityforms' ) ?&gt;&nbsp;</div></li><li><div>                                &lt;input type=&quot;text&quot; id=&quot;routing_email_&lt;?php echo $i ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( rgar( $routing, 'email' ) ); ?&gt;&quot; onkeyup=&quot;SetRouting(&lt;?php echo $i ?&gt;);&quot; /&gt;&nbsp;</div></li><li><div>                                &lt;?php esc_html_e( 'if', 'gravityforms' ) ?&gt;&nbsp;</div></li><li><div>                                &lt;select id=&quot;routing_field_id_&lt;?php echo $i ?&gt;&quot; class='gfield_routing_select' onchange='jQuery(&quot;#routing_value_&lt;?php echo $i ?&gt;&quot;).replaceWith(GetRoutingValues(&lt;?php echo $i ?&gt;, jQuery(this).val())); SetRouting(&lt;?php echo $i ?&gt;); '&gt;&lt;?php echo self::get_routing_fields( $form, rgar( $routing, 'fieldId' ) ) ?&gt;&lt;/select&gt;&nbsp;</div></li><li><div>                                &lt;select id=&quot;routing_operator_&lt;?php echo $i ?&gt;&quot; onchange=&quot;SetRouting(&lt;?php echo $i ?&gt;)&quot; class=&quot;gform_routing_operator&quot;&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;is&quot; &lt;?php echo rgar( $routing, 'operator' ) == 'is' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'is', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;isnot&quot; &lt;?php echo rgar( $routing, 'operator' ) == 'isnot' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'is not', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;&gt;&quot; &lt;?php echo rgar( $routing, 'operator' ) == '&gt;' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'greater than', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;&lt;&quot; &lt;?php echo rgar( $routing, 'operator' ) == '&lt;' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'less than', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;contains&quot; &lt;?php echo rgar( $routing, 'operator' ) == 'contains' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'contains', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;starts_with&quot; &lt;?php echo rgar( $routing, 'operator' ) == 'starts_with' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'starts with', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                    &lt;option value=&quot;ends_with&quot; &lt;?php echo rgar( $routing, 'operator' ) == 'ends_with' ? &quot;selected='selected'&quot; : '' ?&gt;&gt;&lt;?php esc_html_e( 'ends with', 'gravityforms' ) ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                &lt;/select&gt;&nbsp;</div></li><li><div>                                &lt;?php echo self::get_field_values( $i, $form, rgar( $routing, 'fieldId' ), rgar( $routing, 'value' ) ) ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                &lt;a class='gf_insert_field_choice' title='add another rule' onclick='SetRouting(&lt;?php echo $i ?&gt;); InsertRouting(&lt;?php echo $i + 1 ?&gt;);'&gt;&lt;i class='gficon-add'&gt;&lt;/i&gt;&lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                &lt;?php if ( $count &gt; 1 ) { ?&gt;&nbsp;</div></li><li><div>                                    &lt;img src='&lt;?php echo GFCommon::get_base_url() ?&gt;/images/remove.png' id='routing_delete_&lt;?php echo $i ?&gt;' title='remove this email routing' alt='remove this email routing' class='delete_field_choice' style='cursor:pointer;' onclick='DeleteRouting(&lt;?php echo $i ?&gt;);' /&gt;&nbsp;</div></li><li><div>                                &lt;?php } ?&gt;&nbsp;</div></li><li><div>                            &lt;/div&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $is_invalid_rule ) {&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;span class=&quot;validation_message&quot;&gt;&lt;?php esc_html_e( 'Please enter a valid email address for all highlighted routing rules above.', 'gravityforms' ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                        &lt;?php } ?&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;hidden&quot; name=&quot;routing_count&quot; id=&quot;routing_count&quot; value=&quot;&lt;?php echo $routing_list ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;?php echo $subsetting_close; ?&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / to routing --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_to_routing'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_from_name&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'From Name', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_from_name' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; class=&quot;fieldwidth-2 merge-tag-support mt-position-right mt-hide_all_fields&quot; name=&quot;gform_notification_from_name&quot; id=&quot;gform_notification_from_name&quot; value=&quot;&lt;?php echo esc_attr( rgget( 'fromName', $notification ) ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / from name --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_from_name'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_from&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'From Email', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_from_email' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; class=&quot;fieldwidth-2 merge-tag-support mt-position-right mt-hide_all_fields&quot; name=&quot;gform_notification_from&quot; id=&quot;gform_notification_from&quot; value=&quot;&lt;?php echo rgempty( 'from', $notification ) ? '{admin_email}' : esc_attr( rgget( 'from', $notification ) ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / to from email --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_from'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_reply_to&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    $is_invalid_reply_to = ! $is_valid && ! self::is_valid_notification_email( rgar( $notification, 'replyTo' ) );&nbsp;</div></li><li><div>                    $class = $is_invalid_reply_to ? ' gfield_error' : '';&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Reply To', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_reply_to' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; name=&quot;gform_notification_reply_to&quot; id=&quot;gform_notification_reply_to&quot; class=&quot;merge-tag-support mt-hide_all_fields fieldwidth-2&lt;?php echo $class ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( rgget( 'replyTo', $notification ) ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / reply to --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_reply_to'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_bcc&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'BCC', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_bcc' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                $is_invalid_bcc = ! $is_valid && ! self::is_valid_notification_email( rgar( $notification, 'bcc' ) );&nbsp;</div></li><li><div>                $class = $is_invalid_bcc ? ' gfield_error' : '';&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; name=&quot;gform_notification_bcc&quot; id=&quot;gform_notification_bcc&quot; value=&quot;&lt;?php echo esc_attr( rgget( 'bcc', $notification ) ) ?&gt;&quot; class=&quot;merge-tag-support mt-hide_all_fields fieldwidth-2&lt;?php echo $class ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / bcc --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_bcc'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $is_invalid_subject = ! $is_valid && empty( $_POST['gform_notification_subject'] );&nbsp;</div></li><li><div>        $subject_class = $is_invalid_subject ? &quot;class='gfield_error'&quot; : '';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; &lt;?php echo $subject_class ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_subject&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Subject', 'gravityforms' ); ?&gt;&lt;span class=&quot;gfield_required&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;text&quot; name=&quot;gform_notification_subject&quot; id=&quot;gform_notification_subject&quot; class=&quot;fieldwidth-1 merge-tag-support mt-hide_all_fields mt-position-right&quot; value=&quot;&lt;?php echo esc_attr( rgar( $notification, 'subject' ) ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                if ( $is_invalid_subject ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;span class=&quot;validation_message&quot;&gt;&lt;?php esc_html_e( 'Please enter a subject for the notification email', 'gravityforms' ) ?&gt;&lt;/span&gt;&lt;?php&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / subject --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_subject'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        $is_invalid_message = ! $is_valid && empty( $_POST['gform_notification_message'] );&nbsp;</div></li><li><div>        $message_class = $is_invalid_message ? &quot;class='gfield_error'&quot; : '';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; &lt;?php echo $message_class ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_message&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Message', 'gravityforms' ); ?&gt;&lt;span class=&quot;gfield_required&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;span class=&quot;mt-gform_notification_message&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                if ( GFCommon::is_wp_version( '3.3' ) ) {&nbsp;</div></li><li><div>                    wp_editor( rgar( $notification, 'message' ), 'gform_notification_message', array( 'autop' =&gt; false, 'editor_class' =&gt; 'merge-tag-support mt-wp_editor mt-manual_position mt-position-right' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;textarea name=&quot;gform_notification_message&quot; id=&quot;gform_notification_message&quot; class=&quot;fieldwidth-1 fieldheight-1&quot;&gt;&lt;?php echo esc_html( $notification['message'] ) ?&gt;&lt;/textarea&gt;&lt;?php&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $is_invalid_message ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;span class=&quot;validation_message&quot;&gt;&lt;?php esc_html_e( 'Please enter a message for the notification email', 'gravityforms' ) ?&gt;&lt;/span&gt;&lt;?php&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / message --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_message'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_disable_autoformat&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Auto-formatting', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_autoformat' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;checkbox&quot; name=&quot;gform_notification_disable_autoformat&quot; id=&quot;gform_notification_disable_autoformat&quot; value=&quot;1&quot; &lt;?php echo empty( $notification['disableAutoformat'] ) ? '' : &quot;checked='checked'&quot; ?&gt;/&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;form_notification_disable_autoformat&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Disable auto-formatting', 'gravityforms' ); ?&gt;&nbsp;</div></li><li><div>                    &lt;?php gform_tooltip( 'notification_autoformat' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / disable autoformat --&gt;&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_disable_autoformat'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;tr valign=&quot;top&quot; &lt;?php echo rgar( $notification, 'isDefault' ) ? 'style=display:none;' : ''; ?&gt; &gt;&nbsp;</div></li><li><div>            &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;gform_notification_conditional_logic&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php esc_html_e( 'Conditional Logic', 'gravityforms' ) ?&gt;&lt;?php gform_tooltip( 'notification_conditional_logic' ) ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;checkbox&quot; id=&quot;notification_conditional_logic&quot; onclick=&quot;SetConditionalLogic(this.checked); ToggleConditionalLogic(false, 'notification');&quot; &lt;?php checked( is_array( rgar( $notification, 'conditionalLogic' ) ), true ) ?&gt; /&gt;&nbsp;</div></li><li><div>                &lt;label for=&quot;notification_conditional_logic&quot; class=&quot;inline&quot;&gt;&lt;?php esc_html_e( 'Enable conditional logic', 'gravityforms' ) ?&gt;&lt;?php gform_tooltip( 'notification_conditional_logic' ) ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                &lt;br /&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt; &lt;!-- / conditional logic --&gt;&nbsp;</div></li><li><div>        &lt;tr&gt;&nbsp;</div></li><li><div>            &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;notification_conditional_logic_container&quot; class=&quot;gf_animate_sub_settings&quot; style=&quot;padding-left:10px;&quot;&gt;&nbsp;</div></li><li><div>                    &lt;!-- content dynamically created from form_admin.js --&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php $ui_settings['notification_conditional_logic'] = ob_get_contents();&nbsp;</div></li><li><div>        ob_clean(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        ob_end_clean();&nbsp;</div></li><li><div>        $ui_settings = gf_apply_filters( array( 'gform_notification_ui_settings', $form_id ), $ui_settings, $notification, $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $ui_settings;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function validate_notification() {&nbsp;</div></li><li><div>        $is_valid = self::is_valid_notification_to() && ! rgempty( 'gform_notification_subject' ) && ! rgempty( 'gform_notification_message' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bcc = rgpost( 'gform_notification_bcc' );&nbsp;</div></li><li><div>        if ( ! empty( $bcc ) && ! self::is_valid_notification_email( $bcc ) ) {&nbsp;</div></li><li><div>            $is_valid = false;&nbsp;</div></li><li><div>            GFCommon::add_error_message( esc_html__( 'Please enter a valid email address or merge tag in the BCC field.', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $reply_to = rgpost( 'gform_notification_reply_to' );&nbsp;</div></li><li><div>        if ( ! empty( $reply_to ) && ! self::is_valid_notification_email( $reply_to ) ) {&nbsp;</div></li><li><div>            $is_valid = false;&nbsp;</div></li><li><div>            GFCommon::add_error_message( esc_html__( 'Please enter a valid email address or merge tag in the Reply To field.', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $is_valid;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function is_valid_routing() {&nbsp;</div></li><li><div>        $routing = ! empty( $_POST['gform_routing_meta'] ) ? GFCommon::json_decode( stripslashes( $_POST['gform_routing_meta'] ), true ) : null;&nbsp;</div></li><li><div>        if ( empty( $routing ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $routing as $route ) {&nbsp;</div></li><li><div>            if ( ! self::is_valid_notification_email( $route['email'] ) ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function is_valid_notification_email( $text ) {&nbsp;</div></li><li><div>        if ( empty( $text ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $emails = explode( ', ', $text );&nbsp;</div></li><li><div>        foreach ( $emails as $email ) {&nbsp;</div></li><li><div>            $email = trim( $email );&nbsp;</div></li><li><div>            $invalid_email = GFCommon::is_invalid_or_empty_email( $email );&nbsp;</div></li><li><div>            // this used to be more strict; updated to match any merge-tag-like string&nbsp;</div></li><li><div>            $invalid_variable = ! preg_match( '/^{.+}$/', $email );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $invalid_email && $invalid_variable ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function is_valid_notification_to() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $notification_to_email = rgpost( 'gform_notification_to_email' );&nbsp;</div></li><li><div>        $is_valid = ( rgpost( 'gform_notification_to_type' ) == 'routing' && self::is_valid_routing() )&nbsp;</div></li><li><div>            ||&nbsp;</div></li><li><div>            ( rgpost( 'gform_notification_to_type' ) == 'email' && ( self::is_valid_notification_email( $notification_to_email ) ) )&nbsp;</div></li><li><div>            ||&nbsp;</div></li><li><div>            ( rgpost( 'gform_notification_to_type' ) == 'field' && ( ! rgempty( 'gform_notification_to_field' ) ) )&nbsp;</div></li><li><div>            || rgpost( 'gform_notification_to_type' ) == 'hidden';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $is_valid = apply_filters( 'gform_is_valid_notification_to', $is_valid, rgpost( 'gform_notification_to_type' ), rgpost( 'gform_notification_to_email' ), rgpost( 'gform_notification_to_field' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function get_first_routing_field( $form ) {&nbsp;</div></li><li><div>        foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>            if ( in_array( $field-&gt;get_input_type(), self::get_routing_field_types() ) ) {&nbsp;</div></li><li><div>                return $field-&gt;id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function get_routing_fields( $form, $selected_field_id ) {&nbsp;</div></li><li><div>        $str = '';&nbsp;</div></li><li><div>        foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>            $field_label = RGFormsModel::get_label( $field );&nbsp;</div></li><li><div>            if ( in_array( $field-&gt;get_input_type(), self::get_routing_field_types() ) ) {&nbsp;</div></li><li><div>                $selected = $field-&gt;id == $selected_field_id ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                $str .= &quot;&lt;option value='&quot; . $field-&gt;id . &quot;' &quot; . $selected . '&gt;' . $field_label . '&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_routing_field_types() {&nbsp;</div></li><li><div>        $field_types = apply_filters( 'gform_routing_field_types', self::$supported_fields );&nbsp;</div></li><li><div>        return $field_types;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private static function get_field_values( $i, $form, $field_id, $selected_value, $max_field_length = 16 ) {&nbsp;</div></li><li><div>        if ( empty( $field_id ) ) {&nbsp;</div></li><li><div>            $field_id = self::get_first_routing_field( $form );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $field_id ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = RGFormsModel::get_field( $form, $field_id );&nbsp;</div></li><li><div>        $is_any_selected = false;&nbsp;</div></li><li><div>        $str = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $field ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $field-&gt;type == 'post_category' && $field-&gt;displayAllCategories == true ) {&nbsp;</div></li><li><div>            $str .= wp_dropdown_categories( array( 'class' =&gt; 'gfield_routing_select gfield_category_dropdown gfield_routing_value_dropdown', 'orderby' =&gt; 'name', 'id' =&gt; 'routing_value_' . $i, 'selected' =&gt; $selected_value, 'hierarchical' =&gt; true, 'hide_empty' =&gt; 0, 'echo' =&gt; false ) );&nbsp;</div></li><li><div>        } elseif ( $field-&gt;choices ) {&nbsp;</div></li><li><div>            $str .= &quot;&lt;select id='routing_value_&quot; . $i . &quot;' class='gfield_routing_select gfield_routing_value_dropdown'&gt;&quot;;&nbsp;</div></li><li><div>            foreach ( $field-&gt;choices as $choice ) {&nbsp;</div></li><li><div>                $is_selected = $choice['value'] == $selected_value;&nbsp;</div></li><li><div>                $selected = $is_selected ? &quot;selected='selected'&quot; : '';&nbsp;</div></li><li><div>                if ( $is_selected ) {&nbsp;</div></li><li><div>                    $is_any_selected = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $str .= &quot;&lt;option value='&quot; . esc_attr( $choice['value'] ) . &quot;' &quot; . $selected . '&gt;' . $choice['text'] . '&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //adding current selected field value to the list&nbsp;</div></li><li><div>            if ( ! $is_any_selected && ! empty( $selected_value ) ) {&nbsp;</div></li><li><div>                $str .= &quot;&lt;option value='&quot; . esc_attr( $selected_value ) . &quot;' selected='selected'&gt;&quot; . $selected_value . '&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $str .= '&lt;/select&gt;';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            //create a text field for fields that don't have choices (i.e text, textarea, number, email, etc...)&nbsp;</div></li><li><div>            $str = &quot;&lt;input type='text' placeholder='&quot; . esc_html__( 'Enter value', 'gravityforms' ) . &quot;' class='gfield_routing_select' id='routing_value_&quot; . $i . &quot;' value='&quot; . esc_attr( $selected_value ) . &quot;' onchange='SetRouting(&quot; . $i . &quot;);' onkeyup='SetRouting(&quot; . $i . &quot;);'&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_post_category_values() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = 'routing_value_' . rgpost( 'ruleIndex' );&nbsp;</div></li><li><div>        $selected = rgempty( 'selectedValue' ) ? 0 : rgpost( 'selectedValue' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dropdown = wp_dropdown_categories( array( 'class' =&gt; 'gfield_routing_select gfield_routing_value_dropdown gfield_category_dropdown', 'orderby' =&gt; 'name', 'id' =&gt; $id, 'selected' =&gt; $selected, 'hierarchical' =&gt; true, 'hide_empty' =&gt; 0, 'echo' =&gt; false ) );&nbsp;</div></li><li><div>        die( $dropdown );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a form notification by ID.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $notification_id&nbsp;</div></li><li><div>     * @param mixed $form_id Can pass a form ID or a form object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_notification( $notification_id, $form_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $form_id ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = ! is_array( $form_id ) ? RGFormsModel::get_form_meta( $form_id ) : $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'gform_pre_notification_deleted', $form['notifications'][ $notification_id ], $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $form['notifications'][ $notification_id ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // clear Form cache so next retrieval of form meta will reflect deleted notification&nbsp;</div></li><li><div>        RGFormsModel::flush_current_forms();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return RGFormsModel::save_form_notifications( $form['id'], $form['notifications'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function duplicate_notification( $notification_id, $form_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $form_id ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = ! is_array( $form_id ) ? RGFormsModel::get_form_meta( $form_id ) : $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $new_notification = $form['notifications'][ $notification_id ];&nbsp;</div></li><li><div>        $name = rgar( $new_notification, 'name' );&nbsp;</div></li><li><div>        $new_id = uniqid();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $count = 2;&nbsp;</div></li><li><div>        $new_name = $name . ' - Copy 1';&nbsp;</div></li><li><div>        while ( ! self::is_unique_name( $new_name, $form['notifications'] ) ) {&nbsp;</div></li><li><div>            $new_name = $name . &quot; - Copy $count&quot;;&nbsp;</div></li><li><div>            $count ++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $new_notification['name'] = $new_name;&nbsp;</div></li><li><div>        $new_notification['id'] = $new_id;&nbsp;</div></li><li><div>        unset( $new_notification['isDefault'] );&nbsp;</div></li><li><div>        if ( $new_notification['toType'] == 'hidden' ) {&nbsp;</div></li><li><div>            $new_notification['toType'] = 'email';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form['notifications'][ $new_id ] = $new_notification;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // clear Form cache so next retrieval of form meta will return duplicated notification&nbsp;</div></li><li><div>        RGFormsModel::flush_current_forms();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return RGFormsModel::save_form_notifications( $form['id'], $form['notifications'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function is_unique_name( $name, $notifications ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $notifications as $notification ) {&nbsp;</div></li><li><div>            if ( strtolower( rgar( $notification, 'name' ) ) == strtolower( $name ) ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.3.9.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/classes/gfnotification/" class="active">1.9.14.22</a></li><li><a href="http://hookr.io/plugins/gravity-forms/1.3.9.1/classes/gfnotification/" class="">1.3.9.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>GFNotification</li><li><span></span>Gravity Forms</li><li><span></span>1.9.14.22</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>