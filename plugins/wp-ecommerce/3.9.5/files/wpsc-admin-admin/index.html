<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.9.5" data-slug="wp-ecommerce" data-type="file" data-id="27254"><head xmlns="http://www.w3.org/1999/xhtml"><title> wpsc-admin-admin | file | Wp Ecommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, wp-ecommerce, 3.9.5" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=159bbeaeaee06b4047c6cb08eb385b13' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wpsc-admin-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwpsc-admin-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwpsc-admin-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-wp-ecommerce-3.9.5-file-wpsc-admin-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wpsc-admin-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to wp-ecommerce." href="http://hookr.io/plugins/wp-ecommerce/" class="plugin"><span property="name">wp-ecommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.9.5." href="http://hookr.io/plugins/wp-ecommerce/3.9.5/" class="H_VERSION"><span property="name">3.9.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/wp-ecommerce/3.9.5/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wpsc-admin-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="4119"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/all/" title="All">All <span class="count badge">4119</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="836"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/hooks/" title="Hooks">Hooks <span class="count badge">836</span></a></li><li class="" data-id="action" data-count="253"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/actions/" title="Actions">Actions <span class="count badge">253</span></a></li><li class="" data-id="filter" data-count="583"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/filters/" title="Filters">Filters <span class="count badge">583</span></a></li><li class="" data-id="class" data-count="581"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/classes/" title="Classes">Classes <span class="count badge">581</span></a></li><li class="" data-id="constant" data-count="1044"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/constants/" title="Constants">Constants <span class="count badge">1044</span></a></li><li class="" data-id="function" data-count="1652"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/functions/" title="Functions">Functions <span class="count badge">1652</span></a></li><li class="" data-id="shortcode" data-count="6"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">6</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wpsc-admin/admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WP eCommerce Main Admin functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * These are the main WPSC Admin functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package wp-e-commerce</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.7</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// admin includes</span>&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/display-update.page.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/display-items.page.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/display-upgrades.page.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/includes/display-items-functions.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/includes/product-functions.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/includes/save-data.functions.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/includes/updating-functions.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/display-coupons.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-includes/purchaselogs.class.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-includes/theming.class.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/ajax.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/init.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/ajax-and-init.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/display-options-settings.page.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/db-upgrades/upgrade.php' );&nbsp;</div></li><li><div>require_once( WPSC_FILE_PATH . '/wpsc-admin/media.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ( isset( $_SESSION['wpsc_activate_debug_page'] ) && ( $_SESSION['wpsc_activate_debug_page'] == true ) ) || ( defined( 'WPSC_ADD_DEBUG_PAGE' ) && ( constant( 'WPSC_ADD_DEBUG_PAGE' ) == true ) ) )&nbsp;</div></li><li><div>  require_once( WPSC_FILE_PATH . '/wpsc-admin/display-debug.page.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! get_option( 'wpsc_checkout_form_sets' ) ) {&nbsp;</div></li><li><div>  $form_sets = array( __( 'Default Checkout Forms', 'wpsc' ) );&nbsp;</div></li><li><div>  update_option( 'wpsc_checkout_form_sets', $form_sets );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// if we add and wpec admin javascript will add the localizations</span>&nbsp;</div></li><li><div>add_filter( 'wpsc_javascript_localizations', '_wpsc_admin_localizations', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_query_vars_product_list sets the ordering for the edit-products page list</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()   Gets option from the DB given key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array     $vars  req  Default query arguments</span>&nbsp;</div></li><li><div><span class="comment"> * @return array    $vars       Modified query arguments</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_query_vars_product_list( $vars ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( 'wpsc-product' != $vars['post_type'] || in_array( $vars['orderby'], array( 'meta_value_num', 'meta_value' ) ) )&nbsp;</div></li><li><div>      return $vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $vars['posts_per_archive_page'] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( 'dragndrop' == get_option( 'wpsc_sort_by' ) ) {&nbsp;</div></li><li><div>      $vars['orderby'] = 'menu_order title';&nbsp;</div></li><li><div>      $vars['order'] = 'desc';&nbsp;</div></li><li><div>      $vars['nopaging'] = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $vars;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Admin Edit Posts Order</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8.12</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param   string  $orderby_sql  Order by SQL.</span>&nbsp;</div></li><li><div><span class="comment"> * @return  string  Filtered order by SQL.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_edit_posts_orderby( $orderby_sql ) {&nbsp;</div></li><li><div>  global $wp_query, $wpdb;&nbsp;</div></li><li><div>  if ( 'dragndrop' == get_option( 'wpsc_sort_by' ) ) {&nbsp;</div></li><li><div>      if ( function_exists( 'is_main_query' ) && is_main_query() && 'wpsc-product' == get_query_var( 'post_type' ) && is_tax( 'wpsc_product_category' ) ) {&nbsp;</div></li><li><div>          if ( ! empty( $orderby_sql ) )&nbsp;</div></li><li><div>              $orderby_sql = ', ' . $orderby_sql;&nbsp;</div></li><li><div>          $orderby_sql = &quot; {$wpdb-&gt;term_relationships}.term_order ASC&quot; . $orderby_sql;&nbsp;</div></li><li><div>          remove_filter( 'posts_orderby', 'wpsc_admin_edit_posts_orderby' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $orderby_sql;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'posts_orderby', 'wpsc_admin_edit_posts_orderby' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * setting the product & variations per page screen option to between 1 and 999</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses update_user_option()   Updates user option given userid, key, value</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param           $status</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $option     req     Name of option being saved</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $value      req     Value of option being saved</span>&nbsp;</div></li><li><div><span class="comment"> * @return $value after changes...</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_set_screen_option($status, $option, $value) {&nbsp;</div></li><li><div>  if( in_array($option, array (&quot;edit_wpsc_variation_per_page&quot;, &quot;edit_wpsc_product_per_page&quot;, &quot;wpsc_purchases_per_page&quot; )) ) {&nbsp;</div></li><li><div>      if ( &quot;edit_wpsc_variation_per_page&quot; == $option ) {&nbsp;</div></li><li><div>          global $user_ID;&nbsp;</div></li><li><div>          update_user_option($user_ID, 'edit_wpsc-variation_per_page', $value);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $value;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter('set-screen-option', 'wpsc_set_screen_option', 99, 3);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * When rearranging the products for drag and drop it is easiest to arrange them when they are all on the same page...</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()   Gets option from the database given key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int       $per_page   req     number of products per page</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $post_type  req     name of current post type</span>&nbsp;</div></li><li><div><span class="comment"> * @return $per_page after changes...</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_drag_and_drop_ordering($per_page, $post_type) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>  if ( 'wpsc-product' == $post_type && 'dragndrop' == get_option( 'wpsc_sort_by' ) && $count = $wpdb-&gt;get_var( &quot;SELECT COUNT(*) FROM {$wpdb-&gt;posts} WHERE `post_type`='wpsc-product' AND `post_parent`=0&quot; ) )&nbsp;</div></li><li><div>      $per_page = $count;&nbsp;</div></li><li><div>  return $per_page;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'request', 'wpsc_query_vars_product_list' );&nbsp;</div></li><li><div>add_filter( 'edit_posts_per_page' , 'wpsc_drag_and_drop_ordering', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks whether to display or hide the update wp-e-commerce link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()   Gets option from DB given key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean true - show link, false- hide link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_show_update_link() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>  <span class="comment">// Check if old product_list table exists</span>&nbsp;</div></li><li><div>  <span class="comment">// If it exists AND get_option wpsc_upgrade_complete is not true then return true</span>&nbsp;</div></li><li><div>  $sql = 'SHOW TABLES LIKE &quot;'.$wpdb-&gt;prefix.'wpsc_product_list&quot;';&nbsp;</div></li><li><div>  $var = $wpdb-&gt;get_var( $sql );&nbsp;</div></li><li><div>  if ( !empty( $var ) && false == get_option( 'wpsc_hide_update' ) )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_admin_pages function, all the definitons of admin pages are stores here.</span>&nbsp;</div></li><li><div><span class="comment"> * No parameters, returns nothing</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Fairly standard wordpress plugin API stuff for adding the admin pages, rearrange the order to rearrange the pages</span>&nbsp;</div></li><li><div><span class="comment"> * The bits to display the options page first on first use may be buggy, but tend not to stick around long enough to be identified and fixed</span>&nbsp;</div></li><li><div><span class="comment"> * if you find bugs, feel free to fix them.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the permissions are changed here, they will likewise need to be changed for the other sections of the admin that either use ajax</span>&nbsp;</div></li><li><div><span class="comment"> * or bypass the normal download system.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_show_update_link()    Decides whether or not to show the update link</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_submenu_page()         Adds a WordPress submenu page</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters()            Calls wpsc_upgrades_cap allows hooking caps for adiministrator</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters()            Calls wpsc_coupon_cap allows filtering for the coupon caps</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_options_page()         Adds a submenu to the settings page</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_action()               Calls 'admin_print_scripts.$edit_options_page prints out WPEC admin scripts</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters()            Calls 'wpsc_additional_pages' Passes the page_hooks and product_page URL</span>&nbsp;</div></li><li><div><span class="comment"> * @uses do_action()                Calls 'wpsc_add_submenu' Allows you to hook in to the WPEC menu</span>&nbsp;</div></li><li><div><span class="comment"> * @uses update_option()            Updates option given key and value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_pages() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Code to enable or disable the debug page</span>&nbsp;</div></li><li><div>  if ( isset( $_GET['wpsc_activate_debug_page'] ) ) {&nbsp;</div></li><li><div>      if ( 'true' == $_GET['wpsc_activate_debug_page'] ) {&nbsp;</div></li><li><div>          $_SESSION['wpsc_activate_debug_page'] = true;&nbsp;</div></li><li><div>      } else if ( 'false' == $_GET['wpsc_activate_debug_page'] ) {&nbsp;</div></li><li><div>              $_SESSION['wpsc_activate_debug_page'] = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add to Dashboard</span>&nbsp;</div></li><li><div>  <span class="comment">// $page_hooks[] = $purchase_log_page = add_submenu_page( 'index.php', __( 'Store Sales', 'wpsc' ), __( 'Store Sales', 'wpsc' ), 'administrator', 'wpsc-sales-logs', 'wpsc_display_sales_logs' );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wpsc_show_update_link() )&nbsp;</div></li><li><div>      $page_hooks[] = add_submenu_page( 'index.php', __( 'Update Store', 'wpsc' ), __( 'Store Update', 'wpsc' ), 'administrator', 'wpsc-update', 'wpsc_display_update_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $store_upgrades_cap = apply_filters( 'wpsc_upgrades_cap', 'administrator' );&nbsp;</div></li><li><div>  $page_hooks[] = add_submenu_page( 'index.php', __( 'Store Upgrades', 'wpsc' ), __( 'Store Upgrades', 'wpsc' ), $store_upgrades_cap, 'wpsc-upgrades', 'wpsc_display_upgrades_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $purchase_logs_cap = apply_filters( 'wpsc_purchase_logs_cap', 'administrator' );&nbsp;</div></li><li><div>  $page_hooks[] = $purchase_logs_page = add_submenu_page( 'index.php', __( 'Store Sales', 'wpsc' ), __( 'Store Sales', 'wpsc' ), $purchase_logs_cap, 'wpsc-purchase-logs', 'wpsc_display_purchase_logs_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set the base page for Products</span>&nbsp;</div></li><li><div>  $products_page = 'edit.php?post_type=wpsc-product';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $manage_coupon_cap = apply_filters( 'wpsc_coupon_cap', 'administrator' );&nbsp;</div></li><li><div>  $page_hooks[] = $edit_coupons_page = add_submenu_page( $products_page , __( 'Coupons', 'wpsc' ), __( 'Coupons', 'wpsc' ), $manage_coupon_cap, 'wpsc-edit-coupons', 'wpsc_display_coupons_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add Settings pages</span>&nbsp;</div></li><li><div>  $page_hooks[] = $edit_options_page = add_options_page( __( 'Store Settings', 'wpsc' ), __( 'Store', 'wpsc' ), 'administrator', 'wpsc-settings', 'wpsc_display_settings_page' );&nbsp;</div></li><li><div>  add_action( 'admin_print_scripts-' . $edit_options_page , 'wpsc_print_admin_scripts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Debug Page</span>&nbsp;</div></li><li><div>  if ( ( defined( 'WPSC_ADD_DEBUG_PAGE' ) && ( WPSC_ADD_DEBUG_PAGE == true ) ) || ( isset( $_SESSION['wpsc_activate_debug_page'] ) && ( true == $_SESSION['wpsc_activate_debug_page'] ) ) )&nbsp;</div></li><li><div>      $page_hooks[] = add_options_page( __( 'Store Debug', 'wpsc' ), __( 'Store Debug', 'wpsc' ), 'administrator', 'wpsc-debug', 'wpsc_debug_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $page_hooks = apply_filters( 'wpsc_additional_pages', $page_hooks, $products_page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'wpsc_add_submenu' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Include the javascript and CSS for this page</span>&nbsp;</div></li><li><div>  <span class="comment">// This is so important that I can't even express it in one line</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $page_hooks as $page_hook ) {&nbsp;</div></li><li><div>      add_action( 'load-' . $page_hook, 'wpsc_admin_include_css_and_js_refac' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $page_hook ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case $edit_options_page :&nbsp;</div></li><li><div>          add_action( 'load-' . $page_hook, 'wpsc_admin_include_optionspage_css_and_js' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case $purchase_logs_page :&nbsp;</div></li><li><div>          add_action( 'admin_head', 'wpsc_product_log_rss_feed' );&nbsp;</div></li><li><div>          add_action( 'load-' . $page_hook, 'wpsc_admin_include_purchase_logs_css_and_js' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case $edit_coupons_page :&nbsp;</div></li><li><div>          add_action( 'load-' . $page_hook, 'wpsc_admin_include_coupon_js' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Some updating code is run from here, is as good a place as any, and better than some</span>&nbsp;</div></li><li><div>  if ( ( null == get_option( 'wpsc_trackingid_subject' ) ) && ( null == get_option( 'wpsc_trackingid_message' ) ) ) {&nbsp;</div></li><li><div>      update_option( 'wpsc_trackingid_subject', __( 'Product Tracking Email', 'wpsc' ) );&nbsp;</div></li><li><div>      update_option( 'wpsc_trackingid_message', __( &quot;Track & Trace means you may track the progress of your parcel with our online parcel tracker, just login to our website and enter the following Tracking ID to view the status of your order.\n\nTracking ID: %trackid%\n&quot;, 'wpsc' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_action( 'load-' . $edit_options_page, 'wpsc_load_settings_page', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// only load the purchase log list table and page classes when it's necessary</span>&nbsp;</div></li><li><div>  <span class="comment">// also, the WPSC_Purchase_Logs_List_Table needs to be initializied before admin_header.php</span>&nbsp;</div></li><li><div>  <span class="comment">// is loaded, therefore wpsc_load_purchase_logs_page needs to do this as well</span>&nbsp;</div></li><li><div>  add_action( 'load-' . $purchase_logs_page, 'wpsc_load_purchase_logs_page', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Help tabs</span>&nbsp;</div></li><li><div>  add_action( 'load-' . $edit_options_page , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-' . $purchase_logs_page , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-' . $edit_coupons_page , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-edit.php' , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-post.php' , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-post-new.php' , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>  add_action( 'load-edit-tags.php' , 'wpsc_add_help_tabs' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// screen options on Sales Log</span>&nbsp;</div></li><li><div>  add_action( 'load-' . $purchase_logs_page , 'wpsc_add_purchase_logs_screen_option' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This function adds contextual help to all WPEC screens.</span>&nbsp;</div></li><li><div><span class="comment"> * add_contextual_help() is supported as well as $screen-&gt;add_help_tab().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_current_screen()   Returns WordPress admin screen object</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_bloginfo()         Returns information about the WordPress site</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_help_tab()         Used to add a tab to the contextual help menu</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_add_help_tabs() {&nbsp;</div></li><li><div>  $tabs = array(&nbsp;</div></li><li><div>      <span class="comment">// Store Settings Page</span>&nbsp;</div></li><li><div>      'settings_page_wpsc-settings' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Store Settings', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'category/configuring-your-store/store-settings/' =&gt; _x( 'Store Settings Overview' , 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div>              'category/configuring-your-store/payment-gateways/' =&gt; _x( 'Configuring Your Payment Gateways', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div>              'category/configuring-your-store/shipping/' =&gt; _x( 'Configuring Your Shipping Modules', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sales Log Page</span>&nbsp;</div></li><li><div>      'dashboard_page_wpsc-purchase-logs' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Sales Log', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'documentation/sales/' =&gt; _x( 'Monitor and Manage Your Sales', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Main Products Listing Admin Page (edit.php?post_type=wpsc-product)</span>&nbsp;</div></li><li><div>      'edit-wpsc-product' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Product Catalog', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'category/managing-your-store/' =&gt; _x( 'Managing Your Store', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add and Edit Product Pages</span>&nbsp;</div></li><li><div>      'wpsc-product' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Add and Edit Product', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'category/managing-your-store/' =&gt; _x( 'Managing Your Store' , 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div>              'resource/video-adding-products/' =&gt; _x( 'Video: Adding Products', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Product Tags Page</span>&nbsp;</div></li><li><div>      'edit-product_tag' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Product Tags', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt;array(&nbsp;</div></li><li><div>              'resource/video-product-tags/' =&gt; _x( 'Video: Product Tags', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Product Category Page</span>&nbsp;</div></li><li><div>      'edit-wpsc_product_category' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Product Categories', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'resource/video-creating-product-categories/' =&gt; _x( 'Video: Creating Product Categories', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Product Variations Page</span>&nbsp;</div></li><li><div>      'edit-wpsc-variation' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Product Variations', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'category/managing-your-store/' =&gt; _x( 'Managing Your Store', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Coupon Page</span>&nbsp;</div></li><li><div>      'wpsc-product_page_wpsc-edit-coupons' =&gt; array(&nbsp;</div></li><li><div>          'title' =&gt; _x( 'Coupons', 'contextual help tab', 'wpsc' ), &nbsp;</div></li><li><div>          'links' =&gt; array(&nbsp;</div></li><li><div>              'resource/video-creating-coupons/' =&gt; _x( 'Video: Creating Coupons', 'contextual help link', 'wpsc' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>  if ( array_key_exists( $screen-&gt;id, $tabs ) ) {&nbsp;</div></li><li><div>      $tab = $tabs[$screen-&gt;id];&nbsp;</div></li><li><div>      $content = '&lt;p&gt;&lt;strong&gt;' . __( 'For More Information', 'wpsc' ) . '&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>      $links = array();&nbsp;</div></li><li><div>      foreach( $tab['links'] as $link =&gt; $link_title ) {&nbsp;</div></li><li><div>          $link = 'http:<span class="comment">//docs.wpecommerce.org/' . $link;</span>&nbsp;</div></li><li><div>          $links[] = '&lt;a target=&quot;_blank&quot; href=&quot;' . esc_url( $link ) . '&quot;&gt;' . esc_html( $link_title ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $content .= '&lt;p&gt;' . implode( '&lt;br /&gt;', $links ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $screen-&gt;add_help_tab( array(&nbsp;</div></li><li><div>          'id' =&gt; $screen-&gt;id . '_help', &nbsp;</div></li><li><div>          'title' =&gt; $tab['title'], &nbsp;</div></li><li><div>          'content' =&gt; $content, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This function allows change in number of purchase logs shown on Sales Log (Screen Options).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_screen_option()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_add_purchase_logs_screen_option() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// setup Screen Option for purchase logs per page</span>&nbsp;</div></li><li><div>  add_screen_option( 'per_page', array(&nbsp;</div></li><li><div>      'label' =&gt; __(&quot;Sales Orders&quot;, 'wpsc'), &nbsp;</div></li><li><div>      'default' =&gt; 20, &nbsp;</div></li><li><div>      'option' =&gt; 'wpsc_purchases_per_page'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Includes purchase logs CSS and JS</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @acces public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()    Recommended way of adding scripts in WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_localize_script()   Adds noncing and other data to the logs script</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_include_purchase_logs_css_and_js() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-e-commerce-purchase-logs', WPSC_URL . '/wpsc-admin/js/purchase-logs.js', array( 'jquery' ), WPSC_VERSION . '.' . WPSC_MINOR_VERSION );&nbsp;</div></li><li><div>  wp_localize_script( 'wp-e-commerce-purchase-logs', 'WPSC_Purchase_Logs_Admin', array(&nbsp;</div></li><li><div>      'nonce' =&gt; wp_create_nonce( 'wpsc_purchase_logs' ), &nbsp;</div></li><li><div>      'change_purchase_log_status_nonce' =&gt; _wpsc_create_ajax_nonce( 'change_purchase_log_status' ), &nbsp;</div></li><li><div>      'purchase_log_save_tracking_id_nonce' =&gt; _wpsc_create_ajax_nonce( 'purchase_log_save_tracking_id' ), &nbsp;</div></li><li><div>      'purchase_log_send_tracking_email_nonce' =&gt; _wpsc_create_ajax_nonce( 'purchase_log_send_tracking_email' ), &nbsp;</div></li><li><div>      'sending_message' =&gt; _x( 'sending...', 'sending tracking email for purchase log', 'wpsc' ), &nbsp;</div></li><li><div>      'sent_message' =&gt; _x( 'Email Sent!', 'sending tracking email for purchase log', 'wpsc' ), &nbsp;</div></li><li><div>      'current_view' =&gt; empty( $_REQUEST['status'] ) ? 'all' : $_REQUEST['status'], &nbsp;</div></li><li><div>      'current_filter' =&gt; empty( $_REQUEST['m'] ) ? '' : $_REQUEST['m'], &nbsp;</div></li><li><div>      'current_page' =&gt; empty( $_REQUEST['paged'] ) ? '' : $_REQUEST['paged'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Purchase Log Action Links</span>&nbsp;</div></li><li><div>  wp_enqueue_script( 'wpsc-purchase-log-action-links', WPSC_URL . '/wpsc-admin/js/purchase-log-action-links.js', array( 'jquery' ), WPSC_VERSION . '.' . WPSC_MINOR_VERSION );&nbsp;</div></li><li><div>  wp_localize_script( 'wpsc-purchase-log-action-links', 'WPSC_Purchase_Log_Action_Links', array(&nbsp;</div></li><li><div>      'purchase_log_action_link_nonce' =&gt; _wpsc_create_ajax_nonce( 'purchase_log_action_link' ), &nbsp;</div></li><li><div>      'log_id' =&gt; empty( $_REQUEST['id'] ) ? '' : absint( $_REQUEST['id'] )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Loads the WPEC settings page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WPSC_Settings_Page::get_instance()   Gets instance of WPEC settings page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_load_settings_page() {&nbsp;</div></li><li><div>  require_once('settings-page.php');&nbsp;</div></li><li><div>  WPSC_Settings_Page::get_instance();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Leads the purchase logs page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WPSC_Purchase_Log_Page()     Loads the edit and view sales page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_load_purchase_logs_page() {&nbsp;</div></li><li><div>  require_once( WPSC_FILE_PATH . '/wpsc-admin/includes/purchase-log-list-table-class.php' );&nbsp;</div></li><li><div>  require_once( WPSC_FILE_PATH . '/wpsc-admin/display-sales-logs.php' );&nbsp;</div></li><li><div>  $page = new WPSC_Purchase_Log_Page();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays the WPEC purchase logs</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses do_action()  Calls 'wpsc_display_purchase_logs_page' allows hooking of the sales log page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_display_purchase_logs_page() {&nbsp;</div></li><li><div>  do_action( 'wpsc_display_purchase_logs_page' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Produces an RSS feed for the product log</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_query_arg()  Allows you to add arguments to the end of a URL</span>&nbsp;</div></li><li><div><span class="comment"> * @uses admin_url()      Retrieves URL to the WordPress admin</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_product_log_rss_feed() {&nbsp;</div></li><li><div>  echo &quot;&lt;link type='application/rss+xml' href='&quot; . add_query_arg( array( 'rss' =&gt; 'true', 'rss_key' =&gt; 'key', 'action' =&gt; 'purchase_log', 'type' =&gt; 'rss' ), admin_url( 'index.php' ) ) . &quot;' title='&quot; . esc_attr__( 'WP eCommerce Purchase Log RSS', 'wpsc' ) . &quot;' rel='alternate' /&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Includes and enqueues scripts and styles for coupons</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_style()   Includes and prints styles for WPEC in the WordPress admin</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()  Includes and prints scripts for WPEC in the WordPress admin</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_include_coupon_js() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Variables</span>&nbsp;</div></li><li><div>  $version_identifier = WPSC_VERSION . '.' . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// global js</span>&nbsp;</div></li><li><div>  _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Coupon CSS</span>&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-e-commerce-admin_2.7', WPSC_URL         . '/wpsc-admin/css/settingspage.css', false, false, 'all' );&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-e-commerce-admin', WPSC_URL         . '/wpsc-admin/css/admin.css', false, $version_identifier, 'all' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Coupon JS</span>&nbsp;</div></li><li><div>  wp_enqueue_script( 'livequery', WPSC_URL         . '/wpsc-admin/js/jquery.livequery.js', array( 'jquery' ), '1.0.3' );&nbsp;</div></li><li><div>  wp_enqueue_script( 'jquery-ui-datepicker' );&nbsp;</div></li><li><div>  wp_enqueue_style( 'jquery-ui-datepicker' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-e-commerce-admin_legacy', WPSC_URL         . '/wpsc-admin/js/admin-legacy.js', array( 'jquery', 'jquery-ui-core', 'jquery-ui-sortable', 'jquery-ui-datepicker' ), $version_identifier );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $admin_color = get_user_option( 'admin_color' );&nbsp;</div></li><li><div>  $scheme = 'classic' === $admin_color ? $admin_color : 'fresh';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_style( 'wpsc-jquery-ui-datepicker', WPSC_URL . '/wpsc-admin/css/jquery.ui.datepicker-' . $scheme . '.css', false, $version_identifier );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Includes and enqueues scripts and styles for the WPEC options page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()          Includes and prints out the JS for the WPEC options page</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_localize_script()         Sets up the JS vars needed</span>&nbsp;</div></li><li><div><span class="comment"> * @uses _wpsc_create_ajax_nonce()    Alias for wp_create_nonce, creates a random one time use token</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_current_tab_id()         Returns the current tab id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_style()           Includes and prints out the CSS for the WPEC options page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_include_optionspage_css_and_js() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version_identifier = WPSC_VERSION . &quot;.&quot; . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-e-commerce-admin-settings-page', WPSC_URL . '/wpsc-admin/js/settings-page.js', array( 'jquery-query' ), $version_identifier );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_localize_script( 'wp-e-commerce-admin-settings-page', 'WPSC_Settings_Page', array(&nbsp;</div></li><li><div>      'navigate_settings_tab_nonce' =&gt; _wpsc_create_ajax_nonce( 'navigate_settings_tab' ), &nbsp;</div></li><li><div>      'payment_gateway_settings_form_nonce' =&gt; _wpsc_create_ajax_nonce( 'payment_gateway_settings_form' ), &nbsp;</div></li><li><div>      'shipping_module_settings_form_nonce' =&gt; _wpsc_create_ajax_nonce( 'shipping_module_settings_form' ), &nbsp;</div></li><li><div>      'display_region_list_nonce' =&gt; _wpsc_create_ajax_nonce( 'display_region_list' ), &nbsp;</div></li><li><div>      'update_checkout_fields_order_nonce' =&gt; _wpsc_create_ajax_nonce( 'update_checkout_fields_order' ), &nbsp;</div></li><li><div>      'add_tax_rate_nonce' =&gt; _wpsc_create_ajax_nonce( 'add_tax_rate' ), &nbsp;</div></li><li><div>      'current_tab' =&gt; WPSC_Settings_Page::get_instance()-&gt;get_current_tab_id(), &nbsp;</div></li><li><div>      'before_unload_dialog' =&gt; __( 'The changes you made will be lost if you navigate away from this page.', 'wpsc' ), &nbsp;</div></li><li><div>      'ajax_navigate_confirm_dialog' =&gt; __( 'The changes you made will be lost if you navigate away from this page.', 'wpsc' ) . &quot;\n\n&quot; . __( 'Click OK to discard your changes, or Cancel to remain on this page.' ), &nbsp;</div></li><li><div>      'edit_field_options' =&gt; __( 'Edit Options', 'wpsc' ), &nbsp;</div></li><li><div>      'hide_edit_field_options' =&gt; __( 'Hide Options', 'wpsc' ), &nbsp;</div></li><li><div>      'delete_form_set_confirm' =&gt; __( 'Are you sure you want to delete %s? Submitted data of this form set will also be removed from sales logs.', 'wpsc' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-e-commerce-admin_2.7', WPSC_URL . '/wpsc-admin/css/settingspage.css', false, false, 'all' );&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-e-commerce-ui-tabs', WPSC_URL . '/wpsc-admin/css/jquery.ui.tabs.css', false, $version_identifier, 'all' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sets up the WPEC metaboxes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses remove_meta_box()    Removes the default taxonomy meta box so our own can be added</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_meta_bax()       Adds metaboxes to the WordPress admin interface</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_meta_boxes() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>  $pagename = 'wpsc-product';&nbsp;</div></li><li><div>  remove_meta_box( 'wpsc-variationdiv', 'wpsc-product', 'side' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//if a variation page do not show these metaboxes</span>&nbsp;</div></li><li><div>  if ( is_object( $post ) && $post-&gt;post_parent == 0 ) {&nbsp;</div></li><li><div>      add_meta_box( 'wpsc_product_variation_forms' , __( 'Variations', 'wpsc' )           , 'wpsc_product_variation_forms' , $pagename, 'normal', 'high' );&nbsp;</div></li><li><div>  } else if( is_object( $post ) && $post-&gt;post_status == &quot;inherit&quot; ) {&nbsp;</div></li><li><div>      remove_meta_box( 'tagsdiv-product_tag' , 'wpsc-product', 'core' );&nbsp;</div></li><li><div>      remove_meta_box( 'wpsc_product_categorydiv' , 'wpsc-product', 'core' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_meta_box( 'wpsc_price_control_forms', __('Product Pricing', 'wpsc'), 'wpsc_price_control_forms', $pagename, 'side', 'low' );&nbsp;</div></li><li><div>  add_meta_box( 'wpsc_stock_control_forms', __('Stock Inventory', 'wpsc'), 'wpsc_stock_control_forms', $pagename, 'side', 'low' );&nbsp;</div></li><li><div>  add_meta_box( 'wpsc_product_taxes_forms', __('Taxes', 'wpsc'), 'wpsc_product_taxes_forms', $pagename, 'side', 'low' );&nbsp;</div></li><li><div>  add_meta_box( 'wpsc_product_delivery_forms', __('Product Delivery', 'wpsc'), 'wpsc_product_delivery_forms', $pagename, 'normal', 'high' );&nbsp;</div></li><li><div>  add_meta_box( 'wpsc_product_details_forms', __('Product Details', 'wpsc'), 'wpsc_product_details_forms', $pagename, 'normal', 'high' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_footer', 'wpsc_meta_boxes' );&nbsp;</div></li><li><div>add_action( 'admin_enqueue_scripts', 'wpsc_admin_include_css_and_js_refac' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Includes the JS and CSS</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $pagehook     The pagehook for the currently viewing page, provided by the 'admin_enqueue_scripts' action</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_admin_css()               Enqueues or prints a stylesheet in the admin</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()          Enqueues the specified script</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_localize_script()         Sets up the JS vars needed</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_style()           Enqueues the styles</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_dequeue_script()          Removes a previously enqueued script by handle</span>&nbsp;</div></li><li><div><span class="comment"> * @uses _wpsc_create_ajax_nonce()    Alias for wp_create_nonce, creates a random one time use token</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_include_css_and_js_refac( $pagehook ) {&nbsp;</div></li><li><div>  global $post_type, $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'dashboard_page_wpsc-sales-logs' == $current_screen-&gt;id ) {&nbsp;</div></li><li><div>      <span class="comment">// jQuery</span>&nbsp;</div></li><li><div>      wp_enqueue_script( 'jquery' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'jquery-ui-draggable' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'jquery-ui-droppable' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'jquery-ui-sortable' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Metaboxes</span>&nbsp;</div></li><li><div>      wp_enqueue_script( 'common' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-lists' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'postbox' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version_identifier = WPSC_VERSION . &quot;.&quot; . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>  $pages = array( 'index.php', 'options-general.php', 'edit.php', 'post.php', 'post-new.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( in_array( $pagehook, $pages ) && $post_type == 'wpsc-product' )  || $current_screen-&gt;id == 'edit-wpsc_product_category' || $current_screen-&gt;id == 'dashboard_page_wpsc-sales-logs' || $current_screen-&gt;id == 'dashboard_page_wpsc-purchase-logs' || $current_screen-&gt;id == 'settings_page_wpsc-settings' || $current_screen-&gt;id == 'wpsc-product_page_wpsc-edit-coupons' || $current_screen-&gt;id == 'edit-wpsc-variation' || $current_screen-&gt;id == 'wpsc-product-variations-iframe' || ( $pagehook == 'media-upload-popup' && get_post_type( $_REQUEST['post_id'] ) == 'wpsc-product' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_script( 'livequery', WPSC_URL . '/wpsc-admin/js/jquery.livequery.js', array( 'jquery' ), '1.0.3' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-e-commerce-admin', WPSC_URL . '/wpsc-admin/js/admin.js', array( 'jquery', 'jquery-ui-core', 'jquery-ui-sortable' ), $version_identifier, false );&nbsp;</div></li><li><div>      wp_enqueue_script( 'wpsc-sortable-table', WPSC_URL . '/wpsc-admin/js/sortable-table.js', array( 'jquery' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $current_screen-&gt;id, array( 'wpsc-product', 'edit-wpsc-variation', 'wpsc-product' ) ) ) {&nbsp;</div></li><li><div>          wp_enqueue_script( 'wp-e-commerce-variations', WPSC_URL . '/wpsc-admin/js/variations.js', array( 'jquery', 'wpsc-sortable-table' ), $version_identifier );&nbsp;</div></li><li><div>          wp_localize_script(&nbsp;</div></li><li><div>              'wp-e-commerce-variations', <span class="comment">// handle</span>&nbsp;</div></li><li><div>              'WPSC_Variations', <span class="comment">// variable name</span>&nbsp;</div></li><li><div>              array(                       <span class="comment">// args</span>&nbsp;</div></li><li><div>                  'thickbox_title' =&gt; __( 'Add Media - %s', 'wpsc' ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      wp_enqueue_style( 'wp-e-commerce-admin', WPSC_URL . '/wpsc-admin/css/admin.css', false, $version_identifier, 'all' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      static $_wpsc_admin_l10n_loaded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $_wpsc_admin_l10n_loaded ) {&nbsp;</div></li><li><div>          <span class="comment">// Localize scripts</span>&nbsp;</div></li><li><div>          wp_localize_script( 'wp-e-commerce-admin', 'wpsc_adminL10n', array(&nbsp;</div></li><li><div>              'dragndrop_set' =&gt; ( get_option( 'wpsc_sort_by' ) == 'dragndrop' ? 'true' : 'false' ), &nbsp;</div></li><li><div>              'save_product_order_nonce' =&gt; _wpsc_create_ajax_nonce( 'save_product_order' ), &nbsp;</div></li><li><div>              'l10n_print_after' =&gt; 'try{convertEntities(wpsc_adminL10n);}catch(e) {};', &nbsp;</div></li><li><div>              'empty_coupon' =&gt; esc_html__( 'Please enter a coupon code.', 'wpsc' ), &nbsp;</div></li><li><div>              'bulk_edit_no_vars' =&gt; esc_html__( 'Quick Edit options are limited when editing products that have variations. You will need to edit the variations themselves.', 'wpsc' ), &nbsp;</div></li><li><div>              'wpsc_core_images_url' =&gt; WPSC_CORE_IMAGES_URL, &nbsp;</div></li><li><div>              'variation_parent_swap' =&gt; esc_html_x( 'New Variation Set', 'Variation taxonomy parent', 'wpsc' ), &nbsp;</div></li><li><div>              <span class="comment">/** translators             : This string is prepended to the 'New Variation Set' string */</span>&nbsp;</div></li><li><div>              'variation_helper_text' =&gt; esc_html_x( 'Choose the Variation Set you want to add variants to. If you\'re creating a new variation set then select', 'Variation helper text', 'wpsc' ), &nbsp;</div></li><li><div>              'variations_tutorial' =&gt; esc_html__( 'Variations allow you to create options for your products. For example, if you\'re selling T-Shirts, they will generally have a &quot;Size&quot; option. Size will be the Variation Set name, and it will be a &quot;New Variant Set&quot;. You will then create variants (small, medium, large) which will have the &quot;Variation Set&quot; of Size. Once you have made your set you can use the table on the right to manage them (edit, delete). You will be able to order your variants by dragging and dropping them within their Variation Set.', 'wpsc' ), &nbsp;</div></li><li><div>              <span class="comment">/** translators             : These strings are dynamically inserted as a drop-down for the Coupon comparison conditions */</span>&nbsp;</div></li><li><div>              'coupons_compare_or' =&gt; esc_html_x( 'OR' , 'Coupon comparison logic', 'wpsc' ), &nbsp;</div></li><li><div>              'coupons_compare_and' =&gt; esc_html_x( 'AND' , 'Coupon comparison logic', 'wpsc' ), &nbsp;</div></li><li><div>              'meta_downloads_plural' =&gt; __( ' downloads', 'live preview for downloads metabox', 'wpsc' ), &nbsp;</div></li><li><div>              'meta_downloads_singular' =&gt; __( ' download' , 'live preview for downloads metabox', 'wpsc' ), &nbsp;</div></li><li><div>              'wpsc_inline_css_error' =&gt; __( 'It is not possible to enable the inline CSS without also enabling the common CSS.' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_wpsc_admin_l10n_loaded = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $pagehook == 'wpsc-product-variations-iframe' ) {&nbsp;</div></li><li><div>      _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-e-commerce-product-variations', WPSC_URL . '/wpsc-admin/js/product-variations.js', array( 'jquery' ), $version_identifier );&nbsp;</div></li><li><div>      wp_localize_script( 'wp-e-commerce-product-variations', 'WPSC_Product_Variations', array(&nbsp;</div></li><li><div>          'product_id' =&gt; absint( $_REQUEST['product_id'] ), &nbsp;</div></li><li><div>          'add_variation_set_nonce' =&gt; _wpsc_create_ajax_nonce( 'add_variation_set' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $pagehook == 'media-upload-popup' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = get_post( $_REQUEST['post_id'] );&nbsp;</div></li><li><div>      if ( $post-&gt;post_type == 'wpsc-product' && $post-&gt;post_parent ) {&nbsp;</div></li><li><div>          _wpsc_enqueue_wp_e_commerce_admin();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_dequeue_script( 'set-post-thumbnail' );&nbsp;</div></li><li><div>          wp_enqueue_script( 'wpsc-set-post-thumbnail', WPSC_URL . '/wpsc-admin/js/set-post-thumbnail.js', array( 'jquery', 'wp-e-commerce-admin' ), $version_identifier );&nbsp;</div></li><li><div>          wp_localize_script( 'wpsc-set-post-thumbnail', 'WPSC_Set_Post_Thumbnail', array(&nbsp;</div></li><li><div>              'link_text' =&gt; __( 'Use as Product Thumbnail', 'wpsc' ), &nbsp;</div></li><li><div>              'saving' =&gt; __( 'Saving...' ), &nbsp;</div></li><li><div>              'error' =&gt; __( 'Could not set that as the thumbnail image. Try a different attachment.' ), &nbsp;</div></li><li><div>              'done' =&gt; __( 'Done' ), &nbsp;</div></li><li><div>              'nonce' =&gt; _wpsc_create_ajax_nonce( 'set_variation_product_thumbnail' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'dashboard_page_wpsc-upgrades' == $pagehook || 'dashboard_page_wpsc-update' == $pagehook )&nbsp;</div></li><li><div>      wp_enqueue_style( 'wp-e-commerce-admin', WPSC_URL . '/wpsc-admin/css/admin.css', false, $version_identifier, 'all' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds admin javascript to the wp-e-commerce-admin javascript</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8.14</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array      array containing key value pairs, keys are turned into javascript globals with thier associated values</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_admin_localizations( $localizations ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $hidden_boxes = get_option( 'wpsc_hidden_box' );&nbsp;</div></li><li><div>  $hidden_boxes = implode( ', ', (array)$hidden_boxes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $form_types_option = get_option( 'wpsc_checkout_form_fields' );&nbsp;</div></li><li><div>  if ( ! $form_types_option || ! is_array( $form_types_option ) ) {&nbsp;</div></li><li><div>      $form_types_option = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $unique_names_option = get_option( 'wpsc_checkout_unique_names' );&nbsp;</div></li><li><div>  if ( ! $unique_names_option || ! is_array( $unique_names_option ) ) {&nbsp;</div></li><li><div>      $unique_names_option = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $form_types = '';&nbsp;</div></li><li><div>  foreach ( $form_types_option as $form_type ) {&nbsp;</div></li><li><div>      $form_types .= '&lt;option value=&quot;' . $form_type . '&quot;&gt;' . $form_type . '&lt;/option&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $unique_names = '&lt;option value=&quot;-1&quot;&gt;' . __( 'Select a Unique Name', 'wpsc' ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>  foreach ( $unique_names_option as $unique_name ) {&nbsp;</div></li><li><div>      $unique_names .= '&lt;option value=&quot;' . $unique_name . '&quot;&gt;' . $unique_name . '&lt;/option&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $localizations['ajaxurl'] = admin_url( 'admin-ajax.php', 'relative' );&nbsp;</div></li><li><div>  $localizations['hidden_boxes'] = '&quot;' . esc_js( $hidden_boxes ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['IS_WP27'] = '&quot;' . esc_js( IS_WP27 ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_DELETE'] = '&quot;' . esc_js( __( 'Delete', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_TEXT'] = '&quot;' . esc_js( __( 'Text', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_EMAIL'] = '&quot;' . esc_js( __( 'Email', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_COUNTRY'] = '&quot;' . esc_js( __( 'Country', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_TEXTAREA'] = '&quot;' . esc_js( __( 'Textarea', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_HEADING'] = '&quot;' . esc_js( __( 'Heading', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_COUPON'] = '&quot;' . esc_js( __( 'Coupon', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $localizations['HTML_FORM_FIELD_TYPES'] = '&quot;' . esc_js( $form_types ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['HTML_FORM_FIELD_UNIQUE_NAMES'] = '&quot;' . esc_js( $unique_names ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_LABEL'] = '&quot;' . esc_js( __( 'Label', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_LABEL_DESC'] = '&quot;' . esc_js( __( 'Label Description', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_ITEM_NUMBER'] = '&quot;' . esc_js( __( 'Item Number', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_LIFE_NUMBER'] = '&quot;' . esc_js( __( 'Life Number', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_PRODUCT_CODE'] = '&quot;' . esc_js( __( 'Product Code', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_PDF'] = '&quot;' . esc_js( __( 'PDF', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_AND_ABOVE'] = '&quot;' . esc_js( __( ' and above', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_IF_PRICE_IS'] = '&quot;' . esc_js( __( 'If price is ', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>  $localizations['TXT_WPSC_IF_WEIGHT_IS'] = '&quot;' . esc_js( __( 'If weight is ', 'wpsc' ) ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// we only want to add these localizations once, it should happen on the first admin script load</span>&nbsp;</div></li><li><div>  remove_filter( 'wpsc_javascript_localizations', '_wpsc_admin_localizations', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $localizations;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Enqueue the admin script that applies to applies to all wpsc admin pages</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_enqueue_wp_e_commerce_admin( ) {&nbsp;</div></li><li><div>  static $already_enqueued = false;&nbsp;</div></li><li><div>  if ( ! $already_enqueued ) {&nbsp;</div></li><li><div>      $version_identifier = WPSC_VERSION . '.' . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-e-commerce-admin-js', WPSC_URL . '/wpsc-admin/js/wp-e-commerce-admin.js', false, false, $version_identifier );&nbsp;</div></li><li><div>      wp_localize_script( 'wp-e-commerce-admin-js', 'wpsc_admin_vars', wpsc_javascript_localizations() );&nbsp;</div></li><li><div>      $already_enqueued = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_menu', 'wpsc_admin_pages' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays latest activity in the Dashboard widget</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses $wpdb                          WordPress database object for queries</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_var()                      Returns single variable from the database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_html__()                   Gets translation of $text and escapes it for HTML output</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_currency_display()        Displays the currency</span>&nbsp;</div></li><li><div><span class="comment"> * @uses admin_display_total_price()    Displays the total price</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_html_x()</span>&nbsp;</div></li><li><div><span class="comment"> * @uses _n()                           Retrieves the singular or plural version</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_admin_latest_activity() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>  $totalOrders = $wpdb-&gt;get_var( &quot;SELECT COUNT(*) FROM `&quot; . WPSC_TABLE_PURCHASE_LOGS . &quot;`&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This is the right hand side for the past 30 days revenue on the wp dashboard</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  echo &quot;&lt;div id='leftDashboard'&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;strong class='dashboardHeading'&gt;&quot; . esc_html__( 'Current Month', 'wpsc' ) . &quot;&lt;/strong&gt;&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  <span class="comment">// calculates total amount of orders for the month</span>&nbsp;</div></li><li><div>  $year = date( &quot;Y&quot; );&nbsp;</div></li><li><div>  $month = date( &quot;m&quot; );&nbsp;</div></li><li><div>  $start_timestamp = mktime( 0, 0, 0, $month, 1, $year );&nbsp;</div></li><li><div>  $end_timestamp = mktime( 0, 0, 0, ( $month + 1 ), 0, $year );&nbsp;</div></li><li><div>  $sql = &quot;SELECT COUNT(*) FROM `&quot; . WPSC_TABLE_PURCHASE_LOGS . &quot;` WHERE `date` BETWEEN '$start_timestamp' AND '$end_timestamp' AND `processed` IN (2, 3, 4) ORDER BY `date` DESC&quot;;&nbsp;</div></li><li><div>  $currentMonthOrders = $wpdb-&gt;get_var( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//calculates amount of money made for the month</span>&nbsp;</div></li><li><div>  $currentMonthsSales = wpsc_currency_display( admin_display_total_price( $start_timestamp, $end_timestamp ) );&nbsp;</div></li><li><div>  echo $currentMonthsSales;&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . esc_html_x( 'Sales', 'the total value of sales in dashboard widget', 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;span class='pricedisplay'&gt;&quot;;&nbsp;</div></li><li><div>  echo $currentMonthOrders;&nbsp;</div></li><li><div>  echo &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . _n( 'Order', 'Orders', $currentMonthOrders, 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//calculates average sales amount per order for the month</span></span>&nbsp;</div></li><li><div>  if ( $currentMonthOrders &gt; 0 ) {&nbsp;</div></li><li><div>      $monthsAverage = ( (int)admin_display_total_price( $start_timestamp, $end_timestamp ) / (int)$currentMonthOrders );&nbsp;</div></li><li><div>      echo wpsc_currency_display( $monthsAverage );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//echo &quot;&lt;/span&gt;&quot;;</span></span>&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . esc_html__( 'Avg Order', 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This is the left side for the total life time revenue on the wp dashboard</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo &quot;&lt;div id='rightDashboard' &gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;strong class='dashboardHeading'&gt;&quot; . esc_html__( 'Total Income', 'wpsc' ) . &quot;&lt;/strong&gt;&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  echo wpsc_currency_display( admin_display_total_price() );&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . esc_html_x( 'Sales', 'the total value of sales in dashboard widget', 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;span class='pricedisplay'&gt;&quot;;&nbsp;</div></li><li><div>  echo $totalOrders;&nbsp;</div></li><li><div>  echo &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . _n( 'Order', 'Orders', $totalOrders, 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;p class='dashboardWidgetSpecial'&gt;&quot;;&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//calculates average sales amount per order for the month</span></span>&nbsp;</div></li><li><div>  if ( ( admin_display_total_price() &gt; 0 ) && ( $totalOrders &gt; 0 ) ) {&nbsp;</div></li><li><div>      $totalAverage = ( (int)admin_display_total_price() / (int)$totalOrders );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $totalAverage = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo wpsc_currency_display( $totalAverage );&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//echo &quot;&lt;/span&gt;&quot;;</span></span>&nbsp;</div></li><li><div>  echo &quot;&lt;span class='dashboardWidget'&gt;&quot; . esc_html__( 'Avg Order', 'wpsc' ) . &quot;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>  echo &quot;&lt;div style='clear:both'&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wpsc_admin_pre_activity', 'wpsc_admin_latest_activity' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Dashboard Widget Setup</span>&nbsp;</div></li><li><div><span class="comment"> * Adds the dashboard widgets if the user is an admin</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Since 3.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_style()           Enqueues CSS</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()          Enqueues JS</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_add_dashboard_widget()    Adds a new widget to the WordPress admin dashboard</span>&nbsp;</div></li><li><div><span class="comment"> * @uses current_user_can()           Checks the capabilities of the current user</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_dashboard_widget_setup() {&nbsp;</div></li><li><div>  $version_identifier = WPSC_VERSION . &quot;.&quot; . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>  <span class="comment">// Enqueue the styles and scripts necessary</span>&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-e-commerce-admin', WPSC_URL . '/wpsc-admin/css/admin.css', false, $version_identifier, 'all' );&nbsp;</div></li><li><div>  wp_enqueue_script( 'datepicker-ui', WPSC_URL . &quot;/wpsc-core/js/ui.datepicker.js&quot;, array( 'jquery', 'jquery-ui-core', 'jquery-ui-sortable' ), $version_identifier );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $news_cap = apply_filters( 'wpsc_dashboard_news_cap' , 'manage_options' );&nbsp;</div></li><li><div>  $sales_cap = apply_filters( 'wpsc_dashboard_sales_summary_cap' , 'manage_options' );&nbsp;</div></li><li><div>  $quarterly_sales_cap = apply_filters( 'wpsc_dashboard_quarterly_sales_cap', 'manage_options' );&nbsp;</div></li><li><div>  $monthly_sales_cap = apply_filters( 'wpsc_dashboard_monthly_sales_cap' , 'manage_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add the dashboard widgets</span>&nbsp;</div></li><li><div>  if ( current_user_can( $news_cap ) )&nbsp;</div></li><li><div>      wp_add_dashboard_widget( 'wpsc_dashboard_news', __( 'WP eCommerce News' , 'wpsc' ), 'wpsc_dashboard_news' );&nbsp;</div></li><li><div>  if ( current_user_can( $sales_cap ) )&nbsp;</div></li><li><div>      wp_add_dashboard_widget( 'wpsc_dashboard_widget', __( 'Sales Summary', 'wpsc' ), 'wpsc_dashboard_widget' );&nbsp;</div></li><li><div>  if ( current_user_can( $quarterly_sales_cap ) )&nbsp;</div></li><li><div>      wp_add_dashboard_widget( 'wpsc_quarterly_dashboard_widget', __( 'Sales by Quarter', 'wpsc' ), 'wpsc_quarterly_dashboard_widget' );&nbsp;</div></li><li><div>  if ( current_user_can( $monthly_sales_cap ) )&nbsp;</div></li><li><div>      wp_add_dashboard_widget( 'wpsc_dashboard_4months_widget', __( 'Sales by Month', 'wpsc' ), 'wpsc_dashboard_4months_widget' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sort the Dashboard widgets so ours it at the top</span>&nbsp;</div></li><li><div>  global $wp_meta_boxes;&nbsp;</div></li><li><div>  $boxes = $wp_meta_boxes['dashboard'];&nbsp;</div></li><li><div>  $normal = isset( $wp_meta_boxes['dashboard']['normal'] ) ? $wp_meta_boxes['dashboard']['normal'] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $normal_dashboard = isset( $normal['core'] ) ? $normal['core'] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Backup and delete our new dashbaord widget from the end of the array</span>&nbsp;</div></li><li><div>  $wpsc_widget_backup = array();&nbsp;</div></li><li><div>  if ( isset( $normal_dashboard['wpsc_dashboard_news'] ) ) {&nbsp;</div></li><li><div>      $wpsc_widget_backup['wpsc_dashboard_news'] = $normal_dashboard['wpsc_dashboard_news'];&nbsp;</div></li><li><div>      unset( $normal_dashboard['wpsc_dashboard_news'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( isset( $normal_dashboard['wpsc_dashboard_widget'] ) ) {&nbsp;</div></li><li><div>      $wpsc_widget_backup['wpsc_dashboard_widget'] = $normal_dashboard['wpsc_dashboard_widget'];&nbsp;</div></li><li><div>      unset( $normal_dashboard['wpsc_dashboard_widget'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( isset( $normal_dashboard['wpsc_quarterly_dashboard_widget'] ) ) {&nbsp;</div></li><li><div>      $wpsc_widget_backup['wpsc_quarterly_dashboard_widget'] = $normal_dashboard['wpsc_quarterly_dashboard_widget'];&nbsp;</div></li><li><div>      unset( $normal_dashboard['wpsc_quarterly_dashboard_widget'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( isset( $normal_dashboard['wpsc_dashboard_4months_widget'] ) ) {&nbsp;</div></li><li><div>      $wpsc_widget_backup['wpsc_dashboard_4months_widget'] = $normal_dashboard['wpsc_dashboard_4months_widget'];&nbsp;</div></li><li><div>      unset( $normal_dashboard['wpsc_dashboard_4months_widget'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Merge the two arrays together so our widget is at the beginning</span>&nbsp;</div></li><li><div>  $sorted_dashboard = array_merge( $wpsc_widget_backup, $normal_dashboard );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Save the sorted array back into the original metaboxes</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_meta_boxes['dashboard']['normal']['core'] = $sorted_dashboard;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> *     Registers the widgets on the WordPress Dashboard</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_dashboard_setup', 'wpsc_dashboard_widget_setup' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Shows the RSS feed for the WPEC dashboard widget</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses fetch_feed()             Build SimplePie object based on RSS or Atom feed from URL.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_widget_rss_output()   Display the RSS entries in a list</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_dashboard_news() {&nbsp;</div></li><li><div>  $rss = fetch_feed( 'http:<span class="comment">//wpecommerce.org/feed/?category_name=news' );</span>&nbsp;</div></li><li><div>  $args = array( 'show_author' =&gt; 1, 'show_date' =&gt; 1, 'show_summary' =&gt; 1, 'items' =&gt; 3 );&nbsp;</div></li><li><div>  wp_widget_rss_output( $rss, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets the quarterly summary of revenue</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()                 Retrieves an option from the WordPress database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses admin_display_total_price()  Displays the total price</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array        The array of prices</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_get_quarterly_summary() {&nbsp;</div></li><li><div>  $firstquarter = (int)get_option( 'wpsc_first_quart' );&nbsp;</div></li><li><div>  $secondquarter = (int)get_option( 'wpsc_second_quart' );&nbsp;</div></li><li><div>  $thirdquarter = (int)get_option( 'wpsc_third_quart' );&nbsp;</div></li><li><div>  $fourthquarter = (int)get_option( 'wpsc_fourth_quart' );&nbsp;</div></li><li><div>  $finalquarter = (int)get_option( 'wpsc_final_quart' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $results[] = admin_display_total_price( $thirdquarter + 1, $fourthquarter );&nbsp;</div></li><li><div>  $results[] = admin_display_total_price( $secondquarter + 1, $thirdquarter );&nbsp;</div></li><li><div>  $results[] = admin_display_total_price( $firstquarter + 1, $secondquarter );&nbsp;</div></li><li><div>  $results[] = admin_display_total_price( $finalquarter, $firstquarter );&nbsp;</div></li><li><div>  return $results;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Called by wp_add_dashboard_widget and ads the quarterly revenue reports to the WordPress admin dashboard</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()     Gets the specified option from database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_html_e()     Displays translated text that has been escaped for safe use in HTML</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_quarterly_dashboard_widget() {&nbsp;</div></li><li><div>  if ( get_option( 'wpsc_business_year_start' ) == false ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;form action='' method='post'&gt;&nbsp;</div></li><li><div>          &lt;label for='date_start'&gt;&lt;?php esc_html_e( 'Financial Year End' , 'wpsc' ); ?&gt;: &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;input id='date_start' type='text' class='pickdate' size='11' value='&lt;?php echo get_option( 'wpsc_last_date' ); ?&gt;' name='add_start' /&gt;&nbsp;</div></li><li><div>             &lt;!--&lt;select name='add_start[day]'&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      for ( $i = 1; $i &lt;= 31; ++$i ) {&nbsp;</div></li><li><div>          $selected = '';&nbsp;</div></li><li><div>          if ( $i == date( &quot;d&quot; ) ) {&nbsp;</div></li><li><div>              $selected = &quot;selected='selected'&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo &quot;&lt;option $selected value='$i'&gt;$i&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>                 &lt;/select&gt;&nbsp;</div></li><li><div>         &lt;select name='add_start[month]'&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>      for ( $i = 1; $i &lt;= 12; ++$i ) {&nbsp;</div></li><li><div>          $selected = '';&nbsp;</div></li><li><div>          if ( $i == (int)date( &quot;m&quot; ) ) {&nbsp;</div></li><li><div>              $selected = &quot;selected='selected'&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo &quot;&lt;option $selected value='$i'&gt;&quot; . date( &quot;M&quot;, mktime( 0, 0, 0, $i, 1, date( &quot;Y&quot; ) ) ) . &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>                 &lt;/select&gt;&nbsp;</div></li><li><div>         &lt;select name='add_start[year]'&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>      for ( $i = date( &quot;Y&quot; ); $i &lt;= ( date( &quot;Y&quot; ) + 12 ); ++$i ) {&nbsp;</div></li><li><div>          $selected = '';&nbsp;</div></li><li><div>          if ( $i == date( &quot;Y&quot; ) ) {&nbsp;</div></li><li><div>              $selected = &quot;selected='true'&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo &quot;&lt;option $selected value='$i'&gt;&quot; . $i . &quot;&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>                 &lt;/select&gt;--&gt;&nbsp;</div></li><li><div>      &lt;input type='hidden' name='wpsc_admin_action' value='wpsc_quarterly' /&gt;&nbsp;</div></li><li><div>      &lt;input type='submit' class='button primary' value='Submit' name='wpsc_submit' /&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      if ( get_option( 'wpsc_first_quart' ) != '' ) {&nbsp;</div></li><li><div>          $firstquarter = get_option( 'wpsc_first_quart' );&nbsp;</div></li><li><div>          $secondquarter = get_option( 'wpsc_second_quart' );&nbsp;</div></li><li><div>          $thirdquarter = get_option( 'wpsc_third_quart' );&nbsp;</div></li><li><div>          $fourthquarter = get_option( 'wpsc_fourth_quart' );&nbsp;</div></li><li><div>          $finalquarter = get_option( 'wpsc_final_quart' );&nbsp;</div></li><li><div>          $revenue = wpsc_get_quarterly_summary();&nbsp;</div></li><li><div>          $currsymbol = wpsc_get_currency_symbol();&nbsp;</div></li><li><div>          foreach ( $revenue as $rev ) {&nbsp;</div></li><li><div>              if ( $rev == '' ) {&nbsp;</div></li><li><div>                  $totals[] = '0.00';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $totals[] = $rev;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>          &lt;div id='box'&gt;&nbsp;</div></li><li><div>              &lt;p class='atglance'&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_left'&gt;&lt;?php esc_html_e( 'At a Glance' , 'wpsc' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_right'&gt;&lt;?php esc_html_e( 'Revenue' , 'wpsc' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;div style='clear:both'&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;p class='quarterly'&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_left'&gt;&lt;strong&gt;01&lt;/strong&gt;&nbsp; (&lt;?php echo date( 'M Y', $thirdquarter ) . ' - ' . date( 'M Y', $fourthquarter ); ?&gt;)&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_right'&gt;&lt;?php echo $currsymbol . ' ' . $totals[0]; ?&gt;&lt;/span&gt;&lt;/p&gt;&nbsp;</div></li><li><div>              &lt;p class='quarterly'&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_left'&gt;&lt;strong&gt;02&lt;/strong&gt;&nbsp; (&lt;?php echo date( 'M Y', $secondquarter ) . ' - ' . date( 'M Y', $thirdquarter ); ?&gt;)&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_right'&gt;&lt;?php echo $currsymbol . ' ' . $totals[1]; ?&gt;&lt;/span&gt;&lt;/p&gt;&nbsp;</div></li><li><div>              &lt;p class='quarterly'&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_left'&gt;&lt;strong&gt;03&lt;/strong&gt;&nbsp; (&lt;?php echo date( 'M Y', $firstquarter ) . ' - ' . date( 'M Y', $secondquarter ); ?&gt;)&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_right'&gt;&lt;?php echo $currsymbol . ' ' . $totals[2]; ?&gt;&lt;/span&gt;&lt;/p&gt;&nbsp;</div></li><li><div>              &lt;p class='quarterly'&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_left'&gt;&lt;strong&gt;04&lt;/strong&gt;&nbsp; (&lt;?php echo date( 'M Y', $finalquarter ) . ' - ' . date( 'M Y', $firstquarter ); ?&gt;)&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span class='wpsc_quart_right'&gt;&lt;?php echo $currsymbol . ' ' . $totals[3]; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;div style='clear:both'&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Called by wp_add_dashboard_widget to add the WPSC dashboard widget</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses do_action()    Calls 'wpsc_admin_pre_activity'</span>&nbsp;</div></li><li><div><span class="comment"> * @uses do_action()    Calls 'wpsc_admin_post_activity'</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_dashboard_widget() {&nbsp;</div></li><li><div>  do_action( 'wpsc_admin_pre_activity' );&nbsp;</div></li><li><div>  do_action( 'wpsc_admin_post_activity' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * END - Dashboard Widget for 2.7</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Dashboard Widget Last Four Month Sales.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses $wpdb                      WordPress database object for queries</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_results()              Gets generic multiple row results from the WordPress database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_var()                  Returns a single variable from the database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_currency_display()    Returns the currency with the display options applied</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_dashboard_4months_widget() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this_year = date( &quot;Y&quot; ); <span class="comment">//get current year and month</span>&nbsp;</div></li><li><div>  $this_month = date( &quot;n&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $months[] = mktime( 0, 0, 0, $this_month - 3, 1, $this_year ); <span class="comment">//generate  unix time stamps fo 4 last months</span>&nbsp;</div></li><li><div>  $months[] = mktime( 0, 0, 0, $this_month - 2, 1, $this_year );&nbsp;</div></li><li><div>  $months[] = mktime( 0, 0, 0, $this_month - 1, 1, $this_year );&nbsp;</div></li><li><div>  $months[] = mktime( 0, 0, 0, $this_month, 1, $this_year );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $products = $wpdb-&gt;get_results( &quot;SELECT `cart`.`prodid`, &nbsp;</div></li><li><div>   `cart`.`name`&nbsp;</div></li><li><div>   FROM `&quot; . WPSC_TABLE_CART_CONTENTS . &quot;` AS `cart`&nbsp;</div></li><li><div>   INNER JOIN `&quot; . WPSC_TABLE_PURCHASE_LOGS . &quot;` AS `logs`&nbsp;</div></li><li><div>   ON `cart`.`purchaseid` = `logs`.`id`&nbsp;</div></li><li><div>   WHERE `logs`.`processed` &gt;= 2&nbsp;</div></li><li><div>   AND `logs`.`date` &gt;= &quot; . $months[0] . &quot;&nbsp;</div></li><li><div>   GROUP BY `cart`.`prodid`&nbsp;</div></li><li><div>   ORDER BY SUM(`cart`.`price` * `cart`.`quantity`) DESC&nbsp;</div></li><li><div>   LIMIT 4&quot;, ARRAY_A ); <span class="comment">//get 4 products with top income in 4 last months.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $timeranges[0][&quot;start&quot;] = mktime( 0, 0, 0, $this_month - 3, 1, $this_year ); <span class="comment">//make array of time ranges</span>&nbsp;</div></li><li><div>  $timeranges[0][&quot;end&quot;] = mktime( 0, 0, 0, $this_month - 2, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[1][&quot;start&quot;] = mktime( 0, 0, 0, $this_month - 2, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[1][&quot;end&quot;] = mktime( 0, 0, 0, $this_month - 1, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[2][&quot;start&quot;] = mktime( 0, 0, 0, $this_month - 1, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[2][&quot;end&quot;] = mktime( 0, 0, 0, $this_month, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[3][&quot;start&quot;] = mktime( 0, 0, 0, $this_month, 1, $this_year );&nbsp;</div></li><li><div>  $timeranges[3][&quot;end&quot;] = time(); <span class="comment">// using mktime here can generate a php runtime warning</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $prod_data = array( );&nbsp;</div></li><li><div>  foreach ( (array)$products as $product ) { <span class="comment">//run through products and get each product income amounts and name</span>&nbsp;</div></li><li><div>      $sale_totals = array( );&nbsp;</div></li><li><div>      foreach ( $timeranges as $timerange ) { <span class="comment">//run through time ranges of product, and get its income over each time range</span>&nbsp;</div></li><li><div>          $prodsql = &quot;SELECT&nbsp;</div></li><li><div>          SUM(`cart`.`price` * `cart`.`quantity`) AS sum&nbsp;</div></li><li><div>          FROM `&quot; . WPSC_TABLE_CART_CONTENTS . &quot;` AS `cart`&nbsp;</div></li><li><div>          INNER JOIN `&quot; . WPSC_TABLE_PURCHASE_LOGS . &quot;` AS `logs`&nbsp;</div></li><li><div>              ON `cart`.`purchaseid` = `logs`.`id`&nbsp;</div></li><li><div>          WHERE `logs`.`processed` &gt;= 2&nbsp;</div></li><li><div>              AND `logs`.`date` &gt;= &quot; . $timerange[&quot;start&quot;] . &quot;&nbsp;</div></li><li><div>              AND `logs`.`date` &lt; &quot; . $timerange[&quot;end&quot;] . &quot;&nbsp;</div></li><li><div>              AND `cart`.`prodid` = &quot; . $product['prodid'] . &quot;&nbsp;</div></li><li><div>          GROUP BY `cart`.`prodid`&quot;; <span class="comment">//get the amount of income that current product has generaterd over current time range</span>&nbsp;</div></li><li><div>          $sale_totals[] = $wpdb-&gt;get_var( $prodsql ); <span class="comment">//push amount to array</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $prod_data[] = array(&nbsp;</div></li><li><div>          'sale_totals' =&gt; $sale_totals, &nbsp;</div></li><li><div>          'product_name' =&gt; $product['name'] ); <span class="comment">//result: array of 2: $prod_data[0] = array(income)</span>&nbsp;</div></li><li><div>      $sums = array( ); <span class="comment">//reset array    //$prod_data[1] = product name</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tablerow = 1;&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div style=&quot;padding-bottom:15px; &quot;&gt;&lt;?php esc_html_e( 'Last four months of sales on a per product basis:', 'wpsc' ); ?&gt;&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;table style=&quot;width:100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&nbsp;</div></li><li><div>      &lt;tr style=&quot;font-style:italic; color:#666;&quot; height=&quot;20&quot;&gt;&nbsp;</div></li><li><div>          &lt;td colspan=&quot;2&quot; style=&quot; font-family:\'Times New Roman\', Times, serif; font-size:15px; border-bottom:solid 1px #000;&quot;&gt;&lt;?php esc_html_e( 'At a Glance', 'wpsc' ); ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;?php foreach ( $months as $mnth ): ?&gt;&nbsp;</div></li><li><div>          &lt;td align=&quot;center&quot; style=&quot; font-family:\'Times New Roman\'; font-size:15px; border-bottom:solid 1px #000;&quot;&gt;&lt;?php echo date( &quot;M&quot;, $mnth ); ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>  &lt;?php foreach ( (array)$prod_data as $sales_data ): ?&gt;&nbsp;</div></li><li><div>      &lt;tr height=&quot;20&quot;&gt;&nbsp;</div></li><li><div>          &lt;td width=&quot;20&quot; style=&quot;font-weight:bold; color:#008080; border-bottom:solid 1px #000;&quot;&gt;&lt;?php echo $tablerow; ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;td style=&quot;border-bottom:solid 1px #000;width:60px&quot;&gt;&lt;?php echo $sales_data['product_name']; ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;?php foreach ( $sales_data['sale_totals'] as $amount ): ?&gt;&nbsp;</div></li><li><div>              &lt;td align=&quot;center&quot; style=&quot;border-bottom:solid 1px #000;&quot;&gt;&lt;?php echo wpsc_currency_display($amount); ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      $tablerow++;&nbsp;</div></li><li><div>      endforeach; ?&gt;&nbsp;</div></li><li><div>  &lt;/table&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  ob_end_flush();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//Modification to allow for multiple column layout</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @todo docs</span>&nbsp;</div></li><li><div><span class="comment"> * @param $columns</span>&nbsp;</div></li><li><div><span class="comment"> * @param $screen</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpec_two_columns( $columns, $screen ) {&nbsp;</div></li><li><div>  if ( $screen == 'toplevel_page_wpsc-edit-products' )&nbsp;</div></li><li><div>      $columns['toplevel_page_wpsc-edit-products'] = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $columns;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'screen_layout_columns', 'wpec_two_columns', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @todo docs</span>&nbsp;</div></li><li><div><span class="comment"> * @param $actions</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_fav_action( $actions ) {&nbsp;</div></li><li><div>  $actions['post-new.php?post_type=wpsc-product'] = array( 'New Product', 'manage_options' );&nbsp;</div></li><li><div>  return $actions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'favorite_actions', 'wpsc_fav_action' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Enqueue the admin scripts</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_enqueue_script()      Enqueues scripts</span>&nbsp;</div></li><li><div><span class="comment"> * @uses home_url()               Returns the base url for the site</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_print_admin_scripts() {&nbsp;</div></li><li><div>  $version_identifier = WPSC_VERSION . '.' . WPSC_MINOR_VERSION;&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-e-commerce-admin', WPSC_CORE_JS_URL . '/wp-e-commerce.js', array( 'jquery' ), $version_identifier );&nbsp;</div></li><li><div>  wp_localize_script( 'wp-e-commerce-admin', 'wpsc_ajax', wpsc_javascript_localizations() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_ajax_ie_save save changes made using inline edit</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.8</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_post_type_object()       Gets post object for given registered post type name</span>&nbsp;</div></li><li><div><span class="comment"> * @uses current_user_can()           Checks the capabilities of the current user</span>&nbsp;</div></li><li><div><span class="comment"> * @uses absint()                     Converts to a nonnegative integer</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_post()                   Gets the post object given post id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_get_object_terms()        Gets terms for given post object</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_update_post()             Updates the post in the database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_product_meta()           An alias for get_post_meta prefixes with the WPSC key</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_convert_weight()        Converts to weight format specified by user</span>&nbsp;</div></li><li><div><span class="comment"> * @uses json_encode()                Encodes array for JS</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_js()                     Escape single quotes, htmlspecialchar &quot; &lt; &gt; &, and fix line endings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @returns nothing</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_ajax_ie_save() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product_post_type = get_post_type_object( 'wpsc-product' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !current_user_can( $product_post_type-&gt;cap-&gt;edit_posts ) ) {&nbsp;</div></li><li><div>      echo '({&quot;error&quot;:&quot;' . __( 'Error: you don\'t have required permissions to edit this product', 'wpsc' ) . '&quot;, &quot;id&quot;: &quot;'. esc_js( $_POST['id'] ) .'&quot;})';&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $id = absint( $_POST['id'] );&nbsp;</div></li><li><div>  $post = get_post( $_POST['id'] );&nbsp;</div></li><li><div>  $parent = get_post( $post-&gt;post_parent );&nbsp;</div></li><li><div>  $terms = wpsc_get_product_terms( $id, 'wpsc-variation', 'name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product = array(&nbsp;</div></li><li><div>      'ID' =&gt; $_POST['id'], &nbsp;</div></li><li><div>      'post_title' =&gt; $parent-&gt;post_title . ' (' . implode( ', ', $terms ) . ')', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $id = wp_update_post( $product );&nbsp;</div></li><li><div>  if ( $id &gt; 0 ) {&nbsp;</div></li><li><div>      <span class="comment">//need parent meta to know which weight unit we are using</span>&nbsp;</div></li><li><div>      $parent_meta = get_product_meta($post-&gt;post_parent, 'product_metadata', true );&nbsp;</div></li><li><div>      $product_meta = get_product_meta( $product['ID'], 'product_metadata', true );&nbsp;</div></li><li><div>      if ( is_numeric( $_POST['weight'] ) || empty( $_POST['weight'] ) ) {&nbsp;</div></li><li><div>          $product_meta['weight'] = wpsc_convert_weight($_POST['weight'], $parent_meta['weight_unit'], 'pound', true);&nbsp;</div></li><li><div>          $product_meta['weight_unit'] = $parent_meta['weight_unit'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_product_meta( $product['ID'], 'product_metadata', $product_meta );&nbsp;</div></li><li><div>      update_product_meta( $product['ID'], 'price', (float)$_POST['price'] );&nbsp;</div></li><li><div>      update_product_meta( $product['ID'], 'special_price', (float)$_POST['special_price'] );&nbsp;</div></li><li><div>      update_product_meta( $product['ID'], 'sku', sanitize_text_field( $_POST['sku'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !is_numeric($_POST['stock']) )&nbsp;</div></li><li><div>          update_product_meta( $product['ID'], 'stock', '' );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          update_product_meta( $product['ID'], 'stock', absint( $_POST['stock'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta = get_product_meta( $id, 'product_metadata', true );&nbsp;</div></li><li><div>      $price = get_product_meta( $id, 'price', true );&nbsp;</div></li><li><div>      $special_price = get_product_meta( $id, 'special_price', true );&nbsp;</div></li><li><div>      $sku = get_product_meta( $id, 'sku', true );&nbsp;</div></li><li><div>      $sku = ( $sku )?$sku:__('N/A', 'wpsc');&nbsp;</div></li><li><div>      $stock = get_product_meta( $id, 'stock', true );&nbsp;</div></li><li><div>      $stock = ( $stock === '' )?__('N/A', 'wpsc'):$stock;&nbsp;</div></li><li><div>      $results = array( 'id' =&gt; $id, 'title' =&gt; $post-&gt;post_title, 'weight' =&gt; wpsc_convert_weight($meta['weight'], 'pound', $parent_meta['weight_unit']), 'price' =&gt; wpsc_currency_display( $price ), 'special_price' =&gt; wpsc_currency_display( $special_price ), 'sku' =&gt; $sku, 'stock' =&gt; $stock );&nbsp;</div></li><li><div>      echo '(' . json_encode( $results ) . ')';&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo '({&quot;error&quot;:&quot;' . __( 'Error updating product', 'wpsc' ) . '&quot;, &quot;id&quot;: &quot;'. esc_js( $_POST['id'] ) .'&quot;})';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @todo docs</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_meta_box  Allows addition of metaboxes to the wpsc_add_meta_boxes admin</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_add_meta_boxes() {&nbsp;</div></li><li><div>  add_meta_box( 'dashboard_right_now', __( 'Current Month', 'wpsc' ), 'wpsc_right_now', 'dashboard_page_wpsc-sales-logs', 'top' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays notice if user has Great Britain selected as their base country</span>&nbsp;</div></li><li><div><span class="comment"> * Since 3.8.9, we have deprecated Great Britain in favor of the UK</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8.9</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @link http://code.google.com/p/wp-e-commerce/issues/detail?id=1079</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()             Retrieves option from the WordPress database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_outdate_isocodes()   Returns outdated isocodes</span>&nbsp;</div></li><li><div><span class="comment"> * @uses admin_url()              Returns admin_url of the site</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string  The admin notices for deprecated countries</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_action_admin_notices_deprecated_countries_notice() {&nbsp;</div></li><li><div>  $base_country = get_option( 'base_country' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! in_array( $base_country, WPSC_Country::get_outdated_isocodes() ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $base_country ) {&nbsp;</div></li><li><div>      case 'YU':&nbsp;</div></li><li><div>          $message = __( 'Yugoslavia is no longer a valid official country name according to &lt;a href=&quot;%1$s&quot;&gt;ISO 3166&lt;/a&gt; while both Serbia and Montenegro have been added to the country list.&lt;br /&gt; As a result, we highly recommend changing your &lt;em&gt;Base Country&lt;/em&gt; to reflect this change on the &lt;a href=&quot;%2$s&quot;&gt;General Settings&lt;/a&gt; page.', 'wpsc' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'UK':&nbsp;</div></li><li><div>          $message = __( 'Prior to WP eCommerce 3.8.9, in your database, United Kingdom\'s country code is UK and you have already selected that country code as the base country. However, now that you\'re using WP eCommerce version %3$s, it is recommended that you change your base country to the official &quot;GB&quot; country code, according to &lt;a href=&quot;%1$s&quot;&gt;ISO 3166&lt;/a&gt;.&lt;br /&gt; Please go to &lt;a href=&quot;%2$s&quot;&gt;General Settings&lt;/a&gt; page to make this change.&lt;br /&gt;The legacy &quot;UK&quot; item will be marked as &quot;U.K. (legacy)&quot; on the country drop down list. Simply switch to the official &quot;United Kingdom (ISO 3166)&quot; to use the &quot;GB&quot; country code.' , 'wpsc' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'AN':&nbsp;</div></li><li><div>          $message = __( 'Netherlands Antilles is no longer a valid official country name according to &lt;a href=&quot;%1$s&quot;&gt;ISO 3166&lt;/a&gt;.&lt;br /&gt;Please consider changing your &lt;em&gt;Base Country&lt;/em&gt; to reflect this change on the &lt;a href=&quot;%2$s&quot;&gt;General Settings&lt;/a&gt; page.', 'wpsc' );&nbsp;</div></li><li><div>      case 'TP':&nbsp;</div></li><li><div>          $message = __( 'Prior to WP eCommerce 3.8.9, in your database, East Timor\'s country code is TP and you have already selected that country code as the base country. However, now that you\'re using WP eCommerce version %3$s, it is recommended that you change your base country to the official &quot;TL&quot; country code, according to &lt;a href=&quot;%1$s&quot;&gt;ISO 3166&lt;/a&gt;.&lt;br /&gt; Please go to &lt;a href=&quot;%2$s&quot;&gt;General Settings&lt;/a&gt; page to make this change.&lt;br /&gt;The legacy &quot;TP&quot; item will be marked as &quot;East Timor (legacy)&quot; on the country drop down list. Simply switch to the official &quot;Timor-Leste (ISO 3166)&quot; to use the &quot;TL&quot; country code.' , 'wpsc' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message = sprintf(&nbsp;</div></li><li><div>      <span class="comment">/** message */</span> $message, &nbsp;</div></li><li><div>      <span class="comment">/** %1$s    */</span> 'http:<span class="comment">//en.wikipedia.org/wiki/ISO_3166-1', </span>&nbsp;</div></li><li><div>      <span class="comment">/** %2$s    */</span> admin_url( 'options-general.php?page=wpsc-settings&tab=general' ), &nbsp;</div></li><li><div>      <span class="comment">/** %3$s    */</span> WPSC_VERSION&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  echo '&lt;div id=&quot;wpsc-warning&quot; class=&quot;error&quot;&gt;&lt;p&gt;' . $message . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_notices' , '_wpsc_action_admin_notices_deprecated_countries_notice' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_category_sort_order' , 'wpsc_ajax_set_category_order' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_variation_sort_order', 'wpsc_ajax_set_variation_order' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_wpsc_ie_save' , 'wpsc_ajax_ie_save' );&nbsp;</div></li><li><div>add_action( 'in_admin_header' , 'wpsc_add_meta_boxes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Deletes file associated with a product.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses $wpdb              WordPress database object for queries</span>&nbsp;</div></li><li><div><span class="comment"> * @uses prepare()          Prepares a database query by escaping</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_delete_post()   Removes a post attachment or page*</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int       $product_id     req        The id of the product</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $file_name      req        The string</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_delete_file( $product_id, $file_name ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = $wpdb-&gt;prepare( &quot;SELECT ID FROM $wpdb-&gt;posts WHERE post_title = %s AND post_parent = %d AND post_type ='wpsc-product-file'&quot;, $file_name, $product_id );&nbsp;</div></li><li><div>  $product_id_to_delete = $wpdb-&gt;get_var( $sql );&nbsp;</div></li><li><div>  return wp_delete_post( $product_id_to_delete, true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Duplicates a product</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_insert_post()                 Inserts a new post to the database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_duplicate_taxonomies()      Copy the taxonomies of a post to another post</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_duplicate_product_meta()    Copy the metadata of a post to another post</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_duplicate_children()        Copy the children of the product</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object    $post           req     The post object</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool      $new_parent_id  opt     The parent post id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|WP_Error     New post id or error</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_duplicate_product_process( $post, $new_parent_id = false ) {&nbsp;</div></li><li><div>  $new_post_date = $post-&gt;post_date;&nbsp;</div></li><li><div>  $new_post_date_gmt = get_gmt_from_date( $new_post_date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $new_post_type = $post-&gt;post_type;&nbsp;</div></li><li><div>  $post_content = $post-&gt;post_content;&nbsp;</div></li><li><div>  $post_content_filtered = $post-&gt;post_content_filtered;&nbsp;</div></li><li><div>  $post_excerpt = $post-&gt;post_excerpt;&nbsp;</div></li><li><div>  $post_title = sprintf( __( '%s (Duplicate)', 'wpsc' ), $post-&gt;post_title );&nbsp;</div></li><li><div>  $post_name = $post-&gt;post_name;&nbsp;</div></li><li><div>  $comment_status = $post-&gt;comment_status;&nbsp;</div></li><li><div>  $ping_status = $post-&gt;ping_status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_status' =&gt; $post-&gt;post_status, &nbsp;</div></li><li><div>      'post_type' =&gt; $new_post_type, &nbsp;</div></li><li><div>      'ping_status' =&gt; $ping_status, &nbsp;</div></li><li><div>      'post_parent' =&gt; $new_parent_id ? $new_parent_id : $post-&gt;post_parent, &nbsp;</div></li><li><div>      'menu_order' =&gt; $post-&gt;menu_order, &nbsp;</div></li><li><div>      'to_ping' =&gt; $post-&gt;to_ping, &nbsp;</div></li><li><div>      'pinged' =&gt; $post-&gt;pinged, &nbsp;</div></li><li><div>      'post_excerpt' =&gt; $post_excerpt, &nbsp;</div></li><li><div>      'post_title' =&gt; $post_title, &nbsp;</div></li><li><div>      'post_content' =&gt; $post_content, &nbsp;</div></li><li><div>      'post_content_filtered' =&gt; $post_content_filtered, &nbsp;</div></li><li><div>      'post_mime_type' =&gt; $post-&gt;post_mime_type, &nbsp;</div></li><li><div>      'import_id' =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'attachment' == $post-&gt;post_type )&nbsp;</div></li><li><div>      $defaults['guid'] = $post-&gt;guid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = stripslashes_deep( $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Insert the new template in the post table</span>&nbsp;</div></li><li><div>  $new_post_id = wp_insert_post($defaults);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Copy the taxonomies</span>&nbsp;</div></li><li><div>  wpsc_duplicate_taxonomies( $post-&gt;ID, $new_post_id, $post-&gt;post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Copy the meta information</span>&nbsp;</div></li><li><div>  wpsc_duplicate_product_meta( $post-&gt;ID, $new_post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'wpsc_duplicate_product', $post, $new_post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Finds children (Which includes product files AND product images), their meta values, and duplicates them.</span>&nbsp;</div></li><li><div>  wpsc_duplicate_children( $post-&gt;ID, $new_post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $new_post_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Copy the taxonomies of a post to another post</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_object_taxonomies()  Gets taxonomies for the give object</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_get_object_terms()    Gets terms for the taxonomies</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_set_object_terms()    Sets the terms for a post object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int       $id         req     ID of the post we are duping</span>&nbsp;</div></li><li><div><span class="comment"> * @param int       $new_id     req     ID of the new post</span>&nbsp;</div></li><li><div><span class="comment"> * @param string    $post_type  req     The post type we are setting</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_duplicate_taxonomies( $id, $new_id, $post_type ) {&nbsp;</div></li><li><div>  $taxonomies = get_object_taxonomies( $post_type ); <span class="comment">//array(&quot;category&quot;, &quot;post_tag&quot;);</span>&nbsp;</div></li><li><div>  foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>      $post_terms = wpsc_get_product_terms( $id, $taxonomy );&nbsp;</div></li><li><div>      foreach ( $post_terms as $post_term ) {&nbsp;</div></li><li><div>          wp_set_object_terms( $new_id, $post_term-&gt;slug, $taxonomy, true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Copy the meta information of a post to another post</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses $wpdb              WordPress database object for queries</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_results()      Gets generic multirow results from the database</span>&nbsp;</div></li><li><div><span class="comment"> * @uses prepare()          Prepares a database query making it safe</span>&nbsp;</div></li><li><div><span class="comment"> * @uses query()            Runs an SQL query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int   $id     req ID of the post we are duping</span>&nbsp;</div></li><li><div><span class="comment"> * @param int   $new_id req ID of the new post</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_duplicate_product_meta( $id, $new_id ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_meta_infos = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT meta_key, meta_value FROM $wpdb-&gt;postmeta WHERE post_id = %d&quot;, $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $post_meta_infos ) ) {&nbsp;</div></li><li><div>      $sql_query = &quot;INSERT INTO $wpdb-&gt;postmeta (post_id, meta_key, meta_value) VALUES &quot;;&nbsp;</div></li><li><div>      $values = array();&nbsp;</div></li><li><div>      foreach ( $post_meta_infos as $meta_info ) {&nbsp;</div></li><li><div>          $meta_key = $meta_info-&gt;meta_key;&nbsp;</div></li><li><div>          $meta_value = addslashes( $meta_info-&gt;meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $sql_query_sel[] = &quot;( $new_id, '$meta_key', '$meta_value' )&quot;;&nbsp;</div></li><li><div>          $values[] = $new_id;&nbsp;</div></li><li><div>          $values[] = $meta_key;&nbsp;</div></li><li><div>          $values[] = $meta_value;&nbsp;</div></li><li><div>          $values += array( $new_id, $meta_key, $meta_value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $sql_query.= implode( &quot;, &quot;, $sql_query_sel );&nbsp;</div></li><li><div>      $sql_query = $wpdb-&gt;prepare( $sql_query, $values );&nbsp;</div></li><li><div>      $wpdb-&gt;query( $sql_query );&nbsp;</div></li><li><div>      clean_post_cache( $new_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Duplicates children product and children meta</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_posts()                          Gets an array of posts given array of arguments</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpsc_duplicate_product_process()     Duplicates product</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param   int     $old_parent_id  req     Post id for old parent</span>&nbsp;</div></li><li><div><span class="comment"> * @param   int     $new_parenc_id  req     Post id for the new parent</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_duplicate_children( $old_parent_id, $new_parent_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get children products and duplicate them</span>&nbsp;</div></li><li><div>  $child_posts = get_posts( array(&nbsp;</div></li><li><div>      'post_parent' =&gt; $old_parent_id, &nbsp;</div></li><li><div>      'post_type' =&gt; 'any', &nbsp;</div></li><li><div>      'post_status' =&gt; 'any', &nbsp;</div></li><li><div>      'numberposts' =&gt; -1, &nbsp;</div></li><li><div>      'order' =&gt; 'ASC', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $child_posts as $child_post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Duplicate product images and child posts</span>&nbsp;</div></li><li><div>      if ( 'attachment' == get_post_type( $child_post ) ) {&nbsp;</div></li><li><div>          wpsc_duplicate_product_image_process( $child_post, $new_parent_id );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wpsc_duplicate_product_process( $child_post, $new_parent_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'wpsc_duplicate_product_child', $child_post, $new_parent_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Duplicates a product image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses a portion of code from media_sideload_image() in `wp-admin/includes/media.php`</span>&nbsp;</div></li><li><div><span class="comment"> * to check file before downloading from URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses  get_post_type()          Gets post type.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses  wp_get_attachment_url()  Gets attachment URL.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses  download_url()           Download file from URl to temp location.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses  is_wp_error()            Is WP error?</span>&nbsp;</div></li><li><div><span class="comment"> * @uses  media_handle_sideload()  Handle creation of new attachment and attach to post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param   object  $post           The post object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param   bool    $new_parent_id  Optional. The parent post id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return  int                     Attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_duplicate_product_image_process( $child_post, $new_parent_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'attachment' == get_post_type( $child_post ) && apply_filters( 'wpsc_duplicate_product_attachment', true, $child_post ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $file = wp_get_attachment_url( $child_post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $file ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set variables for storage, fix file filename for query strings.</span>&nbsp;</div></li><li><div>          preg_match( '/[^\?]+\.(jpe?g|jpe|gif|png)\b/i', $file, $matches );&nbsp;</div></li><li><div>          $file_array = array();&nbsp;</div></li><li><div>          $file_array['name'] = basename( $matches[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Download file to temp location.</span>&nbsp;</div></li><li><div>          $file_array['tmp_name'] = download_url( $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If error storing temporarily, return the error.</span>&nbsp;</div></li><li><div>          if ( is_wp_error( $file_array['tmp_name'] ) ) {&nbsp;</div></li><li><div>              return $file_array['tmp_name'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Do the validation and storage stuff.</span>&nbsp;</div></li><li><div>          $id = media_handle_sideload( $file_array, $new_parent_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If error storing permanently, unlink.</span>&nbsp;</div></li><li><div>          if ( is_wp_error( $id ) ) {&nbsp;</div></li><li><div>              @unlink( $file_array['tmp_name'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Re-attribute featured image</span>&nbsp;</div></li><li><div>          if ( has_post_thumbnail( $new_parent_id ) && $child_post-&gt;ID == get_post_thumbnail_id( $new_parent_id ) ) {&nbsp;</div></li><li><div>              set_post_thumbnail( $new_parent_id, $id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Copy attachment data</span>&nbsp;</div></li><li><div>          $post_data = array(&nbsp;</div></li><li><div>              'ID' =&gt; $id, &nbsp;</div></li><li><div>              'post_content' =&gt; $child_post-&gt;post_content, &nbsp;</div></li><li><div>              'post_title' =&gt; $child_post-&gt;post_title, &nbsp;</div></li><li><div>              'post_excerpt' =&gt; $child_post-&gt;post_excerpt, &nbsp;</div></li><li><div>              'post_status' =&gt; $child_post-&gt;post_status, &nbsp;</div></li><li><div>              'comment_status' =&gt; $child_post-&gt;comment_status, &nbsp;</div></li><li><div>              'ping_status' =&gt; $child_post-&gt;ping_status, &nbsp;</div></li><li><div>              'post_password' =&gt; $child_post-&gt;post_password, &nbsp;</div></li><li><div>              'post_content_filtered' =&gt; $child_post-&gt;post_content_filtered, &nbsp;</div></li><li><div>              'menu_order' =&gt; $child_post-&gt;menu_order&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_update_post( $post_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Copy alt text</span>&nbsp;</div></li><li><div>          update_post_meta( $id, '_wp_attachment_image_alt', get_post_meta( $child_post-&gt;ID, '_wp_attachment_image_alt', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @todo docs</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_query_arg()      Adds argument to the WordPress query</span>&nbsp;</div></li><li><div><span class="comment"> * @uses update_option()      Updates an option in the WordPress database given string and value</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()         Gets option from the database given string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_admin_notices_3dot8dot9() {&nbsp;</div></li><li><div>  $message = '&lt;p&gt;' . __( 'You are currently using WP eCommerce 3.8.9. There have been major changes in WP eCommerce 3.8.9, so backward-compatibility with existing plugins might not always be guaranteed. If you are unsure, please roll back to 3.8.8.5, and set up a test site with 3.8.9 to make sure WP eCommerce 3.8.9 is compatible with your existing themes and plugins.&lt;br /&gt;If you find any incompatibility issues, please &lt;a href=&quot;%1$s&quot;&gt;report them to us&lt;/a&gt; as well as the other plugins or themes\' developers.' , 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message .= &quot;\n&lt;p&gt;&quot; . __( '&lt;a href=&quot;%2$s&quot;&gt;Hide this warning&lt;/a&gt;', 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message = sprintf(&nbsp;</div></li><li><div>      $message, &nbsp;</div></li><li><div>      'https:<span class="comment">//wpecommerce.org/wp-e-commerce-3-8-9-compatibility-issues/', </span>&nbsp;</div></li><li><div>      esc_url( add_query_arg( 'dismiss_389_upgrade_notice', 1 ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;div id=&quot;wpsc-3.8.9-notice&quot; class=&quot;error&quot;&gt;' . $message . '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( isset( $_REQUEST['dismiss_389_upgrade_notice'] ) || version_compare( WPSC_VERSION, '3.8.10', '&gt;=' ) )&nbsp;</div></li><li><div>  update_option( 'wpsc_hide_3.8.9_notices', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! get_option( 'wpsc_hide_3.8.9_notices' ) )&nbsp;</div></li><li><div>  add_action( 'admin_notices', '_wpsc_admin_notices_3dot8dot9' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks to ensure that shipping is enabled, and one or both of the shipping/billing states are not displayed.</span>&nbsp;</div></li><li><div><span class="comment"> * If those condtions are met, and the user has not previously dismissed the notice, then we notify them</span>&nbsp;</div></li><li><div><span class="comment"> * that the shipping calculator now depend on those fields.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_query_arg()      Adds argument to the WordPress query</span>&nbsp;</div></li><li><div><span class="comment"> * @uses update_option()      Updates an option in the WordPress database given string and value</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()         Gets option from the database given string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_admin_notices_3_8_14_1() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( get_option( 'do_not_use_shipping' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $state_visibility = $wpdb-&gt;get_var( &quot;SELECT COUNT(active) FROM &quot; . WPSC_TABLE_CHECKOUT_FORMS . &quot; WHERE unique_name IN ( 'billingstate', 'shippingstate' ) AND active = '1'&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '2' === $state_visibility ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message = '&lt;p&gt;' . __( 'WP eCommerce has been updated, please confirm the checkout field display&nbsp;</div></li><li><div>settings are correct for your store.&lt;br&gt;&lt;br&gt;&lt;i&gt;The visibility of the checkout billing and shipping&nbsp;</div></li><li><div>drop downs that show states and provinces is now controlled by the &quot;billingstate&quot; and &quot;shippingstate&quot;&nbsp;</div></li><li><div>options set in the &lt;b&gt;Store Settings&lt;/b&gt; on the &lt;b&gt;Checkout&lt;/b&gt; tab.  Prior versions used&nbsp;</div></li><li><div>the &quot;billingcountry&quot; and &quot;shippingcountry&quot; settings to control the visibility of the drop downs.&lt;/i&gt;' , 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message .= &quot;\n&lt;p&gt;&quot; . __( '&lt;a href=&quot;%s&quot;&gt;Hide this warning&lt;/a&gt;', 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message = sprintf(&nbsp;</div></li><li><div>      $message, &nbsp;</div></li><li><div>      esc_url( add_query_arg( 'dismiss_3_8_14_1_upgrade_notice', 1 ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;div id=&quot;wpsc-3-8-14-1-notice&quot; class=&quot;error&quot;&gt;' . $message . '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( isset( $_REQUEST['dismiss_3_8_14_1_upgrade_notice'] ) || version_compare( WPSC_VERSION, '3.9', '&gt;=' ) ) {&nbsp;</div></li><li><div>  update_option( 'wpsc_hide_3_8_14_1_notices', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! get_option( 'wpsc_hide_3_8_14_1_notices' ) )&nbsp;</div></li><li><div>  add_action( 'admin_notices', '_wpsc_admin_notices_3_8_14_1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @todo docs</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_query_arg()      Adds argument to the WordPress query</span>&nbsp;</div></li><li><div><span class="comment"> * @uses update_option()      Updates an option in the WordPress database given string and value</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_option()         Gets option from the database given string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wpsc_admin_notices_3dot8dot11() {&nbsp;</div></li><li><div>  $message = '&lt;p&gt;' . __( 'You are currently using WPeC %1$s.  We introduced a regression in WPeC 3.8.10 which affects your customer user account page. We have included a fix for a &lt;a href=&quot;%2$s&quot;&gt;bug on the User Account management page&lt;/a&gt;. We are able to fix this automatically on most sites, but it appears that you have made changes to your wpsc-user-log.php page.  For that reason, we have some &lt;a href=&quot;%3$s&quot;&gt;simple instructions for you to follow&lt;/a&gt; to resolve the issue.  We are sorry for the inconvenience.' , 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message .= &quot;\n&lt;p&gt;&quot; . __( '&lt;a href=&quot;%4$s&quot;&gt;Hide this warning&lt;/a&gt;', 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $message = sprintf(&nbsp;</div></li><li><div>      $message, &nbsp;</div></li><li><div>      WPSC_VERSION, &nbsp;</div></li><li><div>      'https:<span class="comment">//github.com/wp-e-commerce/WP-e-Commerce/issues/359', </span>&nbsp;</div></li><li><div>      'http:<span class="comment">//docs.wpecommerce.org/documentation/3-8-11-user-logs', </span>&nbsp;</div></li><li><div>      esc_url( add_query_arg( 'dismiss_3811_upgrade_notice', 1 ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;div id=&quot;wpsc-3.8.11-notice&quot; class=&quot;error&quot;&gt;' . $message . '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( isset( $_REQUEST['dismiss_3811_upgrade_notice'] ) )&nbsp;</div></li><li><div>  update_option( '_wpsc_3811_user_log_notice', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( get_option( '_wpsc_3811_user_log_notice' ) )&nbsp;</div></li><li><div>  add_action( 'admin_notices', '_wpsc_admin_notices_3dot8dot11' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _wpsc_notify_google_checkout_deprecation() {&nbsp;</div></li><li><div>  $gateways = get_option( 'custom_gateway_options', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false !== ( $key = array_search( 'google', $gateways ) ) ) {&nbsp;</div></li><li><div>      unset( $gateways[ $key ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $gateways ) ) {&nbsp;</div></li><li><div>      $gateways[] = 'wpsc_merchant_testmode';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_option( 'custom_gateway_options', $gateways );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message = '&lt;p&gt;' . __( 'Effective November 20th, 2013, Google Checkout was shut down and is no longer processing payments.  You are seeing this warning because it appears that Google Checkout was your payment gateway processor.  If it was your sole processor, we have enabled the Test Gateway to ensure that orders are coming through on your site, but we highly recommend enabling a proper gateway.  If you have no preference, we highly recommend Stripe.' , 'wpsc' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;div id=&quot;wpsc-3.8.11-notice&quot; class=&quot;error&quot;&gt;' . $message . '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( in_array( 'google', get_option( 'custom_gateway_options', array() ) ) ) {&nbsp;</div></li><li><div>  add_action( 'admin_notices', '_wpsc_notify_google_checkout_deprecation' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds links to premium support and documentation on WPeCommerce.org</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $links Original links</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $links Updated links</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_support_links( $links ) {&nbsp;</div></li><li><div>  $links[] = sprintf( '&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;', _x( 'https:<span class="comment">//wpecommerce.org/premium-support/', 'Premium Support URL', 'wpsc' ), __( 'Premium Support', 'wpsc' ) );</span>&nbsp;</div></li><li><div>  $links[] = sprintf( '&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;', _x( 'http:<span class="comment">//docs.wpecommerce.org/', 'Documentation URL', 'wpsc' ), __( 'Documentation', 'wpsc' ) );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $links;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter( 'plugin_action_links_' . WPSC_PLUGIN_BASENAME, 'wpsc_support_links' );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span><a href="http://wpecommerce.org/">WP eCommerce</a></li><li><span></span>3.9.5</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>