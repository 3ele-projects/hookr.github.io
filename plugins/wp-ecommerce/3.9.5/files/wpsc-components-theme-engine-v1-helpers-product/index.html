<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.9.5" data-slug="wp-ecommerce" data-type="file" data-id="27510"><head xmlns="http://www.w3.org/1999/xhtml"><title> wpsc-components-theme-engine-v1-helpers-product | file | Wp Ecommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, wp-ecommerce, 3.9.5" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=70842f6b1115e979c62e7896cb23bfad' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wpsc-components-theme-engine-v1-helpers-product/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwpsc-components-theme-engine-v1-helpers-product%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwpsc-components-theme-engine-v1-helpers-product%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-wp-ecommerce-3.9.5-file-wpsc-components-theme-engine-v1-helpers-product","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wpsc-components-theme-engine-v1-helpers-product" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to wp-ecommerce." href="http://hookr.io/plugins/wp-ecommerce/" class="plugin"><span property="name">wp-ecommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.9.5." href="http://hookr.io/plugins/wp-ecommerce/3.9.5/" class="H_VERSION"><span property="name">3.9.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/wp-ecommerce/3.9.5/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wpsc-components-theme-engine-&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="4119"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/all/" title="All">All <span class="count badge">4119</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="836"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/hooks/" title="Hooks">Hooks <span class="count badge">836</span></a></li><li class="" data-id="action" data-count="253"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/actions/" title="Actions">Actions <span class="count badge">253</span></a></li><li class="" data-id="filter" data-count="583"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/filters/" title="Filters">Filters <span class="count badge">583</span></a></li><li class="" data-id="class" data-count="581"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/classes/" title="Classes">Classes <span class="count badge">581</span></a></li><li class="" data-id="constant" data-count="1044"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/constants/" title="Constants">Constants <span class="count badge">1044</span></a></li><li class="" data-id="function" data-count="1652"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/functions/" title="Functions">Functions <span class="count badge">1652</span></a></li><li class="" data-id="shortcode" data-count="6"><a href="http://hookr.io/plugins/wp-ecommerce/3.9.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">6</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wpsc-components/theme-engine-v1/helpers/product.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>add_action( 'save_post' , 'wpsc_refresh_page_urls', 10, 2 );&nbsp;</div></li><li><div>add_action( 'wpsc_theme_footer', 'wpsc_fancy_notifications' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( get_option( 'wpsc_replace_page_title' ) == 1 ) {&nbsp;</div></li><li><div>  add_filter( 'wp_title', 'wpsc_replace_wp_title', 10, 2 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter( 'post_type_link', 'wpsc_product_link', 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_product_link function.</span>&nbsp;</div></li><li><div><span class="comment"> * Gets the product link, hooks into post_link</span>&nbsp;</div></li><li><div><span class="comment"> * Uses the currently selected, only associated or first listed category for the term URL</span>&nbsp;</div></li><li><div><span class="comment"> * If the category slug is the same as the product slug, it prefixes the product slug with &quot;product/&quot; to counteract conflicts</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_product_link( $permalink, $post, $leavename ) {&nbsp;</div></li><li><div>  global $wp_query, $wpsc_page_titles, $wpsc_query, $wp_current_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rewritecode = array(&nbsp;</div></li><li><div>      '%wpsc_product_category%', &nbsp;</div></li><li><div>      $leavename ? '' : '%postname%', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_object( $post ) ) {&nbsp;</div></li><li><div>      <span class="comment">// In wordpress 2.9 we got a post object</span>&nbsp;</div></li><li><div>      $post_id = $post-&gt;ID;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// In wordpress 3.0 we get a post ID</span>&nbsp;</div></li><li><div>      $post_id = $post;&nbsp;</div></li><li><div>      $post = get_post( $post_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only applies to WPSC products, don't stop on permalinks of other CPTs</span>&nbsp;</div></li><li><div>  <span class="comment">// Fixes http://code.google.com/p/wp-e-commerce/issues/detail?id=271</span>&nbsp;</div></li><li><div>  if ( 'wpsc-product' !== $post-&gt;post_type ) {&nbsp;</div></li><li><div>      return $permalink;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'inherit' === $post-&gt;post_status && 0 !== $post-&gt;post_parent ) {&nbsp;</div></li><li><div>      $post_id = $post-&gt;post_parent;&nbsp;</div></li><li><div>      $post = get_post( $post_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $our_permalink_structure = $wp_rewrite-&gt;root;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// This may become customiseable later</span>&nbsp;</div></li><li><div>  $our_permalink_structure .= str_replace( basename( home_url() ), '', $wpsc_page_titles['products'] ) . &quot;/%wpsc_product_category%/%postname%/&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Mostly the same conditions used for posts, but restricted to items with a post type of &quot;wpsc-product &quot;</span>&nbsp;</div></li><li><div>  if ( $wp_rewrite-&gt;using_permalinks() && ! in_array( $post-&gt;post_status, array( 'draft', 'pending' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $product_categories = wpsc_get_product_terms( $post_id, 'wpsc_product_category' );&nbsp;</div></li><li><div>      $product_category_slugs = array( );&nbsp;</div></li><li><div>      foreach ( $product_categories as $product_category ) {&nbsp;</div></li><li><div>          $product_category_slugs[] = $product_category-&gt;slug;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// If the product is associated with multiple categories, determine which one to pick</span>&nbsp;</div></li><li><div>      if ( count( $product_categories ) == 0 ) {&nbsp;</div></li><li><div>          $category_slug = apply_filters( 'wpsc_uncategorized_product_category', 'uncategorized' );&nbsp;</div></li><li><div>      } elseif ( count( $product_categories ) &gt; 1 ) {&nbsp;</div></li><li><div>          if ( (isset( $wp_query-&gt;query_vars['products'] ) && $wp_query-&gt;query_vars['products'] != null) && in_array( $wp_query-&gt;query_vars['products'], $product_category_slugs ) ) {&nbsp;</div></li><li><div>              $product_category = $wp_query-&gt;query_vars['products'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $link = $product_categories[0]-&gt;slug;&nbsp;</div></li><li><div>              if ( ! in_array( 'wp_head', $wp_current_filter) && isset( $wpsc_query-&gt;query_vars['wpsc_product_category'] ) ) {&nbsp;</div></li><li><div>                  $current_cat = $wpsc_query-&gt;query_vars['wpsc_product_category'];&nbsp;</div></li><li><div>                  if ( in_array( $current_cat, $product_category_slugs ) )&nbsp;</div></li><li><div>                      $link = $current_cat;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $product_category = $link;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $category_slug = $product_category;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// If the product is associated with only one category, we only have one choice</span>&nbsp;</div></li><li><div>          if ( !isset( $product_categories[0] ) )&nbsp;</div></li><li><div>              $product_categories[0] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $product_category = $product_categories[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !is_object( $product_category ) )&nbsp;</div></li><li><div>              $product_category = new stdClass();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !isset( $product_category-&gt;slug ) )&nbsp;</div></li><li><div>              $product_category-&gt;slug = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $category_slug = $product_category-&gt;slug;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_name = $post-&gt;post_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( get_option( 'product_category_hierarchical_url', 0 ) ) {&nbsp;</div></li><li><div>          $selected_term = get_term_by( 'slug', $category_slug, 'wpsc_product_category' );&nbsp;</div></li><li><div>          if ( is_object( $selected_term ) ) {&nbsp;</div></li><li><div>              $term_chain = array( $selected_term-&gt;slug );&nbsp;</div></li><li><div>              while ( $selected_term-&gt;parent ) {&nbsp;</div></li><li><div>                  $selected_term = get_term( $selected_term-&gt;parent, 'wpsc_product_category' );&nbsp;</div></li><li><div>                  array_unshift( $term_chain, $selected_term-&gt;slug );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $category_slug = implode( '/', $term_chain );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( isset( $category_slug ) && empty( $category_slug ) )&nbsp;</div></li><li><div>          $category_slug = 'product';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $category_slug = apply_filters( 'wpsc_product_permalink_cat_slug', $category_slug, $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rewritereplace = array(&nbsp;</div></li><li><div>          $category_slug, &nbsp;</div></li><li><div>          $post_name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $permalink = str_replace( $rewritecode, $rewritereplace, $our_permalink_structure );&nbsp;</div></li><li><div>      $permalink = user_trailingslashit( $permalink, 'single' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $permalink = home_url( $permalink );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'wpsc_product_permalink', $permalink, $post-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_list_categories function.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $callback_function - The function name you want to use for displaying the data</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $parameters (default: null) - the additional parameters to the callback function</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $category_id. (default: 0) - The category id defaults to zero, for displaying all categories</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $level. (default: 0)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_list_categories($callback_function, $parameters = null, $category_id = 0, $level = 0) {&nbsp;</div></li><li><div>  global $wpdb, $category_data;&nbsp;</div></li><li><div>  $output = '';&nbsp;</div></li><li><div>  $category_list = get_terms('wpsc_product_category', 'hide_empty=0&parent='.$category_id);&nbsp;</div></li><li><div>  if($category_list != null) {&nbsp;</div></li><li><div>      foreach((array)$category_list as $category) {&nbsp;</div></li><li><div>          $callback_output = $callback_function($category, $level, $parameters);&nbsp;</div></li><li><div>          if(is_array($callback_output)) {&nbsp;</div></li><li><div>              $output .= array_shift($callback_output);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $output .= $callback_output;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $output .= wpsc_list_categories($callback_function, $parameters , $category-&gt;term_id, ($level+1));&nbsp;</div></li><li><div>          if(is_array($callback_output) && (isset($callback_output[1]))) {&nbsp;</div></li><li><div>              $output .= $callback_output[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* Gets the Function Parent Image link and checks whether Image should be displayed or not</span>&nbsp;</div></li><li><div><span class="comment">*</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_parent_category_image($show_thumbnails , $category_image , $width, $height, $grid=false, $show_name) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if(!$show_thumbnails) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if($category_image == WPSC_CATEGORY_URL) {&nbsp;</div></li><li><div>      if(!$show_name) return;&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;span class='wpsc_category_image item_no_image ' style='width:&lt;?php echo $width; ?&gt;px; height: &lt;?php echo $height; ?&gt;px;'&gt;&nbsp;</div></li><li><div>      &lt;span class='link_substitute' &gt;&nbsp;</div></li><li><div>          &lt;span&gt;&lt;?php _e('N/A', 'wpsc'); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/span&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  }else{&nbsp;</div></li><li><div>  ?&gt;&lt;img src='&lt;?php echo $category_image; ?&gt;' width='&lt;?php echo $width; ?&gt;' height='&lt;?php echo $height; ?&gt;' /&gt;&lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/// category template tags start here</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns true if you're on a tag that is a WPeC tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses is_tax()           Returns true/false given taxonomy and takes second parameter of term</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array|int  $term   optional    The term you could be checking for</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool             True if you are on a product_tag false if not</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_is_in_tag( $term = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return is_tax( 'product_tag', $term );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc starts category query function</span>&nbsp;</div></li><li><div><span class="comment">* gets passed the query and makes it into a global variable, then starts capturing the html for the category loop</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_start_category_query($arguments = array()) {&nbsp;</div></li><li><div>global $wpdb, $wpsc_category_query;&nbsp;</div></li><li><div>$wpsc_category_query = $arguments;&nbsp;</div></li><li><div>ob_start();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category name function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category name</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_name() {&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_name]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category description function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category description, accepts parameters for the description container</span>&nbsp;</div></li><li><div><span class="comment">* @param string starting HTML element</span>&nbsp;</div></li><li><div><span class="comment">* @param string ending HTML element</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_description($start_element = '', $end_element = '') {&nbsp;</div></li><li><div>global $wpsc_category_query;&nbsp;</div></li><li><div>$wpsc_category_query['description_container'] = array('start_element' =&gt; $start_element, 'end_element' =&gt;  $end_element);&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_description]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category url function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category URL</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_url() {&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_url]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category id function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category URL</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_id() {&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_id]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category classes function</span>&nbsp;</div></li><li><div><span class="comment">* places classes for the category including selected state</span>&nbsp;</div></li><li><div><span class="comment">*</span>&nbsp;</div></li><li><div><span class="comment">* please note that &quot;current category&quot; means the category that we are in now, </span>&nbsp;</div></li><li><div><span class="comment">* and not the category that we are printing for</span>&nbsp;</div></li><li><div><span class="comment">*</span>&nbsp;</div></li><li><div><span class="comment">* @param $category_to_print - the category for which we should print classes</span>&nbsp;</div></li><li><div><span class="comment">* @param $echo - whether to echo the result (true) or return (false)</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_classes($category_to_print = false, $echo = true) {&nbsp;</div></li><li><div>  global $wp_query, $wpdb;&nbsp;</div></li><li><div>  $result = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//if we are in wpsc category page then get the current category</span>&nbsp;</div></li><li><div>  $curr_cat = false;&nbsp;</div></li><li><div>  $term = get_query_var( 'wpsc_product_category' );&nbsp;</div></li><li><div>  if ( ! $term && get_query_var( 'taxonomy' ) == 'wpsc_product_category' )&nbsp;</div></li><li><div>      $term = get_query_var( 'term' );&nbsp;</div></li><li><div>  if ( $term )&nbsp;</div></li><li><div>      $curr_cat = get_term_by( 'slug', $term, 'wpsc_product_category' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//check if we are in wpsc category page and that we have a term_id of the category to print</span>&nbsp;</div></li><li><div>  <span class="comment">//this is done here because none of the following matters if we don't have one of those and we can</span>&nbsp;</div></li><li><div>  <span class="comment">//safely return</span>&nbsp;</div></li><li><div>  if(isset($category_to_print['term_id']) && $curr_cat) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//we will need a list of current category parents for the following if statement</span>&nbsp;</div></li><li><div>      $curr_cat_parents = wpsc_get_term_parents($curr_cat-&gt;term_id, 'wpsc_product_category');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//if current category is the same as the one we are printing - then add wpsc-current-cat class</span>&nbsp;</div></li><li><div>      if( $category_to_print['term_id'] == $curr_cat-&gt;term_id )&nbsp;</div></li><li><div>          $result = ' wpsc-current-cat ';&nbsp;</div></li><li><div>      <span class="comment">//else check if the category that we are printing is parent of current category</span>&nbsp;</div></li><li><div>      elseif ( in_array($category_to_print['term_id'], $curr_cat_parents) )&nbsp;</div></li><li><div>          $result = ' wpsc-cat-ancestor ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = apply_filters( 'wpsc_print_category_classes', $result, $category_to_print );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty ( $result ) ) {&nbsp;</div></li><li><div>      if ( $echo ) {&nbsp;</div></li><li><div>          echo $result;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $result;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print subcategory function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the subcategories, accepts parameters for the subcategories container, have this as &lt;ul&gt; and &lt;/ul&gt; if using a list</span>&nbsp;</div></li><li><div><span class="comment">* @param string starting HTML element</span>&nbsp;</div></li><li><div><span class="comment">* @param string ending HTML element</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_subcategory($start_element = '', $end_element = '') {&nbsp;</div></li><li><div>global $wpsc_category_query;&nbsp;</div></li><li><div>$wpsc_category_query['subcategory_container'] = array('start_element' =&gt; $start_element, 'end_element' =&gt;  $end_element);&nbsp;</div></li><li><div>echo &quot;[wpsc_subcategory]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>function wpsc_print_category_classes_section() {&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_classes]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category image function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category image, accepts parameters for width and height</span>&nbsp;</div></li><li><div><span class="comment">* @param integer width</span>&nbsp;</div></li><li><div><span class="comment">* @param integer height</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_image($width = null, $height = null) {&nbsp;</div></li><li><div>global $wpsc_category_query;&nbsp;</div></li><li><div>$wpsc_category_query['image_size'] = array('width' =&gt; $width, 'height' =&gt;  $height);&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_image]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc print category products count function</span>&nbsp;</div></li><li><div><span class="comment">* places the shortcode for the category product count, accepts parameters for the container element</span>&nbsp;</div></li><li><div><span class="comment">* @param string starting HTML element</span>&nbsp;</div></li><li><div><span class="comment">* @param string ending HTML element</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_print_category_products_count($start_element = '', $end_element = '') {&nbsp;</div></li><li><div>global $wpsc_category_query;&nbsp;</div></li><li><div>$wpsc_category_query['products_count'] = array('start_element' =&gt; $start_element, 'end_element' =&gt;  $end_element);&nbsp;</div></li><li><div>  echo &quot;[wpsc_category_products_count]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc end category query function</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_end_category_query() {&nbsp;</div></li><li><div>  global $wpdb, $wpsc_category_query;&nbsp;</div></li><li><div>$category_html = ob_get_clean();&nbsp;</div></li><li><div>echo wpsc_display_category_loop($wpsc_category_query, $category_html);&nbsp;</div></li><li><div>unset($GLOBALS['wpsc_category_query']);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc category loop function</span>&nbsp;</div></li><li><div><span class="comment">* This function recursively loops through the categories to display the category tree.</span>&nbsp;</div></li><li><div><span class="comment">* This function also generates a tree of categories at the same time</span>&nbsp;</div></li><li><div><span class="comment">* WARNING: as this function is recursive, be careful what you do with it.</span>&nbsp;</div></li><li><div><span class="comment">* @param array the category query</span>&nbsp;</div></li><li><div><span class="comment">* @param string the category html</span>&nbsp;</div></li><li><div><span class="comment">* @param array the category array branch, is an internal value, leave it alone.</span>&nbsp;</div></li><li><div><span class="comment">* @return string - the finished category html</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_display_category_loop($query, $category_html, &$category_branch = null) {&nbsp;</div></li><li><div>  static $category_count_data = array(); <span class="comment">// the array tree is stored in this</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( isset($query['parent_category_id']) )&nbsp;</div></li><li><div>      $category_id = absint($query['parent_category_id']);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $category_id = 0;&nbsp;</div></li><li><div>  $category_data = get_terms('wpsc_product_category', 'hide_empty=0&parent='.$category_id, OBJECT, 'display');&nbsp;</div></li><li><div>  $output ='';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// if the category branch is identical to null, make it a reference to $category_count_data</span>&nbsp;</div></li><li><div>  if($category_branch === null) {&nbsp;</div></li><li><div>      $category_branch =& $category_count_data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $allowed_tags = array('a' =&gt; array('href' =&gt; array(), 'title' =&gt; array()), 'abbr' =&gt; array('title' =&gt; array()), 'acronym' =&gt; array('title' =&gt; array()), 'code' =&gt; array(), 'em' =&gt; array(), 'strong' =&gt; array(), 'b'=&gt; array());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allowedtags = apply_filters('wpsc_category_description_allowed_tags' , $allowed_tags);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach((array)$category_data as $category_row) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// modifys the query for the next round</span>&nbsp;</div></li><li><div>      $modified_query = $query;&nbsp;</div></li><li><div>      $modified_query['parent_category_id'] = $category_row-&gt;term_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// gets the count of products associated with this category</span>&nbsp;</div></li><li><div>      $category_count = $category_row-&gt;count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sticks the category description in</span>&nbsp;</div></li><li><div>      $category_description = '';&nbsp;</div></li><li><div>      if($category_row-&gt;description != '' && ! empty( $query['description_container'] ) ) {&nbsp;</div></li><li><div>          $start_element = $query['description_container']['start_element'];&nbsp;</div></li><li><div>          $end_element = $query['description_container']['end_element'];&nbsp;</div></li><li><div>          $category_description =  $start_element.wpautop(wptexturize( wp_kses( $category_row-&gt;description, $allowedtags ))).$end_element;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Creates the list of classes on the category item</span>&nbsp;</div></li><li><div>      $category_classes = wpsc_print_category_classes((array)$category_row, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set the variables for this category</span>&nbsp;</div></li><li><div>      $category_branch[$category_row-&gt;term_id]['children'] = array();&nbsp;</div></li><li><div>      $category_branch[$category_row-&gt;term_id]['count'] = (int)$category_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Recurse into the next level of categories</span>&nbsp;</div></li><li><div>      $sub_categories = wpsc_display_category_loop($modified_query, $category_html, $category_branch[$category_row-&gt;term_id]['children']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// grab the product count from the subcategories</span>&nbsp;</div></li><li><div>      foreach((array)$category_branch[$category_row-&gt;term_id]['children'] as $child_category) {&nbsp;</div></li><li><div>          $category_branch[$category_row-&gt;term_id]['count'] += (int)$child_category['count'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// stick the category count array together here</span>&nbsp;</div></li><li><div>      <span class="comment">// this must run after the subcategories and the count of products belonging to them has been obtained</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $category_count = $category_branch[$category_row-&gt;term_id]['count'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $start_element = '';&nbsp;</div></li><li><div>      $end_element = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($query['products_count']['start_element'])) {&nbsp;</div></li><li><div>          $start_element = $query['products_count']['start_element'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($query['products_count']['end_element'])) {&nbsp;</div></li><li><div>          $end_element = $query['products_count']['end_element'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $category_count_html =  $start_element.$category_count.$end_element;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $query['subcategory_container'] ) && ! empty( $sub_categories ) ) {&nbsp;</div></li><li><div>          $start_element = $query['subcategory_container']['start_element'];&nbsp;</div></li><li><div>          $end_element = $query['subcategory_container']['end_element'];&nbsp;</div></li><li><div>          $sub_categories = $start_element.$sub_categories.$end_element;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// get the category images</span>&nbsp;</div></li><li><div>      $category_image = wpsc_place_category_image($category_row-&gt;term_id, $modified_query);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $query['image_size']['width'] ) ) {&nbsp;</div></li><li><div>          if ( ! wpsc_category_grid_view() )&nbsp;</div></li><li><div>              $width = wpsc_get_categorymeta( $category_row-&gt;term_id, 'image_width' );&nbsp;</div></li><li><div>          if ( empty( $width ) )&nbsp;</div></li><li><div>              $width = get_option( 'category_image_width' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $width = $query['image_size']['width'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $query['image_size']['height'] ) ) {&nbsp;</div></li><li><div>          if ( ! wpsc_category_grid_view() )&nbsp;</div></li><li><div>              $height = wpsc_get_categorymeta( $category_row-&gt;term_id, 'image_height' );&nbsp;</div></li><li><div>          if ( empty( $height ) )&nbsp;</div></li><li><div>              $height = get_option( 'category_image_height' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $height = $query['image_size']['height'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $category_image = wpsc_get_categorymeta($category_row-&gt;term_id, 'image');&nbsp;</div></li><li><div>      $category_image_html = '';&nbsp;</div></li><li><div>      if(($query['show_thumbnails'] == 1)) {&nbsp;</div></li><li><div>          if((!empty($category_image)) && is_file(WPSC_CATEGORY_DIR.$category_image)) {&nbsp;</div></li><li><div>              $category_image_html = &quot;&lt;img src='&quot;.WPSC_CATEGORY_URL.&quot;$category_image' alt='{$category_row-&gt;name}' title='{$category_row-&gt;name}' style='width: {$width}px; height: {$height}px;' class='wpsc_category_image' /&gt;&quot;;&nbsp;</div></li><li><div>          } elseif( isset( $query['show_name'] ) && 1 == $query['show_name']) {&nbsp;</div></li><li><div>              $category_image_html .= &quot;&lt;span class='wpsc_category_image item_no_image ' style='width: {$width}px; height: {$height}px;'&gt;\n\r&quot;;&nbsp;</div></li><li><div>              $category_image_html .= &quot;    &lt;span class='link_substitute' &gt;\n\r&quot;;&nbsp;</div></li><li><div>              $category_image_html .= &quot;        &lt;span&gt;&quot;.__('N/A', 'wpsc').&quot;&lt;/span&gt;\n\r&quot;;&nbsp;</div></li><li><div>              $category_image_html .= &quot;    &lt;/span&gt;\n\r&quot;;&nbsp;</div></li><li><div>              $category_image_html .= &quot;&lt;/span&gt;\n\r&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// get the list of products associated with this category.</span>&nbsp;</div></li><li><div>      $tags_to_replace = array('[wpsc_category_name]', &nbsp;</div></li><li><div>      '[wpsc_category_description]', &nbsp;</div></li><li><div>      '[wpsc_category_url]', &nbsp;</div></li><li><div>      '[wpsc_category_id]', &nbsp;</div></li><li><div>      '[wpsc_category_classes]', &nbsp;</div></li><li><div>      '[wpsc_category_image]', &nbsp;</div></li><li><div>      '[wpsc_subcategory]', &nbsp;</div></li><li><div>      '[wpsc_category_products_count]');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $content_to_place = array(&nbsp;</div></li><li><div>      esc_html($category_row-&gt;name), &nbsp;</div></li><li><div>      $category_description, &nbsp;</div></li><li><div>      esc_url( get_term_link( $category_row-&gt;slug, 'wpsc_product_category' ) ), &nbsp;</div></li><li><div>      $category_row-&gt;term_id, &nbsp;</div></li><li><div>      $category_classes, &nbsp;</div></li><li><div>      $category_image_html, &nbsp;</div></li><li><div>      $sub_categories, &nbsp;</div></li><li><div>      $category_count_html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Stick all the category html together and concatenate it to the previously generated HTML</span>&nbsp;</div></li><li><div>      $output .= str_replace($tags_to_replace, $content_to_place , $category_html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc category image function</span>&nbsp;</div></li><li><div><span class="comment">* if no parameters are passed, the category is not resized, otherwise it is resized to the specified dimensions</span>&nbsp;</div></li><li><div><span class="comment">* @param integer category id</span>&nbsp;</div></li><li><div><span class="comment">* @param array category query array</span>&nbsp;</div></li><li><div><span class="comment">* @return string - the category image URL, or the URL of the resized version</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_place_category_image($category_id, $query) {&nbsp;</div></li><li><div>  <span class="comment">// show the full sized image for the product, if supplied with dimensions, will resize image to those.</span>&nbsp;</div></li><li><div>      $width = (isset($query['image_size']['width'])) ? ($query['image_size']['width']) : get_option('category_image_width');&nbsp;</div></li><li><div>      $height = (isset($query['image_size']['height'])) ? ($query['image_size']['height']) : get_option('category_image_height');&nbsp;</div></li><li><div>      $image_url = &quot;index.php?wpsc_request_image=true&category_id=&quot;.$category_id.&quot;&width=&quot;.$width.&quot;&height=&quot;.$height;&nbsp;</div></li><li><div>      return htmlspecialchars($image_url);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/// category template tags end here</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc_category_url  function, makes permalink to the category or</span>&nbsp;</div></li><li><div><span class="comment">* @param integer category ID, can be 0</span>&nbsp;</div></li><li><div><span class="comment">* @param boolean permalink compatibility, adds a prefix to prevent permalink namespace conflicts</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_category_url($category_id, $permalink_compatibility = false) {&nbsp;</div></li><li><div>return get_term_link( $category_id, 'wpsc_product_category');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns true if you're on a category that is a WPeC category</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses is_tax()           Returns true/false given taxonomy and takes second parameter of term</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array|int  $term   optional    The term you could be checking for</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool             True if you are on a wpsc_product_category false if not</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_is_in_category( $term = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return is_tax( 'wpsc_product_category', $term );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Uses a category's, (in the wpsc_product_category taxonomy), slug to find its</span>&nbsp;</div></li><li><div><span class="comment"> * ID, then returns it.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $category_slug The slug of the category who's ID we want.</span>&nbsp;</div></li><li><div><span class="comment"> * @return (int | bool) Returns the integer ID of the category if found, or a</span>&nbsp;</div></li><li><div><span class="comment"> * boolean false if the category is not found.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @todo Cache the results of this somewhere.  It could save quite a few trips</span>&nbsp;</div></li><li><div><span class="comment"> * to the MySQL server.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_category_id($category_slug = '') {&nbsp;</div></li><li><div>  if(empty($category_slug))&nbsp;</div></li><li><div>      $category_slug = get_query_var( 'wpsc_product_category' );&nbsp;</div></li><li><div>  elseif(array_key_exists('wpsc_product_category', $_GET))&nbsp;</div></li><li><div>      $category_slug = $_GET['wpsc_product_category'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if(!empty($category_slug)) {&nbsp;</div></li><li><div>      $category = get_term_by('slug', $category_slug, 'wpsc_product_category');&nbsp;</div></li><li><div>      if(!empty($category-&gt;term_id)) {&nbsp;</div></li><li><div>          return $category-&gt;term_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">* wpsc_category_description function, Gets the category description</span>&nbsp;</div></li><li><div><span class="comment">* @param integer category ID, can be 0</span>&nbsp;</div></li><li><div><span class="comment">* @return string category description</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_category_description($category_id = null) {&nbsp;</div></li><li><div>if($category_id &lt; 1)&nbsp;</div></li><li><div>  $category_id = wpsc_category_id();&nbsp;</div></li><li><div>$category = get_term_by( 'id', $category_id, 'wpsc_product_category' );&nbsp;</div></li><li><div>return $category ? $category-&gt;description : '';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpsc_category_name($category_id = null) {&nbsp;</div></li><li><div>  if ( $category_id &lt; 1 )&nbsp;</div></li><li><div>      $category_id = wpsc_category_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $category = get_term_by( 'id', $category_id, 'wpsc_product_category' );&nbsp;</div></li><li><div>  return $category ? $category-&gt;name : '';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function nzshpcrt_display_categories_groups() {&nbsp;</div></li><li><div>  return '';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** wpsc list subcategories function</span>&nbsp;</div></li><li><div><span class="comment">      used to get an array of all the subcategories of a category.</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function wpsc_list_subcategories($category_id = null) {&nbsp;</div></li><li><div>global $wpdb, $category_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $category_list = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT `id` FROM `&quot;.WPSC_TABLE_PRODUCT_CATEGORIES.&quot;` WHERE `category_parent` = %d&quot;, $category_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if($category_list != null) {&nbsp;</div></li><li><div>  foreach($category_list as $subcategory_id) {&nbsp;</div></li><li><div>          $category_list = array_merge((array)$category_list, (array)wpsc_list_subcategories($subcategory_id));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $category_list;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_show_category_thumbnails function</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool - whether to show category thumbnails or not</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_show_category_thumbnails() {&nbsp;</div></li><li><div>  if(get_option('show_category_thumbnails') && wpsc_category_image())&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_show_category_description function</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool - whether to show category description or not</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_show_category_description() {&nbsp;</div></li><li><div>  return get_option( 'wpsc_category_description' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc buy now button code products function</span>&nbsp;</div></li><li><div><span class="comment"> * Sorry about the ugly code, this is just to get the functionality back, buy now will soon be overhauled, and this function will then be completely different</span>&nbsp;</div></li><li><div><span class="comment"> * @return string - html displaying one or more products</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_buy_now_button( $product_id, $replaced_shortcode = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product_id = absint( $product_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product = get_post( $product_id );&nbsp;</div></li><li><div>  $supported_gateways = array( 'wpsc_merchant_paypal_standard', 'paypal_multiple' );&nbsp;</div></li><li><div>  $selected_gateways = get_option( 'custom_gateway_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $replaced_shortcode ) {&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array( 'wpsc_merchant_paypal_standard', (array) $selected_gateways ) ) {&nbsp;</div></li><li><div>      if ( $product_id &gt; 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post_meta = get_post_meta( $product_id, '_wpsc_product_metadata', true );&nbsp;</div></li><li><div>          $shipping = isset( $post_meta['shipping'] ) ? $post_meta['shipping']['local'] : '';&nbsp;</div></li><li><div>          $price = get_post_meta( $product_id, '_wpsc_price', true );&nbsp;</div></li><li><div>          $special_price = get_post_meta( $product_id, '_wpsc_special_price', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $special_price )&nbsp;</div></li><li><div>              $price = $special_price;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( wpsc_uses_shipping ( ) ) {&nbsp;</div></li><li><div>              $handling = get_option( 'base_local_shipping' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $handling = $shipping;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $has_variants = wpsc_product_has_variations( $product_id ) || ! wpsc_product_has_stock( $product_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $src = apply_filters( 'wpsc_buy_now_button_src', _x( 'https:<span class="comment">//www.paypal.com/en_US/i/btn/btn_buynow_LG.gif', 'PayPal Buy Now Button', 'wpsc' ) );</span>&nbsp;</div></li><li><div>          $classes = apply_filters( 'wpsc_buy_now_button_class', &quot;wpsc-buy-now-form wpsc-buy-now-form-{$product_id}&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $classes_array = array_map( 'sanitize_html_class', explode( ' ', $classes ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $classes = implode( ' ', $classes_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $button_html = sprintf( '&lt;input%1$s class=&quot;wpsc-buy-now-button wpsc-buy-now-button-%2$s&quot; type=&quot;image&quot; name=&quot;submit&quot; border=&quot;0&quot; src=&quot;%3$s&quot; alt=&quot;%4$s&quot; /&gt;', &nbsp;</div></li><li><div>              disabled( $has_variants, true, false ), &nbsp;</div></li><li><div>              esc_attr( $product_id ), &nbsp;</div></li><li><div>              esc_url( $src ), &nbsp;</div></li><li><div>              esc_attr__( 'PayPal - The safer, easier way to pay online', 'wpsc' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $button_html = apply_filters( 'wpsc_buy_now_button_html', $button_html, $product_id );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>          &lt;form class=&quot;&lt;?php echo( $classes ); ?&gt;&quot; id=&quot;buy-now-product_&lt;?php echo $product_id; ?&gt;&quot; target=&quot;paypal&quot; action=&quot;&lt;?php echo esc_url( home_url() ); ?&gt;&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;hidden&quot; name=&quot;wpsc_buy_now_callback&quot; value=&quot;1&quot; /&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;hidden&quot; name=&quot;product_id&quot; value=&quot;&lt;?php echo esc_attr( $product_id ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>              if ( $has_variants ) :&nbsp;</div></li><li><div>                  <span class="comment">// grab the variation form fields here</span>&nbsp;</div></li><li><div>                  $wpsc_variations = new wpsc_variations( $product_id );&nbsp;</div></li><li><div>                  while ( wpsc_have_variation_groups() ) : wpsc_the_variation_group();&nbsp;</div></li><li><div>                      printf('&lt;input type=&quot;hidden&quot; class=&quot;variation-value&quot; name=&quot;variation[%1$d]&quot; id=&quot;%2$s&quot; value=&quot;0&quot;/&gt;', wpsc_vargrp_id(), wpsc_vargrp_form_id() );&nbsp;</div></li><li><div>                  endwhile;&nbsp;</div></li><li><div>              endif; <span class="comment">/** END wpsc_product_has_variations */</span>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>              &lt;?php if ( get_option( 'multi_add' ) ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;label for=&quot;quantity&quot;&gt;&lt;?php esc_html_e( 'Quantity', 'wpsc' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;text&quot; size=&quot;4&quot; id=&quot;quantity&quot; class=&quot;wpsc-buy-now-quantity&quot; name=&quot;quantity&quot; value=&quot;&quot; /&gt;&lt;br /&gt;&nbsp;</div></li><li><div>              &lt;?php else: ?&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;hidden&quot; name=&quot;quantity&quot; class=&quot;wpsc-buy-now-quantity&quot; value=&quot;1&quot; /&gt;&nbsp;</div></li><li><div>              &lt;?php endif ?&gt;&nbsp;</div></li><li><div>              &lt;?php echo $button_html; ?&gt;&nbsp;</div></li><li><div>              &lt;img alt='' border='0' width='1' height='1' src='&lt;?php echo esc_url( _x( 'https:<span class="comment">//www.paypal.com/en_US/i/scr/pixel.gif', 'PayPal Pixel', 'wpsc' ) ); ?&gt;' /&gt;</span>&nbsp;</div></li><li><div>          &lt;/form&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $replaced_shortcode ) {&nbsp;</div></li><li><div>      return ob_get_clean();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays products that were bought along with the product defined by $product_id.</span>&nbsp;</div></li><li><div><span class="comment"> * This functionality will be deprecated and be provided by a plugin in a future version.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_also_bought( $product_id ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( get_option( 'wpsc_also_bought' ) == 0 ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// To be made customiseable in a future release</span>&nbsp;</div></li><li><div>  $also_bought_limit = 3;&nbsp;</div></li><li><div>  $element_widths = 96;&nbsp;</div></li><li><div>  $image_display_height = 96;&nbsp;</div></li><li><div>  $image_display_width = 96;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Filter will be used by a plugin to provide 'Also Bought' functionality when this is deprecated from core.</span>&nbsp;</div></li><li><div>  <span class="comment">// Filter is currently private and should not be used by plugin/theme devs as it may only be temporary.</span>&nbsp;</div></li><li><div>  $output = apply_filters( '_wpsc_also_bought', '', $product_id );&nbsp;</div></li><li><div>  if ( ! empty( $output ) ) {&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If above filter returns output then the following is ignore and can be deprecated in future.</span>&nbsp;</div></li><li><div>  $also_bought = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT `&quot; . $wpdb-&gt;posts . &quot;`.* FROM `&quot; . WPSC_TABLE_ALSO_BOUGHT . &quot;`, `&quot; . $wpdb-&gt;posts . &quot;` WHERE `selected_product`= %d AND `&quot; . WPSC_TABLE_ALSO_BOUGHT . &quot;`.`associated_product` = `&quot; . $wpdb-&gt;posts . &quot;`.`id` AND `&quot; . $wpdb-&gt;posts . &quot;`.`post_status` IN('publish', 'protected') ORDER BY `&quot; . WPSC_TABLE_ALSO_BOUGHT . &quot;`.`quantity` DESC LIMIT $also_bought_limit&quot;, $product_id ), ARRAY_A );&nbsp;</div></li><li><div>  if ( is_array( $also_bought ) && count( $also_bought ) &gt; 0 ) {&nbsp;</div></li><li><div>      $output .= '&lt;h2 class=&quot;prodtitles wpsc_also_bought&quot;&gt;' . __( 'People who bought this item also bought', 'wpsc' ) . '&lt;/h2&gt;';&nbsp;</div></li><li><div>      $output .= '&lt;div class=&quot;wpsc_also_bought&quot;&gt;';&nbsp;</div></li><li><div>      foreach ( $also_bought as $also_bought_data ) {&nbsp;</div></li><li><div>          $output .= '&lt;div class=&quot;wpsc_also_bought_item&quot; style=&quot;width: ' . $element_widths . 'px;&quot;&gt;';&nbsp;</div></li><li><div>          if ( get_option( 'show_thumbnails' ) == 1 ) {&nbsp;</div></li><li><div>              $image_path = wpsc_the_product_thumbnail( $image_display_width, $image_display_height, $also_bought_data['ID'] );&nbsp;</div></li><li><div>              if ( $image_path ) {&nbsp;</div></li><li><div>                  $output .= '&lt;a href=&quot;' . esc_attr( get_permalink( $also_bought_data['ID'] ) ) . '&quot; class=&quot;preview_link&quot; rel=&quot;' . esc_attr( sanitize_html_class( get_the_title( $also_bought_data['ID'] ) ) ) . '&quot;&gt;';&nbsp;</div></li><li><div>                  $output .= '&lt;img src=&quot;' . esc_attr( $image_path ) . '&quot; id=&quot;product_image_' . $also_bought_data['ID'] . '&quot; class=&quot;product_image&quot; /&gt;';&nbsp;</div></li><li><div>                  $output .= '&lt;/a&gt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( get_option( 'product_image_width' ) != '' ) {&nbsp;</div></li><li><div>                      $width_and_height = 'width=&quot;' . $image_display_height . '&quot; height=&quot;' . $image_display_height . '&quot; ';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $width_and_height = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $output .= '&lt;img src=&quot;' . WPSC_CORE_THEME_URL . '/wpsc-images/noimage.png&quot; title=&quot;' . esc_attr( get_the_title( $also_bought_data['ID'] ) ) . '&quot; alt=&quot;' . esc_attr( get_the_title( $also_bought_data['ID'] ) ) . '&quot; id=&quot;product_image_' . $also_bought_data['ID'] . '&quot; class=&quot;product_image&quot; ' . $width_and_height . '/&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $output .= '&lt;a class=&quot;wpsc_product_name&quot; href=&quot;' . get_permalink( $also_bought_data['ID'] ) . '&quot;&gt;' . get_the_title( $also_bought_data['ID'] ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>          if ( ! wpsc_product_is_donation( $also_bought_data['ID'] ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Ideally use the wpsc_the_product_price_display() function here but needs some tweaking</span>&nbsp;</div></li><li><div>              $price = get_product_meta( $also_bought_data['ID'], 'price', true );&nbsp;</div></li><li><div>              $special_price = get_product_meta( $also_bought_data['ID'], 'special_price', true );&nbsp;</div></li><li><div>              if ( ! empty( $special_price ) ) {&nbsp;</div></li><li><div>                  $output .= '&lt;span style=&quot;text-decoration: line-through;&quot;&gt;' . wpsc_currency_display( $price ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>                  $output .= wpsc_currency_display( $special_price );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $output .= wpsc_currency_display( $price );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>      $output .= '&lt;br clear=&quot;all&quot; /&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the URL of the loading animation image.</span>&nbsp;</div></li><li><div><span class="comment"> * Can be filtered using the wpsc_loading_animation_url filter.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_loading_animation_url() {&nbsp;</div></li><li><div>  return apply_filters( 'wpsc_loading_animation_url', WPSC_CORE_THEME_URL . 'wpsc-images/indicator.gif' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function fancy_notifications() {&nbsp;</div></li><li><div>  return wpsc_fancy_notifications( true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>function wpsc_fancy_notifications( $return = false ) {&nbsp;</div></li><li><div>  static $already_output = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $already_output )&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $output = &quot;&quot;;&nbsp;</div></li><li><div>  if ( get_option( 'fancy_notifications' ) == 1 ) {&nbsp;</div></li><li><div>      $output = &quot;&quot;;&nbsp;</div></li><li><div>      $output .= &quot;&lt;div id='fancy_notification'&gt;\n\r&quot;;&nbsp;</div></li><li><div>      $output .= &quot;  &lt;div id='loading_animation'&gt;\n\r&quot;;&nbsp;</div></li><li><div>      $output .= '&lt;img id=&quot;fancy_notificationimage&quot; title=&quot;' . esc_attr__( 'Loading', 'wpsc' ) . '&quot; alt=&quot;' . esc_attr__( 'Loading', 'wpsc' ) . '&quot; src=&quot;' . wpsc_loading_animation_url() . '&quot; /&gt;' . __( 'Updating', 'wpsc' ) . &quot;...\n\r&quot;;&nbsp;</div></li><li><div>      $output .= &quot;  &lt;/div&gt;\n\r&quot;;&nbsp;</div></li><li><div>      $output .= &quot;  &lt;div id='fancy_notification_content'&gt;\n\r&quot;;&nbsp;</div></li><li><div>      $output .= &quot;  &lt;/div&gt;\n\r&quot;;&nbsp;</div></li><li><div>      $output .= &quot;&lt;/div&gt;\n\r&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $already_output = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $return )&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function fancy_notification_content( $cart_messages ) {&nbsp;</div></li><li><div>  $siteurl = get_option( 'siteurl' );&nbsp;</div></li><li><div>  $output = '';&nbsp;</div></li><li><div>  foreach ( (array)$cart_messages as $cart_message ) {&nbsp;</div></li><li><div>      $output .= &quot;&lt;span&gt;&quot; . $cart_message . &quot;&lt;/span&gt;&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $output .= &quot;&lt;a href='&quot; . get_option( 'shopping_cart_url' ) . &quot;' class='go_to_checkout'&gt;&quot; . __( 'Go to Checkout', 'wpsc' ) . &quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  $output .= &quot;&lt;a href='#' onclick='jQuery(\&quot;#fancy_notification\&quot;).css(\&quot;display\&quot;, \&quot;none\&quot;); return false;' class='continue_shopping'&gt;&quot; . __( 'Continue Shopping', 'wpsc' ) . &quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc product url function, gets the URL of a product, </span>&nbsp;</div></li><li><div><span class="comment"> * Deprecated, all parameters past the first unused. use get_permalink</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpsc_product_url( $product_id, $category_id = null, $escape = true ) {&nbsp;</div></li><li><div>  $post = get_post($product_id);&nbsp;</div></li><li><div>  if ( isset($post-&gt;post_parent) && $post-&gt;post_parent &gt; 0) {&nbsp;</div></li><li><div>      return get_permalink($post-&gt;post_parent);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return get_permalink($product_id);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function external_link( $product_id ) {&nbsp;</div></li><li><div>  $link = get_product_meta( $product_id, 'external_link', true );&nbsp;</div></li><li><div>  if ( !stristr( $link, 'http:<span class="comment">//' ) ) {</span>&nbsp;</div></li><li><div>      $link = 'http:<span class="comment">//' . $link;</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $target = wpsc_product_external_link_target( $product_id );&nbsp;</div></li><li><div>  $output .= &quot;&lt;input class='wpsc_buy_button' type='button' value='&quot; . wpsc_product_external_link_text( $product_id, __( 'Buy Now', 'wpsc' ) ) . &quot;' onclick='return gotoexternallink(\&quot;$link\&quot;, \&quot;$target\&quot;)'&gt;&quot;;&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * wpsc_refresh_page_urls</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Refresh page urls when pages are updated</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int    $post_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param  object $post</span>&nbsp;</div></li><li><div><span class="comment"> * @uses   wpsc_update_permalink_slugs()</span>&nbsp;</div></li><li><div><span class="comment"> * @return int    $post_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpsc_refresh_page_urls( $post_id, $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! current_user_can( 'manage_options' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'page' != $post-&gt;post_type )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! in_array( $post-&gt;post_status, array( 'publish', 'private' ) ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wpsc_update_permalink_slugs();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $post_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpsc_replace_wp_title( $input ) {&nbsp;</div></li><li><div>  global $wpdb, $wp_query;&nbsp;</div></li><li><div>  $output = wpsc_obtain_the_title();&nbsp;</div></li><li><div>  if ( $output != null ) {&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $input;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpsc_replace_bloginfo_title( $input, $show ) {&nbsp;</div></li><li><div>  global $wpdb, $wp_query;&nbsp;</div></li><li><div>  if ( $show == 'description' ) {&nbsp;</div></li><li><div>      $output = wpsc_obtain_the_title();&nbsp;</div></li><li><div>      if ( $output != null ) {&nbsp;</div></li><li><div>          return $output;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $input;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span><a href="http://wpecommerce.org/">WP eCommerce</a></li><li><span></span>3.9.5</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>