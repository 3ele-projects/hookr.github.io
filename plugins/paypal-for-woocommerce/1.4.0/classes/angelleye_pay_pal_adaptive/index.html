<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.4.0" data-slug="paypal-for-woocommerce" data-type="class" data-id="80515"><head xmlns="http://www.w3.org/1999/xhtml"><title> angelleye_paypal_adaptive | class | Paypal For Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Angelleye_PayPal_Adaptive, class, plugin, paypal-for-woocommerce, 1.4.0" /><meta name="description" content="Angell EYE PayPal Adaptive Payments Class An open source PHP library written to easily work with PayPal's API's" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=0a735d45c30ab97f151866315073c14b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/angelleye_pay_pal_adaptive/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fangelleye_pay_pal_adaptive%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fangelleye_pay_pal_adaptive%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-paypal-for-woocommerce-1.4.0-class-angelleye_pay_pal_adaptive","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="angelleye_pay_pal_adaptive" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to paypal-for-woocommerce." href="http://hookr.io/plugins/paypal-for-woocommerce/" class="plugin"><span property="name">paypal-for-woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.4.0." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/" class="H_VERSION"><span property="name">1.4.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">angelleye_pay_pal_adaptive</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="488"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/all/" title="All">All <span class="count badge">488</span></a></li><li class="" data-id="new" data-count="43"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/new/" title="New">New <span class="count badge">43</span></a></li><li class="" data-id="hooks" data-count="152"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/hooks/" title="Hooks">Hooks <span class="count badge">152</span></a></li><li class="" data-id="action" data-count="31"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/actions/" title="Actions">Actions <span class="count badge">31</span></a></li><li class="" data-id="filter" data-count="121"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/filters/" title="Filters">Filters <span class="count badge">121</span></a></li><li class="active" data-id="class" data-count="309"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/classes/" title="Classes">Classes <span class="count badge">309</span></a></li><li class="" data-id="constant" data-count="21"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/constants/" title="Constants">Constants <span class="count badge">21</span></a></li><li class="" data-id="function" data-count="6"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/functions/" title="Functions">Functions <span class="count badge">6</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Angelleye_PayPal_Adaptive</strong></h1><p>Angell EYE PayPal Adaptive Payments Class An open source PHP library written to easily work with PayPal's API's.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/files/classes-lib-angelleye-paypal-php-library-includes-paypal-adaptive-class/" class="file">/classes/lib/angelleye/paypal-php-library/includes/paypal.adaptive.class.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="32" class="block" start="32"><li><div>class Angelleye_PayPal_Adaptive extends Angelleye_PayPal&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    var $DeveloperAccountEmail = '';&nbsp;</div></li><li><div>    var $XMLNamespace = '';&nbsp;</div></li><li><div>    var $ApplicationID = '';&nbsp;</div></li><li><div>    var $DeviceID = '';&nbsp;</div></li><li><div>    var $IPAddress = '';&nbsp;</div></li><li><div>    var $DetailLevel = '';&nbsp;</div></li><li><div>    var $ErrorLanguage = '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    config preferences&nbsp;</div></li><li><div>     * @return    void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $DataArray = apply_filters( 'angelleye_paypal_adaptive_construct_params', $DataArray );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parent::__construct($DataArray);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;XMLNamespace = 'http://svcs.paypal.com/types/ap';&nbsp;</div></li><li><div>        $this-&gt;DeviceID = isset($DataArray['DeviceID']) ? $DataArray['DeviceID'] : '';&nbsp;</div></li><li><div>        $this-&gt;IPAddress = isset($DataArray['IPAddress']) ? $DataArray['IPAddress'] : $_SERVER['REMOTE_ADDR'];&nbsp;</div></li><li><div>        $this-&gt;DetailLevel = isset($DataArray['DetailLevel']) ? $DataArray['DetailLevel'] : 'ReturnAll';&nbsp;</div></li><li><div>        $this-&gt;ErrorLanguage = isset($DataArray['ErrorLanguage']) ? $DataArray['ErrorLanguage'] : 'en_US';&nbsp;</div></li><li><div>        $this-&gt;APISubject = isset($DataArray['APISubject']) ? $DataArray['APISubject'] : '';&nbsp;</div></li><li><div>        $this-&gt;DeveloperAccountEmail = isset($DataArray['DeveloperAccountEmail']) ? $DataArray['DeveloperAccountEmail'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($this -&gt; Sandbox)&nbsp;</div></li><li><div>        {    &nbsp;</div></li><li><div>            // Sandbox Credentials&nbsp;</div></li><li><div>            $this -&gt; ApplicationID = isset($DataArray['ApplicationID']) ? $DataArray['ApplicationID'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIUsername = isset($DataArray['APIUsername']) && $DataArray['APIUsername'] != '' ? $DataArray['APIUsername'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIPassword = isset($DataArray['APIPassword']) && $DataArray['APIPassword'] != '' ? $DataArray['APIPassword'] : '';&nbsp;</div></li><li><div>            $this -&gt; APISignature = isset($DataArray['APISignature']) && $DataArray['APISignature'] != '' ? $DataArray['APISignature'] : '';&nbsp;</div></li><li><div>            $this -&gt; EndPointURL = isset($DataArray['EndPointURL']) && $DataArray['EndPointURL'] != '' ? $DataArray['EndPointURL'] : 'https://svcs.sandbox.paypal.com/';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif($this -&gt; BetaSandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Beta Sandbox Credentials&nbsp;</div></li><li><div>            $this -&gt; ApplicationID = isset($DataArray['ApplicationID']) ? $DataArray['ApplicationID'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIUsername = isset($DataArray['APIUsername']) && $DataArray['APIUsername'] != '' ? $DataArray['APIUsername'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIPassword = isset($DataArray['APIPassword']) && $DataArray['APIPassword'] != '' ? $DataArray['APIPassword'] : '';&nbsp;</div></li><li><div>            $this -&gt; APISignature = isset($DataArray['APISignature']) && $DataArray['APISignature'] != '' ? $DataArray['APISignature'] : '';&nbsp;</div></li><li><div>            $this -&gt; EndPointURL = isset($DataArray['EndPointURL']) && $DataArray['EndPointURL'] != '' ? $DataArray['EndPointURL'] : 'https://svcs.beta-sandbox.paypal.com/';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Live Credentials&nbsp;</div></li><li><div>            $this -&gt; ApplicationID = isset($DataArray['ApplicationID']) ? $DataArray['ApplicationID'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIUsername = isset($DataArray['APIUsername']) && $DataArray['APIUsername'] != '' ? $DataArray['APIUsername'] : '';&nbsp;</div></li><li><div>            $this -&gt; APIPassword = isset($DataArray['APIPassword']) && $DataArray['APIPassword'] != ''  ? $DataArray['APIPassword'] : '';&nbsp;</div></li><li><div>            $this -&gt; APISignature = isset($DataArray['APISignature']) && $DataArray['APISignature'] != ''  ? $DataArray['APISignature'] : '';&nbsp;</div></li><li><div>            $this -&gt; EndPointURL = isset($DataArray['EndPointURL']) && $DataArray['EndPointURL'] != ''  ? $DataArray['EndPointURL'] : 'https://svcs.paypal.com/';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Build all HTTP headers required for the API call.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    boolean    $PrintHeaders - Whether to print headers on screen or not (true/false)&nbsp;</div></li><li><div>     * @return    array $headers&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function BuildHeaders($PrintHeaders)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $headers = array(&nbsp;</div></li><li><div>                        'X-PAYPAL-SECURITY-USERID: ' . $this -&gt; APIUsername, &nbsp;</div></li><li><div>                        'X-PAYPAL-SECURITY-PASSWORD: ' . $this -&gt; APIPassword, &nbsp;</div></li><li><div>                        'X-PAYPAL-SECURITY-SIGNATURE: ' . $this -&gt; APISignature, &nbsp;</div></li><li><div>                        'X-PAYPAL-SECURITY-SUBJECT: ' . $this -&gt; APISubject, &nbsp;</div></li><li><div>                        'X-PAYPAL-SECURITY-VERSION: ' . $this -&gt; APIVersion, &nbsp;</div></li><li><div>                        'X-PAYPAL-REQUEST-DATA-FORMAT: XML', &nbsp;</div></li><li><div>                        'X-PAYPAL-RESPONSE-DATA-FORMAT: XML', &nbsp;</div></li><li><div>                        'X-PAYPAL-APPLICATION-ID: ' . $this -&gt; ApplicationID, &nbsp;</div></li><li><div>                        'X-PAYPAL-DEVICE-ID: ' . $this -&gt; DeviceID, &nbsp;</div></li><li><div>                        'X-PAYPAL-DEVICE-IPADDRESS: ' . $this -&gt; IPAddress&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($this -&gt; Sandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            array_push($headers, 'X-PAYPAL-SANDBOX-EMAIL-ADDRESS: '.$this-&gt;DeveloperAccountEmail);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($PrintHeaders)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            echo '&lt;pre /&gt;';&nbsp;</div></li><li><div>            print_r($headers);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $headers;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Send the API request to PayPal using CURL&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    string $Request&nbsp;</div></li><li><div>     * @param   string $APIName&nbsp;</div></li><li><div>     * @param   string $APIOperation&nbsp;</div></li><li><div>     * @return    string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function CURLRequest($Request = &quot;&quot;, $APIName = &quot;&quot;, $APIOperation = &quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $curl = curl_init();&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_VERBOSE, 1);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_TIMEOUT, 30);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_URL, $this -&gt; EndPointURL . $APIName . '/' . $APIOperation);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_POSTFIELDS, $Request);&nbsp;</div></li><li><div>                curl_setopt($curl, CURLOPT_HTTPHEADER, $this -&gt; BuildHeaders(false));&nbsp;</div></li><li><div>                                &nbsp;</div></li><li><div>        if($this -&gt; APIMode == 'Certificate')&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            curl_setopt($curl, CURLOPT_SSLCERT, $this -&gt; PathToCertKeyPEM);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Response = curl_exec($curl);        &nbsp;</div></li><li><div>        curl_close($curl);&nbsp;</div></li><li><div>        return $Response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get all errors returned from PayPal&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    string    XML response from PayPal&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function GetErrors($XML)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XML);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Errors = $DOM -&gt; getElementsByTagName('error') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('error') : array();&nbsp;</div></li><li><div>        $ErrorsArray = array();&nbsp;</div></li><li><div>        foreach($Errors as $Error)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $Receiver = $Error -&gt; getElementsByTagName('receiver') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('receiver') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Category = $Error -&gt; getElementsByTagName('category') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('category') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Domain = $Error -&gt; getElementsByTagName('domain') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('domain') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ErrorID = $Error -&gt; getElementsByTagName('errorId') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('errorId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ExceptionID = $Error -&gt; getElementsByTagName('exceptionId') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('exceptionId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Message = $Error -&gt; getElementsByTagName('message') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('message') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Parameter = $Error -&gt; getElementsByTagName('parameter') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('parameter') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Severity = $Error -&gt; getElementsByTagName('severity') -&gt; length  &gt; 0 ? $Error -&gt; getElementsByTagName('severity') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Subdomain = $Error -&gt; getElementsByTagName('subdomain') -&gt; length &gt; 0 ? $Error -&gt; getElementsByTagName('subdomain') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $CurrentError = array(&nbsp;</div></li><li><div>                                  'Receiver' =&gt; $Receiver, &nbsp;</div></li><li><div>                                  'Category' =&gt; $Category, &nbsp;</div></li><li><div>                                  'Domain' =&gt; $Domain, &nbsp;</div></li><li><div>                                  'ErrorID' =&gt; $ErrorID, &nbsp;</div></li><li><div>                                  'ExceptionID' =&gt; $ExceptionID, &nbsp;</div></li><li><div>                                  'Message' =&gt; $Message, &nbsp;</div></li><li><div>                                  'Parameter' =&gt; $Parameter, &nbsp;</div></li><li><div>                                  'Severity' =&gt; $Severity, &nbsp;</div></li><li><div>                                  'Subdomain' =&gt; $Subdomain&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            array_push($ErrorsArray, $CurrentError);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ErrorsArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the request envelope from the XML string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @return    string XML request envelope&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function GetXMLRequestEnvelope()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $XML = '&lt;requestEnvelope xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XML .= '&lt;detailLevel&gt;' . $this -&gt; DetailLevel . '&lt;/detailLevel&gt;';&nbsp;</div></li><li><div>        $XML .= '&lt;errorLanguage&gt;' . $this -&gt; ErrorLanguage . '&lt;/errorLanguage&gt;';&nbsp;</div></li><li><div>        $XML .= '&lt;/requestEnvelope&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $XML;&nbsp;</div></li><li><div>    }    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Log result to a location on the disk.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    string    $filename &nbsp;</div></li><li><div>     * @param   string  $string_data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function Logger($filename, $string_data)&nbsp;</div></li><li><div>    {    &nbsp;</div></li><li><div>        $timestamp = strtotime('now');&nbsp;</div></li><li><div>        $timestamp = date('mdY_giA_', $timestamp);&nbsp;</div></li><li><div>        $file = $_SERVER['DOCUMENT_ROOT'].&quot;/paypal/logs/&quot;.$timestamp.$filename.&quot;.xml&quot;;&nbsp;</div></li><li><div>        $fh = fopen($file, 'w');&nbsp;</div></li><li><div>        fwrite($fh, $string_data);&nbsp;</div></li><li><div>        fclose($fh);    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit Pay() API request to PayPal&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function Pay($DataArray)&nbsp;</div></li><li><div>    {    &nbsp;</div></li><li><div>        // PayRequest Fields&nbsp;</div></li><li><div>        $PayRequestFields = isset($DataArray['PayRequestFields']) ? $DataArray['PayRequestFields'] : array();&nbsp;</div></li><li><div>        $ActionType = isset($PayRequestFields['ActionType']) ? $PayRequestFields['ActionType'] : '';&nbsp;</div></li><li><div>        $CancelURL = isset($PayRequestFields['CancelURL']) ? $PayRequestFields['CancelURL'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($PayRequestFields['CurrencyCode']) ? $PayRequestFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $FeesPayer = isset($PayRequestFields['FeesPayer']) ? $PayRequestFields['FeesPayer'] : '';&nbsp;</div></li><li><div>        $IPNNotificationURL = isset($PayRequestFields['IPNNotificationURL']) ? $PayRequestFields['IPNNotificationURL'] : '';&nbsp;</div></li><li><div>        $Memo = isset($PayRequestFields['Memo']) ? $PayRequestFields['Memo'] : '';&nbsp;</div></li><li><div>        $Pin = isset($PayRequestFields['Pin']) ? $PayRequestFields['Pin'] : '';&nbsp;</div></li><li><div>        $PreapprovalKey = isset($PayRequestFields['PreapprovalKey']) ? $PayRequestFields['PreapprovalKey'] : '';&nbsp;</div></li><li><div>        $ReturnURL = isset($PayRequestFields['ReturnURL']) ? $PayRequestFields['ReturnURL'] : '';&nbsp;</div></li><li><div>        $ReverseAllParallelPaymentsOnError = isset($PayRequestFields['ReverseAllParallelPaymentsOnError']) ? $PayRequestFields['ReverseAllParallelPaymentsOnError'] : '';&nbsp;</div></li><li><div>        $SenderEmail = isset($PayRequestFields['SenderEmail']) ? $PayRequestFields['SenderEmail'] : '';&nbsp;</div></li><li><div>        $TrackingID = isset($PayRequestFields['TrackingID']) ? $PayRequestFields['TrackingID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // ClientDetails Fields&nbsp;</div></li><li><div>        $ClientDetailsFields = isset($DataArray['ClientDetailsFields']) ? $DataArray['ClientDetailsFields'] : array();&nbsp;</div></li><li><div>        $CustomerID = isset($ClientDetailsFields['CustomerID']) ? $ClientDetailsFields['CustomerID'] : '';&nbsp;</div></li><li><div>        $CustomerType = isset($ClientDetailsFields['CustomerType']) ? $ClientDetailsFields['CustomerType'] : '';&nbsp;</div></li><li><div>        $GeoLocation = isset($ClientDetailsFields['GeoLocation']) ? $ClientDetailsFields['GeoLocation'] : '';&nbsp;</div></li><li><div>        $Model = isset($ClientDetailsFields['Model']) ? $ClientDetailsFields['Model'] : '';&nbsp;</div></li><li><div>        $PartnerName = isset($ClientDetailsFields['PartnerName']) ? $ClientDetailsFields['PartnerName'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // FundingConstraint Fields&nbsp;</div></li><li><div>        $FundingTypes = isset($DataArray['FundingTypes']) ? $DataArray['FundingTypes'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Receivers Fields&nbsp;</div></li><li><div>        $Receivers = isset($DataArray['Receivers']) ? $DataArray['Receivers'] : array();&nbsp;</div></li><li><div>        $Amount = isset($Receivers['Amount']) ? $Receivers['Amount'] : '';&nbsp;</div></li><li><div>        $Email = isset($Receivers['Email']) ? $Receivers['Email'] : '';&nbsp;</div></li><li><div>        $InvoiceID = isset($Receivers['InvoiceID']) ? $Receivers['InvoiceID'] : '';&nbsp;</div></li><li><div>        $PaymentType = isset($Receivers['PaymentType']) ? $Receivers['PaymentType'] : '';&nbsp;</div></li><li><div>        $PaymentSubType = isset($Receivers['PaymentSubType']) ? $Receivers['PaymentSubType'] : '';&nbsp;</div></li><li><div>        $Phone = isset($Receivers['Phone']) ? $Receivers['Phone'] : '';&nbsp;</div></li><li><div>        $Primary = isset($Receivers['Primary']) ? strtolower($Receivers['Primary']) : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // SenderIdentifier Fields&nbsp;</div></li><li><div>        $SenderIdentifierFields = isset($DataArray['SenderIdentifierFields']) ? $DataArray['SenderIdentifierFields'] : array();&nbsp;</div></li><li><div>        $UseCredentials = isset($SenderIdentifierFields['UseCredentials']) ? $SenderIdentifierFields['UseCredentials'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // AccountIdentifierFields Fields&nbsp;</div></li><li><div>        $AccountIdentifierFields = isset($DataArray['AccountIdentifierFields']) ? $DataArray['AccountIdentifierFields'] : array();&nbsp;</div></li><li><div>        $AccountEmail = isset($AccountIdentifierFields['Email']) ? $AccountIdentifierFields['Email'] : '';&nbsp;</div></li><li><div>        $AccountPhone = isset($AccountIdentifierFields['Phone']) ? $AccountIdentifierFields['Phone'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;PayRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $ActionType != '' ? '&lt;actionType xmlns=&quot;&quot;&gt;' . $ActionType . '&lt;/actionType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CancelURL != '' ? '&lt;cancelUrl xmlns=&quot;&quot;&gt;' . $CancelURL . '&lt;/cancelUrl&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($ClientDetailsFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;clientDetails xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; ApplicationID != '' ? '&lt;applicationId xmlns=&quot;&quot;&gt;' . $this -&gt; ApplicationID . '&lt;/applicationId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerID != '' ? '&lt;customerId xmlns=&quot;&quot;&gt;' . $CustomerID . '&lt;/customerId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerType != '' ? '&lt;customerType xmlns=&quot;&quot;&gt;' . $CustomerType . '&lt;/customerType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; DeviceID != '' ? '&lt;deviceId xmlns=&quot;&quot;&gt;' . $this -&gt; DeviceID . '&lt;/deviceId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $GeoLocation != '' ? '&lt;geoLocation xmlns=&quot;&quot;&gt;' . $GeoLocation . '&lt;/geoLocation&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; IPAddress != '' ? '&lt;ipAddress xmlns=&quot;&quot;&gt;' . $this -&gt; IPAddress . '&lt;/ipAddress&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Model != '' ? '&lt;model xmlns=&quot;&quot;&gt;' . $Model . '&lt;/model&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $PartnerName != '' ? '&lt;partnerName xmlns=&quot;&quot;&gt;' . $PartnerName . '&lt;/partnerName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/clientDetails&gt;';        &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $FeesPayer != '' ? '&lt;feesPayer xmlns=&quot;&quot;&gt;' . $FeesPayer . '&lt;/feesPayer&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($FundingTypes) &gt; 0)&nbsp;</div></li><li><div>        {        &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;fundingConstraint xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;allowedFundingType xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            foreach($FundingTypes as $FundingType)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;fundingTypeInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;fundingType xmlns=&quot;&quot;&gt;' . $FundingType . '&lt;/fundingType&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/fundingTypeInfo&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/allowedFundingType&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/fundingConstraint&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $IPNNotificationURL != '' ? '&lt;ipnNotificationUrl xmlns=&quot;&quot;&gt;' . $IPNNotificationURL . '&lt;/ipnNotificationUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Memo != '' ? '&lt;memo xmlns=&quot;&quot;&gt;' . $Memo . '&lt;/memo&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Pin != '' ? '&lt;pin xmlns=&quot;&quot;&gt;' . $Pin . '&lt;/pin&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PreapprovalKey != '' ? '&lt;preapprovalKey xmlns=&quot;&quot;&gt;' . $PreapprovalKey . '&lt;/preapprovalKey&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;receiverList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $IsDigitalGoods = FALSE;&nbsp;</div></li><li><div>        foreach($Receivers as $Receiver)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $IsDigitalGoods = strtoupper($Receiver['PaymentType']) == 'DIGITALGOODS' ? TRUE : FALSE;&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;receiver xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Amount'] != '' ? '&lt;amount xmlns=&quot;&quot;&gt;' . $Receiver['Amount'] . '&lt;/amount&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Email'] != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $Receiver['Email'] . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['InvoiceID'] != '' ? '&lt;invoiceId xmlns=&quot;&quot;&gt;' . $Receiver['InvoiceID'] . '&lt;/invoiceId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['PaymentType'] != '' ? '&lt;paymentType xmlns=&quot;&quot;&gt;' . $Receiver['PaymentType'] . '&lt;/paymentType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['PaymentSubType'] != '' ? '&lt;paymentSubType xmlns=&quot;&quot;&gt;' . $Receiver['PaymentSubType'] . '&lt;/paymentSubType&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if($Receiver['Phone']['CountryCode'] != '')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['CountryCode'] != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['CountryCode'] . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['PhoneNumber'] != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['PhoneNumber'] . '&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['Extension'] != '' ? '&lt;extension xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['Extension'] . '&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Primary'] != '' ? '&lt;primary xmlns=&quot;&quot;&gt;' . strtolower($Receiver['Primary']) . '&lt;/primary&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/receiver&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/receiverList&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($SenderIdentifierFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;sender&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;useCredentials xmlns=&quot;&quot;&gt;' . $SenderIdentifierFields['UseCredentials'] . '&lt;/useCredentials&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/sender&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($AccountIdentifierFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;account xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $AccountEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $AccountEmail . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if($AccountPhone != '')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['CountryCode'] != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $AccountPhone['CountryCode'] . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['PhoneNumber'] != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;' . $AccountPhone['PhoneNumber'] . '&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['Extension'] != '' ? '&lt;extension xmlns=&quot;&quot;&gt;' . $AccountPhone['Extension'] . '&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/account&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ReverseAllParallelPaymentsOnError != '' ? '&lt;reverseAllParallelPaymentsOnError xmlns=&quot;&quot;&gt;' . $ReverseAllParallelPaymentsOnError . '&lt;/reverseAllParallelPaymentsOnError&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SenderEmail != '' ? '&lt;senderEmail xmlns=&quot;&quot;&gt;' . $SenderEmail . '&lt;/senderEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TrackingID != '' ? '&lt;trackingId xmlns=&quot;&quot;&gt;' . $TrackingID . '&lt;/trackingId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/PayRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'Pay');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PayKey = $DOM -&gt; getElementsByTagName('payKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('payKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentExecStatus = $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($this -&gt; Sandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.sandbox.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.sandbox.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif($this -&gt; BetaSandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.beta-sandbox.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.beta-sandbox.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PayKey' =&gt; $PayKey, &nbsp;</div></li><li><div>                                   'PaymentExecStatus' =&gt; $PaymentExecStatus, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $PayKey != '' ? $RedirectURL : '', &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit PayWithOptions() API request to PayPal&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function PayWithOptions($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // PayRequest Fields&nbsp;</div></li><li><div>        $PayRequestFields = isset($DataArray['PayRequestFields']) ? $DataArray['PayRequestFields'] : array();&nbsp;</div></li><li><div>        $ActionType = 'CREATE';&nbsp;</div></li><li><div>        $CancelURL = isset($PayRequestFields['CancelURL']) ? $PayRequestFields['CancelURL'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($PayRequestFields['CurrencyCode']) ? $PayRequestFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $FeesPayer = isset($PayRequestFields['FeesPayer']) ? $PayRequestFields['FeesPayer'] : '';&nbsp;</div></li><li><div>        $IPNNotificationURL = isset($PayRequestFields['IPNNotificationURL']) ? $PayRequestFields['IPNNotificationURL'] : '';&nbsp;</div></li><li><div>        $Memo = isset($PayRequestFields['Memo']) ? $PayRequestFields['Memo'] : '';&nbsp;</div></li><li><div>        $Pin = isset($PayRequestFields['Pin']) ? $PayRequestFields['Pin'] : '';&nbsp;</div></li><li><div>        $PreapprovalKey = isset($PayRequestFields['PreapprovalKey']) ? $PayRequestFields['PreapprovalKey'] : '';&nbsp;</div></li><li><div>        $ReturnURL = isset($PayRequestFields['ReturnURL']) ? $PayRequestFields['ReturnURL'] : '';&nbsp;</div></li><li><div>        $ReverseAllParallelPaymentsOnError = isset($PayRequestFields['ReverseAllParallelPaymentsOnError']) ? $PayRequestFields['ReverseAllParallelPaymentsOnError'] : '';&nbsp;</div></li><li><div>        $SenderEmail = isset($PayRequestFields['SenderEmail']) ? $PayRequestFields['SenderEmail'] : '';&nbsp;</div></li><li><div>        $TrackingID = isset($PayRequestFields['TrackingID']) ? $PayRequestFields['TrackingID'] : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // ClientDetails Fields&nbsp;</div></li><li><div>        $ClientDetailsFields = isset($DataArray['ClientDetailsFields']) ? $DataArray['ClientDetailsFields'] : array();&nbsp;</div></li><li><div>        $CustomerID = isset($ClientDetailsFields['CustomerID']) ? $ClientDetailsFields['CustomerID'] : '';&nbsp;</div></li><li><div>        $CustomerType = isset($ClientDetailsFields['CustomerType']) ? $ClientDetailsFields['CustomerType'] : '';&nbsp;</div></li><li><div>        $GeoLocation = isset($ClientDetailsFields['GeoLocation']) ? $ClientDetailsFields['GeoLocation'] : '';&nbsp;</div></li><li><div>        $Model = isset($ClientDetailsFields['Model']) ? $ClientDetailsFields['Model'] : '';&nbsp;</div></li><li><div>        $PartnerName = isset($ClientDetailsFields['PartnerName']) ? $ClientDetailsFields['PartnerName'] : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // FundingConstraint Fields&nbsp;</div></li><li><div>        $FundingTypes = isset($DataArray['FundingTypes']) ? $DataArray['FundingTypes'] : array();&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Receivers Fields&nbsp;</div></li><li><div>        $Receivers = isset($DataArray['Receivers']) ? $DataArray['Receivers'] : array();&nbsp;</div></li><li><div>        $Amount = isset($Receivers['Amount']) ? $Receivers['Amount'] : '';&nbsp;</div></li><li><div>        $Email = isset($Receivers['Email']) ? $Receivers['Email'] : '';&nbsp;</div></li><li><div>        $InvoiceID = isset($Receivers['InvoiceID']) ? $Receivers['InvoiceID'] : '';&nbsp;</div></li><li><div>        $PaymentType = isset($Receivers['PaymentType']) ? $Receivers['PaymentType'] : '';&nbsp;</div></li><li><div>        $PaymentSubType = isset($Receivers['PaymentSubType']) ? $Receivers['PaymentSubType'] : '';&nbsp;</div></li><li><div>        $Phone = isset($Receivers['Phone']) ? $Receivers['Phone'] : '';&nbsp;</div></li><li><div>        $Primary = isset($Receivers['Primary']) ? strtolower($Receivers['Primary']) : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // SenderIdentifier Fields&nbsp;</div></li><li><div>        $SenderIdentifierFields = isset($DataArray['SenderIdentifierFields']) ? $DataArray['SenderIdentifierFields'] : array();&nbsp;</div></li><li><div>        $UseCredentials = isset($SenderIdentifierFields['UseCredentials']) ? $SenderIdentifierFields['UseCredentials'] : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // AccountIdentifierFields Fields&nbsp;</div></li><li><div>        $AccountIdentifierFields = isset($DataArray['AccountIdentifierFields']) ? $DataArray['AccountIdentifierFields'] : array();&nbsp;</div></li><li><div>        $AccountEmail = isset($AccountIdentifierFields['Email']) ? $AccountIdentifierFields['Email'] : '';&nbsp;</div></li><li><div>        $AccountPhone = isset($AccountIdentifierFields['Phone']) ? $AccountIdentifierFields['Phone'] : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;PayRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $ActionType != '' ? '&lt;actionType xmlns=&quot;&quot;&gt;' . $ActionType . '&lt;/actionType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CancelURL != '' ? '&lt;cancelUrl xmlns=&quot;&quot;&gt;' . $CancelURL . '&lt;/cancelUrl&gt;' : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if(count($ClientDetailsFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;clientDetails xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; ApplicationID != '' ? '&lt;applicationId xmlns=&quot;&quot;&gt;' . $this -&gt; ApplicationID . '&lt;/applicationId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerID != '' ? '&lt;customerId xmlns=&quot;&quot;&gt;' . $CustomerID . '&lt;/customerId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerType != '' ? '&lt;customerType xmlns=&quot;&quot;&gt;' . $CustomerType . '&lt;/customerType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; DeviceID != '' ? '&lt;deviceId xmlns=&quot;&quot;&gt;' . $this -&gt; DeviceID . '&lt;/deviceId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $GeoLocation != '' ? '&lt;geoLocation xmlns=&quot;&quot;&gt;' . $GeoLocation . '&lt;/geoLocation&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $this -&gt; IPAddress != '' ? '&lt;ipAddress xmlns=&quot;&quot;&gt;' . $this -&gt; IPAddress . '&lt;/ipAddress&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Model != '' ? '&lt;model xmlns=&quot;&quot;&gt;' . $Model . '&lt;/model&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $PartnerName != '' ? '&lt;partnerName xmlns=&quot;&quot;&gt;' . $PartnerName . '&lt;/partnerName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/clientDetails&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $FeesPayer != '' ? '&lt;feesPayer xmlns=&quot;&quot;&gt;' . $FeesPayer . '&lt;/feesPayer&gt;' : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if(count($FundingTypes) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;fundingConstraint xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;allowedFundingType xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            foreach($FundingTypes as $FundingType)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;fundingTypeInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;fundingType xmlns=&quot;&quot;&gt;' . $FundingType . '&lt;/fundingType&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/fundingTypeInfo&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/allowedFundingType&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/fundingConstraint&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $XMLRequest .= $IPNNotificationURL != '' ? '&lt;ipnNotificationUrl xmlns=&quot;&quot;&gt;' . $IPNNotificationURL . '&lt;/ipnNotificationUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Memo != '' ? '&lt;memo xmlns=&quot;&quot;&gt;' . $Memo . '&lt;/memo&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Pin != '' ? '&lt;pin xmlns=&quot;&quot;&gt;' . $Pin . '&lt;/pin&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PreapprovalKey != '' ? '&lt;preapprovalKey xmlns=&quot;&quot;&gt;' . $PreapprovalKey . '&lt;/preapprovalKey&gt;' : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;receiverList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $IsDigitalGoods = FALSE;&nbsp;</div></li><li><div>        foreach($Receivers as $Receiver)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $IsDigitalGoods = strtoupper($Receiver['PaymentType']) == 'DIGITALGOODS' ? TRUE : FALSE;&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;receiver xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Amount'] != '' ? '&lt;amount xmlns=&quot;&quot;&gt;' . $Receiver['Amount'] . '&lt;/amount&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Email'] != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $Receiver['Email'] . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['InvoiceID'] != '' ? '&lt;invoiceId xmlns=&quot;&quot;&gt;' . $Receiver['InvoiceID'] . '&lt;/invoiceId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['PaymentType'] != '' ? '&lt;paymentType xmlns=&quot;&quot;&gt;' . $Receiver['PaymentType'] . '&lt;/paymentType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['PaymentSubType'] != '' ? '&lt;paymentSubType xmlns=&quot;&quot;&gt;' . $Receiver['PaymentSubType'] . '&lt;/paymentSubType&gt;' : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            if($Receiver['Phone']['CountryCode'] != '')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['CountryCode'] != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['CountryCode'] . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['PhoneNumber'] != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['PhoneNumber'] . '&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Phone']['Extension'] != '' ? '&lt;extension xmlns=&quot;&quot;&gt;' . $Receiver['Phone']['Extension'] . '&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            $XMLRequest .= $Receiver['Primary'] != '' ? '&lt;primary xmlns=&quot;&quot;&gt;' . strtolower($Receiver['Primary']) . '&lt;/primary&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/receiver&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/receiverList&gt;';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if(count($SenderIdentifierFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;sender&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;useCredentials xmlns=&quot;&quot;&gt;' . $SenderIdentifierFields['UseCredentials'] . '&lt;/useCredentials&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/sender&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if(count($AccountIdentifierFields) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;account xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $AccountEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $AccountEmail . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            if($AccountPhone != '')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['CountryCode'] != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $AccountPhone['CountryCode'] . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['PhoneNumber'] != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;' . $AccountPhone['PhoneNumber'] . '&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $AccountPhone['Extension'] != '' ? '&lt;extension xmlns=&quot;&quot;&gt;' . $AccountPhone['Extension'] . '&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/account&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ReverseAllParallelPaymentsOnError != '' ? '&lt;reverseAllParallelPaymentsOnError xmlns=&quot;&quot;&gt;' . $ReverseAllParallelPaymentsOnError . '&lt;/reverseAllParallelPaymentsOnError&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SenderEmail != '' ? '&lt;senderEmail xmlns=&quot;&quot;&gt;' . $SenderEmail . '&lt;/senderEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TrackingID != '' ? '&lt;trackingId xmlns=&quot;&quot;&gt;' . $TrackingID . '&lt;/trackingId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/PayRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PayXMLRequest = $XMLRequest;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'Pay');&nbsp;</div></li><li><div>        $PayXMLResponse = $XMLResponse;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $PayKey = $DOM -&gt; getElementsByTagName('payKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('payKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentExecStatus = $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if($this -&gt; Sandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.sandbox.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.sandbox.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif($this -&gt; BetaSandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.beta-sandbox.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.beta-sandbox.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($IsDigitalGoods)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.paypal.com/webapps/adaptivepayment/flow/pay?paykey='.$PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $RedirectURL = 'https://www.paypal.com/webscr?cmd=_ap-payment&paykey=' . $PayKey;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!$this-&gt;APICallSuccessful($Ack))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>                $ResponseDataArray = array(&nbsp;</div></li><li><div>                    'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                    'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                    'Build' =&gt; $Build, &nbsp;</div></li><li><div>                    'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                    'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                    'PayKey' =&gt; $PayKey, &nbsp;</div></li><li><div>                    'PaymentExecStatus' =&gt; $PaymentExecStatus, &nbsp;</div></li><li><div>                    'PayXMLRequest' =&gt; $PayXMLRequest, &nbsp;</div></li><li><div>                    'PayXMLResponse' =&gt; $PayXMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            return $ResponseDataArray;&nbsp;</div></li><li><div>            exit();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // SetPaymentOptions Basic Fields&nbsp;</div></li><li><div>        $SPOFields = isset($DataArray['SPOFields']) ? $DataArray['SPOFields'] : array();&nbsp;</div></li><li><div>        $ShippingAddressID = isset($SPOFields['ShippingAddressID']) ? $SPOFields['ShippingAddressID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // DisplayOptions Fields&nbsp;</div></li><li><div>        $DisplayOptions = isset($DataArray['DisplayOptions']) ? $DataArray['DisplayOptions'] : array();&nbsp;</div></li><li><div>        $EmailHeaderImageURL = isset($DisplayOptions['EmailHeaderImageURL']) ? $DisplayOptions['EmailHeaderImageURL'] : '';&nbsp;</div></li><li><div>        $EmailMarketingImageURL = isset($DisplayOptions['EmailMarketingImageURL']) ? $DisplayOptions['EmailMarketingImageURL'] : '';&nbsp;</div></li><li><div>        $HeaderImageURL = isset($DisplayOptions['HeaderImageURL']) ? $DisplayOptions['HeaderImageURL'] : '';&nbsp;</div></li><li><div>        $BusinessName = isset($DisplayOptions['BusinessName']) ? $DisplayOptions['BusinessName'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // InstitutionCustomer Fields&nbsp;</div></li><li><div>        $InstitutionCustomer = isset($DataArray['InstitutionCustomer']) ? $DataArray['InstitutionCustomer'] : array();&nbsp;</div></li><li><div>        $CountryCode = isset($InstitutionCustomer['CountryCode']) ? $InstitutionCustomer['CountryCode'] : '';&nbsp;</div></li><li><div>        $DisplayName = isset($InstitutionCustomer['DisplayName']) ? $InstitutionCustomer['DisplayName'] : '';&nbsp;</div></li><li><div>        $InstitutionCustomerEmail = isset($InstitutionCustomer['Email']) ? $InstitutionCustomer['Email'] : '';&nbsp;</div></li><li><div>        $FirstName = isset($InstitutionCustomer['FirstName']) ? $InstitutionCustomer['FirstName'] : '';&nbsp;</div></li><li><div>        $LastName = isset($InstitutionCustomer['LastName']) ? $InstitutionCustomer['LastName'] : '';&nbsp;</div></li><li><div>        $InstitutionCustomerID = isset($InstitutionCustomer['InstitutionCustomerID']) ? $InstitutionCustomer['InstitutionCustomerID'] : '';&nbsp;</div></li><li><div>        $InstitutionID = isset($InstitutionCustomer['InstitutionID']) ? $InstitutionCustomer['InstitutionID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // SenderOptions Fields&nbsp;</div></li><li><div>        $SenderOptions = isset($DataArray['SenderOptions']) ? $DataArray['SenderOptions'] : array();&nbsp;</div></li><li><div>        $RequireShippingAddressSelection = isset($SenderOptions['RequireShippingAddressSelection']) ? $SenderOptions['RequireShippingAddressSelection'] : '';&nbsp;</div></li><li><div>        $ReferrerCode = $this-&gt;APIButtonSource;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // ReceiverOptions Fields&nbsp;</div></li><li><div>        $ReceiverOptionsXML = '';&nbsp;</div></li><li><div>        $ReceiverOptions = isset($DataArray['ReceiverOptions']) ? $DataArray['ReceiverOptions'] : array();&nbsp;</div></li><li><div>        foreach($ReceiverOptions as $ReceiverOption)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $Description = isset($ReceiverOption['Description']) ? $ReceiverOption['Description'] : '';&nbsp;</div></li><li><div>            $CustomID = isset($ReceiverOption['CustomID']) ? $ReceiverOption['CustomID'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // Invoice Data&nbsp;</div></li><li><div>            $InvoiceData = isset($ReceiverOption['InvoiceData']) ? $ReceiverOption['InvoiceData'] : array();&nbsp;</div></li><li><div>            $TotalTax = isset($InvoiceData['TotalTax']) ? $InvoiceData['TotalTax'] : '';&nbsp;</div></li><li><div>            $TotalShipping = isset($InvoiceData['TotalShipping']) ? $InvoiceData['TotalShipping'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // InvoiceItem Fields&nbsp;</div></li><li><div>            $InvoiceItems = isset($ReceiverOption['InvoiceItems']) ? $ReceiverOption['InvoiceItems'] : array();&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // ReceiverIdentifer Fields&nbsp;</div></li><li><div>            $ReceiverIdentifier = isset($ReceiverOption['ReceiverIdentifier']) ? $ReceiverOption['ReceiverIdentifier'] : array();&nbsp;</div></li><li><div>            $ReceiverIdentifierEmail = isset($ReceiverIdentifier['Email']) ? $ReceiverIdentifier['Email'] : '';&nbsp;</div></li><li><div>            $PhoneCountryCode = isset($ReceiverIdentifier['PhoneCountryCode']) ? $ReceiverIdentifier['PhoneCountryCode'] : '';&nbsp;</div></li><li><div>            $PhoneNumber = isset($ReceiverIdentifier['PhoneNumber']) ? $ReceiverIdentifier['PhoneNumber'] : '';&nbsp;</div></li><li><div>            $PhoneExtension = isset($ReceiverIdentifier['PhoneExtension']) ? $ReceiverIdentifier['PhoneExtension'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                $ReceiverOptionsXML .= '&lt;receiverOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $ReceiverOptionsXML .= $Description != '' ? '&lt;description xmlns=&quot;&quot;&gt;'.$Description.'&lt;/description&gt;' : '';&nbsp;</div></li><li><div>                $ReceiverOptionsXML .= $CustomID != '' ? '&lt;customId xmlns=&quot;&quot;&gt;'.$CustomID.'&lt;/customId&gt;' : '';&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                if(!empty($InvoiceData))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;invoiceData xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $TotalTax != '' ? '&lt;totalTax xmlns=&quot;&quot;&gt;'.$TotalTax.'&lt;/totalTax&gt;' : '';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $TotalShipping != '' ? '&lt;totalShipping xmlns=&quot;&quot;&gt;'.$TotalShipping.'&lt;/totalShipping&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;item xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Name'] != '' ? '&lt;name xmlns=&quot;&quot;&gt;'.$InvoiceItem['Name'].'&lt;/name&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Identifier'] != '' ? '&lt;identifier xmlns=&quot;&quot;&gt;'.$InvoiceItem['Identifier'].'&lt;/identifier&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Price'] != '' ? '&lt;price xmlns=&quot;&quot;&gt;'.$InvoiceItem['Price'].'&lt;/price&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['ItemPrice'] != '' ? '&lt;itemPrice xmlns=&quot;&quot;&gt;'.$InvoiceItem['ItemPrice'].'&lt;/itemPrice&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['ItemCount'] != '' ? '&lt;itemCount xmlns=&quot;&quot;&gt;'.$InvoiceItem['ItemCount'].'&lt;/itemCount&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;/item&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;/invoiceData&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                if(count($ReceiverIdentifier) &gt; 0)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;receiver xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $ReceiverIdentifierEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;'.$ReceiverIdentifierEmail.'&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    if($PhoneNumber != '')&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;'.$PhoneCountryCode.'&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneNumber != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;'.$PhoneNumber.'&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneExtension != '' ? '&lt;extension xmlns=&quot;&quot;&gt;'.$PhoneExtension.'&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;/receiver&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                $ReceiverOptionsXML .= '&lt;/receiverOptions&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;SetPaymentOptionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;'.$PayKey.'&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingAddressID != '' ? '&lt;shippingAddressId xmlns=&quot;&quot;&gt;'.$ShippingAddressID.'&lt;/shippingAddressId&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($InstitutionCustomer) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;initiatingEntity xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;institutionCustomer xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionID != '' ? '&lt;institutionId xmlns=&quot;&quot;&gt;'.$InstitutionID.'&lt;/institutionId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $FirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;'.$FirstName.'&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $LastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;'.$LastName.'&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $DisplayName != '' ? '&lt;displayName xmlns=&quot;&quot;&gt;'.$DisplayName.'&lt;/displayName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionCustomerID != '' ? '&lt;institutionCustomerId xmlns=&quot;&quot;&gt;'.$InstitutionCustomerID.'&lt;/institutionCustomerId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;'.$CountryCode.'&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionCustomerEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;'.$InstitutionCustomerEmail.'&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/institutionCustomer&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/initiatingEntity&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($DisplayOptions) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;displayOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $EmailHeaderImageURL != '' ? '&lt;emailHeaderImageUrl xmlns=&quot;&quot;&gt;'.$EmailHeaderImageURL.'&lt;/emailHeaderImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $EmailMarketingImageURL != '' ? '&lt;emailMarketingImageUrl xmlns=&quot;&quot;&gt;'.$EmailMarketingImageURL.'&lt;/emailMarketingImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $HeaderImageURL != '' ? '&lt;headerImageUrl xmlns=&quot;&quot;&gt;'.$HeaderImageURL.'&lt;/headerImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;'.$BusinessName.'&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/displayOptions&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($SenderOptions) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;senderOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $RequireShippingAddressSelection != '' ? '&lt;requireShippingAddressSelection xmlns=&quot;&quot;&gt;'.$RequireShippingAddressSelection.'&lt;/requireShippingAddressSelection&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ReferrerCode != '' ? '&lt;referrerCode xmlns=&quot;&quot;&gt;'.$ReferrerCode.'&lt;/referrerCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/senderOptions&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ReceiverOptionsXML;&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/SetPaymentOptionsRequest&gt;';&nbsp;</div></li><li><div>        $SetPaymentOptionsXMLRequest = $XMLRequest;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'SetPaymentOptions');&nbsp;</div></li><li><div>        $SetPaymentOptionsXMLResponse = $XMLResponse;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                'Build' =&gt; $Build, &nbsp;</div></li><li><div>                'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                'PayKey' =&gt; $PayKey, &nbsp;</div></li><li><div>                'PaymentExecStatus' =&gt; $PaymentExecStatus, &nbsp;</div></li><li><div>                'RedirectURL' =&gt; $PayKey != '' ? $RedirectURL : '', &nbsp;</div></li><li><div>                'PayXMLRequest' =&gt; $PayXMLRequest, &nbsp;</div></li><li><div>                'PayXMLResponse' =&gt; $PayXMLResponse, &nbsp;</div></li><li><div>                'SetPaymentOptionsXMLRequest' =&gt; $SetPaymentOptionsXMLRequest, &nbsp;</div></li><li><div>                'SetPaymentOptionsXMLResponse' =&gt; $SetPaymentOptionsXMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit PaymentDetails API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function PaymentDetails($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // PaymentDetails Fields&nbsp;</div></li><li><div>        $PaymentDetailsFields = isset($DataArray['PaymentDetailsFields']) ? $DataArray['PaymentDetailsFields'] : array();&nbsp;</div></li><li><div>        $PayKey = isset($PaymentDetailsFields['PayKey']) ? $PaymentDetailsFields['PayKey'] : '';&nbsp;</div></li><li><div>        $TransactionID = isset($PaymentDetailsFields['TransactionID']) ? $PaymentDetailsFields['TransactionID'] : '';&nbsp;</div></li><li><div>        $TrackingID = isset($PaymentDetailsFields['TrackingID']) ? $PaymentDetailsFields['TrackingID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;PaymentDetailsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;' . $PayKey . '&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TransactionID != '' ? '&lt;transactionId xmlns=&quot;&quot;&gt;' . $TransactionID . '&lt;/transactionId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TrackingID != '' ? '&lt;trackingId xmlns=&quot;&quot;&gt;' . $TrackingID . '&lt;/trackingId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/PaymentDetailsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'PaymentDetails');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ActionType = $DOM -&gt; getElementsByTagName('actionType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('actionType') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CancelURL = $DOM -&gt; getElementsByTagName('cancelUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('cancelUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurrencyCode = $DOM -&gt; getElementsByTagName('currencyCode') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('currencyCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $FeesPayer = $DOM -&gt; getElementsByTagName('feesPayer') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('feesPayer') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $FundingTypesDOM = $DOM -&gt; getElementsByTagName('fundingType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('fundingType') : array();&nbsp;</div></li><li><div>        $FundingTypes = array();&nbsp;</div></li><li><div>        foreach($FundingTypesDOM as $FundingType)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            array_push($FundingTypes, $FundingType);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $IPNNotificationURL = $DOM -&gt; getElementsByTagName('ipnNotificationUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ipnNotificationUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Memo = $DOM -&gt; getElementsByTagName('memo') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('memo') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PayKey = $DOM -&gt; getElementsByTagName('payKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('payKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PendingRefund = $DOM -&gt; getElementsByTagName('pendingRefund') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('pendingRefund') -&gt; item(0) -&gt; nodeValue : 'false';&nbsp;</div></li><li><div>        $RefundedAmount = $DOM -&gt; getElementsByTagName('refundedAmount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundedAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $SenderTransactionID = $DOM -&gt; getElementsByTagName('senderTransactionID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('senderTransactionID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $SenderTransactionStatus = $DOM -&gt; getElementsByTagName('senderTransactionStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('senderTransactionStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TransactionID = $DOM -&gt; getElementsByTagName('transactionId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('transactionId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TransactionStatus = $DOM -&gt; getElementsByTagName('transactionStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('transactionStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentInfo = array(&nbsp;</div></li><li><div>                            'PendingRefund' =&gt; $PendingRefund, &nbsp;</div></li><li><div>                            'RefundAmount' =&gt; $RefundedAmount, &nbsp;</div></li><li><div>                            'SenderTransactionID' =&gt; $SenderTransactionID, &nbsp;</div></li><li><div>                            'SenderTransactionStatus' =&gt; $SenderTransactionStatus, &nbsp;</div></li><li><div>                            'TransactionID' =&gt; $TransactionID, &nbsp;</div></li><li><div>                            'TransactionStatus' =&gt; $TransactionStatus&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PreapprovalKey = $DOM -&gt; getElementsByTagName('preapprovalKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('preapprovalKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $ReturnURL = $DOM -&gt; getElementsByTagName('returnUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('returnUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $ReverseAllParallelPaymentsOnError = $DOM -&gt; getElementsByTagName('reverseAllParallelPaymentsOnError') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('reverseAllParallelPaymentsOnError') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $SenderEmail = $DOM -&gt; getElementsByTagName('senderEmail') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('senderEmail') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Status = $DOM -&gt; getElementsByTagName('status') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('status') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TrackingID = $DOM -&gt; getElementsByTagName('trackingId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('trackingId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Amount = $DOM -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Email = $DOM -&gt; getElementsByTagName('email') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('email') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentType = $DOM -&gt; getElementsByTagName('paymentType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentType') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Primary = $DOM -&gt; getElementsByTagName('primary') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('primary') -&gt; item(0) -&gt; nodeValue : 'false';&nbsp;</div></li><li><div>        $Receiver = array(&nbsp;</div></li><li><div>                        'Amount' =&gt; $Amount, &nbsp;</div></li><li><div>                        'Email' =&gt; $Email, &nbsp;</div></li><li><div>                        'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                        'PaymentType' =&gt; $PaymentType, &nbsp;</div></li><li><div>                        'Primary' =&gt; $Primary&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'ActionType' =&gt; $ActionType, &nbsp;</div></li><li><div>                                   'CancelURL' =&gt; $CancelURL, &nbsp;</div></li><li><div>                                   'CurrencyCode' =&gt; $CurrencyCode, &nbsp;</div></li><li><div>                                   'FeesPayer' =&gt; $FeesPayer, &nbsp;</div></li><li><div>                                   'FundingTypes' =&gt; $FundingTypes, &nbsp;</div></li><li><div>                                   'IPNNotificationURL' =&gt; $IPNNotificationURL, &nbsp;</div></li><li><div>                                   'Memo' =&gt; $Memo, &nbsp;</div></li><li><div>                                   'PayKey' =&gt; $PayKey, &nbsp;</div></li><li><div>                                   'PaymentInfo' =&gt; $PaymentInfo, &nbsp;</div></li><li><div>                                   'PreapprovalKey' =&gt; $PreapprovalKey, &nbsp;</div></li><li><div>                                   'ReturnURL' =&gt; $ReturnURL, &nbsp;</div></li><li><div>                                   'ReverseAllParallelPaymentsOnError' =&gt; $ReverseAllParallelPaymentsOnError, &nbsp;</div></li><li><div>                                   'SenderEmail' =&gt; $SenderEmail, &nbsp;</div></li><li><div>                                   'Status' =&gt; $Status, &nbsp;</div></li><li><div>                                   'TrackingID' =&gt; $TrackingID, &nbsp;</div></li><li><div>                                   'Receiver' =&gt; $Receiver, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit ExecutePayment API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function ExecutePayment($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // ExecutePaymentFields Fields&nbsp;</div></li><li><div>        $ExecutePaymentFields = isset($DataArray['ExecutePaymentFields']) ? $DataArray['ExecutePaymentFields'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;ExecutePaymentRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= isset($ExecutePaymentFields['PayKey']) && $ExecutePaymentFields['PayKey'] != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;' . $ExecutePaymentFields['PayKey'] . '&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= isset($ExecutePaymentFields['FundingPlanID']) && $ExecutePaymentFields['FundingPlanID'] != '' ? '&lt;fundingPlanId xmlns=&quot;&quot;&gt;' . $ExecutePaymentFields['FundingPlanID'] . '&lt;/fundingPlanId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/ExecutePaymentRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'ExecutePayment');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentExecStatus = $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentExecStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PaymentExecStatus' =&gt; $PaymentExecStatus, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit GetPaymentOptions API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function GetPaymentOptions($PayKey)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetPaymentOptionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;' . $PayKey. '&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetPaymentOptionsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'GetPaymentOptions');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // GetPaymentOptionsResponse Fields&nbsp;</div></li><li><div>        $PayKey = $DOM -&gt; getElementsByTagName('payKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('payKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $ShippingAddressID = $DOM -&gt; getElementsByTagName('shippingAddressId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('shippingAddressId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // InitiatingEntity Fields&nbsp;</div></li><li><div>        $InstitutionCustomer = $DOM -&gt; getElementsByTagName('institutionCustomer') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('institutionCustomer') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CountryCode = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $DisplayName = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('displayName') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('displayName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Email = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('email') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('email') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $FirstName = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('firstName') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('firstName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InstitutionCustomerID = $InstitutionCustomer != '' &&  $InstitutionCustomer -&gt; getElementsByTagName('institutionCustomerId') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('institutionCustomerId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InstitutionID = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('institutionId') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('institutionId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $LastName = $InstitutionCustomer != '' && $InstitutionCustomer -&gt; getElementsByTagName('lastName') -&gt; length &gt; 0 ? $InstitutionCustomer -&gt; getElementsByTagName('lastName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InitiatingEntity = array(&nbsp;</div></li><li><div>                                        'CountryCode' =&gt; $CountryCode, &nbsp;</div></li><li><div>                                        'DisplayName' =&gt; $DisplayName, &nbsp;</div></li><li><div>                                        'Email' =&gt; $Email, &nbsp;</div></li><li><div>                                        'FirstName' =&gt; $FirstName, &nbsp;</div></li><li><div>                                        'InstitutionCustomerID' =&gt; $InstitutionCustomerID, &nbsp;</div></li><li><div>                                        'InstitutionID' =&gt; $InstitutionID, &nbsp;</div></li><li><div>                                        'LastName' =&gt; $LastName&nbsp;</div></li><li><div> );    &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // DisplayOptions Fields&nbsp;</div></li><li><div>        $EmailHeaderImageURL = $DOM -&gt; getElementsByTagName('emailHeaderImageUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('emailHeaderImageUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $EmailMarketingImageURL = $DOM -&gt; getElementsByTagName('emailMarketingImageUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('emailMarketingImageUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $BusinessName = $DOM -&gt; getElementsByTagName('businessName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('businessName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $DisplayOptions = array(&nbsp;</div></li><li><div>                                'EmailHeaderImageURL' =&gt; $EmailHeaderImageURL, &nbsp;</div></li><li><div>                                'EmailMarketingImageURL' =&gt; $EmailMarketingImageURL, &nbsp;</div></li><li><div>                                'BusinessName' =&gt; $BusinessName&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Sender Options&nbsp;</div></li><li><div>        $RequireShippingAddressSelection = $DOM -&gt; getElementsByTagName('requireShippingAddressSelection') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('requireShippingAddressSelection') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // ReceiverOptions Fields&nbsp;</div></li><li><div>        $ReceiverOptions = $DOM -&gt; getElementsByTagName('receiverOptions') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('receiverOptions') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Description = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('description') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('description') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CustomID = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('customId') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('customId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Email = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('email') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('email') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PhoneCountryCode = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PhoneNumber = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('phoneNumber') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('phoneNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PhoneExtension = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('extension') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('extension') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // InvoiceDataFields&nbsp;</div></li><li><div>        $InvoiceItems = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('item') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('item') : array();&nbsp;</div></li><li><div>        $TotalTax = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('totalTax') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('totalTax') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TotalShipping = $ReceiverOptions != '' && $ReceiverOptions -&gt; getElementsByTagName('totalShipping') -&gt; length &gt; 0 ? $ReceiverOptions -&gt; getElementsByTagName('totalShipping') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $InvoiceItemsArray = array();&nbsp;</div></li><li><div>        foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $ItemName = $InvoiceItem -&gt; getElementsByTagName('name') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('name') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemIdentifier = $InvoiceItem -&gt; getElementsByTagName('identifier') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('identifier') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemSubtotal = $InvoiceItem -&gt; getElementsByTagName('price') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('price') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemPrice = $InvoiceItem -&gt; getElementsByTagName('itemPrice') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('itemPrice') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemCount = $InvoiceItem -&gt; getElementsByTagName('itemCount') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('itemCount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $CurrentItem = array(&nbsp;</div></li><li><div>                                'Name' =&gt; $ItemName, &nbsp;</div></li><li><div>                                'Identifier' =&gt; $ItemIdentifier, &nbsp;</div></li><li><div>                                'Subtotal' =&gt; $ItemSubtotal, &nbsp;</div></li><li><div>                                'Price' =&gt; $ItemPrice, &nbsp;</div></li><li><div>                                'ItemCount' =&gt; $ItemCount&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            array_push($InvoiceItemsArray, $CurrentItem);    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $InvoiceData = array('TotalTax' =&gt; $TotalTax, 'TotalShipping' =&gt; $TotalShipping, 'InvoiceItems' =&gt; $InvoiceItemsArray);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ReceiverOptionsFields = array(&nbsp;</div></li><li><div>                                    'Description' =&gt; $Description, &nbsp;</div></li><li><div>                                    'CustomID' =&gt; $CustomID, &nbsp;</div></li><li><div>                                    'Email' =&gt; $Email, &nbsp;</div></li><li><div>                                    'PhoneCountryCode' =&gt; $PhoneCountryCode, &nbsp;</div></li><li><div>                                    'PhoneNumber' =&gt; $PhoneNumber, &nbsp;</div></li><li><div>                                    'PhoneExtension' =&gt; $PhoneExtension, &nbsp;</div></li><li><div>                                    'InvoiceData' =&gt; $InvoiceData&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PayKey' =&gt; $PayKey, &nbsp;</div></li><li><div>                                   'ShippingAddressID' =&gt; $ShippingAddressID, &nbsp;</div></li><li><div>                                   'InitiatingEntity' =&gt; $InitiatingEntity, &nbsp;</div></li><li><div>                                   'DisplayOptions' =&gt; $DisplayOptions, &nbsp;</div></li><li><div>                                   'RequireShippingAddressSelection' =&gt; $RequireShippingAddressSelection, &nbsp;</div></li><li><div>                                   'ReceiverOptions' =&gt; $ReceiverOptionsFields, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit SetPaymentOptions API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function SetPaymentOptions($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // SetPaymentOptions Basic Fields&nbsp;</div></li><li><div>        $SPOFields = isset($DataArray['SPOFields']) ? $DataArray['SPOFields'] : array();&nbsp;</div></li><li><div>        $PayKey = isset($SPOFields['PayKey']) ? $SPOFields['PayKey'] : '';&nbsp;</div></li><li><div>        $ShippingAddressID = isset($SPOFields['ShippingAddressID']) ? $SPOFields['ShippingAddressID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // DisplayOptions Fields&nbsp;</div></li><li><div>        $DisplayOptions = isset($DataArray['DisplayOptions']) ? $DataArray['DisplayOptions'] : array();&nbsp;</div></li><li><div>        $EmailHeaderImageURL = isset($DisplayOptions['EmailHeaderImageURL']) ? $DisplayOptions['EmailHeaderImageURL'] : '';&nbsp;</div></li><li><div>        $EmailMarketingImageURL = isset($DisplayOptions['EmailMarketingImageURL']) ? $DisplayOptions['EmailMarketingImageURL'] : '';&nbsp;</div></li><li><div>        $HeaderImageURL = isset($DisplayOptions['HeaderImageURL']) ? $DisplayOptions['HeaderImageURL'] : '';&nbsp;</div></li><li><div>        $BusinessName = isset($DisplayOptions['BusinessName']) ? $DisplayOptions['BusinessName'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // InstitutionCustomer Fields&nbsp;</div></li><li><div>        $InstitutionCustomer = isset($DataArray['InstitutionCustomer']) ? $DataArray['InstitutionCustomer'] : array();&nbsp;</div></li><li><div>        $CountryCode = isset($InstitutionCustomer['CountryCode']) ? $InstitutionCustomer['CountryCode'] : '';&nbsp;</div></li><li><div>        $DisplayName = isset($InstitutionCustomer['DisplayName']) ? $InstitutionCustomer['DisplayName'] : '';&nbsp;</div></li><li><div>        $InstitutionCustomerEmail = isset($InstitutionCustomer['Email']) ? $InstitutionCustomer['Email'] : '';&nbsp;</div></li><li><div>        $FirstName = isset($InstitutionCustomer['FirstName']) ? $InstitutionCustomer['FirstName'] : '';&nbsp;</div></li><li><div>        $LastName = isset($InstitutionCustomer['LastName']) ? $InstitutionCustomer['LastName'] : '';&nbsp;</div></li><li><div>        $InstitutionCustomerID = isset($InstitutionCustomer['InstitutionCustomerID']) ? $InstitutionCustomer['InstitutionCustomerID'] : '';&nbsp;</div></li><li><div>        $InstitutionID = isset($InstitutionCustomer['InstitutionID']) ? $InstitutionCustomer['InstitutionID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // SenderOptions Fields&nbsp;</div></li><li><div>        $SenderOptions = isset($DataArray['SenderOptions']) ? $DataArray['SenderOptions'] : array();&nbsp;</div></li><li><div>        $RequireShippingAddressSelection = isset($SenderOptions['RequireShippingAddressSelection']) ? $SenderOptions['RequireShippingAddressSelection'] : '';&nbsp;</div></li><li><div>        $ReferrerCode = $this-&gt;APIButtonSource;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // ReceiverOptions Fields&nbsp;</div></li><li><div>        $ReceiverOptionsXML = '';&nbsp;</div></li><li><div>        $ReceiverOptions = isset($DataArray['ReceiverOptions']) ? $DataArray['ReceiverOptions'] : array();&nbsp;</div></li><li><div>        foreach($ReceiverOptions as $ReceiverOption)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $Description = isset($ReceiverOption['Description']) ? $ReceiverOption['Description'] : '';&nbsp;</div></li><li><div>            $CustomID = isset($ReceiverOption['CustomID']) ? $ReceiverOption['CustomID'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // Invoice Data&nbsp;</div></li><li><div>            $InvoiceData = isset($ReceiverOption['InvoiceData']) ? $ReceiverOption['InvoiceData'] : array();&nbsp;</div></li><li><div>            $TotalTax = isset($InvoiceData['TotalTax']) ? $InvoiceData['TotalTax'] : '';&nbsp;</div></li><li><div>            $TotalShipping = isset($InvoiceData['TotalShipping']) ? $InvoiceData['TotalShipping'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // InvoiceItem Fields&nbsp;</div></li><li><div>            $InvoiceItems = isset($ReceiverOption['InvoiceItems']) ? $ReceiverOption['InvoiceItems'] : array();&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // ReceiverIdentifer Fields&nbsp;</div></li><li><div>            $ReceiverIdentifier = isset($ReceiverOption['ReceiverIdentifier']) ? $ReceiverOption['ReceiverIdentifier'] : array();&nbsp;</div></li><li><div>            $ReceiverIdentifierEmail = isset($ReceiverIdentifier['Email']) ? $ReceiverIdentifier['Email'] : '';&nbsp;</div></li><li><div>            $PhoneCountryCode = isset($ReceiverIdentifier['PhoneCountryCode']) ? $ReceiverIdentifier['PhoneCountryCode'] : '';&nbsp;</div></li><li><div>            $PhoneNumber = isset($ReceiverIdentifier['PhoneNumber']) ? $ReceiverIdentifier['PhoneNumber'] : '';&nbsp;</div></li><li><div>            $PhoneExtension = isset($ReceiverIdentifier['PhoneExtension']) ? $ReceiverIdentifier['PhoneExtension'] : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                $ReceiverOptionsXML .= '&lt;receiverOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $ReceiverOptionsXML .= $Description != '' ? '&lt;description xmlns=&quot;&quot;&gt;'.$Description.'&lt;/description&gt;' : '';&nbsp;</div></li><li><div>                $ReceiverOptionsXML .= $CustomID != '' ? '&lt;customId xmlns=&quot;&quot;&gt;'.$CustomID.'&lt;/customId&gt;' : '';&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                if(!empty($InvoiceData))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;invoiceData xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $TotalTax != '' ? '&lt;totalTax xmlns=&quot;&quot;&gt;'.$TotalTax.'&lt;/totalTax&gt;' : '';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $TotalShipping != '' ? '&lt;totalShipping xmlns=&quot;&quot;&gt;'.$TotalShipping.'&lt;/totalShipping&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;item xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Name'] != '' ? '&lt;name xmlns=&quot;&quot;&gt;'.$InvoiceItem['Name'].'&lt;/name&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Identifier'] != '' ? '&lt;identifier xmlns=&quot;&quot;&gt;'.$InvoiceItem['Identifier'].'&lt;/identifier&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['Price'] != '' ? '&lt;price xmlns=&quot;&quot;&gt;'.$InvoiceItem['Price'].'&lt;/price&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['ItemPrice'] != '' ? '&lt;itemPrice xmlns=&quot;&quot;&gt;'.$InvoiceItem['ItemPrice'].'&lt;/itemPrice&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $InvoiceItem['ItemCount'] != '' ? '&lt;itemCount xmlns=&quot;&quot;&gt;'.$InvoiceItem['ItemCount'].'&lt;/itemCount&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;/item&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;/invoiceData&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                if(count($ReceiverIdentifier) &gt; 0)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;receiver xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= $ReceiverIdentifierEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;'.$ReceiverIdentifierEmail.'&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    if($PhoneNumber != '')&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;phone xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;'.$PhoneCountryCode.'&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneNumber != '' ? '&lt;phoneNumber xmlns=&quot;&quot;&gt;'.$PhoneNumber.'&lt;/phoneNumber&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= $PhoneExtension != '' ? '&lt;extension xmlns=&quot;&quot;&gt;'.$PhoneExtension.'&lt;/extension&gt;' : '';&nbsp;</div></li><li><div>                        $ReceiverOptionsXML .= '&lt;/phone&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>                    $ReceiverOptionsXML .= '&lt;/receiver&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                $ReceiverOptionsXML .= '&lt;/receiverOptions&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;SetPaymentOptionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;'.$PayKey.'&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingAddressID != '' ? '&lt;shippingAddressId xmlns=&quot;&quot;&gt;'.$ShippingAddressID.'&lt;/shippingAddressId&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($InstitutionCustomer) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;initiatingEntity xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;institutionCustomer xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionID != '' ? '&lt;institutionId xmlns=&quot;&quot;&gt;'.$InstitutionID.'&lt;/institutionId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $FirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;'.$FirstName.'&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $LastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;'.$LastName.'&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $DisplayName != '' ? '&lt;displayName xmlns=&quot;&quot;&gt;'.$DisplayName.'&lt;/displayName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionCustomerID != '' ? '&lt;institutionCustomerId xmlns=&quot;&quot;&gt;'.$InstitutionCustomerID.'&lt;/institutionCustomerId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;'.$CountryCode.'&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $InstitutionCustomerEmail != '' ? '&lt;email xmlns=&quot;&quot;&gt;'.$InstitutionCustomerEmail.'&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/institutionCustomer&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/initiatingEntity&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($DisplayOptions) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;displayOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $EmailHeaderImageURL != '' ? '&lt;emailHeaderImageUrl xmlns=&quot;&quot;&gt;'.$EmailHeaderImageURL.'&lt;/emailHeaderImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $EmailMarketingImageURL != '' ? '&lt;emailMarketingImageUrl xmlns=&quot;&quot;&gt;'.$EmailMarketingImageURL.'&lt;/emailMarketingImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $HeaderImageURL != '' ? '&lt;headerImageUrl xmlns=&quot;&quot;&gt;'.$HeaderImageURL.'&lt;/headerImageUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;'.$BusinessName.'&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/displayOptions&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(count($SenderOptions) &gt; 0)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;senderOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $RequireShippingAddressSelection != '' ? '&lt;requireShippingAddressSelection xmlns=&quot;&quot;&gt;'.$RequireShippingAddressSelection.'&lt;/requireShippingAddressSelection&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ReferrerCode != '' ? '&lt;referrerCode xmlns=&quot;&quot;&gt;'.$ReferrerCode.'&lt;/referrerCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/senderOptions&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ReceiverOptionsXML;&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/SetPaymentOptionsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'SetPaymentOptions');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit Preapproval API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function Preapproval($DataArray)&nbsp;</div></li><li><div>    {    &nbsp;</div></li><li><div>        $PreapprovalFields = isset($DataArray['PreapprovalFields']) ? $DataArray['PreapprovalFields'] : array();&nbsp;</div></li><li><div>        $CancelURL = isset($PreapprovalFields['CancelURL']) ? $PreapprovalFields['CancelURL'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($PreapprovalFields['CurrencyCode']) ? $PreapprovalFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $DateOfMonth = isset($PreapprovalFields['DateOfMonth']) ? $PreapprovalFields['DateOfMonth'] : '';&nbsp;</div></li><li><div>        $DayOfWeek = isset($PreapprovalFields['DayOfWeek']) ? $PreapprovalFields['DayOfWeek'] : '';&nbsp;</div></li><li><div>        $EndingDate = isset($PreapprovalFields['EndingDate']) ? $PreapprovalFields['EndingDate'] : '';&nbsp;</div></li><li><div>        $IPNNotificationURL = isset($PreapprovalFields['IPNNotificationURL']) ? $PreapprovalFields['IPNNotificationURL'] : '';&nbsp;</div></li><li><div>        $MaxAmountPerPayment = isset($PreapprovalFields['MaxAmountPerPayment']) ? $PreapprovalFields['MaxAmountPerPayment'] : '';&nbsp;</div></li><li><div>        $MaxNumberOfPayments = isset($PreapprovalFields['MaxNumberOfPayments']) ? $PreapprovalFields['MaxNumberOfPayments'] : '';&nbsp;</div></li><li><div>        $MaxNumberOfPaymentsPerPeriod = isset($PreapprovalFields['MaxNumberOfPaymentsPerPeriod']) ? $PreapprovalFields['MaxNumberOfPaymentsPerPeriod'] : '';&nbsp;</div></li><li><div>        $MaxTotalAmountOfAllPayments = isset($PreapprovalFields['MaxTotalAmountOfAllPayments']) ? $PreapprovalFields['MaxTotalAmountOfAllPayments'] : '';&nbsp;</div></li><li><div>        $Memo = isset($PreapprovalFields['Memo']) ? $PreapprovalFields['Memo'] : '';&nbsp;</div></li><li><div>        $PaymentPeriod = isset($PreapprovalFields['PaymentPeriod']) ? $PreapprovalFields['PaymentPeriod'] : '';&nbsp;</div></li><li><div>        $PinType = isset($PreapprovalFields['PinType']) ? $PreapprovalFields['PinType'] : '';&nbsp;</div></li><li><div>        $ReturnURL = isset($PreapprovalFields['ReturnURL']) ? $PreapprovalFields['ReturnURL'] : '';&nbsp;</div></li><li><div>        $SenderEmail = isset($PreapprovalFields['SenderEmail']) ? $PreapprovalFields['SenderEmail'] : '';&nbsp;</div></li><li><div>        $StartingDate = isset($PreapprovalFields['StartingDate']) ? $PreapprovalFields['StartingDate'] : '';&nbsp;</div></li><li><div>        $FeesPayer = isset($PreapprovalFields['FeesPayer']) ? $PreapprovalFields['FeesPayer'] : '';&nbsp;</div></li><li><div>        $DisplayMaxTotalAmount = isset($PreapprovalFields['DisplayMaxTotalAmount']) ? $PreapprovalFields['DisplayMaxTotalAmount'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ClientDetailsFields = isset($DataArray['ClientDetailsFields']) ? $DataArray['ClientDetailsFields'] : array();&nbsp;</div></li><li><div>        $CustomerID = isset($ClientDetailsFields['CustomerID']) ? $ClientDetailsFields['CustomerID'] : '';&nbsp;</div></li><li><div>        $CustomerType = isset($ClientDetailsFields['CustomerType']) ? $ClientDetailsFields['CustomerType'] : '';&nbsp;</div></li><li><div>        $GeoLocation = isset($ClientDetailsFields['GeoLocation']) ? $ClientDetailsFields['GeoLocation'] : '';&nbsp;</div></li><li><div>        $Model = isset($ClientDetailsFields['Model']) ? $ClientDetailsFields['Model'] : '';&nbsp;</div></li><li><div>        $PartnerName = isset($ClientDetailsFields['PartnerName']) ? $ClientDetailsFields['PartnerName'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;PreapprovalRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;cancelUrl xmlns=&quot;&quot;&gt;' . $CancelURL . '&lt;/cancelUrl&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;clientDetails xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; ApplicationID != '' ? '&lt;applicationId xmlns=&quot;&quot;&gt;' . $this -&gt; ApplicationID . '&lt;/applicationId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CustomerID != '' ? '&lt;customerId xmlns=&quot;&quot;&gt;' . $CustomerID . '&lt;/customerId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CustomerType != '' ? '&lt;customerType xmlns=&quot;&quot;&gt;' . $CustomerType . '&lt;/customerType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; DeviceID != '' ? '&lt;deviceId xmlns=&quot;&quot;&gt;' . $this -&gt; DeviceID . '&lt;/deviceId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $GeoLocation != '' ? '&lt;geoLocation xmlns=&quot;&quot;&gt;' . $GeoLocation . '&lt;/geoLocation&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; IPAddress != '' ? '&lt;ipAddress xmlns=&quot;&quot;&gt;' . $this -&gt; IPAddress . '&lt;/ipAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Model != '' ? '&lt;model xmlns=&quot;&quot;&gt;' . $Model . '&lt;/model&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerName != '' ? '&lt;partnerName xmlns=&quot;&quot;&gt;' . $PartnerName . '&lt;/partnerName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/clientDetails&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $DateOfMonth != '' ? '&lt;dateOfMonth xmlns=&quot;&quot;&gt;' . $DateOfMonth . '&lt;/dateOfMonth&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DayOfWeek != '' ? '&lt;dayOfWeek xmlns=&quot;&quot;&gt;' . $DayOfWeek . '&lt;/dayOfWeek&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $EndingDate != '' ? '&lt;endingDate xmlns=&quot;&quot;&gt;' . $EndingDate . '&lt;/endingDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $IPNNotificationURL != '' ? '&lt;ipnNotificationUrl xmlns=&quot;&quot;&gt;' . $IPNNotificationURL . '&lt;/ipnNotificationUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MaxAmountPerPayment != '' ? '&lt;maxAmountPerPayment xmlns=&quot;&quot;&gt;' . $MaxAmountPerPayment . '&lt;/maxAmountPerPayment&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MaxNumberOfPayments != '' ? '&lt;maxNumberOfPayments xmlns=&quot;&quot;&gt;' . $MaxNumberOfPayments . '&lt;/maxNumberOfPayments&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MaxNumberOfPaymentsPerPeriod != '' ? '&lt;maxNumberOfPaymentsPerPeriod xmlns=&quot;&quot;&gt;' . $MaxNumberOfPaymentsPerPeriod . '&lt;/maxNumberOfPaymentsPerPeriod&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MaxTotalAmountOfAllPayments != '' ? '&lt;maxTotalAmountOfAllPayments xmlns=&quot;&quot;&gt;' . $MaxTotalAmountOfAllPayments . '&lt;/maxTotalAmountOfAllPayments&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Memo != '' ? '&lt;memo xmlns=&quot;&quot;&gt;' . $Memo . '&lt;/memo&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PaymentPeriod != '' ? '&lt;paymentPeriod xmlns=&quot;&quot;&gt;' . $PaymentPeriod . '&lt;/paymentPeriod&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PinType != '' ? '&lt;pinType xmlns=&quot;&quot;&gt;' . $PinType . '&lt;/pinType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $FeesPayer != '' ? '&lt;feesPayer xmlns=&quot;&quot;&gt;' . $FeesPayer . '&lt;/feesPayer&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DisplayMaxTotalAmount != '' ? '&lt;displayMaxTotalAmount xmlns=&quot;&quot;&gt;' . $DisplayMaxTotalAmount . '&lt;/displayMaxTotalAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SenderEmail != '' ? '&lt;senderEmail xmlns=&quot;&quot;&gt;' . $SenderEmail . '&lt;/senderEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $StartingDate != '' ? '&lt;startingDate xmlns=&quot;&quot;&gt;' . $StartingDate . '&lt;/startingDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/PreapprovalRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'Preapproval');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PreapprovalKey = $DOM -&gt; getElementsByTagName('preapprovalKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('preapprovalKey') -&gt; item(0) -&gt; nodeValue: '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($this -&gt; Sandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $RedirectURL = 'https://www.sandbox.paypal.com/webscr?cmd=_ap-preapproval&preapprovalkey=' . $PreapprovalKey;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif($this -&gt; BetaSandbox)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $RedirectURL = 'https://www.beta-sandbox.paypal.com/webscr?cmd=_ap-preapproval&preapprovalkey=' . $PreapprovalKey;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $RedirectURL = 'https://www.paypal.com/webscr?cmd=_ap-preapproval&preapprovalkey=' . $PreapprovalKey;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PreapprovalKey' =&gt; $PreapprovalKey, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $PreapprovalKey != '' ? $RedirectURL : '', &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit PreapprovalDetails API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function PreapprovalDetails($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $PreapprovalDetailsFields = isset($DataArray['PreapprovalDetailsFields']) ? $DataArray['PreapprovalDetailsFields'] : array();&nbsp;</div></li><li><div>        $GetBillingAddress = isset($PreapprovalDetailsFields['GetBillingAddress']) ? $PreapprovalDetailsFields['GetBillingAddress'] : '';&nbsp;</div></li><li><div>        $PreapprovalKey = isset($PreapprovalDetailsFields['PreapprovalKey']) ? $PreapprovalDetailsFields['PreapprovalKey'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;PreapprovalDetailsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $GetBillingAddress != '' ? '&lt;getBillingAddress xmlns=&quot;&quot;&gt;' . $GetBillingAddress . '&lt;/getBillingAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PreapprovalKey != '' ? '&lt;preapprovalKey xmlns=&quot;&quot;&gt;' . $PreapprovalKey . '&lt;/preapprovalKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/PreapprovalDetailsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'PreapprovalDetails');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Approved = $DOM -&gt; getElementsByTagName('approved') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('approved') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CancelURL = $DOM -&gt; getElementsByTagName('cancelUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('cancelUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurPayments = $DOM -&gt; getElementsByTagName('curPayments') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('curPayments') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurPaymentsAmount = $DOM -&gt; getElementsByTagName('curPaymentsAmount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('curPaymentsAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurPeriodAttempts = $DOM -&gt; getElementsByTagName('curPeriodAttempts') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('curPeriodAttempts') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurPeriodEndingDate = $DOM -&gt; getElementsByTagName('curPeriodEndingDate') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('curPeriodEndingDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CurrencyCode = $DOM -&gt; getElementsByTagName('currencyCode') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('currencyCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $DateOfMonth = $DOM -&gt; getElementsByTagName('dateOfMonth') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('dateOfMonth') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $DayOfWeek = $DOM -&gt; getElementsByTagName('dayOfWeek') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('dayOfWeek') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $EndingDate = $DOM -&gt; getElementsByTagName('endingDate') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('endingDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $IPNNotificationURL = $DOM -&gt; getElementsByTagName('ipnNotificationUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ipnNotificationUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $MaxAmountPerPayment = $DOM -&gt; getElementsByTagName('maxAmountPerPayment') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('maxAmountPerPayment') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $MaxNumberOfPayments = $DOM -&gt; getElementsByTagName('maxNumberOfPayments') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('maxNumberOfPayments') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $MaxNumberOfPaymentsPerPeriod = $DOM -&gt; getElementsByTagName('maxNumberOfPaymentsPerPeriod') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('maxNumberOfPaymentsPerPeriod') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $MaxTotalAmountOfAllPayments = $DOM -&gt; getElementsByTagName('maxTotalAmountOfAllPayments') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('maxTotalAmountOfAllPayments') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Memo = $DOM -&gt; getElementsByTagName('memo') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('memo') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentPeriod = $DOM -&gt; getElementsByTagName('paymentPeriod') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentPeriod') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PinType = $DOM -&gt; getElementsByTagName('pinType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('pinType') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $ReturnUrl = $DOM -&gt; getElementsByTagName('returnUrl') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('returnUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $SenderEmail = $DOM -&gt; getElementsByTagName('senderEmail') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('senderEmail') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $StartingDate = $DOM -&gt; getElementsByTagName('startingDate') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('startingDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Status = $DOM -&gt; getElementsByTagName('status') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('status') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'Approved' =&gt; $Approved, &nbsp;</div></li><li><div>                                   'CancelURL' =&gt; $CancelURL, &nbsp;</div></li><li><div>                                   'CurPayments' =&gt; $CurPayments, &nbsp;</div></li><li><div>                                   'CurPaymentsAmount' =&gt; $CurPaymentsAmount, &nbsp;</div></li><li><div>                                   'CurPeriodAttempts' =&gt; $CurPeriodAttempts, &nbsp;</div></li><li><div>                                   'CurPeriodEndingDate' =&gt; $CurPeriodEndingDate, &nbsp;</div></li><li><div>                                   'CurrencyCode' =&gt; $CurrencyCode, &nbsp;</div></li><li><div>                                   'DateOfMonth' =&gt; $DateOfMonth, &nbsp;</div></li><li><div>                                   'DayOfWeek' =&gt; $DayOfWeek, &nbsp;</div></li><li><div>                                   'EndingDate' =&gt; $EndingDate, &nbsp;</div></li><li><div>                                   'IPNNotificationURL' =&gt; $IPNNotificationURL, &nbsp;</div></li><li><div>                                   'MaxAmountPerPayment' =&gt; $MaxAmountPerPayment, &nbsp;</div></li><li><div>                                   'MaxNumberOfPayments' =&gt; $MaxNumberOfPayments, &nbsp;</div></li><li><div>                                   'MaxNumberOfPaymentsPerPeriod' =&gt; $MaxNumberOfPaymentsPerPeriod, &nbsp;</div></li><li><div>                                   'MaxTotalAmountOfAllPayments' =&gt; $MaxTotalAmountOfAllPayments, &nbsp;</div></li><li><div>                                   'Memo' =&gt; $Memo, &nbsp;</div></li><li><div>                                   'PaymentPeriod' =&gt; $PaymentPeriod, &nbsp;</div></li><li><div>                                   'PinType' =&gt; $PinType, &nbsp;</div></li><li><div>                                   'ReturnUrl' =&gt; $ReturnUrl, &nbsp;</div></li><li><div>                                   'SenderEmail' =&gt; $SenderEmail, &nbsp;</div></li><li><div>                                   'StartingDate' =&gt; $StartingDate, &nbsp;</div></li><li><div>                                   'Status' =&gt; $Status, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit CancelPreapproval API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function CancelPreapproval($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $CancelPreapprovalFields = isset($DataArray['CancelPreapprovalFields']) ? $DataArray['CancelPreapprovalFields'] : array();&nbsp;</div></li><li><div>        $PreapprovalKey = isset($CancelPreapprovalFields['PreapprovalKey']) ? $CancelPreapprovalFields['PreapprovalKey'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CancelPreapprovalRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PreapprovalKey != '' ? '&lt;preapprovalKey xmlns=&quot;&quot;&gt;' . $PreapprovalKey . '&lt;/preapprovalKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CancelPreapprovalRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'CancelPreapproval');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit Refund API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function Refund($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $RefundFields = isset($DataArray['RefundFields']) ? $DataArray['RefundFields'] : array();&nbsp;</div></li><li><div>        $CurrencyCode = isset($RefundFields['CurrencyCode']) ? $RefundFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $PayKey = isset($RefundFields['PayKey']) ? $RefundFields['PayKey'] : '';&nbsp;</div></li><li><div>        $TransactionID = isset($RefundFields['TransactionID']) ? $RefundFields['TransactionID'] : '';&nbsp;</div></li><li><div>        $TrackingID = isset($RefundFields['TrackingID']) ? $RefundFields['TrackingID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Receivers = isset($DataArray['Receivers']) ? $DataArray['Receivers'] : array();&nbsp;</div></li><li><div>        $Amount = isset($Receivers['Amount']) ? $Receivers['Amount'] : '';&nbsp;</div></li><li><div>        $Email = isset($Receivers['Email']) ? $Receivers['Email'] : '';&nbsp;</div></li><li><div>        $InvoiceID = isset($Receivers['InvoiceID']) ? $Receivers['InvoiceID'] : '';&nbsp;</div></li><li><div>        $Primary = isset($Receivers['Primary']) ? $Receivers['Primary'] : '';&nbsp;</div></li><li><div>        $PaymentType = isset($Receivers['PaymentType']) ? $Receivers['PaymentType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;RefundRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;' . $PayKey . '&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($Receivers))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;receiverList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            foreach($Receivers as $Receiver)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;receiver xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Amount'] != '' ? '&lt;amount xmlns=&quot;&quot;&gt;' . $Receiver['Amount'] . '&lt;/amount&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['Email'] != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $Receiver['Email'] . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['InvoiceID'] != '' ? '&lt;invoiceId xmlns=&quot;&quot;&gt;' . $Receiver['InvoiceID'] . '&lt;/invoiceId&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $Receiver['PaymentType'] != '' ? '&lt;paymentType xmlns=&quot;&quot;&gt;' . $Receiver['PaymentType'] . '&lt;/paymentType&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/receiver&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/receiverList&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $TransactionID != '' ? '&lt;transactionId xmlns=&quot;&quot;&gt;' . $TransactionID . '&lt;/transactionId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TrackingID != '' ? '&lt;trackingId xmlns=&quot;&quot;&gt;' . $TrackingID . '&lt;/trackingId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/RefundRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'Refund');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $EncryptedTransactionID = $DOM -&gt; getElementsByTagName('encryptedRefundTransactionId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('encryptedRefundTransactionId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundFeeAmount = $DOM -&gt; getElementsByTagName('refundFeeAmount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundFeeAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundGrossAmount = $DOM -&gt; getElementsByTagName('refundGrossAmount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundGrossAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundHasBecomeFull = $DOM -&gt; getElementsByTagName('refundHasBecomeFull') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundHasBecomeFull') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundNetAmount = $DOM -&gt; getElementsByTagName('refundNetAmount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundNetAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundStatus = $DOM -&gt; getElementsByTagName('refundStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RefundTransactionStatus = $DOM -&gt; getElementsByTagName('refundTransactionStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('refundTransactionStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TotalOfAllRefunds = $DOM -&gt; getElementsByTagName('totalOfAllRefunds') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('totalOfAllRefunds') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Amount = $DOM -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Email = $DOM -&gt; getElementsByTagName('email') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('email') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PaymentType = $DOM -&gt; getElementsByTagName('paymentType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paymentType') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Primary = $DOM -&gt; getElementsByTagName('primary') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('primary') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Receiver = array(&nbsp;</div></li><li><div>                        'Amount' =&gt; $Amount, &nbsp;</div></li><li><div>                        'Email' =&gt; $Email, &nbsp;</div></li><li><div>                        'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                        'PaymentType' =&gt; $PaymentType, &nbsp;</div></li><li><div>                        'Primary' =&gt; $Primary&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'EncryptedTransactionID' =&gt; $EncryptedTransactionID, &nbsp;</div></li><li><div>                                   'RefundFeeAmount' =&gt; $RefundFeeAmount, &nbsp;</div></li><li><div>                                   'RefundGrossAmount' =&gt; $RefundGrossAmount, &nbsp;</div></li><li><div>                                   'RefundHasBecomeFull' =&gt; $RefundHasBecomeFull, &nbsp;</div></li><li><div>                                   'RefundNetAmount' =&gt; $RefundNetAmount, &nbsp;</div></li><li><div>                                   'RefundStatus' =&gt; $RefundStatus, &nbsp;</div></li><li><div>                                   'RefundTransactionStatus' =&gt; $RefundTransactionStatus, &nbsp;</div></li><li><div>                                   'TotalOfAllRefunds' =&gt; $TotalOfAllRefunds, &nbsp;</div></li><li><div>                                   'Receiver' =&gt; $Receiver, &nbsp;</div></li><li><div>                                   'RawRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'RawResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit ConvertCurrency API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function ConvertCurrency($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $BaseAmountList = isset($DataArray['BaseAmountList']) ? $DataArray['BaseAmountList'] : array();&nbsp;</div></li><li><div>        $ConvertToCurrencyList = isset($DataArray['ConvertToCurrencyList']) ? $DataArray['ConvertToCurrencyList'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;ConvertCurrencyRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;baseAmountList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        foreach($BaseAmountList as $BaseAmount)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;currency xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;code xmlns=&quot;&quot;&gt;' . $BaseAmount['Code'] . '&lt;/code&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;amount xmlns=&quot;&quot;&gt;' . $BaseAmount['Amount'] . '&lt;/amount&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/currency&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/baseAmountList&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;convertToCurrencyList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        foreach($ConvertToCurrencyList as $CurrencyCode)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/convertToCurrencyList&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/ConvertCurrencyRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'ConvertCurrency');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $CurrencyConversionListArray = array();&nbsp;</div></li><li><div>        $CurrencyConversionListDOM = $DOM -&gt; getElementsByTagName('currencyConversionList') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('currencyConversionList') : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        foreach($CurrencyConversionListDOM as $CurrencyConversionList)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $BaseAmountDOM = $CurrencyConversionList -&gt; getElementsByTagName('baseAmount') -&gt; length &gt; 0 ? $CurrencyConversionList -&gt; getElementsByTagName('baseAmount') : array();        &nbsp;</div></li><li><div>            foreach($BaseAmountDOM as $BaseAmount)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $BaseAmountCurrencyCode = $BaseAmount -&gt; getElementsByTagName('code') -&gt; length &gt; 0 ? $BaseAmount -&gt; getElementsByTagName('code') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BaseAmountValue = $BaseAmount -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $BaseAmount -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BaseAmountArray = array(&nbsp;</div></li><li><div>                                         'Code' =&gt; $BaseAmountCurrencyCode, &nbsp;</div></li><li><div>                                         'Amount' =&gt; $BaseAmountValue&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $CurrencyListArray = array();&nbsp;</div></li><li><div>            $CurrencyListDOM = $CurrencyConversionList -&gt; getElementsByTagName('currency') -&gt; length &gt; 0 ? $CurrencyConversionList -&gt; getElementsByTagName('currency') : array();&nbsp;</div></li><li><div>            foreach($CurrencyListDOM as $CurrencyList)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $ListCurrencyCode = $CurrencyList -&gt; getElementsByTagName('code') -&gt; length &gt; 0 ? $CurrencyList -&gt; getElementsByTagName('code') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ListCurrencyAmount = $CurrencyList -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $CurrencyList -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ListCurrencyCurrent = array(&nbsp;</div></li><li><div>                                             'Code' =&gt; $ListCurrencyCode, &nbsp;</div></li><li><div>                                             'Amount' =&gt; $ListCurrencyAmount&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                array_push($CurrencyListArray, $ListCurrencyCurrent);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $CurrencyConversionListCurrent = array(&nbsp;</div></li><li><div>                                                   'BaseAmount' =&gt; $BaseAmountArray, &nbsp;</div></li><li><div>                                                   'CurrencyList' =&gt; $CurrencyListArray&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            array_push($CurrencyConversionListArray, $CurrencyConversionListCurrent);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'CurrencyConversionList' =&gt; $CurrencyConversionListArray, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit CreateAccount API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function CreateAccount($DataArray)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $CreateAccountFields = isset($DataArray['CreateAccountFields']) ? $DataArray['CreateAccountFields'] : array();&nbsp;</div></li><li><div>        $AccountType = isset($CreateAccountFields['AccountType']) ? $CreateAccountFields['AccountType'] : '';&nbsp;</div></li><li><div>        $CitizenshipCountryCode = isset($CreateAccountFields['CitizenshipCountryCode']) ? $CreateAccountFields['CitizenshipCountryCode'] : '';&nbsp;</div></li><li><div>        $ContactPhoneNumber = isset($CreateAccountFields['ContactPhoneNumber']) ? $CreateAccountFields['ContactPhoneNumber'] : '';&nbsp;</div></li><li><div>        $HomePhoneNumber = isset($CreateAccountFields['HomePhoneNumber']) ? $CreateAccountFields['HomePhoneNumber'] : '';&nbsp;</div></li><li><div>        $MobilePhoneNumber = isset($CreateAccountFields['MobilePhoneNumber']) ? $CreateAccountFields['MobilePhoneNumber'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($CreateAccountFields['CurrencyCode']) ? $CreateAccountFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $DateOfBirth = isset($CreateAccountFields['DateOfBirth']) ? $CreateAccountFields['DateOfBirth'] : '';&nbsp;</div></li><li><div>        $EmailAddress = isset($CreateAccountFields['EmailAddress']) ? $CreateAccountFields['EmailAddress'] : '';&nbsp;</div></li><li><div>        $Salutation = isset($CreateAccountFields['Salutation']) ? $CreateAccountFields['Salutation'] : '';&nbsp;</div></li><li><div>        $FirstName = isset($CreateAccountFields['FirstName']) ? $CreateAccountFields['FirstName'] : '';&nbsp;</div></li><li><div>        $MiddleName = isset($CreateAccountFields['MiddleName']) ? $CreateAccountFields['MiddleName'] : '';&nbsp;</div></li><li><div>        $LastName = isset($CreateAccountFields['LastName']) ? $CreateAccountFields['LastName'] : '';&nbsp;</div></li><li><div>        $Suffix = isset($CreateAccountFields['Suffix']) ? $CreateAccountFields['Suffix'] : '';&nbsp;</div></li><li><div>        $NotificationURL = isset($CreateAccountFields['NotificationURL']) ? $CreateAccountFields['NotificationURL'] : '';&nbsp;</div></li><li><div>        $PerformExtraVettingOnThisAccount = isset($CreateAccountFields['PerformExtraVettingOnThisAccount']) ? $CreateAccountFields['PerformExtraVettingOnThisAccount'] : '';        &nbsp;</div></li><li><div>        $PreferredLanguageCode = isset($CreateAccountFields['PreferredLanguageCode']) && $CreateAccountFields['PreferredLanguageCode'] != '' ? $CreateAccountFields['PreferredLanguageCode'] : 'en_US';&nbsp;</div></li><li><div>        $RegistrationType = isset($CreateAccountFields['RegistrationType']) ? $CreateAccountFields['RegistrationType'] : 'Web';&nbsp;</div></li><li><div>        $SuppressWelcomeEmail = isset($CreateAccountFields['SuppressWelcomeEmail']) ? $CreateAccountFields['SuppressWelcomeEmail'] : '';&nbsp;</div></li><li><div>        $TaxID = isset($CreateAccountFields['TaxID']) ? $CreateAccountFields['TaxID'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ReturnURL = isset($CreateAccountFields['ReturnURL']) ? $CreateAccountFields['ReturnURL'] : '';&nbsp;</div></li><li><div>        $ShowAddCreditCard = isset($CreateAccountFields['ShowAddCreditCard']) ? $CreateAccountFields['ShowAddCreditCard'] : '';&nbsp;</div></li><li><div>        $ShowMobileConfirm = isset($CreateAccountFields['ShowMobileConfirm']) ? $CreateAccountFields['ShowMobileConfirm'] : '';&nbsp;</div></li><li><div>        $ReturnURLDescription = isset($CreateAccountFields['ReturnURLDescription']) ? $CreateAccountFields['ReturnURLDescription'] : '';&nbsp;</div></li><li><div>        $UseMiniBrowser = isset($CreateAccountFields['UseMiniBrowser']) ? $CreateAccountFields['UseMiniBrowser'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Address = isset($DataArray['Address']) ? $DataArray['Address'] : array();&nbsp;</div></li><li><div>        $Line1 = isset($Address['Line1']) ? $Address['Line1'] : '';&nbsp;</div></li><li><div>        $Line2 = isset($Address['Line2']) ? $Address['Line2'] : '';&nbsp;</div></li><li><div>        $City = isset($Address['City']) ? $Address['City'] : '';&nbsp;</div></li><li><div>        $State = isset($Address['State']) ? $Address['State'] : '';&nbsp;</div></li><li><div>        $PostalCode = isset($Address['PostalCode']) ? $Address['PostalCode'] : '';&nbsp;</div></li><li><div>        $CountryCode = isset($Address['CountryCode']) ? $Address['CountryCode'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $BusinessInfo = isset($DataArray['BusinessInfo']) ? $DataArray['BusinessInfo'] : array();&nbsp;</div></li><li><div>        $AveragePrice = isset($BusinessInfo['AveragePrice']) ? $BusinessInfo['AveragePrice'] : '';&nbsp;</div></li><li><div>        $AverageMonthlyVolume = isset($BusinessInfo['AverageMonthlyVolume']) ? $BusinessInfo['AverageMonthlyVolume'] : '';&nbsp;</div></li><li><div>        $BusinessName = isset($BusinessInfo['BusinessName']) ? $BusinessInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BusinessType = isset($BusinessInfo['BusinessType']) ? $BusinessInfo['BusinessType'] : '';&nbsp;</div></li><li><div>        $BusinessSubType = isset($BusinessInfo['BusinessSubType']) ? $BusinessInfo['BusinessSubType'] : '';&nbsp;</div></li><li><div>        $Category = isset($BusinessInfo['Category']) ? $BusinessInfo['Category'] : '';&nbsp;</div></li><li><div>        $CommercialRegistrationLocation = isset($BusinessInfo['CommercialRegistrationLocation']) ? $BusinessInfo['CommercialRegistrationLocation'] : '';&nbsp;</div></li><li><div>        $CompanyID = isset($BusinessInfo['CompanyID']) ? $BusinessInfo['CompanyID'] : '';&nbsp;</div></li><li><div>        $CustomerServiceEmail = isset($BusinessInfo['CustomerServiceEmail']) ? $BusinessInfo['CustomerServiceEmail'] : '';&nbsp;</div></li><li><div>        $CustomerServicePhone = isset($BusinessInfo['CustomerServicePhone']) ? $BusinessInfo['CustomerServicePhone'] : '';&nbsp;</div></li><li><div>        $DateOfEstablishment = isset($BusinessInfo['DateOfEstablishment']) ? $BusinessInfo['DateOfEstablishment'] : '';&nbsp;</div></li><li><div>        $DisputeEmail = isset($BusinessInfo['DisputeEmail']) ? $BusinessInfo['DisputeEmail'] : '';&nbsp;</div></li><li><div>        $DoingBusinessAs = isset($BusinessInfo['DoingBusinessAs']) ? $BusinessInfo['DoingBusinessAs'] : '';&nbsp;</div></li><li><div>        $EstablishmentCountryCode = isset($BusinessInfo['EstablishmentCountryCode']) ? $BusinessInfo['EstablishmentCountryCode'] : '';&nbsp;</div></li><li><div>        $EstablishmentState = isset($BusinessInfo['EstablishmentState']) ? $BusinessInfo['EstablishmentState'] : '';&nbsp;</div></li><li><div>        $IncorporationID = isset($BusinessInfo['IncorporationID']) ? $BusinessInfo['IncorporationID'] : '';&nbsp;</div></li><li><div>        $MerchantCategoryCode = isset($BusinessInfo['MerchantCategoryCode']) ? $BusinessInfo['MerchantCategoryCode'] : '';&nbsp;</div></li><li><div>        $PercentageRevenueFromOnline = isset($BusinessInfo['PercentageRevenueFromOnline']) ? $BusinessInfo['PercentageRevenueFromOnline'] : '';&nbsp;</div></li><li><div>        $SalesVenu = isset($BusinessInfo['SalesVenu']) ? $BusinessInfo['SalesVenu'] : '';&nbsp;</div></li><li><div>        $SalesVenuDesc = isset($BusinessInfo['SalesVenuDesc']) ? $BusinessInfo['SalesVenuDesc'] : '';&nbsp;</div></li><li><div>        $SubCategory = isset($BusinessInfo['SubCategory']) ? $BusinessInfo['SubCategory'] : '';&nbsp;</div></li><li><div>        $VatCountryCode = isset($BusinessInfo['VatCountryCode']) ? $BusinessInfo['VatCountryCode'] : '';&nbsp;</div></li><li><div>        $VatID = isset($BusinessInfo['VatID']) ? $BusinessInfo['VatID'] : '';&nbsp;</div></li><li><div>        $WebSite = isset($BusinessInfo['WebSite']) ? $BusinessInfo['WebSite'] : '';&nbsp;</div></li><li><div>        $WorkPhone = isset($BusinessInfo['WorkPhone']) ? $BusinessInfo['WorkPhone'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessAddress = isset($DataArray['BusinessAddress']) ? $DataArray['BusinessAddress'] : array();&nbsp;</div></li><li><div>        $BusinessAddressLine1 = isset($BusinessAddress['Line1']) ? $BusinessAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BusinessAddressLine2 = isset($BusinessAddress['Line2']) ? $BusinessAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BusinessAddressCity = isset($BusinessAddress['City']) ? $BusinessAddress['City'] : '';&nbsp;</div></li><li><div>        $BusinessAddressState = isset($BusinessAddress['State']) ? $BusinessAddress['State'] : '';&nbsp;</div></li><li><div>        $BusinessAddressPostalCode = isset($BusinessAddress['PostalCode']) ? $BusinessAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BusinessAddressCountryCode = isset($BusinessAddress['CountryCode']) ? $BusinessAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddress = isset($DataArray['PrinciplePlaceOfBusinessAddress']) ? $DataArray['PrinciplePlaceOfBusinessAddress'] : array();&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressLine1 = isset($PrinciplePlaceOfBusinessAddress['Line1']) ? $PrinciplePlaceOfBusinessAddress['Line1'] : '';&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressLine2 = isset($PrinciplePlaceOfBusinessAddress['Line2']) ? $PrinciplePlaceOfBusinessAddress['Line2'] : '';&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressCity = isset($PrinciplePlaceOfBusinessAddress['City']) ? $PrinciplePlaceOfBusinessAddress['City'] : '';&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressState = isset($PrinciplePlaceOfBusinessAddress['State']) ? $PrinciplePlaceOfBusinessAddress['State'] : '';&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressPostalCode = isset($PrinciplePlaceOfBusinessAddress['PostalCode']) ? $PrinciplePlaceOfBusinessAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $PrinciplePlaceOfBusinessAddressCountryCode = isset($PrinciplePlaceOfBusinessAddress['CountryCode']) ? $PrinciplePlaceOfBusinessAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $RegisteredOfficeAddress = isset($DataArray['RegisteredOfficeAddress']) ? $DataArray['RegisteredOfficeAddress'] : array();&nbsp;</div></li><li><div>        $RegisteredOfficeAddressLine1 = isset($RegisteredOfficeAddress['Line1']) ? $RegisteredOfficeAddress['Line1'] : '';&nbsp;</div></li><li><div>        $RegisteredOfficeAddressLine2 = isset($RegisteredOfficeAddress['Line2']) ? $RegisteredOfficeAddress['Line2'] : '';&nbsp;</div></li><li><div>        $RegisteredOfficeAddressCity = isset($RegisteredOfficeAddress['City']) ? $RegisteredOfficeAddress['City'] : '';&nbsp;</div></li><li><div>        $RegisteredOfficeAddressState = isset($RegisteredOfficeAddress['State']) ? $RegisteredOfficeAddress['State'] : '';&nbsp;</div></li><li><div>        $RegisteredOfficeAddressPostalCode = isset($RegisteredOfficeAddress['PostalCode']) ? $RegisteredOfficeAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $RegisteredOfficeAddressCountryCode = isset($RegisteredOfficeAddress['CountryCode']) ? $RegisteredOfficeAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessStakeHolder = isset($DataArray['BusinessStakeHolder']) ? $DataArray['BusinessStakeHolder'] : array();&nbsp;</div></li><li><div>        $BusinessStakeHolderDateOfBirth = isset($BusinessStakeHolder['DateOfBirth']) ? $BusinessStakeHolder['DateOfBirth'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderFullLegalName = isset($BusinessStakeHolder['FullLegalName']) ? $BusinessStakeHolder['FullLegalName'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderSalutation = isset($BusinessStakeHolder['Salutation']) ? $BusinessStakeHolder['Salutation'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderFirstName = isset($BusinessStakeHolder['FirstName']) ? $BusinessStakeHolder['FirstName'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderMiddleName = isset($BusinessStakeHolder['MiddleName']) ? $BusinessStakeHolder['MiddleName'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderLastName = isset($BusinessStakeHolder['LastName']) ? $BusinessStakeHolder['LastName'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderSuffix = isset($BusinessStakeHolder['Suffix']) ? $BusinessStakeHolder['Suffix'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderRole = isset($BusinessStakeHolder['Role']) ? $BusinessStakeHolder['Role'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderCountryCode = isset($BusinessStakeHolder['CountryCode']) ? $BusinessStakeHolder['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessStakeHolderAddress = isset($DataArray['BusinessStakeHolderAddress']) ? $DataArray['BusinessStakeHolderAddress'] : array();&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressLine1 = isset($BusinessStakeHolderAddress['Line1']) ? $BusinessStakeHolderAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressLine2 = isset($BusinessStakeHolderAddress['Line2']) ? $BusinessStakeHolderAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressCity = isset($BusinessStakeHolderAddress['City']) ? $BusinessStakeHolderAddress['City'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressState = isset($BusinessStakeHolderAddress['State']) ? $BusinessStakeHolderAddress['State'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressPostalCode = isset($BusinessStakeHolderAddress['PostalCode']) ? $BusinessStakeHolderAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BusinessStakeHolderAddressCountryCode = isset($BusinessStakeHolderAddress['CountryCode']) ? $BusinessStakeHolderAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PartnerFields = isset($DataArray['PartnerFields']) ? $DataArray['PartnerFields'] : array();&nbsp;</div></li><li><div>        $PartnerField1 = isset($PartnerFields['Field1']) ? $PartnerFields['Field1'] : '';&nbsp;</div></li><li><div>        $PartnerField2 = isset($PartnerFields['Field2']) ? $PartnerFields['Field2'] : '';&nbsp;</div></li><li><div>        $PartnerField3 = isset($PartnerFields['Field3']) ? $PartnerFields['Field3'] : '';&nbsp;</div></li><li><div>        $PartnerField4 = isset($PartnerFields['Field4']) ? $PartnerFields['Field4'] : '';&nbsp;</div></li><li><div>        $PartnerField5 = isset($PartnerFields['Field5']) ? $PartnerFields['Field5'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CreateAccountRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $AccountType != '' ? '&lt;accountType xmlns=&quot;&quot;&gt;' . $AccountType . '&lt;/accountType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $EmailAddress != '' ? '&lt;emailAddress xmlns=&quot;&quot;&gt;' . $EmailAddress . '&lt;/emailAddress&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($Salutation != '' || $FirstName != '' || $MiddleName != '' || $LastName != '' || $Suffix != '')&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;name xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Salutation != '' ? '&lt;salutation xmlns=&quot;&quot;&gt;' . $Salutation . '&lt;/salutation&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $FirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $FirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $MiddleName != '' ? '&lt;middleName xmlns=&quot;&quot;&gt;' . $MiddleName . '&lt;/middleName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $LastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $LastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Suffix != '' ? '&lt;suffix xmlns=&quot;&quot;&gt;' . $Suffix . '&lt;/suffix&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/name&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $DateOfBirth != '' ? '&lt;dateOfBirth xmlns=&quot;&quot;&gt;' . $DateOfBirth . '&lt;/dateOfBirth&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($Address))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Line1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $Line1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Line2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $Line2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $City != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $City . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $State != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $State . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $PostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $PostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $CountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ContactPhoneNumber != '' ? '&lt;contactPhoneNumber xmlns=&quot;&quot;&gt;' . $ContactPhoneNumber . '&lt;/contactPhoneNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $HomePhoneNumber != '' ? '&lt;homePhoneNumber xmlns=&quot;&quot;&gt;' . $HomePhoneNumber . '&lt;/homePhoneNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MobilePhoneNumber != '' ? '&lt;mobilePhoneNumber xmlns=&quot;&quot;&gt;' . $MobilePhoneNumber . '&lt;/mobilePhoneNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CitizenshipCountryCode != '' ? '&lt;citizenshipCountryCode xmlns=&quot;&quot;&gt;' . $CitizenshipCountryCode . '&lt;/citizenshipCountryCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PreferredLanguageCode != '' ? '&lt;preferredLanguageCode xmlns=&quot;&quot;&gt;' . $PreferredLanguageCode . '&lt;/preferredLanguageCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $NotificationURL != '' ? '&lt;notificationURL xmlns=&quot;&quot;&gt;' . $NotificationURL . '&lt;/notificationURL&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerField1 != '' ? '&lt;partnerField1 xmlns=&quot;&quot;&gt;' . $PartnerField1 . '&lt;/partnerField1&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerField2 != '' ? '&lt;partnerField2 xmlns=&quot;&quot;&gt;' . $PartnerField2 . '&lt;/partnerField2&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerField3 != '' ? '&lt;partnerField3 xmlns=&quot;&quot;&gt;' . $PartnerField3 . '&lt;/partnerField3&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerField4 != '' ? '&lt;partnerField4 xmlns=&quot;&quot;&gt;' . $PartnerField4 . '&lt;/partnerField4&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PartnerField5 != '' ? '&lt;partnerField5 xmlns=&quot;&quot;&gt;' . $PartnerField5 . '&lt;/partnerField5&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $RegistrationType != '' ? '&lt;registrationType xmlns=&quot;&quot;&gt;' . $RegistrationType . '&lt;/registrationType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SuppressWelcomeEmail != '' ? '&lt;suppressWelcomeEmail xmlns=&quot;&quot;&gt;' . $SuppressWelcomeEmail . '&lt;/suppressWelcomeEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PerformExtraVettingOnThisAccount != '' ? '&lt;performExtraVettingOnthisAccount xmlns=&quot;&quot;&gt;' . $PerformExtraVettingOnThisAccount . '&lt;/performExtraVettingOnthisAccount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TaxID != '' ? '&lt;taxId xmlns=&quot;&quot;&gt;' . $TaxID . '&lt;/taxId&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($ReturnURL != '' || $ReturnURLDescription != '' || $ShowAddCreditCard != '' || $ShowMobileConfirm != '' || $UseMiniBrowser != '')&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;createAccountWebOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURLDescription != '' ? '&lt;returnUrlDescription xmlns=&quot;&quot;&gt;' . $ReturnURLDescription . '&lt;/returnUrlDescription&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShowAddCreditCard != '' ? '&lt;showAddCreditCard xmlns=&quot;&quot;&gt;' . $ShowAddCreditCard . '&lt;/showAddCreditCard&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShowMobileConfirm != '' ? '&lt;showMobileConfirm xmlns=&quot;&quot;&gt;' . $ShowMobileConfirm . '&lt;/showMobileConfirm&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $UseMiniBrowser != '' ? '&lt;useMiniBrowser xmlns=&quot;&quot;&gt;' . $UseMiniBrowser . '&lt;/useMiniBrowser&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/createAccountWebOptions&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BusinessInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;businessInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;'. $BusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BusinessAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;businessAddress xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BusinessAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BusinessAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BusinessAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BusinessAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BusinessAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BusinessAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/businessAddress&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= $WorkPhone != '' ? '&lt;workPhone xmlns=&quot;&quot;&gt;'. $WorkPhone . '&lt;/workPhone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Category != '' ? '&lt;category xmlns=&quot;&quot;&gt;' . $Category . '&lt;/category&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $SubCategory != '' ? '&lt;subCategory xmlns=&quot;&quot;&gt;'. $SubCategory . '&lt;/subCategory&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $MerchantCategoryCode != '' ? '&lt;merchantCategoryCode xmlns=&quot;&quot;&gt;' . $MerchantCategoryCode . '&lt;/merchantCategoryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $DoingBusinessAs != '' ? '&lt;doingBusinessAs xmlns=&quot;&quot;&gt;' . $DoingBusinessAs . '&lt;/doingBusinessAs&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerServicePhone != '' ? '&lt;customerServicePhone xmlns=&quot;&quot;&gt;' . $CustomerServicePhone . '&lt;/customerServicePhone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CustomerServiceEmail != '' ? '&lt;customerServiceEmail xmlns=&quot;&quot;&gt;' . $CustomerServiceEmail . '&lt;/customerServiceEmail&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $DisputeEmail != '' ? '&lt;disputeEmail xmlns=&quot;&quot;&gt;'. $DisputeEmail . '&lt;/disputeEmail&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $WebSite != '' ? '&lt;webSite xmlns=&quot;&quot;&gt;' . $WebSite . '&lt;/webSite&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CompanyID != '' ? '&lt;companyId xmlns=&quot;&quot;&gt;' . $CompanyID . '&lt;/companyId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $DateOfEstablishment != '' ? '&lt;dateOfEstablishment xmlns=&quot;&quot;&gt;' . $DateOfEstablishment . '&lt;/dateOfEstablishment&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessType != '' ? '&lt;businessType xmlns=&quot;&quot;&gt;' . $BusinessType . '&lt;/businessType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessSubType != '' ? '&lt;businessSubType xmlns=&quot;&quot;&gt;' . $BusinessSubType . '&lt;/businessSubType&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $IncorporationID != '' ? '&lt;incorporationId xmlns=&quot;&quot;&gt;' . $IncorporationID . '&lt;/incorporationId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $AveragePrice != '' ? '&lt;averagePrice xmlns=&quot;&quot;&gt;' . $AveragePrice . '&lt;/averagePrice&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $AverageMonthlyVolume != '' ? '&lt;averageMonthlyVolume xmlns=&quot;&quot;&gt;' . $AverageMonthlyVolume . '&lt;/averageMonthlyVolume&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $PercentageRevenueFromOnline != '' ? '&lt;percentageRevenueFromOnline xmlns=&quot;&quot;&gt;' . $PercentageRevenueFromOnline . '&lt;/percentageRevenueFromOnline&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $SalesVenu != '' ? '&lt;salesVenue xmlns=&quot;&quot;&gt;' . $SalesVenu . '&lt;/salesVenue&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $SalesVenuDesc != '' ? '&lt;salesVenueDesc xmlns=&quot;&quot;&gt;' . $SalesVenuDesc . '&lt;/salesVenueDesc&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $VatID != '' ? '&lt;vatId xmlns=&quot;&quot;&gt;' . $VatID . '&lt;/vatId&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $VatCountryCode != '' ? '&lt;vatCountryCode xmlns=&quot;&quot;&gt;' . $VatCountryCode . '&lt;/vatCountryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CommercialRegistrationLocation != '' ? '&lt;commercialRegistrationLocation xmlns=&quot;&quot;&gt;' . $CommercialRegistrationLocation . '&lt;/commercialRegistrationLocation&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($PrinciplePlaceOfBusinessAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;principlePlaceOfBusinessAddress xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $PrinciplePlaceOfBusinessAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $PrinciplePlaceOfBusinessAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/principlePlaceOfBusinessAddress&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($RegisteredOfficeAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;registeredOfficeAddress xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $RegisteredOfficeAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $RegisteredOfficeAddressCountryCode . '&lt;/countryCode&gt;' : '';        &nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/registeredOfficeAddress&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= $EstablishmentCountryCode != '' ? '&lt;establishmentCountryCode xmlns=&quot;&quot;&gt;' . $EstablishmentCountryCode . '&lt;/establishmentCountryCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $EstablishmentState != '' ? '&lt;establishmentState xmlns=&quot;&quot;&gt;' . $EstablishmentState . '&lt;/establishmentState&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BusinessStakeHolder))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;businessStakeHolder xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessStakeHolderRole != '' ? '&lt;role xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderRole . '&lt;/role&gt;' : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                if($BusinessStakeHolderSalutation != '' || $BusinessStakeHolderFirstName != '' || $BusinessStakeHolderMiddleName != '' || $BusinessStakeHolderLastName != '' || $BusinessStakeHolderSuffix != '')&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $XMLRequest .= '&lt;name xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderSalutation != '' ? '&lt;salutation xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderSalutation . '&lt;/salutation&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderMiddleName != '' ? '&lt;middleName xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderMiddleName . '&lt;/middleName&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderSuffix != '' ? '&lt;suffix xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderSuffix . '&lt;/suffix&gt;' : '';        &nbsp;</div></li><li><div>                    $XMLRequest .= '&lt;/name&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $XMLRequest .= $BusinessStakeHolderFullLegalName != '' ? '&lt;fullLegalName xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderFullLegalName . '&lt;/fullLegalName&gt;' : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                if(!empty($BusinessStakeHolderAddress))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                    $XMLRequest .= $BusinessStakeHolderAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderAddressCountryCode . '&lt;/countryCode&gt;' : '';        &nbsp;</div></li><li><div>                    $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $XMLRequest .= $BusinessStakeHolderDateOfBirth != '' ? '&lt;dateOfBirth xmlns=&quot;&quot;&gt;' . $BusinessStakeHolderDateOfBirth . '&lt;/dateOfBirth&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/businessStakeHolder&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/businessInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CreateAccountRequest&gt;';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'CreateAccount');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $AccountID = $DOM -&gt; getElementsByTagName('accountId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('accountId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CreateAccountKey = $DOM -&gt; getElementsByTagName('createAccountKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('createAccountKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $ExecStatus = $DOM -&gt; getElementsByTagName('execStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('execStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RedirectURL = $DOM -&gt; getElementsByTagName('redirectURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('redirectURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'AccountID' =&gt; $AccountID, &nbsp;</div></li><li><div>                                   'CreateAccountKey' =&gt; $CreateAccountKey, &nbsp;</div></li><li><div>                                   'ExecStatus' =&gt; $ExecStatus, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $RedirectURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submit AddBankAccount API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function AddBankAccount($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $AddBankAccountFields = isset($DataArray['AddBankAccountFields']) ? $DataArray['AddBankAccountFields'] : array();&nbsp;</div></li><li><div>        $EmailAddress = isset($AddBankAccountFields['EmailAddress']) ? $AddBankAccountFields['EmailAddress'] : '';&nbsp;</div></li><li><div>        $AccountID = isset($AddBankAccountFields['AccountID']) ? $AddBankAccountFields['AccountID'] : '';&nbsp;</div></li><li><div>        $CreateAccountKey = isset($AddBankAccountFields['CreateAccountKey']) ? $AddBankAccountFields['CreateAccountKey'] : '';&nbsp;</div></li><li><div>        $BankCountryCode = isset($AddBankAccountFields['BankCountryCode']) ? $AddBankAccountFields['BankCountryCode'] : '';&nbsp;</div></li><li><div>        $BankName = isset($AddBankAccountFields['BankName']) ? $AddBankAccountFields['BankName'] : '';&nbsp;</div></li><li><div>        $RoutingNumber = isset($AddBankAccountFields['RoutingNumber']) ? $AddBankAccountFields['RoutingNumber'] : '';&nbsp;</div></li><li><div>        $BankAccountType = isset($AddBankAccountFields['BankAccountType']) ? $AddBankAccountFields['BankAccountType'] : '';&nbsp;</div></li><li><div>        $BankAccountNumber = isset($AddBankAccountFields['BankAccountNumber']) ? $AddBankAccountFields['BankAccountNumber'] : '';&nbsp;</div></li><li><div>        $IBAN = isset($AddBankAccountFields['IBAN']) ? $AddBankAccountFields['IBAN'] : '';&nbsp;</div></li><li><div>        $CLABE = isset($AddBankAccountFields['CLABE']) ? $AddBankAccountFields['CLABE'] : '';&nbsp;</div></li><li><div>        $BSBNumber = isset($AddBankAccountFields['BSBNumber']) ? $AddBankAccountFields['BSBNumber'] : '';&nbsp;</div></li><li><div>        $BranchLocation = isset($AddBankAccountFields['BranchLocation']) ? $AddBankAccountFields['BranchLocation'] : '';&nbsp;</div></li><li><div>        $SortCode = isset($AddBankAccountFields['SortCode']) ? $AddBankAccountFields['SortCode'] : '';&nbsp;</div></li><li><div>        $BankTransitNumber = isset($AddBankAccountFields['BankTransitNumber']) ? $AddBankAccountFields['BankTransitNumber'] : '';&nbsp;</div></li><li><div>        $InstitutionNumber = isset($AddBankAccountFields['InstitutionNumber']) ? $AddBankAccountFields['InstitutionNumber'] : '';&nbsp;</div></li><li><div>        $BranchCode = isset($AddBankAccountFields['BranchCode']) ? $AddBankAccountFields['BranchCode'] : '';&nbsp;</div></li><li><div>        $AgencyNumber = isset($AddBankAccountFields['AgencyNumber']) ? $AddBankAccountFields['AgencyNumber'] : '';&nbsp;</div></li><li><div>        $BankCode = isset($AddBankAccountFields['BankCode']) ? $AddBankAccountFields['BankCode'] : '';&nbsp;</div></li><li><div>        $RibKey = isset($AddBankAccountFields['RibKey']) ? $AddBankAccountFields['RibKey'] : '';&nbsp;</div></li><li><div>        $ControlDigit = isset($AddBankAccountFields['ControlDigit']) ? $AddBankAccountFields['ControlDigit'] : '';&nbsp;</div></li><li><div>        $TaxIDType = isset($AddBankAccountFields['TaxIDType']) ? $AddBankAccountFields['TaxIDType'] : '';&nbsp;</div></li><li><div>        $TaxIDNumber = isset($AddBankAccountFields['TaxIDNumber']) ? $AddBankAccountFields['TaxIDNumber'] : '';&nbsp;</div></li><li><div>        $AccountHolderDateOfBirth = isset($AddBankAccountFields['AccountHolderDateOfBirth']) ? $AddBankAccountFields['AccountHolderDateOfBirth'] : '';&nbsp;</div></li><li><div>        $ConfirmationType = isset($AddBankAccountFields['ConfirmationType']) ? $AddBankAccountFields['ConfirmationType'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $WebOptions = isset($DataArray['WebOptions']) ? $DataArray['WebOptions'] : array();&nbsp;</div></li><li><div>        $ReturnURL = isset($WebOptions['ReturnURL']) ? $WebOptions['ReturnURL'] : '';&nbsp;</div></li><li><div>        $CancelURL = isset($WebOptions['CancelURL']) ? $WebOptions['CancelURL'] : '';&nbsp;</div></li><li><div>        $ReturnURLDescription = isset($WebOptions['ReturnURLDescription']) ? $WebOptions['ReturnURLDescription'] : '';&nbsp;</div></li><li><div>        $CancelURLDescription = isset($WebOptions['CancelURLDescription']) ? $WebOptions['CancelURLDescription'] : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;AddBankAccountRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $EmailAddress != '' ? '&lt;emailAddress xmlns=&quot;&quot;&gt;' . $EmailAddress . '&lt;/emailAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $AccountID != '' ? '&lt;accountId xmlns=&quot;&quot;&gt;' . $AccountID . '&lt;/accountId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CreateAccountKey != '' ? '&lt;createAccountKey xmlns=&quot;&quot;&gt;' . $CreateAccountKey . '&lt;/createAccountKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankCountryCode != '' ? '&lt;bankCountryCode xmlns=&quot;&quot;&gt;' . $BankCountryCode . '&lt;/bankCountryCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankName != '' ? '&lt;bankName xmlns=&quot;&quot;&gt;' . $BankName . '&lt;/bankName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $RoutingNumber != '' ? '&lt;routingNumber xmlns=&quot;&quot;&gt;' . $RoutingNumber . '&lt;/routingNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankAccountType != '' ? '&lt;bankAccountType xmlns=&quot;&quot;&gt;' . $BankAccountType . '&lt;/bankAccountType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankAccountNumber != '' ? '&lt;bankAccountNumber xmlns=&quot;&quot;&gt;' . $BankAccountNumber . '&lt;/bankAccountNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $IBAN != '' ? '&lt;iban xmlns=&quot;&quot;&gt;' . $IBAN . '&lt;/iban&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CLABE != '' ? '&lt;clabe xmlns=&quot;&quot;&gt;' . $CLABE . '&lt;/clabe&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BSBNumber != '' ? '&lt;bsbNumber xmlns=&quot;&quot;&gt;' . $BSBNumber . '&lt;/bsbNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BranchLocation != '' ? '&lt;branchLocation xmlns=&quot;&quot;&gt;' . $BranchLocation . '&lt;/branchLocation&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SortCode != '' ? '&lt;sortCode xmlns=&quot;&quot;&gt;' . $SortCode . '&lt;/sortCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankTransitNumber != '' ? '&lt;bankTransitNumber xmlns=&quot;&quot;&gt;' . $BankTransitNumber . '&lt;/bankTransitNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $InstitutionNumber != '' ? '&lt;institutionNumber xmlns=&quot;&quot;&gt;' . $InstitutionNumber . '&lt;/institutionNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BranchCode != '' ? '&lt;branchCode xmlns=&quot;&quot;&gt;' . $BranchCode . '&lt;/branchCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $AgencyNumber != '' ? '&lt;agencyNumber xmlns=&quot;&quot;&gt;' . $AgencyNumber . '&lt;/agencyNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $BankCode != '' ? '&lt;bankCode xmlns=&quot;&quot;&gt;' . $BankCode . '&lt;/bankCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $RibKey != '' ? '&lt;ribKey xmlns=&quot;&quot;&gt;' . $RibKey . '&lt;/ribKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ControlDigit != '' ? '&lt;controlDigit xmlns=&quot;&quot;&gt;' . $ControlDigit . '&lt;/controlDigit&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TaxIDType != '' ? '&lt;taxIdType xmlns=&quot;&quot;&gt;' . $TaxIDType . '&lt;/taxIdType&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $TaxIDNumber != '' ? '&lt;taxIdNumber xmlns=&quot;&quot;&gt;' . $TaxIDNumber . '&lt;/taxIdNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $AccountHolderDateOfBirth != '' ? '&lt;accountHolderDateOfBirth xmlns=&quot;&quot;&gt;' . $AccountHolderDateOfBirth . '&lt;/accountHolderDateOfBirth&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ConfirmationType != '' ? '&lt;confirmationType xmlns=&quot;&quot;&gt;' . $ConfirmationType . '&lt;/confirmationType&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($WebOptions))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;webOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CancelURL != '' ? '&lt;cancelUrl xmlns=&quot;&quot;&gt;' . $CancelURL . '&lt;/cancelUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURLDescription != '' ? '&lt;returnUrlDescription xmlns=&quot;&quot;&gt;' . $ReturnURLDescription . '&lt;/returnUrlDescription&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CancelURLDescription != '' ? '&lt;cancelUrlDescription xmlns=&quot;&quot;&gt;' . $CancelURLDescription . '&lt;/cancelUrlDescription&gt;' : '';    &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/webOptions&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/AddBankAccountRequest&gt;';&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>         // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'AddBankAccount');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ExecStatus = $DOM -&gt; getElementsByTagName('execStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('execStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $FundingSourceKey = $DOM -&gt; getElementsByTagName('fundingSourceKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('fundingSourceKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RedirectURL = $DOM -&gt; getElementsByTagName('redirectURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('redirectURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'ExecStatus' =&gt; $ExecStatus, &nbsp;</div></li><li><div>                                   'FundingSourceKey' =&gt; $FundingSourceKey, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $RedirectURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit AddPaymentCard API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function AddPaymentCard($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $AddPaymentCardFields = isset($DataArray['AddPaymentCardFields']) ? $DataArray['AddPaymentCardFields'] : array();&nbsp;</div></li><li><div>        $EmailAddress = isset($AddPaymentCardFields['EmailAddress']) ? $AddPaymentCardFields['EmailAddress'] : '';&nbsp;</div></li><li><div>        $AccountID = isset($AddPaymentCardFields['AccountID']) ? $AddPaymentCardFields['AccountID'] : '';&nbsp;</div></li><li><div>        $CreateAccountKey = isset($AddPaymentCardFields['CreateAccountKey']) ? $AddPaymentCardFields['CreateAccountKey'] : '';&nbsp;</div></li><li><div>        $CardOwnerDateOfBirth = isset($AddPaymentCardFields['CardOwnerDateOfBirth']) ? $AddPaymentCardFields['CardOwnerDateOfBirth'] : '';&nbsp;</div></li><li><div>        $CardNumber = isset($AddPaymentCardFields['CardNumber']) ? $AddPaymentCardFields['CardNumber'] : '';&nbsp;</div></li><li><div>        $CardType = isset($AddPaymentCardFields['CardType']) ? $AddPaymentCardFields['CardType'] : '';&nbsp;</div></li><li><div>        $CardVerificationNumber = isset($AddPaymentCardFields['CardVerificationNumber']) ? $AddPaymentCardFields['CardVerificationNumber'] : '';&nbsp;</div></li><li><div>        $StartDate = isset($AddPaymentCardFields['StartDate']) ? $AddPaymentCardFields['StartDate'] : '';&nbsp;</div></li><li><div>        $IssueNumber = isset($AddPaymentCardFields['IssueNumber']) ? $AddPaymentCardFields['IssueNumber'] : '';&nbsp;</div></li><li><div>        $ConfirmationType = isset($AddPaymentCardFields['ConfirmationType']) ? $AddPaymentCardFields['ConfirmationType'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $NameOnCard = isset($DataArray['NameOnCard']) ? $DataArray['NameOnCard'] : array();&nbsp;</div></li><li><div>        $Salutation = isset($NameOnCard['Salutation']) ? $NameOnCard['Salutation'] : '';&nbsp;</div></li><li><div>        $FirstName = isset($NameOnCard['FirstName']) ? $NameOnCard['FirstName'] : '';&nbsp;</div></li><li><div>        $MiddleName = isset($NameOnCard['MiddleName']) ? $NameOnCard['MiddleName'] : '';&nbsp;</div></li><li><div>        $LastName = isset($NameOnCard['LastName']) ? $NameOnCard['LastName'] : '';&nbsp;</div></li><li><div>        $Suffix = isset($NameOnCard['Suffix']) ? $NameOnCard['Suffix'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingAddress = isset($DataArray['BillingAddress']) ? $DataArray['BillingAddress'] : array();&nbsp;</div></li><li><div>        $Line1 = isset($BillingAddress['Line1']) ? $BillingAddress['Line1'] : '';&nbsp;</div></li><li><div>        $Line2 = isset($BillingAddress['Line2']) ? $BillingAddress['Line2'] : '';&nbsp;</div></li><li><div>        $City = isset($BillingAddress['City']) ? $BillingAddress['City'] : '';&nbsp;</div></li><li><div>        $State = isset($BillingAddress['State']) ? $BillingAddress['State'] : '';&nbsp;</div></li><li><div>        $PostalCode = isset($BillingAddress['PostalCode']) ? $BillingAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $CountryCode = isset($BillingAddress['CountryCode']) ? $BillingAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ExpirationDate = isset($DataArray['ExpirationDate']) ? $DataArray['ExpirationDate'] : array();&nbsp;</div></li><li><div>        $Month = isset($ExpirationDate['Month']) ? $ExpirationDate['Month'] : '';&nbsp;</div></li><li><div>        $Year = isset($ExpirationDate['Year']) ? $ExpirationDate['Year'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $WebOptions = isset($DataArray['WebOptions']) ? $DataArray['WebOptions'] : array();&nbsp;</div></li><li><div>        $ReturnURL = isset($WebOptions['ReturnURL']) ? $WebOptions['ReturnURL'] : '';&nbsp;</div></li><li><div>        $CancelURL = isset($WebOptions['CancelURL']) ? $WebOptions['CancelURL'] : '';&nbsp;</div></li><li><div>        $ReturnURLDescription = isset($WebOptions['ReturnURLDescription']) ? $WebOptions['ReturnURLDescription'] : '';&nbsp;</div></li><li><div>        $CancelURLDescription = isset($WebOptions['CancelURLDescription']) ? $WebOptions['CancelURLDescription'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;AddPaymentCardRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $EmailAddress != '' ? '&lt;emailAddress xmlns=&quot;&quot;&gt;' . $EmailAddress . '&lt;/emailAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $AccountID != '' ? '&lt;accountId xmlns=&quot;&quot;&gt;' . $AccountID . '&lt;/accountId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CreateAccountKey != '' ? '&lt;createAccountKey xmlns=&quot;&quot;&gt;' . $CreateAccountKey . '&lt;/createAccountKey&gt;' : '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if(!empty($NameOnCard))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;nameOnCard xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Salutation != '' ? '&lt;salutation xmlns=&quot;&quot;&gt;' . $Salutation . '&lt;/salutation&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $FirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $FirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $MiddleName != '' ? '&lt;middleName xmlns=&quot;&quot;&gt;' . $MiddleName . '&lt;/middleName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $LastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $LastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Suffix != '' ? '&lt;suffix xmlns=&quot;&quot;&gt;' . $Suffix . '&lt;/suffix&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/nameOnCard&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BillingAddress))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;billingAddress xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Line1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $Line1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Line2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $Line2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $City != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $City . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $State != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $State . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $PostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $PostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $CountryCode . '&lt;/countryCode&gt;' : '';            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/billingAddress&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $CardOwnerDateOfBirth != '' ? '&lt;cardOwnerDateOfBirth xmlns=&quot;&quot;&gt;' . $CardOwnerDateOfBirth . '&lt;/cardOwnerDateOfBirth&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CardNumber != '' ? '&lt;cardNumber xmlns=&quot;&quot;&gt;' . $CardNumber . '&lt;/cardNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $CardType != '' ? '&lt;cardType xmlns=&quot;&quot;&gt;' . $CardType . '&lt;/cardType&gt;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($ExpirationDate))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;expirationDate xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Month != '' ? '&lt;month xmlns=&quot;&quot;&gt;' . $Month . '&lt;/month&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Year != '' ? '&lt;year xmlns=&quot;&quot;&gt;' . $Year . '&lt;/year&gt;' : '';            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/expirationDate&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $XMLRequest .= $CardVerificationNumber != '' ? '&lt;cardVerificationNumber xmlns=&quot;&quot;&gt;' . $CardVerificationNumber . '&lt;/cardVerificationNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $StartDate != '' ? '&lt;startDate xmlns=&quot;&quot;&gt;' . $StartDate . '&lt;/startDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $IssueNumber != '' ? '&lt;issueNumber xmlns=&quot;&quot;&gt;' . $IssueNumber . '&lt;/issueNumber&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ConfirmationType != '' ? '&lt;confirmationType xmlns=&quot;&quot;&gt;' . $ConfirmationType . '&lt;/confirmationType&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($WebOptions))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;webOptions xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURL != '' ? '&lt;returnUrl xmlns=&quot;&quot;&gt;' . $ReturnURL . '&lt;/returnUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CancelURL != '' ? '&lt;cancelUrl xmlns=&quot;&quot;&gt;' . $CancelURL . '&lt;/cancelUrl&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ReturnURLDescription != '' ? '&lt;returnUrlDescription xmlns=&quot;&quot;&gt;' . $ReturnURLDescription . '&lt;/returnUrlDescription&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CancelURLDescription != '' ? '&lt;cancelUrlDescription xmlns=&quot;&quot;&gt;' . $CancelURLDescription . '&lt;/cancelUrlDescription&gt;' : '';    &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/webOptions&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/AddPaymentCardRequest&gt;';&nbsp;</div></li><li><div>                 &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'AddPaymentCard');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ExecStatus = $DOM -&gt; getElementsByTagName('execStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('execStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $FundingSourceKey = $DOM -&gt; getElementsByTagName('fundingSourceKey') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('fundingSourceKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RedirectURL = $DOM -&gt; getElementsByTagName('redirectURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('redirectURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'ExecStatus' =&gt; $ExecStatus, &nbsp;</div></li><li><div>                                   'FundingSourceKey' =&gt; $FundingSourceKey, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $RedirectURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit SetFundingSourceConfirmed API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function SetFundingSourceConfirmed($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $SetFundingSourceConfirmedFields = isset($DataArray['SetFundingSourceConfirmedFields']) ? $DataArray['SetFundingSourceConfirmedFields'] : array();&nbsp;</div></li><li><div>        $EmailAddress = isset($SetFundingSourceConfirmedFields['EmailAddress']) ? $SetFundingSourceConfirmedFields['EmailAddress'] : '';&nbsp;</div></li><li><div>        $AccountID = isset($SetFundingSourceConfirmedFields['AccountID']) ? $SetFundingSourceConfirmedFields['AccountID'] : '';&nbsp;</div></li><li><div>        $FundingSourceKey = isset($SetFundingSourceConfirmedFields['FundingSourceKey']) ? $SetFundingSourceConfirmedFields['FundingSourceKey'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;SetFundingSourceConfirmedRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $EmailAddress != '' ? '&lt;emailAddress xmlns=&quot;&quot;&gt;' . $EmailAddress . '&lt;/emailAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $AccountID != '' ? '&lt;accountId xmlns=&quot;&quot;&gt;' . $AccountID . '&lt;/accountId&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $FundingSourceKey != '' ? '&lt;fundingSourceKey xmlns=&quot;&quot;&gt;' . $FundingSourceKey . '&lt;/fundingSourceKey&gt;' : '';        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/SetFundingSourceConfirmedRequest&gt;';&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'SetFundingSourceConfirmed');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetVerifiedStatus API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetVerifiedStatus($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $GetVerifiedStatusFields = isset($DataArray['GetVerifiedStatusFields']) ? $DataArray['GetVerifiedStatusFields'] : array();&nbsp;</div></li><li><div>        $EmailAddress = isset($GetVerifiedStatusFields['EmailAddress']) ? $GetVerifiedStatusFields['EmailAddress'] : '';&nbsp;</div></li><li><div>        $MatchCriteria = isset($GetVerifiedStatusFields['MatchCriteria']) ? $GetVerifiedStatusFields['MatchCriteria'] : '';&nbsp;</div></li><li><div>        $FirstName = isset($GetVerifiedStatusFields['FirstName']) ? $GetVerifiedStatusFields['FirstName'] : '';&nbsp;</div></li><li><div>        $LastName = isset($GetVerifiedStatusFields['LastName']) ? $GetVerifiedStatusFields['LastName'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetVerifiedStatusRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $EmailAddress != '' ? '&lt;emailAddress xmlns=&quot;&quot;&gt;' . $EmailAddress . '&lt;/emailAddress&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MatchCriteria != '' ? '&lt;matchCriteria xmlns=&quot;&quot;&gt;' . $MatchCriteria . '&lt;/matchCriteria&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $FirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $FirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $LastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $LastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetVerifiedStatusRequest&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'GetVerifiedStatus');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $AccountStatus = $DOM -&gt; getElementsByTagName('accountStatus') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('accountStatus') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CountryCode = $DOM -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $EmailAddress = $DOM -&gt; getElementsByTagName('emailAddress') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('emailAddress') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $AccountID = $DOM -&gt; getElementsByTagName('accountId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('accountId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $AccountType = $DOM -&gt; getElementsByTagName('accountType') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('accountType') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $BusinessName = $DOM -&gt; getElementsByTagName('businessName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('businessName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Salutation = $DOM -&gt; getElementsByTagName('salutation') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('salutation') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $FirstName = $DOM -&gt; getElementsByTagName('firstName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('firstName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $MiddleName = $DOM -&gt; getElementsByTagName('middleName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('middleName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $LastName = $DOM -&gt; getElementsByTagName('lastName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('lastName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Suffix = $DOM -&gt; getElementsByTagName('suffix') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('suffix') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'AccountStatus' =&gt; $AccountStatus, &nbsp;</div></li><li><div>                                   'CountryCode' =&gt; $CountryCode, &nbsp;</div></li><li><div>                                   'EmailAddress' =&gt; $EmailAddress, &nbsp;</div></li><li><div>                                   'AccountID' =&gt; $AccountID, &nbsp;</div></li><li><div>                                   'BusinessName' =&gt; $BusinessName, &nbsp;</div></li><li><div>                                   'Salutation' =&gt; $Salutation, &nbsp;</div></li><li><div>                                   'FirstName' =&gt; $FirstName, &nbsp;</div></li><li><div>                                   'MiddleName' =&gt; $MiddleName, &nbsp;</div></li><li><div>                                   'LastName' =&gt; $LastName, &nbsp;</div></li><li><div>                                   'Suffix' =&gt; $Suffix, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetFundingPlans API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetFundingPlans($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $GetFundingPlansFields = isset($DataArray['GetFundingPlansFields']) ? $DataArray['GetFundingPlansFields'] : array();&nbsp;</div></li><li><div>        $PayKey = isset($GetFundingPlansFields['PayKey']) ? $GetFundingPlansFields['PayKey'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetFundingPlansRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;payKey xmlns=&quot;&quot;&gt;' . $PayKey . '&lt;/payKey&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetFundingPlansRequest&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptiveAccounts', 'GetFundingPlans');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $FundingPlanType = $DOM -&gt; getElementsByTagName('fundingPlan') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('fundingPlan') : array();&nbsp;</div></li><li><div>        foreach($FundingPlanType as $FundingPlan)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $FundingPlanID = $FundingPlan -&gt; getElementsByTagName('fundingPlanId') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('fundingPlanId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $FundingAmountType = $FundingPlan -&gt; getElementsByTagName('fundingAmount') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('fundingAmount') : array();&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            foreach($FundingAmountType as $FundingAmount)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $FundingAmountCode = $FundingAmount -&gt; getElementsByTagName('code') -&gt; length &gt; 0 ? $FundingAmount -&gt; getElementsByTagName('code') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $FundingAmountAmount = $FundingAmount -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $FundingAmount -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $BackupFundingSourceType = $FundingPlan -&gt; getElementsByTagName('backupFundingSource') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('backupFundingSource') : array();&nbsp;</div></li><li><div>            foreach($BackupFundingSourceType as $BackupFundingSource)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $BackupFundingSource_LastFourOfAccountNumber = $BackupFundingSource -&gt; getElementsByTagName('lastFourOfAccountNumber') -&gt; length &gt; 0 ? $BackupFundingSource -&gt; getElementsByTagName('lastFourOfAccountNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BackupFundingSource_Type = $BackupFundingSource -&gt; getElementsByTagName('type') -&gt; length &gt; 0 ? $BackupFundingSource -&gt; getElementsByTagName('type') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BackupFundingSource_DisplayName = $BackupFundingSource -&gt; getElementsByTagName('displayName') -&gt; length &gt; 0 ? $BackupFundingSource -&gt; getElementsByTagName('displayName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BackupFundingSource_FundingSourceID = $BackupFundingSource -&gt; getElementsByTagName('fundingSourceId') -&gt; length &gt; 0 ? $BackupFundingSource -&gt; getElementsByTagName('fundingSourceId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BackupFundingSource_Allowed = $BackupFundingSource -&gt; getElementsByTagName('allowed') -&gt; length &gt; 0 ? $BackupFundingSource -&gt; getElementsByTagName('allowed') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $SenderFeesType = $FundingPlan -&gt; getElementsByTagName('senderFees') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('senderFees') : array();&nbsp;</div></li><li><div>            foreach($SenderFeesType as $SenderFees)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $SenderFeesCode = $SenderFees -&gt; getElementsByTagName('code') -&gt; length &gt; 0 ? $SenderFees -&gt; getElementsByTagName('code') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $SenderFeesAmount = $SenderFees -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $SenderFees -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $CurrencyConversionType = $FundingPlan -&gt; getElementsByTagName('currencyConversion') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('currencyConversion') : array();&nbsp;</div></li><li><div>            foreach($CurrencyConversionType as $CurrencyConversion)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $CurrencyConversion_From = $CurrencyConversion -&gt; getElementsByTagName('from') -&gt; length &gt; 0 ? $CurrencyConversion -&gt; getElementsByTagName('from') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $CurrencyConversion_To = $CurrencyConversion -&gt; getElementsByTagName('to') -&gt; length &gt; 0 ? $CurrencyConversion -&gt; getElementsByTagName('to') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $CurrencyConversion_ExchangeRate = $CurrencyConversion -&gt; getElementsByTagName('exchangeRate') -&gt; length &gt; 0 ? $CurrencyConversion -&gt; getElementsByTagName('exchangeRate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $FundingPlanChargeType = $FundingPlan -&gt; getElementsByTagName('charge') -&gt; length &gt; 0 ? $FundingPlan -&gt; getElementsByTagName('charge') : array();&nbsp;</div></li><li><div>            foreach($FundingPlanChargeType as $FundingPlanCharge)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $FundingPlanChargeCode = $FundingPlanCharge -&gt; getElementsByTagName('code') -&gt; length &gt; 0 ? $FundingPlanCharge -&gt; getElementsByTagName('code') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $FundingPlanChargeAmount = $FundingPlanCharge -&gt; getElementsByTagName('amount') -&gt; length &gt; 0 ? $FundingPlanCharge -&gt; getElementsByTagName('amount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $FundingPlanChargeFundingSourceType = $FundingPlanCharge -&gt; getElementsByTagName('fundingSource') -&gt; length &gt; 0 ? $FundingPlanCharge -&gt; getElementsByTagName('fundingSource') : array();&nbsp;</div></li><li><div>                foreach($FundingPlanChargeFundingSourceType as $FundingPlanChargeFundingSource)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $FundingPlanChargeFundingSource_LastFourOfAccountNumber = $FundingPlanChargeFundingSource -&gt; getElementsByTagName('lastFourOfAccountNumber') -&gt; length &gt; 0 ? $FundingPlanChargeFundingSource -&gt; getElementsByTagName('lastFourOfAccountNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                    $FundingPlanChargeFundingSource_Type = $FundingPlanChargeFundingSource -&gt; getElementsByTagName('type') -&gt; length &gt; 0 ? $FundingPlanChargeFundingSource -&gt; getElementsByTagName('type') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                    $FundingPlanChargeFundingSource_DisplayName = $FundingPlanChargeFundingSource -&gt; getElementsByTagName('displayName') -&gt; length &gt; 0 ? $FundingPlanChargeFundingSource -&gt; getElementsByTagName('displayName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                    $FundingPlanChargeFundingSource_FundingSourceID = $FundingPlanChargeFundingSource -&gt; getElementsByTagName('fundingSourceId') -&gt; length &gt; 0 ? $FundingPlanChargeFundingSource -&gt; getElementsByTagName('fundingSourceId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                    $FundingPlanChargeFundingSource_Allowed = $FundingPlanChargeFundingSource -&gt; getElementsByTagName('allowed') -&gt; length &gt; 0 ? $FundingPlanChargeFundingSource -&gt; getElementsByTagName('allowed') -&gt; item(0) -&gt; nodeValue : '';            &nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }            &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'FundingPlanID' =&gt; isset($FundingPlanID) ? $FundingPlanID : '', &nbsp;</div></li><li><div>                                   'FundingAmountCode' =&gt; isset($FundingAmountCode) ? $FundingAmountCode : '', &nbsp;</div></li><li><div>                                   'FundingAmountAmount' =&gt; isset($FundingAmountAmount) ? $FundingAmountAmount : '', &nbsp;</div></li><li><div>                                   'SenderFeesCode' =&gt; isset($SenderFeesCode) ? $SenderFeesCode : '', &nbsp;</div></li><li><div>                                   'SenderFeesAmount' =&gt; isset($SenderFeesAmount) ? $SenderFeesAmount : '', &nbsp;</div></li><li><div>                                   'BackupFundingSource_LastFourOfAccountNumber' =&gt; isset($BackupFundingSource_LastFourOfAccountNumber) ? $BackupFundingSource_LastFourOfAccountNumber : '', &nbsp;</div></li><li><div>                                   'BackupFundingSource_Type' =&gt; isset($BackupFundingSource_Type) ? $BackupFundingSource_Type : '', &nbsp;</div></li><li><div>                                   'BackupFundingSource_DisplayName' =&gt; isset($BackupFundingSource_DisplayName) ? $BackupFundingSource_DisplayName : '', &nbsp;</div></li><li><div>                                   'BackupFundingSource_FundingSourceID' =&gt; isset($BackupFundingSource_FundingSourceID) ? $BackupFundingSource_FundingSourceID : '', &nbsp;</div></li><li><div>                                   'BackupFundingSource_Allowed' =&gt; isset($BackupFundingSource_Allowed) ? $BackupFundingSource_Allowed : '', &nbsp;</div></li><li><div>                                   'CurrencyConversion_From' =&gt; isset($CurrencyConversion_From) ? $CurrencyConversion_From : '', &nbsp;</div></li><li><div>                                   'CurrencyConversion_To' =&gt; isset($CurrencyConversion_To) ? $CurrencyConversion_To : '', &nbsp;</div></li><li><div>                                   'CurrencyConversion_ExchangeRate' =&gt; isset($CurrencyConversion_ExchangeRate) ? $CurrencyConversion_ExchangeRate : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeCode' =&gt; isset($FundingPlanChargeCode) ? $FundingPlanChargeCode : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeAmount' =&gt; isset($FundingPlanChargeAmount) ? $FundingPlanChargeAmount : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeFundingSource_LastFourOfAccountNumber' =&gt; isset($FundingPlanChargeFundingSource_LastFourOfAccountNumber) ? $FundingPlanChargeFundingSource_LastFourOfAccountNumber : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeFundingSource_Type' =&gt; isset($FundingPlanChargeFundingSource_Type) ? $FundingPlanChargeFundingSource_Type : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeFundingSource_DisplayName' =&gt; isset($FundingPlanChargeFundingSource_DisplayName) ? $FundingPlanChargeFundingSource_DisplayName : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeFundingSource_FundingSourceID' =&gt; isset($FundingPlanChargeFundingSource_FundingSourceID) ? $FundingPlanChargeFundingSource_FundingSourceID : '', &nbsp;</div></li><li><div>                                   'FundingPlanChargeFundingSource_Allowed' =&gt; isset($FundingPlanChargeFundingSource_Allowed) ? $FundingPlanChargeFundingSource_Allowed : '', &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetShippingAddresses API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetShippingAddresses($PayKey)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetShippingAddressesRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $PayKey != '' ? '&lt;key xmlns=&quot;&quot;&gt;' . $PayKey . '&lt;/key&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetShippingAddressesRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'AdaptivePayments', 'GetShippingAddresses');&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $AddresseeName = $DOM -&gt; getElementsByTagName('addresseeName') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('addresseeName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $AddressID = $DOM -&gt; getElementsByTagName('addressId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('addressId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Line1 = $DOM -&gt; getElementsByTagName('line1') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('line1') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Line2 = $DOM -&gt; getElementsByTagName('line2') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('line2') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $City = $DOM -&gt; getElementsByTagName('city') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('city') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $State = $DOM -&gt; getElementsByTagName('state') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('state') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PostalCode = $DOM -&gt; getElementsByTagName('postalCode') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('postalCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CountryCode = $DOM -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Type = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'AddresseeName' =&gt; $AddresseeName, &nbsp;</div></li><li><div>                                   'AddressID' =&gt; $AddressID, &nbsp;</div></li><li><div>                                   'Line1' =&gt; $Line1, &nbsp;</div></li><li><div>                                   'Line2' =&gt; $Line2, &nbsp;</div></li><li><div>                                   'City' =&gt; $City, &nbsp;</div></li><li><div>                                   'State' =&gt; $State, &nbsp;</div></li><li><div>                                   'PostalCode' =&gt; $PostalCode, &nbsp;</div></li><li><div>                                   'CountryCode' =&gt; $CountryCode, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit CreateInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function CreateInvoice($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $CreateInvoiceFields = isset($DataArray['CreateInvoiceFields']) ? $DataArray['CreateInvoiceFields'] : array();&nbsp;</div></li><li><div>        $MerchantEmail = isset($CreateInvoiceFields['MerchantEmail']) ? $CreateInvoiceFields['MerchantEmail'] : '';&nbsp;</div></li><li><div>        $PayerEmail = isset($CreateInvoiceFields['PayerEmail']) ? $CreateInvoiceFields['PayerEmail'] : '';&nbsp;</div></li><li><div>        $Number = isset($CreateInvoiceFields['Number']) ? $CreateInvoiceFields['Number'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($CreateInvoiceFields['CurrencyCode']) ? $CreateInvoiceFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $InvoiceDate = isset($CreateInvoiceFields['InvoiceDate']) ? $CreateInvoiceFields['InvoiceDate'] : '';&nbsp;</div></li><li><div>        $DueDate = isset($CreateInvoiceFields['DueDate']) ? $CreateInvoiceFields['DueDate'] : '';&nbsp;</div></li><li><div>        $PaymentTerms = isset($CreateInvoiceFields['PaymentTerms']) ? $CreateInvoiceFields['PaymentTerms'] : '';&nbsp;</div></li><li><div>        $DiscountPercent = isset($CreateInvoiceFields['DiscountPercent']) ? $CreateInvoiceFields['DiscountPercent'] : '';&nbsp;</div></li><li><div>        $DiscountAmount = isset($CreateInvoiceFields['DiscountAmount']) ? $CreateInvoiceFields['DiscountAmount'] : '';&nbsp;</div></li><li><div>        $Terms = isset($CreateInvoiceFields['Terms']) ? $CreateInvoiceFields['Terms'] : '';&nbsp;</div></li><li><div>        $Note = isset($CreateInvoiceFields['Note']) ? $CreateInvoiceFields['Note'] : '';&nbsp;</div></li><li><div>        $MerchantMemo = isset($CreateInvoiceFields['MerchantMemo']) ? $CreateInvoiceFields['MerchantMemo'] : '';&nbsp;</div></li><li><div>        $ShippingAmount = isset($CreateInvoiceFields['ShippingAmount']) ? $CreateInvoiceFields['ShippingAmount'] : '';&nbsp;</div></li><li><div>        $ShippingTaxName = isset($CreateInvoiceFields['ShippingTaxName']) ? $CreateInvoiceFields['ShippingTaxName'] : '';&nbsp;</div></li><li><div>        $ShippingTaxRate = isset($CreateInvoiceFields['ShippingTaxRate']) ? $CreateInvoiceFields['ShippingTaxRate'] : '';&nbsp;</div></li><li><div>        $LogoURL = isset($CreateInvoiceFields['LogoURL']) ? $CreateInvoiceFields['LogoURL'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfo = isset($DataArray['BusinessInfo']) ? $DataArray['BusinessInfo'] : array();&nbsp;</div></li><li><div>        $BusinessFirstName = isset($BusinessInfo['FirstName']) ? $BusinessInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BusinessLastName = isset($BusinessInfo['LastName']) ? $BusinessInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BusinessBusinessName = isset($BusinessInfo['BusinessName']) ? $BusinessInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BusinessPhone = isset($BusinessInfo['Phone']) ? $BusinessInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BusinessFax = isset($BusinessInfo['Fax']) ? $BusinessInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BusinessWebsite = isset($BusinessInfo['Website']) ? $BusinessInfo['Website'] : '';&nbsp;</div></li><li><div>        $BusinessCustom = isset($BusinessInfo['Custom']) ? $BusinessInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfoAddress = isset($DataArray['BusinessInfoAddress']) ? $DataArray['BusinessInfoAddress'] : array();&nbsp;</div></li><li><div>        $BusinessInfoAddressLine1 = isset($BusinessInfoAddress['Line1']) ? $BusinessInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressLine2 = isset($BusinessInfoAddress['Line2']) ? $BusinessInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCity = isset($BusinessInfoAddress['City']) ? $BusinessInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressState = isset($BusinessInfoAddress['State']) ? $BusinessInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressPostalCode = isset($BusinessInfoAddress['PostalCode']) ? $BusinessInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCountryCode = isset($BusinessInfoAddress['CountryCode']) ? $BusinessInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressType = isset($BusinessInfoAddress['AddressType']) ? $BusinessInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfo = isset($DataArray['BillingInfo']) ? $DataArray['BillingInfo'] : array();&nbsp;</div></li><li><div>        $BillingFirstName = isset($BillingInfo['FirstName']) ? $BillingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BillingLastName = isset($BillingInfo['LastName']) ? $BillingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BillingBusinessName = isset($BillingInfo['BusinessName']) ? $BillingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BillingPhone = isset($BillingInfo['Phone']) ? $BillingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BillingFax = isset($BillingInfo['Fax']) ? $BillingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BillingWebsite = isset($BillingInfo['Website']) ? $BillingInfo['Website'] : '';&nbsp;</div></li><li><div>        $BillingCustom = isset($BillingInfo['Custom']) ? $BillingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfoAddress = isset($DataArray['BillingInfoAddress']) ? $DataArray['BillingInfoAddress'] : array();&nbsp;</div></li><li><div>        $BillingInfoAddressLine1 = isset($BillingInfoAddress['Line1']) ? $BillingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressLine2 = isset($BillingInfoAddress['Line2']) ? $BillingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCity = isset($BillingInfoAddress['City']) ? $BillingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressState = isset($BillingInfoAddress['State']) ? $BillingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressPostalCode = isset($BillingInfoAddress['PostalCode']) ? $BillingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCountryCode = isset($BillingInfoAddress['CountryCode']) ? $BillingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressType = isset($BillingInfoAddress['AddressType']) ? $BillingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfo = isset($DataArray['ShippingInfo']) ? $DataArray['ShippingInfo'] : array();&nbsp;</div></li><li><div>        $ShippingFirstName = isset($ShippingInfo['FirstName']) ? $ShippingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $ShippingLastName = isset($ShippingInfo['LastName']) ? $ShippingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $ShippingBusinessName = isset($ShippingInfo['BusinessName']) ? $ShippingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $ShippingPhone = isset($ShippingInfo['Phone']) ? $ShippingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $ShippingFax = isset($ShippingInfo['Fax']) ? $ShippingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $ShippingWebsite = isset($ShippingInfo['Website']) ? $ShippingInfo['Website'] : '';&nbsp;</div></li><li><div>        $ShippingCustom = isset($ShippingInfo['Custom']) ? $ShippingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfoAddress = isset($DataArray['ShippingInfoAddress']) ? $DataArray['ShippingInfoAddress'] : array();&nbsp;</div></li><li><div>        $ShippingInfoAddressLine1 = isset($ShippingInfoAddress['Line1']) ? $ShippingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressLine2 = isset($ShippingInfoAddress['Line2']) ? $ShippingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCity = isset($ShippingInfoAddress['City']) ? $ShippingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressState = isset($ShippingInfoAddress['State']) ? $ShippingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressPostalCode = isset($ShippingInfoAddress['PostalCode']) ? $ShippingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCountryCode = isset($ShippingInfoAddress['CountryCode']) ? $ShippingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressType = isset($ShippingInfoAddress['AddressType']) ? $ShippingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $InvoiceItems = isset($DataArray['InvoiceItems']) ? $DataArray['InvoiceItems'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CreateInvoiceRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;invoice xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantEmail != '' ? '&lt;merchantEmail xmlns=&quot;&quot;&gt;' . $MerchantEmail . '&lt;/merchantEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PayerEmail != '' ? '&lt;payerEmail xmlns=&quot;&quot;&gt;' . $PayerEmail . '&lt;/payerEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Number != '' ? '&lt;number xmlns=&quot;&quot;&gt;' . $Number . '&lt;/number&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BusinessInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;merchantInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BusinessFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BusinessLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BusinessBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BusinessPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BusinessFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BusinessWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BusinessCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BusinessInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/merchantInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($InvoiceItems))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;itemList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;item xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Name'] != '' ? '&lt;name xmlns=&quot;&quot;&gt;' . $InvoiceItem['Name'] . '&lt;/name&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Description'] != '' ? '&lt;description xmlns=&quot;&quot;&gt;' . $InvoiceItem['Description'] . '&lt;/description&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Date'] != '' ? '&lt;date xmlns=&quot;&quot;&gt;' . $InvoiceItem['Date'] . '&lt;/date&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Quantity'] != '' ? '&lt;quantity xmlns=&quot;&quot;&gt;' . $InvoiceItem['Quantity'] . '&lt;/quantity&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['UnitPrice'] != '' ? '&lt;unitPrice xmlns=&quot;&quot;&gt;' . $InvoiceItem['UnitPrice'] . '&lt;/unitPrice&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxName'] != '' ? '&lt;taxName xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxName'] . '&lt;/taxName&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxRate'] != '' ? '&lt;taxRate xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxRate'] . '&lt;/taxRate&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/item&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/itemList&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceDate != '' ? '&lt;invoiceDate xmlns=&quot;&quot;&gt;' . $InvoiceDate . '&lt;/invoiceDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DueDate != '' ? '&lt;dueDate xmlns=&quot;&quot;&gt;' . $DueDate . '&lt;/dueDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PaymentTerms != '' ? '&lt;paymentTerms xmlns=&quot;&quot;&gt;' . $PaymentTerms . '&lt;/paymentTerms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountPercent != '' ? '&lt;discountPercent xmlns=&quot;&quot;&gt;' . $DiscountPercent . '&lt;/discountPercent&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountAmount != '' ? '&lt;discountAmount xmlns=&quot;&quot;&gt;' . $DiscountAmount . '&lt;/discountAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Terms != '' ? '&lt;terms xmlns=&quot;&quot;&gt;' . $Terms . '&lt;/terms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Note != '' ? '&lt;note xmlns=&quot;&quot;&gt;' . $Note . '&lt;/note&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantMemo != '' ? '&lt;merchantMemo xmlns=&quot;&quot;&gt;' . $MerchantMemo . '&lt;/merchantMemo&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BillingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;billingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BillingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BillingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BillingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BillingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BillingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BillingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BillingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BillingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BillingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BillingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/billingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($ShippingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;shippingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $ShippingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $ShippingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $ShippingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $ShippingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $ShippingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $ShippingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $ShippingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($ShippingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/shippingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ShippingAmount != '' ? '&lt;shippingAmount xmlns=&quot;&quot;&gt;' . $ShippingAmount . '&lt;/shippingAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxName != '' ? '&lt;shippingTaxName xmlns=&quot;&quot;&gt;' . $ShippingTaxName . '&lt;/shippingTaxName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxRate != '' ? '&lt;shippingTaxRate xmlns=&quot;&quot;&gt;' . $ShippingTaxRate . '&lt;/shippingTaxRate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $LogoURL != '' ? '&lt;logoUrl xmlns=&quot;&quot;&gt;' . $LogoURL . '&lt;/logoUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;referrerCode xmlns=&quot;&quot;&gt;'.$this-&gt;APIButtonSource.'&lt;/referrerCode&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/invoice&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CreateInvoiceRequest&gt;';&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'CreateInvoice');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceNumber = $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceNumber' =&gt; $InvoiceNumber, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit SendInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    string    InvoiceID&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function SendInvoice($InvoiceID)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>         // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;SendInvoiceRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceID != '' ? '&lt;invoiceID xmlns=&quot;&quot;&gt;' . $InvoiceID . '&lt;/invoiceID&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/SendInvoiceRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>         // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'SendInvoice');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit CreateAndSendInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function CreateAndSendInvoice($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $CreateInvoiceFields = isset($DataArray['CreateInvoiceFields']) ? $DataArray['CreateInvoiceFields'] : array();&nbsp;</div></li><li><div>        $MerchantEmail = isset($CreateInvoiceFields['MerchantEmail']) ? $CreateInvoiceFields['MerchantEmail'] : '';&nbsp;</div></li><li><div>        $PayerEmail = isset($CreateInvoiceFields['PayerEmail']) ? $CreateInvoiceFields['PayerEmail'] : '';&nbsp;</div></li><li><div>        $Number = isset($CreateInvoiceFields['Number']) ? $CreateInvoiceFields['Number'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($CreateInvoiceFields['CurrencyCode']) ? $CreateInvoiceFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $InvoiceDate = isset($CreateInvoiceFields['InvoiceDate']) ? $CreateInvoiceFields['InvoiceDate'] : '';&nbsp;</div></li><li><div>        $DueDate = isset($CreateInvoiceFields['DueDate']) ? $CreateInvoiceFields['DueDate'] : '';&nbsp;</div></li><li><div>        $PaymentTerms = isset($CreateInvoiceFields['PaymentTerms']) ? $CreateInvoiceFields['PaymentTerms'] : '';&nbsp;</div></li><li><div>        $DiscountPercent = isset($CreateInvoiceFields['DiscountPercent']) ? $CreateInvoiceFields['DiscountPercent'] : '';&nbsp;</div></li><li><div>        $DiscountAmount = isset($CreateInvoiceFields['DiscountAmount']) ? $CreateInvoiceFields['DiscountAmount'] : '';&nbsp;</div></li><li><div>        $Terms = isset($CreateInvoiceFields['Terms']) ? $CreateInvoiceFields['Terms'] : '';&nbsp;</div></li><li><div>        $Note = isset($CreateInvoiceFields['Note']) ? $CreateInvoiceFields['Note'] : '';&nbsp;</div></li><li><div>        $MerchantMemo = isset($CreateInvoiceFields['MerchantMemo']) ? $CreateInvoiceFields['MerchantMemo'] : '';&nbsp;</div></li><li><div>        $ShippingAmount = isset($CreateInvoiceFields['ShippingAmount']) ? $CreateInvoiceFields['ShippingAmount'] : '';&nbsp;</div></li><li><div>        $ShippingTaxName = isset($CreateInvoiceFields['ShippingTaxName']) ? $CreateInvoiceFields['ShippingTaxName'] : '';&nbsp;</div></li><li><div>        $ShippingTaxRate = isset($CreateInvoiceFields['ShippingTaxRate']) ? $CreateInvoiceFields['ShippingTaxRate'] : '';&nbsp;</div></li><li><div>        $LogoURL = isset($CreateInvoiceFields['LogoURL']) ? $CreateInvoiceFields['LogoURL'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfo = isset($DataArray['BusinessInfo']) ? $DataArray['BusinessInfo'] : array();&nbsp;</div></li><li><div>        $BusinessFirstName = isset($BusinessInfo['FirstName']) ? $BusinessInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BusinessLastName = isset($BusinessInfo['LastName']) ? $BusinessInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BusinessBusinessName = isset($BusinessInfo['BusinessName']) ? $BusinessInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BusinessPhone = isset($BusinessInfo['Phone']) ? $BusinessInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BusinessFax = isset($BusinessInfo['Fax']) ? $BusinessInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BusinessWebsite = isset($BusinessInfo['Website']) ? $BusinessInfo['Website'] : '';&nbsp;</div></li><li><div>        $BusinessCustom = isset($BusinessInfo['Custom']) ? $BusinessInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfoAddress = isset($DataArray['BusinessInfoAddress']) ? $DataArray['BusinessInfoAddress'] : array();&nbsp;</div></li><li><div>        $BusinessInfoAddressLine1 = isset($BusinessInfoAddress['Line1']) ? $BusinessInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressLine2 = isset($BusinessInfoAddress['Line2']) ? $BusinessInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCity = isset($BusinessInfoAddress['City']) ? $BusinessInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressState = isset($BusinessInfoAddress['State']) ? $BusinessInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressPostalCode = isset($BusinessInfoAddress['PostalCode']) ? $BusinessInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCountryCode = isset($BusinessInfoAddress['CountryCode']) ? $BusinessInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressType = isset($BusinessInfoAddress['AddressType']) ? $BusinessInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfo = isset($DataArray['BillingInfo']) ? $DataArray['BillingInfo'] : array();&nbsp;</div></li><li><div>        $BillingFirstName = isset($BillingInfo['FirstName']) ? $BillingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BillingLastName = isset($BillingInfo['LastName']) ? $BillingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BillingBusinessName = isset($BillingInfo['BusinessName']) ? $BillingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BillingPhone = isset($BillingInfo['Phone']) ? $BillingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BillingFax = isset($BillingInfo['Fax']) ? $BillingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BillingWebsite = isset($BillingInfo['Website']) ? $BillingInfo['Website'] : '';&nbsp;</div></li><li><div>        $BillingCustom = isset($BillingInfo['Custom']) ? $BillingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfoAddress = isset($DataArray['BillingInfoAddress']) ? $DataArray['BillingInfoAddress'] : array();&nbsp;</div></li><li><div>        $BillingInfoAddressLine1 = isset($BillingInfoAddress['Line1']) ? $BillingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressLine2 = isset($BillingInfoAddress['Line2']) ? $BillingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCity = isset($BillingInfoAddress['City']) ? $BillingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressState = isset($BillingInfoAddress['State']) ? $BillingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressPostalCode = isset($BillingInfoAddress['PostalCode']) ? $BillingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCountryCode = isset($BillingInfoAddress['CountryCode']) ? $BillingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressType = isset($BillingInfoAddress['AddressType']) ? $BillingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfo = isset($DataArray['ShippingInfo']) ? $DataArray['ShippingInfo'] : array();&nbsp;</div></li><li><div>        $ShippingFirstName = isset($ShippingInfo['FirstName']) ? $ShippingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $ShippingLastName = isset($ShippingInfo['LastName']) ? $ShippingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $ShippingBusinessName = isset($ShippingInfo['BusinessName']) ? $ShippingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $ShippingPhone = isset($ShippingInfo['Phone']) ? $ShippingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $ShippingFax = isset($ShippingInfo['Fax']) ? $ShippingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $ShippingWebsite = isset($ShippingInfo['Website']) ? $ShippingInfo['Website'] : '';&nbsp;</div></li><li><div>        $ShippingCustom = isset($ShippingInfo['Custom']) ? $ShippingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfoAddress = isset($DataArray['ShippingInfoAddress']) ? $DataArray['ShippingInfoAddress'] : array();&nbsp;</div></li><li><div>        $ShippingInfoAddressLine1 = isset($ShippingInfoAddress['Line1']) ? $ShippingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressLine2 = isset($ShippingInfoAddress['Line2']) ? $ShippingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCity = isset($ShippingInfoAddress['City']) ? $ShippingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressState = isset($ShippingInfoAddress['State']) ? $ShippingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressPostalCode = isset($ShippingInfoAddress['PostalCode']) ? $ShippingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCountryCode = isset($ShippingInfoAddress['CountryCode']) ? $ShippingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressType = isset($ShippingInfoAddress['AddressType']) ? $ShippingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $InvoiceItems = isset($DataArray['InvoiceItems']) ? $DataArray['InvoiceItems'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CreateAndSendInvoiceRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;invoice xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantEmail != '' ? '&lt;merchantEmail xmlns=&quot;&quot;&gt;' . $MerchantEmail . '&lt;/merchantEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PayerEmail != '' ? '&lt;payerEmail xmlns=&quot;&quot;&gt;' . $PayerEmail . '&lt;/payerEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Number != '' ? '&lt;number xmlns=&quot;&quot;&gt;' . $Number . '&lt;/number&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BusinessInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;merchantInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BusinessFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BusinessLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BusinessBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BusinessPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BusinessFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BusinessWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BusinessCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BusinessInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/merchantInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($InvoiceItems))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;itemList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;item xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Name'] != '' ? '&lt;name xmlns=&quot;&quot;&gt;' . $InvoiceItem['Name'] . '&lt;/name&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Description'] != '' ? '&lt;description xmlns=&quot;&quot;&gt;' . $InvoiceItem['Description'] . '&lt;/description&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Date'] != '' ? '&lt;date xmlns=&quot;&quot;&gt;' . $InvoiceItem['Date'] . '&lt;/date&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Quantity'] != '' ? '&lt;quantity xmlns=&quot;&quot;&gt;' . $InvoiceItem['Quantity'] . '&lt;/quantity&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['UnitPrice'] != '' ? '&lt;unitPrice xmlns=&quot;&quot;&gt;' . $InvoiceItem['UnitPrice'] . '&lt;/unitPrice&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxName'] != '' ? '&lt;taxName xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxName'] . '&lt;/taxName&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxRate'] != '' ? '&lt;taxRate xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxRate'] . '&lt;/taxRate&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/item&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/itemList&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceDate != '' ? '&lt;invoiceDate xmlns=&quot;&quot;&gt;' . $InvoiceDate . '&lt;/invoiceDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DueDate != '' ? '&lt;dueDate xmlns=&quot;&quot;&gt;' . $DueDate . '&lt;/dueDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PaymentTerms != '' ? '&lt;paymentTerms xmlns=&quot;&quot;&gt;' . $PaymentTerms . '&lt;/paymentTerms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountPercent != '' ? '&lt;discountPercent xmlns=&quot;&quot;&gt;' . $DiscountPercent . '&lt;/discountPercent&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountAmount != '' ? '&lt;discountAmount xmlns=&quot;&quot;&gt;' . $DiscountAmount . '&lt;/discountAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Terms != '' ? '&lt;terms xmlns=&quot;&quot;&gt;' . $Terms . '&lt;/terms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Note != '' ? '&lt;note xmlns=&quot;&quot;&gt;' . $Note . '&lt;/note&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantMemo != '' ? '&lt;merchantMemo xmlns=&quot;&quot;&gt;' . $MerchantMemo . '&lt;/merchantMemo&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BillingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;billingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BillingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BillingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BillingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BillingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BillingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BillingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BillingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BillingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BillingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BillingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/billingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($ShippingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;shippingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $ShippingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $ShippingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $ShippingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $ShippingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $ShippingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $ShippingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $ShippingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($ShippingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/shippingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ShippingAmount != '' ? '&lt;shippingAmount xmlns=&quot;&quot;&gt;' . $ShippingAmount . '&lt;/shippingAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxName != '' ? '&lt;shippingTaxName xmlns=&quot;&quot;&gt;' . $ShippingTaxName . '&lt;/shippingTaxName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxRate != '' ? '&lt;shippingTaxRate xmlns=&quot;&quot;&gt;' . $ShippingTaxRate . '&lt;/shippingTaxRate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $LogoURL != '' ? '&lt;logoUrl xmlns=&quot;&quot;&gt;' . $LogoURL . '&lt;/logoUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;referrerCode xmlns=&quot;&quot;&gt;'.$this-&gt;APIButtonSource.'&lt;/referrerCode&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/invoice&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CreateAndSendInvoiceRequest&gt;';&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'CreateAndSendInvoice');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceNumber = $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceNumber' =&gt; $InvoiceNumber, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit UpdateInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function UpdateInvoice($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $UpdateInvoiceFields = isset($DataArray['UpdateInvoiceFields']) ? $DataArray['UpdateInvoiceFields'] : array();&nbsp;</div></li><li><div>        $InvoiceID = isset($UpdateInvoiceFields['InvoiceID']) ? $UpdateInvoiceFields['InvoiceID'] : '';&nbsp;</div></li><li><div>        $MerchantEmail = isset($UpdateInvoiceFields['MerchantEmail']) ? $UpdateInvoiceFields['MerchantEmail'] : '';&nbsp;</div></li><li><div>        $PayerEmail = isset($UpdateInvoiceFields['PayerEmail']) ? $UpdateInvoiceFields['PayerEmail'] : '';&nbsp;</div></li><li><div>        $Number = isset($UpdateInvoiceFields['Number']) ? $UpdateInvoiceFields['Number'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($UpdateInvoiceFields['CurrencyCode']) ? $UpdateInvoiceFields['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $InvoiceDate = isset($UpdateInvoiceFields['InvoiceDate']) ? $UpdateInvoiceFields['InvoiceDate'] : '';&nbsp;</div></li><li><div>        $DueDate = isset($UpdateInvoiceFields['DueDate']) ? $UpdateInvoiceFields['DueDate'] : '';&nbsp;</div></li><li><div>        $PaymentTerms = isset($UpdateInvoiceFields['PaymentTerms']) ? $UpdateInvoiceFields['PaymentTerms'] : '';&nbsp;</div></li><li><div>        $DiscountPercent = isset($UpdateInvoiceFields['DiscountPercent']) ? $UpdateInvoiceFields['DiscountPercent'] : '';&nbsp;</div></li><li><div>        $DiscountAmount = isset($UpdateInvoiceFields['DiscountAmount']) ? $UpdateInvoiceFields['DiscountAmount'] : '';&nbsp;</div></li><li><div>        $Terms = isset($UpdateInvoiceFields['Terms']) ? $UpdateInvoiceFields['Terms'] : '';&nbsp;</div></li><li><div>        $Note = isset($UpdateInvoiceFields['Note']) ? $UpdateInvoiceFields['Note'] : '';&nbsp;</div></li><li><div>        $MerchantMemo = isset($UpdateInvoiceFields['MerchantMemo']) ? $UpdateInvoiceFields['MerchantMemo'] : '';&nbsp;</div></li><li><div>        $ShippingAmount = isset($UpdateInvoiceFields['ShippingAmount']) ? $UpdateInvoiceFields['ShippingAmount'] : '';&nbsp;</div></li><li><div>        $ShippingTaxName = isset($UpdateInvoiceFields['ShippingTaxName']) ? $UpdateInvoiceFields['ShippingTaxName'] : '';&nbsp;</div></li><li><div>        $ShippingTaxRate = isset($UpdateInvoiceFields['ShippingTaxRate']) ? $UpdateInvoiceFields['ShippingTaxRate'] : '';&nbsp;</div></li><li><div>        $LogoURL = isset($UpdateInvoiceFields['LogoURL']) ? $UpdateInvoiceFields['LogoURL'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfo = isset($DataArray['BusinessInfo']) ? $DataArray['BusinessInfo'] : array();&nbsp;</div></li><li><div>        $BusinessFirstName = isset($BusinessInfo['FirstName']) ? $BusinessInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BusinessLastName = isset($BusinessInfo['LastName']) ? $BusinessInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BusinessBusinessName = isset($BusinessInfo['BusinessName']) ? $BusinessInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BusinessPhone = isset($BusinessInfo['Phone']) ? $BusinessInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BusinessFax = isset($BusinessInfo['Fax']) ? $BusinessInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BusinessWebsite = isset($BusinessInfo['Website']) ? $BusinessInfo['Website'] : '';&nbsp;</div></li><li><div>        $BusinessCustom = isset($BusinessInfo['Custom']) ? $BusinessInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BusinessInfoAddress = isset($DataArray['BusinessInfoAddress']) ? $DataArray['BusinessInfoAddress'] : array();&nbsp;</div></li><li><div>        $BusinessInfoAddressLine1 = isset($BusinessInfoAddress['Line1']) ? $BusinessInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressLine2 = isset($BusinessInfoAddress['Line2']) ? $BusinessInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCity = isset($BusinessInfoAddress['City']) ? $BusinessInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressState = isset($BusinessInfoAddress['State']) ? $BusinessInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressPostalCode = isset($BusinessInfoAddress['PostalCode']) ? $BusinessInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressCountryCode = isset($BusinessInfoAddress['CountryCode']) ? $BusinessInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BusinessInfoAddressType = isset($BusinessInfoAddress['AddressType']) ? $BusinessInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfo = isset($DataArray['BillingInfo']) ? $DataArray['BillingInfo'] : array();&nbsp;</div></li><li><div>        $BillingFirstName = isset($BillingInfo['FirstName']) ? $BillingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $BillingLastName = isset($BillingInfo['LastName']) ? $BillingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $BillingBusinessName = isset($BillingInfo['BusinessName']) ? $BillingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $BillingPhone = isset($BillingInfo['Phone']) ? $BillingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $BillingFax = isset($BillingInfo['Fax']) ? $BillingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $BillingWebsite = isset($BillingInfo['Website']) ? $BillingInfo['Website'] : '';&nbsp;</div></li><li><div>        $BillingCustom = isset($BillingInfo['Custom']) ? $BillingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfoAddress = isset($DataArray['BillingInfoAddress']) ? $DataArray['BillingInfoAddress'] : array();&nbsp;</div></li><li><div>        $BillingInfoAddressLine1 = isset($BillingInfoAddress['Line1']) ? $BillingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressLine2 = isset($BillingInfoAddress['Line2']) ? $BillingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCity = isset($BillingInfoAddress['City']) ? $BillingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressState = isset($BillingInfoAddress['State']) ? $BillingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressPostalCode = isset($BillingInfoAddress['PostalCode']) ? $BillingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressCountryCode = isset($BillingInfoAddress['CountryCode']) ? $BillingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $BillingInfoAddressType = isset($BillingInfoAddress['AddressType']) ? $BillingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfo = isset($DataArray['ShippingInfo']) ? $DataArray['ShippingInfo'] : array();&nbsp;</div></li><li><div>        $ShippingFirstName = isset($ShippingInfo['FirstName']) ? $ShippingInfo['FirstName'] : '';&nbsp;</div></li><li><div>        $ShippingLastName = isset($ShippingInfo['LastName']) ? $ShippingInfo['LastName'] : '';&nbsp;</div></li><li><div>        $ShippingBusinessName = isset($ShippingInfo['BusinessName']) ? $ShippingInfo['BusinessName'] : '';&nbsp;</div></li><li><div>        $ShippingPhone = isset($ShippingInfo['Phone']) ? $ShippingInfo['Phone'] : '';&nbsp;</div></li><li><div>        $ShippingFax = isset($ShippingInfo['Fax']) ? $ShippingInfo['Fax'] : '';&nbsp;</div></li><li><div>        $ShippingWebsite = isset($ShippingInfo['Website']) ? $ShippingInfo['Website'] : '';&nbsp;</div></li><li><div>        $ShippingCustom = isset($ShippingInfo['Custom']) ? $ShippingInfo['Custom'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfoAddress = isset($DataArray['ShippingInfoAddress']) ? $DataArray['ShippingInfoAddress'] : array();&nbsp;</div></li><li><div>        $ShippingInfoAddressLine1 = isset($ShippingInfoAddress['Line1']) ? $ShippingInfoAddress['Line1'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressLine2 = isset($ShippingInfoAddress['Line2']) ? $ShippingInfoAddress['Line2'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCity = isset($ShippingInfoAddress['City']) ? $ShippingInfoAddress['City'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressState = isset($ShippingInfoAddress['State']) ? $ShippingInfoAddress['State'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressPostalCode = isset($ShippingInfoAddress['PostalCode']) ? $ShippingInfoAddress['PostalCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressCountryCode = isset($ShippingInfoAddress['CountryCode']) ? $ShippingInfoAddress['CountryCode'] : '';&nbsp;</div></li><li><div>        $ShippingInfoAddressType = isset($ShippingInfoAddress['AddressType']) ? $ShippingInfoAddress['AddressType'] : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $InvoiceItems = isset($DataArray['InvoiceItems']) ? $DataArray['InvoiceItems'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;UpdateInvoiceRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceID != '' ? '&lt;invoiceID xmlns=&quot;&quot;&gt;' . $InvoiceID . '&lt;/invoiceID&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;invoice xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantEmail != '' ? '&lt;merchantEmail xmlns=&quot;&quot;&gt;' . $MerchantEmail . '&lt;/merchantEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PayerEmail != '' ? '&lt;payerEmail xmlns=&quot;&quot;&gt;' . $PayerEmail . '&lt;/payerEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Number != '' ? '&lt;number xmlns=&quot;&quot;&gt;' . $Number . '&lt;/number&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BusinessInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;merchantInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BusinessFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BusinessLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BusinessBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BusinessPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BusinessFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BusinessWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BusinessCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BusinessInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BusinessInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BusinessInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/merchantInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($InvoiceItems))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;itemList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            foreach($InvoiceItems as $InvoiceItem)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;item xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Name'] != '' ? '&lt;name xmlns=&quot;&quot;&gt;' . $InvoiceItem['Name'] . '&lt;/name&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Description'] != '' ? '&lt;description xmlns=&quot;&quot;&gt;' . $InvoiceItem['Description'] . '&lt;/description&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Date'] != '' ? '&lt;date xmlns=&quot;&quot;&gt;' . $InvoiceItem['Date'] . '&lt;/date&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['Quantity'] != '' ? '&lt;quantity xmlns=&quot;&quot;&gt;' . $InvoiceItem['Quantity'] . '&lt;/quantity&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['UnitPrice'] != '' ? '&lt;unitPrice xmlns=&quot;&quot;&gt;' . $InvoiceItem['UnitPrice'] . '&lt;/unitPrice&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxName'] != '' ? '&lt;taxName xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxName'] . '&lt;/taxName&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $InvoiceItem['TaxRate'] != '' ? '&lt;taxRate xmlns=&quot;&quot;&gt;' . $InvoiceItem['TaxRate'] . '&lt;/taxRate&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/item&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/itemList&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceDate != '' ? '&lt;invoiceDate xmlns=&quot;&quot;&gt;' . $InvoiceDate . '&lt;/invoiceDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DueDate != '' ? '&lt;dueDate xmlns=&quot;&quot;&gt;' . $DueDate . '&lt;/dueDate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PaymentTerms != '' ? '&lt;paymentTerms xmlns=&quot;&quot;&gt;' . $PaymentTerms . '&lt;/paymentTerms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountPercent != '' ? '&lt;discountPercent xmlns=&quot;&quot;&gt;' . $DiscountPercent . '&lt;/discountPercent&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $DiscountAmount != '' ? '&lt;discountAmount xmlns=&quot;&quot;&gt;' . $DiscountAmount . '&lt;/discountAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Terms != '' ? '&lt;terms xmlns=&quot;&quot;&gt;' . $Terms . '&lt;/terms&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Note != '' ? '&lt;note xmlns=&quot;&quot;&gt;' . $Note . '&lt;/note&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantMemo != '' ? '&lt;merchantMemo xmlns=&quot;&quot;&gt;' . $MerchantMemo . '&lt;/merchantMemo&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($BillingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;billingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $BillingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $BillingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BillingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $BillingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $BillingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $BillingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BillingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $BillingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($BillingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $BillingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $BillingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $BillingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $BillingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $BillingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/billingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($ShippingInfo))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;shippingInfo xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFirstName != '' ? '&lt;firstName xmlns=&quot;&quot;&gt;' . $ShippingFirstName . '&lt;/firstName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingLastName != '' ? '&lt;lastName xmlns=&quot;&quot;&gt;' . $ShippingLastName . '&lt;/lastName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingBusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $ShippingBusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingPhone != '' ? '&lt;phone xmlns=&quot;&quot;&gt;' . $ShippingPhone . '&lt;/phone&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingFax != '' ? '&lt;fax xmlns=&quot;&quot;&gt;' . $ShippingFax . '&lt;/fax&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingWebsite != '' ? '&lt;website xmlns=&quot;&quot;&gt;' . $ShippingWebsite . '&lt;/website&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $ShippingCustom != '' ? '&lt;customValue xmlns=&quot;&quot;&gt;' . $ShippingCustom . '&lt;/customValue&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($ShippingInfoAddress))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;address xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine1 != '' ? '&lt;line1 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine1 . '&lt;/line1&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressLine2 != '' ? '&lt;line2 xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressLine2 . '&lt;/line2&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCity != '' ? '&lt;city xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCity . '&lt;/city&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressState != '' ? '&lt;state xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressState . '&lt;/state&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressPostalCode != '' ? '&lt;postalCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressPostalCode . '&lt;/postalCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressCountryCode != '' ? '&lt;countryCode xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressCountryCode . '&lt;/countryCode&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= $ShippingInfoAddressType != '' ? '&lt;type xmlns=&quot;&quot;&gt;' . $ShippingInfoAddressType . '&lt;/type&gt;' : '';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/address&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/shippingInfo&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $ShippingAmount != '' ? '&lt;shippingAmount xmlns=&quot;&quot;&gt;' . $ShippingAmount . '&lt;/shippingAmount&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxName != '' ? '&lt;shippingTaxName xmlns=&quot;&quot;&gt;' . $ShippingTaxName . '&lt;/shippingTaxName&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $ShippingTaxRate != '' ? '&lt;shippingTaxRate xmlns=&quot;&quot;&gt;' . $ShippingTaxRate . '&lt;/shippingTaxRate&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $LogoURL != '' ? '&lt;logoUrl xmlns=&quot;&quot;&gt;' . $LogoURL . '&lt;/logoUrl&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/invoice&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/UpdateInvoiceRequest&gt;';&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'UpdateInvoice');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceNumber = $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceNumber' =&gt; $InvoiceNumber, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit UpdateInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    string&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetInvoiceDetails($InvoiceID)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetInvoiceDetailsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceID != '' ? '&lt;invoiceID xmlns=&quot;&quot;&gt;' . $InvoiceID . '&lt;/invoiceID&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetInvoiceDetailsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'GetInvoiceDetails');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceType = $DOM -&gt; getElementsByTagName('invoice') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoice') : array();&nbsp;</div></li><li><div>        foreach($InvoiceType as $Invoice)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $MerchantEmail = $Invoice -&gt; getElementsByTagName('merchantEmail') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('merchantEmail') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PayerEmail = $Invoice -&gt; getElementsByTagName('payerEmail') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('payerEmail') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Number = $Invoice -&gt; getElementsByTagName('number') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('number') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CurrencyCode = $Invoice -&gt; getElementsByTagName('currencyCode') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('currencyCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $InvoiceDate = $Invoice -&gt; getElementsByTagName('invoiceDate') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('invoiceDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $DueDate = $Invoice -&gt; getElementsByTagName('dueDate') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('dueDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PaymentTerms = $Invoice -&gt; getElementsByTagName('paymentTerms') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('paymentTerms') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $DiscountPercent = $Invoice -&gt; getElementsByTagName('discountPercent') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('discountPercent') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $DiscountAmount = $Invoice -&gt; getElementsByTagName('discountAmount') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('discountAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Terms = $Invoice -&gt; getElementsByTagName('terms') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('terms') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $InvoiceNote = $Invoice -&gt; getElementsByTagName('note') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('note') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantMemo = $Invoice -&gt; getElementsByTagName('merchantMemo') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('merchantMemo') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingAmount = $Invoice -&gt; getElementsByTagName('shippingAmount') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingTaxName = $Invoice -&gt; getElementsByTagName('shippingTaxName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingTaxName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingTaxRate = $Invoice -&gt; getElementsByTagName('shippingTaxRate') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingTaxRate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $LogoURL = $Invoice -&gt; getElementsByTagName('logoUrl') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('logoUrl') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $InvoiceDetailsType = $DOM -&gt; getElementsByTagName('invoiceDetails') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceDetails') : array();&nbsp;</div></li><li><div>        foreach($InvoiceDetailsType as $InvoiceDetails)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $Status = $InvoiceDetails -&gt; getElementsByTagName('status') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('status') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $TotalAmount = $InvoiceDetails -&gt; getElementsByTagName('totalAmount') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('totalAmount') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $Origin = $InvoiceDetails -&gt; getElementsByTagName('origin') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('origin') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CreatedDate = $InvoiceDetails -&gt; getElementsByTagName('createdDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('createdDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CreatedBy = $InvoiceDetails -&gt; getElementsByTagName('createdBy') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('createdBy') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CanceledDate = $InvoiceDetails -&gt; getElementsByTagName('canceledDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('canceledDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CanceledByActor = $InvoiceDetails -&gt; getElementsByTagName('canceledByActor') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('canceledByActor') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $CanceledBy = $InvoiceDetails -&gt; getElementsByTagName('canceledBy') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('canceledBy') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $LastUpdatedDate = $InvoiceDetails -&gt; getElementsByTagName('lastUpdatedDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('lastUpdatedDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $LastUpdatedBy = $InvoiceDetails -&gt; getElementsByTagName('lastUpdatedBy') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('lastUpdatedBy') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $FirstSentDate = $InvoiceDetails -&gt; getElementsByTagName('firstSentDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('firstSentDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $LastSentDate = $InvoiceDetails -&gt; getElementsByTagName('lastSentDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('lastSentDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $LastSentBy = $InvoiceDetails -&gt; getElementsByTagName('lastSentBy') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('lastSentBy') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PaidDate = $InvoiceDetails -&gt; getElementsByTagName('paidDate') -&gt; length &gt; 0 ? $InvoiceDetails -&gt; getElementsByTagName('paidDate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $InvoiceItems = array();&nbsp;</div></li><li><div>        $InvoiceItemsType = $DOM -&gt; getElementsByTagName('item') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('item') : array();&nbsp;</div></li><li><div>        foreach($InvoiceItemsType as $InvoiceItem)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $ItemName = $InvoiceItem -&gt; getElementsByTagName('name') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('name') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemDescription = $InvoiceItem -&gt; getElementsByTagName('description') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('description') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemDate = $InvoiceItem -&gt; getElementsByTagName('date') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('date') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemQuantity = $InvoiceItem -&gt; getElementsByTagName('quantity') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('quantity') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemUnitPrice = $InvoiceItem -&gt; getElementsByTagName('unitPrice') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('unitPrice') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemTaxName = $InvoiceItem -&gt; getElementsByTagName('taxName') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('taxName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ItemTaxRate = $InvoiceItem -&gt; getElementsByTagName('taxRate') -&gt; length &gt; 0 ? $InvoiceItem -&gt; getElementsByTagName('taxRate') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $InvoiceItemArray = array(&nbsp;</div></li><li><div>                                    'Name' =&gt; $ItemName, &nbsp;</div></li><li><div>                                    'Description' =&gt; $ItemDescription, &nbsp;</div></li><li><div>                                    'Date' =&gt; $ItemDate, &nbsp;</div></li><li><div>                                    'Quantity' =&gt; $ItemQuantity, &nbsp;</div></li><li><div>                                    'UnitPrice' =&gt; $ItemUnitPrice, &nbsp;</div></li><li><div>                                    'TaxName' =&gt; $ItemTaxName, &nbsp;</div></li><li><div>                                    'TaxRate' =&gt; $ItemTaxRate&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            array_push($InvoiceItems, $InvoiceItemArray);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $MerchantInfoType = $DOM -&gt; getElementsByTagName('merchantInfo') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('merchantInfo') : array();&nbsp;</div></li><li><div>        foreach($MerchantInfoType as $MerchantInfo)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $MerchantFirstName = $MerchantInfo -&gt; getElementsByTagName('firstName') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('firstName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantLastName = $MerchantInfo -&gt; getElementsByTagName('lastName') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('lastName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantBusinessName = $MerchantInfo -&gt; getElementsByTagName('businessName') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('businessName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantPhone = $MerchantInfo -&gt; getElementsByTagName('phone') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('phone') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantFax = $MerchantInfo -&gt; getElementsByTagName('fax') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('fax') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantWebsite = $MerchantInfo -&gt; getElementsByTagName('website') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('website') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $MerchantCustom = $MerchantInfo -&gt; getElementsByTagName('customValue') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('customValue') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $MerchantInfoAddressType = $MerchantInfo -&gt; getElementsByTagName('address') -&gt; length &gt; 0 ? $MerchantInfo -&gt; getElementsByTagName('address') : array();&nbsp;</div></li><li><div>            foreach($MerchantInfoAddressType as $MerchantInfoAddress)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $MerchantAddressLine1 = $MerchantInfoAddress -&gt; getElementsByTagName('line1') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('line1') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressLine2 = $MerchantInfoAddress -&gt; getElementsByTagName('line2') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('line2') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressCity = $MerchantInfoAddress -&gt; getElementsByTagName('city') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('city') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressState = $MerchantInfoAddress -&gt; getElementsByTagName('state') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('state') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressPostalCode = $MerchantInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressCountryCode = $MerchantInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $MerchantAddressType = $MerchantInfoAddress -&gt; getElementsByTagName('type') -&gt; length &gt; 0 ? $MerchantInfoAddress -&gt; getElementsByTagName('type') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $BillingInfoType = $DOM -&gt; getElementsByTagName('billingInfo') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('billingInfo') : array();&nbsp;</div></li><li><div>        foreach($BillingInfoType as $BillingInfo)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $BillingFirstName = $BillingInfo -&gt; getElementsByTagName('firstName') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('firstName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingLastName = $BillingInfo -&gt; getElementsByTagName('lastName') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('lastName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingBusinessName = $BillingInfo -&gt; getElementsByTagName('businessName') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('businessName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingPhone = $BillingInfo -&gt; getElementsByTagName('phone') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('phone') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingFax = $BillingInfo -&gt; getElementsByTagName('fax') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('fax') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingWebsite = $BillingInfo -&gt; getElementsByTagName('website') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('website') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $BillingCustom = $BillingInfo -&gt; getElementsByTagName('customValue') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('customValue') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $BillingInfoAddressType = $BillingInfo -&gt; getElementsByTagName('address') -&gt; length &gt; 0 ? $BillingInfo -&gt; getElementsByTagName('address') : array();&nbsp;</div></li><li><div>            foreach($BillingInfoAddressType as $BillingInfoAddress)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $BillingAddressLine1 = $BillingInfoAddress -&gt; getElementsByTagName('line1') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('line1') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressLine2 = $BillingInfoAddress -&gt; getElementsByTagName('line2') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('line2') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressCity = $BillingInfoAddress -&gt; getElementsByTagName('city') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('city') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressState = $BillingInfoAddress -&gt; getElementsByTagName('state') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('state') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressPostalCode = $BillingInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressCountryCode = $BillingInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $BillingAddressType = $BillingInfoAddress -&gt; getElementsByTagName('type') -&gt; length &gt; 0 ? $BillingInfoAddress -&gt; getElementsByTagName('type') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ShippingInfoType = $DOM -&gt; getElementsByTagName('shippingInfo') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('shippingInfo') : array();&nbsp;</div></li><li><div>        foreach($ShippingInfoType as $ShippingInfo)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $ShippingFirstName = $ShippingInfo -&gt; getElementsByTagName('firstName') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('firstName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingLastName = $ShippingInfo -&gt; getElementsByTagName('lastName') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('lastName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingBusinessName = $ShippingInfo -&gt; getElementsByTagName('businessName') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('businessName') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingPhone = $ShippingInfo -&gt; getElementsByTagName('phone') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('phone') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingFax = $ShippingInfo -&gt; getElementsByTagName('fax') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('fax') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingWebsite = $ShippingInfo -&gt; getElementsByTagName('website') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('website') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $ShippingCustom = $ShippingInfo -&gt; getElementsByTagName('customValue') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('customValue') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $ShippingInfoAddressType = $ShippingInfo -&gt; getElementsByTagName('address') -&gt; length &gt; 0 ? $ShippingInfo -&gt; getElementsByTagName('address') : array();&nbsp;</div></li><li><div>            foreach($ShippingInfoAddressType as $ShippingInfoAddress)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $ShippingAddressLine1 = $ShippingInfoAddress -&gt; getElementsByTagName('line1') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('line1') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressLine2 = $ShippingInfoAddress -&gt; getElementsByTagName('line2') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('line2') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressCity = $ShippingInfoAddress -&gt; getElementsByTagName('city') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('city') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressState = $ShippingInfoAddress -&gt; getElementsByTagName('state') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('state') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressPostalCode = $ShippingInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('postalCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressCountryCode = $ShippingInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('countryCode') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                $ShippingAddressType = $ShippingInfoAddress -&gt; getElementsByTagName('type') -&gt; length &gt; 0 ? $ShippingInfoAddress -&gt; getElementsByTagName('type') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ViaPayPal = $DOM -&gt; getElementsByTagName('viaPayPal') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('viaPayPal') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PayPalPaymentDetailsType = $DOM -&gt; getElementsByTagName('paypalPayment') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('paypalPayment') : array();&nbsp;</div></li><li><div>        foreach($PayPalPaymentDetailsType as $PayPalPaymentDetails)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $PayPalTransactionID = $PayPalPaymentDetails -&gt; getElementsByTagName('transactionID') -&gt; length &gt; 0 ? $PayPalPaymentDetails -&gt; getElementsByTagName('transactionID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PayPalTransactionDate = $PayPalPaymentDetails -&gt; getElementsByTagName('date') -&gt; length &gt; 0 ? $PayPalPaymentDetails -&gt; getElementsByTagName('date') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $OtherPaymentDetailsType = $DOM -&gt; getElementsByTagName('otherPayment') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('otherPayment') : array();&nbsp;</div></li><li><div>        foreach($OtherPaymentDetailsType as $OtherPaymentDetails)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $PaymentMethod = $OtherPaymentDetails -&gt; getElementsByTagName('method') -&gt; length &gt; 0 ? $OtherPaymentDetails -&gt; getElementsByTagName('method') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PaymentMethodNote = $OtherPaymentDetails -&gt; getElementsByTagName('note') -&gt; length &gt; 0 ? $OtherPaymentDetails -&gt; getElementsByTagName('note') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PaymentMethodDate = $OtherPaymentDetails -&gt; getElementsByTagName('date') -&gt; length &gt; 0 ? $OtherPaymentDetails -&gt; getElementsByTagName('date') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'MerchantEmail' =&gt; isset($MerchantEmail) ? $MerchantEmail : '', &nbsp;</div></li><li><div>                                   'PayerEmail' =&gt; isset($PayerEmail) ? $PayerEmail : '', &nbsp;</div></li><li><div>                                   'Number' =&gt; isset($Number) ? $Number : '', &nbsp;</div></li><li><div>                                   'CurrencyCode' =&gt; isset($CurrencyCode) ? $CurrencyCode : '', &nbsp;</div></li><li><div>                                   'InvoiceDate' =&gt; isset($InvoiceDate) ? $InvoiceDate : '', &nbsp;</div></li><li><div>                                   'DueDate' =&gt; isset($DueDate) ? $DueDate : '', &nbsp;</div></li><li><div>                                   'PaymentTerms' =&gt; isset($PaymentTerms) ? $PaymentTerms : '', &nbsp;</div></li><li><div>                                   'DiscountPercent' =&gt; isset($DiscountPercent) ? $DiscountPercent : '', &nbsp;</div></li><li><div>                                   'DiscountAmount' =&gt; isset($DiscountAmount) ? $DiscountAmount : '', &nbsp;</div></li><li><div>                                   'Terms' =&gt; isset($Terms) ? $Terms : '', &nbsp;</div></li><li><div>                                   'InvoiceNote' =&gt; isset($InvoiceNote) ? $InvoiceNote : '', &nbsp;</div></li><li><div>                                   'MerchantMemo' =&gt; isset($MerchantMemo) ? $MerchantMemo : '', &nbsp;</div></li><li><div>                                   'ShippingAmount' =&gt; isset($ShippingAmount) ? $ShippingAmount : '', &nbsp;</div></li><li><div>                                   'ShippingTaxName' =&gt; isset($ShippingTaxName) ? $ShippingTaxName : '', &nbsp;</div></li><li><div>                                   'ShippingTaxRate' =&gt; isset($ShippingTaxRate) ? $ShippingTaxRate : '', &nbsp;</div></li><li><div>                                   'LogoURL' =&gt; isset($LogoURL) ? $LogoURL : '', &nbsp;</div></li><li><div>                                   'Status' =&gt; isset($Status) ? $Status : '', &nbsp;</div></li><li><div>                                   'TotalAmount' =&gt; isset($TotalAmount) ? $TotalAmount : '', &nbsp;</div></li><li><div>                                   'Origin' =&gt; isset($Origin) ? $Origin : '', &nbsp;</div></li><li><div>                                   'CreatedDate' =&gt; isset($CreatedDate) ? $CreatedDate : '', &nbsp;</div></li><li><div>                                   'CreatedBy' =&gt; isset($CreatedBy) ? $CreatedBy : '', &nbsp;</div></li><li><div>                                   'CanceledDate' =&gt; isset($CanceledDate) ? $CanceledDate : '', &nbsp;</div></li><li><div>                                   'CanceledByActor' =&gt; isset($CanceledByActor) ? $CanceledByActor : '', &nbsp;</div></li><li><div>                                   'CanceledBy' =&gt; isset($CanceledBy) ? $CanceledBy : '', &nbsp;</div></li><li><div>                                   'LastUpdatedDate' =&gt; isset($LastUpdatedDate) ? $LastUpdatedDate : '', &nbsp;</div></li><li><div>                                   'LastUpdatedBy' =&gt; isset($LastUpdatedBy) ? $LastUpdatedBy : '', &nbsp;</div></li><li><div>                                   'FistSentDate' =&gt; isset($FirstSentDate) ? $FirstSentDate : '', &nbsp;</div></li><li><div>                                   'LastSentDate' =&gt; isset($LastSentDate) ? $LastSentDate : '', &nbsp;</div></li><li><div>                                   'LastSentBy' =&gt; isset($LastSentBy) ? $LastSentBy : '', &nbsp;</div></li><li><div>                                   'PaidDate' =&gt; isset($PaidDate) ? $PaidDate : '', &nbsp;</div></li><li><div>                                   'InvoiceItems' =&gt; isset($InvoiceItems) ? $InvoiceItems : '', &nbsp;</div></li><li><div>                                   'MerchantFirstName' =&gt; isset($MerchantFirstName) ? $MerchantFirstName : '', &nbsp;</div></li><li><div>                                   'MerchantLastName' =&gt; isset($MerchantLastName) ? $MerchantLastName : '', &nbsp;</div></li><li><div>                                   'MerchantBusinessName' =&gt; isset($MerchantBusinessName) ? $MerchantBusinessName : '', &nbsp;</div></li><li><div>                                   'MerchantPhone' =&gt; isset($MerchantPhone) ? $MerchantPhone : '', &nbsp;</div></li><li><div>                                   'MerchantFax' =&gt; isset($MerchantFax) ? $MerchantFax : '', &nbsp;</div></li><li><div>                                   'MerchantWebsite' =&gt; isset($MerchantWebsite) ? $MerchantWebsite : '', &nbsp;</div></li><li><div>                                   'MerchantCustom' =&gt; isset($MerchantCustom) ? $MerchantCustom : '', &nbsp;</div></li><li><div>                                   'MerchantAddressLine1' =&gt; isset($MerchantAddressLine1) ? $MerchantAddressLine1 : '', &nbsp;</div></li><li><div>                                   'MerchantAddressLine2' =&gt; isset($MerchantAddressLine2) ? $MerchantAddressLine2 : '', &nbsp;</div></li><li><div>                                   'MerchantAddressCity' =&gt; isset($MerchantAddressCity) ? $MerchantAddressCity : '', &nbsp;</div></li><li><div>                                   'MerchantAddressState' =&gt; isset($MerchantAddressState) ? $MerchantAddressState : '', &nbsp;</div></li><li><div>                                   'MerchantAddressPostalCode' =&gt; isset($MerchantAddressPostalCode) ? $MerchantAddressPostalCode : '', &nbsp;</div></li><li><div>                                   'MerchantAddressCountryCode' =&gt; isset($MerchantAddressCountryCode) ? $MerchantAddressCountryCode : '', &nbsp;</div></li><li><div>                                   'MerchantAddressType' =&gt; isset($MerchantAddressType) ? $MerchantAddressType : '', &nbsp;</div></li><li><div>                                   'BillingFirstName' =&gt; isset($BillingFirstName) ? $BillingFirstName : '', &nbsp;</div></li><li><div>                                   'BillingLastName' =&gt; isset($BillingLastName) ? $BillingLastName : '', &nbsp;</div></li><li><div>                                   'BillingBusinessName' =&gt; isset($BillingBusinessName) ? $BillingBusinessName : '', &nbsp;</div></li><li><div>                                   'BillingPhone' =&gt; isset($BillingPhone) ? $BillingPhone : '', &nbsp;</div></li><li><div>                                   'BillingFax' =&gt; isset($BillingFax) ? $BillingFax : '', &nbsp;</div></li><li><div>                                   'BillingWebsite' =&gt; isset($BillingWebsite) ? $BillingWebsite : '', &nbsp;</div></li><li><div>                                   'BillingCustom' =&gt; isset($BillingCustom) ? $BillingCustom : '', &nbsp;</div></li><li><div>                                   'BillingAddressLine1' =&gt; isset($BillingAddressLine1) ? $BillingAddressLine1 : '', &nbsp;</div></li><li><div>                                   'BillingAddressLine2' =&gt; isset($BillingAddressLine2) ? $BillingAddressLine2 : '', &nbsp;</div></li><li><div>                                   'BillingAddressCity' =&gt; isset($BillingAddressCity) ? $BillingAddressCity : '', &nbsp;</div></li><li><div>                                   'BillingAddressState' =&gt; isset($BillingAddressState) ? $BillingAddressState : '', &nbsp;</div></li><li><div>                                   'BillingAddressPostalCode' =&gt; isset($BillingAddressPostalCode) ? $BillingAddressPostalCode : '', &nbsp;</div></li><li><div>                                   'BillingAddressCountryCode' =&gt; isset($BillingAddressCountryCode) ? $BillingAddressCountryCode : '', &nbsp;</div></li><li><div>                                   'BillingAddressType' =&gt; isset($BillingAddressType) ? $BillingAddressType : '', &nbsp;</div></li><li><div>                                   'ShippingFirstName' =&gt; isset($ShippingFirstName) ? $ShippingFirstName : '', &nbsp;</div></li><li><div>                                   'ShippingLastName' =&gt; isset($ShippingLastName) ? $ShippingLastName : '', &nbsp;</div></li><li><div>                                   'ShippingBusinessName' =&gt; isset($ShippingBusinessName) ? $ShippingBusinessName : '', &nbsp;</div></li><li><div>                                   'ShippingPhone' =&gt; isset($ShippingPhone) ? $ShippingPhone : '', &nbsp;</div></li><li><div>                                   'ShippingFax' =&gt; isset($ShippingFax) ? $ShippingFax : '', &nbsp;</div></li><li><div>                                   'ShippingWebsite' =&gt; isset($ShippingWebsite) ? $ShippingWebsite : '', &nbsp;</div></li><li><div>                                   'ShippingCustom' =&gt; isset($ShippingCustom) ? $ShippingCustom : '', &nbsp;</div></li><li><div>                                   'ShippingAddressLine1' =&gt; isset($ShippingAddressLine1) ? $ShippingAddressLine1 : '', &nbsp;</div></li><li><div>                                   'ShippingAddressLine2' =&gt; isset($ShippingAddressLine2) ? $ShippingAddressLine2 : '', &nbsp;</div></li><li><div>                                   'ShippingAddressCity' =&gt; isset($ShippingAddressCity) ? $ShippingAddressCity : '', &nbsp;</div></li><li><div>                                   'ShippingAddressState' =&gt; isset($ShippingAddressState) ? $ShippingAddressState : '', &nbsp;</div></li><li><div>                                   'ShippingAddressPostalCode' =&gt; isset($ShippingAddressPostalCode) ? $ShippingAddressPostalCode : '', &nbsp;</div></li><li><div>                                   'ShippingAddressCountryCode' =&gt; isset($ShippingAddressCountryCode) ? $ShippingAddressCountryCode : '', &nbsp;</div></li><li><div>                                   'ShippingAddressType' =&gt; isset($ShippingAddressType) ? $ShippingAddressType : '', &nbsp;</div></li><li><div>                                   'ViaPayPal' =&gt; isset($ViaPayPal) ? $ViaPayPal : '', &nbsp;</div></li><li><div>                                   'PayPalTransactionID' =&gt; isset($PayPalTransactionID) ? $PayPalTransactionID : '', &nbsp;</div></li><li><div>                                   'PayPalTransactionDate' =&gt; isset($PayPalTransactionDate) ? $PayPalTransactionDate : '', &nbsp;</div></li><li><div>                                   'PaymentMethod' =&gt; isset($PaymentMethod) ? $PaymentMethod : '', &nbsp;</div></li><li><div>                                   'PaymentMethodNote' =&gt; isset($PaymentMethodNote) ? $PaymentMethodNote : '', &nbsp;</div></li><li><div>                                   'PaymentMethodDate' =&gt; isset($PaymentMethodDate) ? $PaymentMethodDate : '', &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit CancelInvoice API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function CancelInvoice($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $CancelInvoiceFields = isset($DataArray['CancelInvoiceFields']) ? $DataArray['CancelInvoiceFields'] : array();&nbsp;</div></li><li><div>        $InvoiceID = isset($CancelInvoiceFields['InvoiceID']) ? $CancelInvoiceFields['InvoiceID'] : '';&nbsp;</div></li><li><div>        $Subject = isset($CancelInvoiceFields['Subject']) ? $CancelInvoiceFields['Subject'] : '';&nbsp;</div></li><li><div>        $NoteForPayer = isset($CancelInvoiceFields['NoteForPayer']) ? $CancelInvoiceFields['NoteForPayer'] : '';&nbsp;</div></li><li><div>        $SendCopyToMerchant = isset($CancelInvoiceFields['SendCopyToMerchant']) ? $CancelInvoiceFields['SendCopyToMerchant'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CancelInvoiceRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceID != '' ? '&lt;invoiceID xmlns=&quot;&quot;&gt;' . $InvoiceID . '&lt;/invoiceID&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Subject != '' ? '&lt;subject xmlns=&quot;&quot;&gt;' . $Subject . '&lt;/subject&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $NoteForPayer != '' ? '&lt;noteForPayer xmlns=&quot;&quot;&gt;' . $NoteForPayer . '&lt;/noteForPayer&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SendCopyToMerchant != '' ? '&lt;sendCopyToMerchant xmlns=&quot;&quot;&gt;' . $SendCopyToMerchant . '&lt;/sendCopyToMerchant&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CancelInvoiceRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'CancelInvoice');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceNumber = $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceNumber' =&gt; $InvoiceNumber, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit SearchInvoices API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function SearchInvoices($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $SearchInvoicesFields = isset($DataArray['SearchInvoicesFields']) ? $DataArray['SearchInvoicesFields'] : array();&nbsp;</div></li><li><div>        $MerchantEmail = isset($SearchInvoicesFields['MerchantEmail']) ? $SearchInvoicesFields['MerchantEmail'] : '';&nbsp;</div></li><li><div>        $Page = isset($SearchInvoicesFields['Page']) ? $SearchInvoicesFields['Page'] : '';&nbsp;</div></li><li><div>        $PageSize = isset($SearchInvoicesFields['PageSize']) ? $SearchInvoicesFields['PageSize'] : '';        &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Parameters = isset($DataArray['Parameters']) ? $DataArray['Parameters'] : array();&nbsp;</div></li><li><div>        $Email = isset($Parameters['Email']) ? $Parameters['Email'] : '';&nbsp;</div></li><li><div>        $RecipientName = isset($Parameters['RecipientName']) ? $Parameters['RecipientName'] : '';&nbsp;</div></li><li><div>        $BusinessName = isset($Parameters['BusinessName']) ? $Parameters['BusinessName'] : '';&nbsp;</div></li><li><div>        $InvoiceNumber = isset($Parameters['InvoiceNumber']) ? $Parameters['InvoiceNumber'] : '';&nbsp;</div></li><li><div>        $Status = isset($Parameters['Status']) ? $Parameters['Status'] : '';&nbsp;</div></li><li><div>        $LowerAmount = isset($Parameters['LowerAmount']) ? $Parameters['LowerAmount'] : '';&nbsp;</div></li><li><div>        $UpperAmount = isset($Parameters['UpperAmount']) ? $Parameters['UpperAmount'] : '';&nbsp;</div></li><li><div>        $CurrencyCode = isset($Parameters['CurrencyCode']) ? $Parameters['CurrencyCode'] : '';&nbsp;</div></li><li><div>        $Memo = isset($Parameters['Memo']) ? $Parameters['Memo'] : '';&nbsp;</div></li><li><div>        $Origin = isset($Parameters['Origin']) ? $Parameters['Origin'] : '';&nbsp;</div></li><li><div>        $InvoiceDate = isset($Parameters['InvoiceDate']) ? $Parameters['InvoiceDate'] : array();&nbsp;</div></li><li><div>        $DueDate = isset($Parameters['DueDate']) ? $Parameters['DueDate'] : array();&nbsp;</div></li><li><div>        $PaymentDate = isset($Parameters['PaymentDate']) ? $Parameters['PaymentDate'] : array();&nbsp;</div></li><li><div>        $CreationDate = isset($Parameters['CreationDate']) ? $Parameters['CreationDate'] : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;SearchInvoicesRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $MerchantEmail != '' ? '&lt;merchantEmail xmlns=&quot;&quot;&gt;' . $MerchantEmail . '&lt;/merchantEmail&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Page != '' ? '&lt;page xmlns=&quot;&quot;&gt;' . $Page . '&lt;/page&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $PageSize != '' ? '&lt;pageSize xmlns=&quot;&quot;&gt;' . $PageSize . '&lt;/pageSize&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if(!empty($Parameters))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;parameters xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>            $XMLRequest .= $Email != '' ? '&lt;email xmlns=&quot;&quot;&gt;' . $Email . '&lt;/email&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $RecipientName != '' ? '&lt;recipientName xmlns=&quot;&quot;&gt;' . $RecipientName . '&lt;/recipientName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $BusinessName != '' ? '&lt;businessName xmlns=&quot;&quot;&gt;' . $BusinessName . '&lt;/businessName&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $InvoiceNumber != '' ? '&lt;invoiceNumber xmlns=&quot;&quot;&gt;' . $InvoiceNumber . '&lt;/invoiceNumber&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Status != '' ? '&lt;status xmlns=&quot;&quot;&gt;' . $Status . '&lt;/status&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $LowerAmount != '' ? '&lt;lowerAmount xmlns=&quot;&quot;&gt;' . $LowerAmount . '&lt;/lowerAmount&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $UpperAmount != '' ? '&lt;upperAmount xmlns=&quot;&quot;&gt;' . $UpperAmount . '&lt;/upperAmount&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $CurrencyCode != '' ? '&lt;currencyCode xmlns=&quot;&quot;&gt;' . $CurrencyCode . '&lt;/currencyCode&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Memo != '' ? '&lt;memo xmlns=&quot;&quot;&gt;' . $Memo . '&lt;/memo&gt;' : '';&nbsp;</div></li><li><div>            $XMLRequest .= $Origin != '' ? '&lt;origin xmlns=&quot;&quot;&gt;' . $Origin . '&lt;/origin&gt;' : '';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($InvoiceDate))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;invoiceDate xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;startDate xmlns=&quot;&quot;&gt;' . $InvoiceDate['StartDate'] . '&lt;/startDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;endDate xmlns=&quot;&quot;&gt;' . $InvoiceDate['EndDate'] . '&lt;/endDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/invoiceDate&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($DueDate))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;dueDate xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;startDate xmlns=&quot;&quot;&gt;' . $DueDate['StartDate'] . '&lt;/startDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;endDate xmlns=&quot;&quot;&gt;' . $DueDate['EndDate'] . '&lt;/endDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/dueDate&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($PaymentDate))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;paymentDate xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;startDate xmlns=&quot;&quot;&gt;' . $PaymentDate['StartDate'] . '&lt;/startDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;endDate xmlns=&quot;&quot;&gt;' . $PaymentDate['EndDate'] . '&lt;/endDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/paymentDate&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if(!empty($CreationDate))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;creationDate xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;startDate xmlns=&quot;&quot;&gt;' . $CreationDate['StartDate'] . '&lt;/startDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;endDate xmlns=&quot;&quot;&gt;' . $CreationDate['EndDate'] . '&lt;/endDate&gt;';&nbsp;</div></li><li><div>                $XMLRequest .= '&lt;/creationDate&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $XMLRequest .= '&lt;/parameters&gt;';    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/SearchInvoicesRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'SearchInvoices');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $Count = $DOM -&gt; getElementsByTagName('count') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('count') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Page = $DOM -&gt; getElementsByTagName('page') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('page') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $HasNextPage = $DOM -&gt; getElementsByTagName('hasNextPage') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('hasNextPage') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $HasPreviousPage = $DOM -&gt; getElementsByTagName('hasPreviousPage') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('hasPreviousPage') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoicesType = $DOM -&gt; getElementsByTagName('invoice') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoice') : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Invoices = array();&nbsp;</div></li><li><div>        foreach($InvoicesType as $Invoice)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $InvoiceID = $Invoice -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $MerchantEmail = $Invoice -&gt; getElementsByTagName('merchantEmail') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('merchantEmail') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $PayerEmail = $Invoice -&gt; getElementsByTagName('payerEmail') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('payerEmail') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $Number = $Invoice -&gt; getElementsByTagName('number') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('number') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $BillingBusinessName = $Invoice -&gt; getElementsByTagName('billingBusinessName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('billingBusinessName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $BillingFirstName = $Invoice -&gt; getElementsByTagName('billingFirstName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('billingFirstName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $BillingLastName = $Invoice -&gt; getElementsByTagName('billingLastName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('billingLastName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $ShippingBusinessName = $Invoice -&gt; getElementsByTagName('shippingBusinessName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingBusinessName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $ShippingFirstName = $Invoice -&gt; getElementsByTagName('shippingFirstName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingFirstName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $ShippingLastName = $Invoice -&gt; getElementsByTagName('shippingLastName') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('shippingLastName') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $TotalAmount = $Invoice -&gt; getElementsByTagName('totalAmount') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('totalAmount') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $CurrencyCode = $Invoice -&gt; getElementsByTagName('currencyCode') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('currencyCode') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $InvoiceDate = $Invoice -&gt; getElementsByTagName('invoiceDate') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('invoiceDate') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $DueDate = $Invoice -&gt; getElementsByTagName('dueDate') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('dueDate') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $Status = $Invoice -&gt; getElementsByTagName('status') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('status') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            $Origin = $Invoice -&gt; getElementsByTagName('origin') -&gt; length &gt; 0 ? $Invoice -&gt; getElementsByTagName('origin') -&gt; item(0) -&gt; nodeValue : '';        &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $InvoiceItem = array(&nbsp;</div></li><li><div>                                'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                'MerchantEmail' =&gt; $MerchantEmail, &nbsp;</div></li><li><div>                                'PayerEmail' =&gt; $PayerEmail, &nbsp;</div></li><li><div>                                'Number' =&gt; $Number, &nbsp;</div></li><li><div>                                'BillingBusinessName' =&gt; $BillingBusinessName, &nbsp;</div></li><li><div>                                'BillingFirstName' =&gt; $BillingFirstName, &nbsp;</div></li><li><div>                                'BillingLastName' =&gt; $BillingLastName, &nbsp;</div></li><li><div>                                'ShippingBusinessName' =&gt; $ShippingBusinessName, &nbsp;</div></li><li><div>                                'ShippingFirstName' =&gt; $ShippingFirstName, &nbsp;</div></li><li><div>                                'ShippingLastName' =&gt; $ShippingLastName, &nbsp;</div></li><li><div>                                'TotalAmount' =&gt; $TotalAmount, &nbsp;</div></li><li><div>                                'CurrencyCode' =&gt; $CurrencyCode, &nbsp;</div></li><li><div>                                'InvoiceDate' =&gt; $InvoiceDate, &nbsp;</div></li><li><div>                                'DueDate' =&gt; $DueDate, &nbsp;</div></li><li><div>                                'Status' =&gt; $Status, &nbsp;</div></li><li><div>                                'Origin' =&gt; $Origin&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            array_push($Invoices, $InvoiceItem);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'Count' =&gt; $Count, &nbsp;</div></li><li><div>                                   'Page' =&gt; $Page, &nbsp;</div></li><li><div>                                   'HasNextPage' =&gt; $HasNextPage, &nbsp;</div></li><li><div>                                   'HasPreviousPage' =&gt; $HasPreviousPage, &nbsp;</div></li><li><div>                                   'Invoices' =&gt; $Invoices, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit MarkInvoiceAsPaid API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function MarkInvoiceAsPaid($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $MarkInvoiceAsPaidFields = isset($DataArray['MarkInvoiceAsPaidFields']) ? $DataArray['MarkInvoiceAsPaidFields'] : array();&nbsp;</div></li><li><div>        $InvoiceID = isset($MarkInvoiceAsPaidFields['InvoiceID']) ? $MarkInvoiceAsPaidFields['InvoiceID'] : '';&nbsp;</div></li><li><div>        $Method = isset($MarkInvoiceAsPaidFields['Method']) ? $MarkInvoiceAsPaidFields['Method'] : '';&nbsp;</div></li><li><div>        $Note = isset($MarkInvoiceAsPaidFields['Note']) ? $MarkInvoiceAsPaidFields['Note'] : '';&nbsp;</div></li><li><div>        $Date = isset($MarkInvoiceAsPaidFields['Date']) ? $MarkInvoiceAsPaidFields['Date'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;MarkInvoiceAsPaidRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $InvoiceID != '' ? '&lt;invoiceID xmlns=&quot;&quot;&gt;' . $InvoiceID . '&lt;/invoiceID&gt;' : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;payment xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $Method != '' ? '&lt;method xmlns=&quot;&quot;&gt;' . $Method . '&lt;/method&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Note != '' ? '&lt;note xmlns=&quot;&quot;&gt;' . $Note . '&lt;/note&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Date != '' ? '&lt;date xmlns=&quot;&quot;&gt;' . $Date . '&lt;/date&gt;' : '';        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/payment&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/MarkInvoiceAsPaidRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Invoice', 'MarkInvoiceAsPaid');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $InvoiceID = $DOM -&gt; getElementsByTagName('invoiceID') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceID') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceNumber = $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceNumber') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $InvoiceURL = $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('invoiceURL') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'InvoiceID' =&gt; $InvoiceID, &nbsp;</div></li><li><div>                                   'InvoiceNumber' =&gt; $InvoiceNumber, &nbsp;</div></li><li><div>                                   'InvoiceURL' =&gt; $InvoiceURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div> &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit RequestPermissions API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function RequestPermissions($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $RequestPermissionsFields = isset($DataArray['RequestPermissionsFields']) ? $DataArray['RequestPermissionsFields'] : array();&nbsp;</div></li><li><div>        $Scope = isset($RequestPermissionsFields['Scope']) ? $RequestPermissionsFields['Scope'] : array();&nbsp;</div></li><li><div>        $Callback = isset($RequestPermissionsFields['Callback']) ? $RequestPermissionsFields['Callback'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;RequestPermissionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        foreach($Scope as $Value)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= $Scope != '' ? '&lt;scope xmlns=&quot;&quot;&gt;' . $Value . '&lt;/scope&gt;' : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $XMLRequest .= $Callback != '' ? '&lt;callback xmlns=&quot;&quot;&gt;' . $Callback . '&lt;/callback&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/RequestPermissionsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'RequestPermissions');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $Token = $DOM -&gt; getElementsByTagName('token') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('token') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $RedirectURL = $this-&gt;Sandbox ? 'https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=_grant-permission&request_token=' . $Token : 'https://www.paypal.com/cgi-bin/webscr?cmd=_grant-permission&request_token=' . $Token;&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'Token' =&gt; $Token, &nbsp;</div></li><li><div>                                   'RedirectURL' =&gt; $RedirectURL, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray; &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetAccessToken API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetAccessToken($DataArray)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>         $GetAccessTokenFields = isset($DataArray['GetAccessTokenFields']) ? $DataArray['GetAccessTokenFields'] : array();&nbsp;</div></li><li><div>        $Token = isset($GetAccessTokenFields['Token']) ? $GetAccessTokenFields['Token'] : '';&nbsp;</div></li><li><div>        $Verifier = isset($GetAccessTokenFields['Verifier']) ? $GetAccessTokenFields['Verifier'] : '';&nbsp;</div></li><li><div>        $SubjectAlias = isset($GetAccessTokenFields['SubjectAlias']) ? $GetAccessTokenFields['SubjectAlias'] : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetAccessTokenRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $Token != '' ? '&lt;token xmlns=&quot;&quot;&gt;' . $Token . '&lt;/token&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $Verifier != '' ? '&lt;verifier xmlns=&quot;&quot;&gt;' . $Verifier . '&lt;/verifier&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= $SubjectAlias != '' ? '&lt;subjectAlias xmlns=&quot;&quot;&gt;' . $SubjectAlias . '&lt;/subjectAlias&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetAccessTokenRequest&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'GetAccessToken');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Scope = array();&nbsp;</div></li><li><div>        $Scopes = $DOM -&gt; getElementsByTagName('scope') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('scope') : array();&nbsp;</div></li><li><div>        foreach($Scopes as $ScopeType)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            array_push($Scope, $ScopeType-&gt;nodeValue);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $Token = $DOM -&gt; getElementsByTagName('token') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('token') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $TokenSecret = $DOM -&gt; getElementsByTagName('tokenSecret') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('tokenSecret') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'Scope' =&gt; $Scope, &nbsp;</div></li><li><div>                                   'Token' =&gt; $Token, &nbsp;</div></li><li><div>                                   'TokenSecret' =&gt; $TokenSecret, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;  &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetPermissions API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetPermissions($Token)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetPermissionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $Token != '' ? '&lt;token xmlns=&quot;&quot;&gt;' . $Token . '&lt;/token&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetPermissionsRequest&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'GetPermissions');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $Scope = array();&nbsp;</div></li><li><div>        $Scopes = $DOM -&gt; getElementsByTagName('scope') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('scope') : array();&nbsp;</div></li><li><div>        foreach($Scopes as $ScopeType)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            array_push($Scope, $ScopeType-&gt;nodeValue);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'Scope' =&gt; $Scope, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray; &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit CancelPermissions API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function CancelPermissions($Token)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>         // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;CancelPermissionsRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= $Token != '' ? '&lt;token xmlns=&quot;&quot;&gt;' . $Token . '&lt;/token&gt;' : '';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/CancelPermissionsRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>         // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'CancelPermissions');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray; &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetBasicPersonalData API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetBasicPersonalData($AttributeList)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetBasicPersonalDataRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;attributeList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        foreach($AttributeList as $Attribute)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;attribute xmlns=&quot;&quot;&gt;' . $Attribute . '&lt;/attribute&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/attributeList&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetBasicPersonalDataRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'GetBasicPersonalData');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $PersonalDataList = $DOM -&gt; getElementsByTagName('personalData') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('personalData') : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PersonalData = array();&nbsp;</div></li><li><div>        foreach($PersonalDataList as $PersonalDataType)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $PersonalDataKey = $PersonalDataType -&gt; getElementsByTagName('personalDataKey') -&gt; length &gt; 0 ? $PersonalDataType -&gt; getElementsByTagName('personalDataKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PersonalDataValue = $PersonalDataType -&gt; getElementsByTagName('personalDataValue') -&gt; length &gt; 0 ? $PersonalDataType -&gt; getElementsByTagName('personalDataValue') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $PersonalDataItem = array('PersonalDataKey' =&gt; $PersonalDataKey, 'PersonalDataValue' =&gt; $PersonalDataValue);&nbsp;</div></li><li><div>            array_push($PersonalData, $PersonalDataItem);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PersonalDataKey = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PersonalDataValue = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PersonalData' =&gt; $PersonalData, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray; &nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     /**&nbsp;</div></li><li><div>     * Submit GetAdvancedPersonalData API request to PayPal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access    public&nbsp;</div></li><li><div>     * @param    array    call config data&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     function GetAdvancedPersonalData($AttributeList)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>         // Generate XML Request&nbsp;</div></li><li><div>        $XMLRequest = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;GetAdvancedPersonalDataRequest xmlns=&quot;' . $this -&gt; XMLNamespace . '&quot;&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= $this -&gt; GetXMLRequestEnvelope();&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;attributeList xmlns=&quot;&quot;&gt;';&nbsp;</div></li><li><div>        foreach($AttributeList as $Attribute)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $XMLRequest .= '&lt;attribute xmlns=&quot;&quot;&gt;' . $Attribute . '&lt;/attribute&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/attributeList&gt;';&nbsp;</div></li><li><div>        $XMLRequest .= '&lt;/GetAdvancedPersonalDataRequest&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Call the API and load XML response into DOM&nbsp;</div></li><li><div>        $XMLResponse = $this -&gt; CURLRequest($XMLRequest, 'Permissions', 'GetAdvancedPersonalData');&nbsp;</div></li><li><div>        $DOM = new DOMDocument();&nbsp;</div></li><li><div>        $DOM -&gt; loadXML($XMLResponse);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Parse XML values&nbsp;</div></li><li><div>        $Fault = $DOM -&gt; getElementsByTagName('FaultMessage') -&gt; length &gt; 0 ? true : false;&nbsp;</div></li><li><div>        $Errors = $this -&gt; GetErrors($XMLResponse);&nbsp;</div></li><li><div>        $Ack = $DOM -&gt; getElementsByTagName('ack') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('ack') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Build = $DOM -&gt; getElementsByTagName('build') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('build') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $CorrelationID = $DOM -&gt; getElementsByTagName('correlationId') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('correlationId') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $Timestamp = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $PersonalDataList = $DOM -&gt; getElementsByTagName('personalData') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('personalData') : array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PersonalData = array();&nbsp;</div></li><li><div>        foreach($PersonalDataList as $PersonalDataType)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $PersonalDataKey = $PersonalDataType -&gt; getElementsByTagName('personalDataKey') -&gt; length &gt; 0 ? $PersonalDataType -&gt; getElementsByTagName('personalDataKey') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>            $PersonalDataValue = $PersonalDataType -&gt; getElementsByTagName('personalDataValue') -&gt; length &gt; 0 ? $PersonalDataType -&gt; getElementsByTagName('personalDataValue') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $PersonalDataItem = array('PersonalDataKey' =&gt; $PersonalDataKey, 'PersonalDataValue' =&gt; $PersonalDataValue);&nbsp;</div></li><li><div>            array_push($PersonalData, $PersonalDataItem);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $PersonalDataKey = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        $PersonalDataValue = $DOM -&gt; getElementsByTagName('timestamp') -&gt; length &gt; 0 ? $DOM -&gt; getElementsByTagName('timestamp') -&gt; item(0) -&gt; nodeValue : '';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $ResponseDataArray = array(&nbsp;</div></li><li><div>                                   'Errors' =&gt; $Errors, &nbsp;</div></li><li><div>                                   'Ack' =&gt; $Ack, &nbsp;</div></li><li><div>                                   'Build' =&gt; $Build, &nbsp;</div></li><li><div>                                   'CorrelationID' =&gt; $CorrelationID, &nbsp;</div></li><li><div>                                   'Timestamp' =&gt; $Timestamp, &nbsp;</div></li><li><div>                                   'PersonalData' =&gt; $PersonalData, &nbsp;</div></li><li><div>                                   'XMLRequest' =&gt; $XMLRequest, &nbsp;</div></li><li><div>                                   'XMLResponse' =&gt; $XMLResponse&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return $ResponseDataArray;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>} // End Class PayPal_Adaptive&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/classes/angelleye_pay_pal_adaptive/" class="">1.4.3</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.2/classes/angelleye_pay_pal_adaptive/" class="">1.4.2</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.1/classes/angelleye_pay_pal_adaptive/" class="">1.4.1</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/classes/angelleye_pay_pal_adaptive/" class="active">1.4.0</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.3.3/classes/angelleye_pay_pal_adaptive/" class="">1.3.3</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Angelleye_PayPal_Adaptive</li><li><span></span>PayPal for WooCommerce</li><li><span></span>1.4.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>