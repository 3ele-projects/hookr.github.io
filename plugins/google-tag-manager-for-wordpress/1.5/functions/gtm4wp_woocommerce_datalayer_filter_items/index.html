<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr function lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr function lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr function lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr function ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr function gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr function" data-site="plugin" data-version="1.5" data-slug="google-tag-manager-for-wordpress" data-type="function" data-id="77655"><head xmlns="http://www.w3.org/1999/xhtml"><title> gtm4wp_woocommerce_datalayer_filter_items | function | Google Tag Manager For WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="gtm4wp_woocommerce_datalayer_filter_items, function, plugin, google-tag-manager-for-wordpress, 1.5" /><meta name="description" content="The Google Tag Manager for Wordpress gtm4wp woocommerce datalayer filter items function." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6f69c15a5d7b81f753ca3ddc76eee9e7' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/functions/gtm4wp_woocommerce_datalayer_filter_items/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fgtm4wp_woocommerce_datalayer_filter_items%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fgtm4wp_woocommerce_datalayer_filter_items%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-google-tag-manager-for-wordpress-1.5-function-gtm4wp_woocommerce_datalayer_filter_items","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="gtm4wp_woocommerce_datalayer_filter_items" class="single single-function single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to google-tag-manager-for-wordpr&hellip;." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/" class="plugin"><span property="name">google-tag-manager-for-wordpr&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.5." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/" class="H_VERSION"><span property="name">1.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to functions." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/" class=""><span property="name">functions</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">gtm4wp_woocommerce_datalayer_&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="function"><ul role="navigation"><li class="" data-id="all" data-count="243"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/all/" title="All">All <span class="count badge">243</span></a></li><li class="" data-id="new" data-count="4"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/new/" title="New">New <span class="count badge">4</span></a></li><li class="" data-id="hooks" data-count="25"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/hooks/" title="Hooks">Hooks <span class="count badge">25</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="25"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/filters/" title="Filters">Filters <span class="count badge">25</span></a></li><li class="" data-id="class" data-count="60"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/classes/" title="Classes">Classes <span class="count badge">60</span></a></li><li class="" data-id="constant" data-count="110"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/" title="Constants">Constants <span class="count badge">110</span></a></li><li class="active" data-id="function" data-count="48"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/" title="Functions">Functions <span class="count badge">48</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>gtm4wp_woocommerce_datalayer_filter_items</strong></h1><p>The Google Tag Manager for WordPress <strong>gtm4wp woocommerce datalayer filter items</strong> function.</p> </section> <section id="description"><h2>Description</h2><pre><div>gtm4wp_woocommerce_datalayer_filter_items( <a href="#" class="param" data-type="" data-desc="The datalayer." data-depr="" data-opt="" title="The datalayer.">$dataLayer</a> );&nbsp;</div></pre></section> <section id="params"><h2>Parameters <span class="count">(1)</span></h2><dl><dt> <span class="index">0.</span> <span class="param"> $datalayer </span></dt><dd> The datalayer.</dd></dl> </section><hr /> <section id="usage"><h2>Usage</h2><pre><ol><li><div>if ( !function_exists( '<span class="func">gtm4wp_woocommerce_datalayer_filter_items</span>' ) ) {&nbsp;</div></li><li><div>    require_once ABSPATH . PLUGINDIR . 'google-tag-manager-for-wordpress/integration/woocommerce.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// The datalayer.</span>&nbsp;</div></li><li><div><span class="param">$datalayer</span> = null;&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// NOTICE! Understand what this does before running.</span>&nbsp;</div></li><li><div><span class="param">$result</span> = <span class="func">gtm4wp_woocommerce_datalayer_filter_items</span>(<span class="param">$datalayer</span>);&nbsp;</div></li><li><div>   &nbsp;</div></li></ol></pre></section><hr /> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The function is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/files/integration-woocommerce/" class="file">/integration/woocommerce.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="21" class="block" start="21"><li><div>function gtm4wp_woocommerce_datalayer_filter_items( $dataLayer ) {&nbsp;</div></li><li><div>    global $woocommerce, $gtm4wp_options, $wp_query, $gtm4wp_datalayer_name, $gtm4wp_product_counter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( is_product_category() || is_product_tag() || is_front_page() || is_shop() ) {&nbsp;</div></li><li><div>    if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>      $dataLayer[&quot;ecomm_prodid&quot;] = array();&nbsp;</div></li><li><div>      $dataLayer[&quot;ecomm_pagetype&quot;] = ( is_front_page() ? &quot;home&quot; : &quot;category&quot; );&nbsp;</div></li><li><div>      $dataLayer[&quot;ecomm_totalvalue&quot;] = 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    } else if ( is_product() ) {&nbsp;</div></li><li><div>        if ( ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) || ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) ) {&nbsp;</div></li><li><div>            $prodid = get_the_ID();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $product = get_product( $prodid );&nbsp;</div></li><li><div>            $product_price = $product-&gt;get_price();&nbsp;</div></li><li><div>            $_product_cats = get_the_terms( $product-&gt;id, 'product_cat' );&nbsp;</div></li><li><div>            if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>                $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>                $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcusesku/" data-id="1191479" title="GTM4WP_OPTION_INTEGRATE_WCUSESKU" class="constant">GTM4WP_OPTION_INTEGRATE_WCUSESKU</a> ] ) {&nbsp;</div></li><li><div>                $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>                if ( &quot;&quot; != $product_sku ) {&nbsp;</div></li><li><div>                    $prodid = $product_sku;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_temp_productdata = array(&nbsp;</div></li><li><div>                &quot;name&quot; =&gt; <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_html_entity_decode/" data-id="1191658" title="gtm4wp_woocommerce_html_entity_decode" class="function">gtm4wp_woocommerce_html_entity_decode</a>( get_the_title() ), &nbsp;</div></li><li><div>                &quot;id&quot; =&gt; $prodid, &nbsp;</div></li><li><div>                &quot;price&quot; =&gt; $product_price, &nbsp;</div></li><li><div>                &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $eec_product_array = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_wpfilter_eec_product_array/" data-id="1191644" title="GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY" class="constant">GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY</a>, $_temp_productdata, &quot;productdetail&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>                $remarketing_id = (string)$prodid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_prodid&quot;] = $remarketing_id;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;product&quot;;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$eec_product_array[ &quot;price&quot; ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>                    &quot;detail&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;products&quot; =&gt; array($eec_product_array)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else if ( is_cart() ) {&nbsp;</div></li><li><div>        if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>            <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_addjs/" data-id="1191655" title="gtm4wp_woocommerce_addjs" class="function">gtm4wp_woocommerce_addjs</a>(&quot;&nbsp;</div></li><li><div>                $( document ).on( 'click', '[name=update_cart]', function() {&nbsp;</div></li><li><div>                    $( '.product-quantity input.qty' ).each(function() {&nbsp;</div></li><li><div>                        var _original_value = $( this ).prop( 'defaultValue' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        var _current_value = parseInt( $( this ).val() );&nbsp;</div></li><li><div>                        if ( isNaN( _current_value ) ) {&nbsp;</div></li><li><div>                            _current_value = _original_value;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( _original_value != _current_value ) {&nbsp;</div></li><li><div>                            var productdata = $( this ).closest( '.cart_item' ).find( '.remove' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( _original_value &lt; _current_value ) {&nbsp;</div></li><li><div>                                &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                                    'event': 'gtm4wp.addProductToCartEEC', &nbsp;</div></li><li><div>                                    'ecommerce': {&nbsp;</div></li><li><div>                                        'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                                        'add': {&nbsp;</div></li><li><div>                                            'products': [{&nbsp;</div></li><li><div>                                                'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                                                id       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                                                'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                                                'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                                                'quantity': _current_value - _original_value&nbsp;</div></li><li><div>                                            }]&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                });&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                                    'event': 'gtm4wp.removeFromCartEEC', &nbsp;</div></li><li><div>                                    'ecommerce': {&nbsp;</div></li><li><div>                                        'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                                        'remove': {&nbsp;</div></li><li><div>                                            'products': [{&nbsp;</div></li><li><div>                                                'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                                                id       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                                                'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                                                'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                                                'quantity': _original_value - _current_value&nbsp;</div></li><li><div>                                            }]&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                });&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>            $products = $woocommerce-&gt;cart-&gt;get_cart();&nbsp;</div></li><li><div>            $product_ids = array();&nbsp;</div></li><li><div>            foreach( $products as $oneproduct ) {&nbsp;</div></li><li><div>                $remarketing_id = $oneproduct['product_id'];&nbsp;</div></li><li><div>                if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcusesku/" data-id="1191479" title="GTM4WP_OPTION_INTEGRATE_WCUSESKU" class="constant">GTM4WP_OPTION_INTEGRATE_WCUSESKU</a> ] ) {&nbsp;</div></li><li><div>                    $product_sku = isset( $oneproduct['product_sku'] ) ? $oneproduct['product_sku'] : &quot;&quot;;&nbsp;</div></li><li><div>                    if ( &quot;&quot; != $product_sku ) {&nbsp;</div></li><li><div>                        $remarketing_id = $product_sku;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $product_ids[] = $remarketing_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $dataLayer[&quot;ecomm_prodid&quot;] = $product_ids;&nbsp;</div></li><li><div>            $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;cart&quot;;&nbsp;</div></li><li><div>            if ( ! $woocommerce-&gt;cart-&gt;prices_include_tax ) {&nbsp;</div></li><li><div>                $cart_total = $woocommerce-&gt;cart-&gt;cart_contents_total;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $cart_total = $woocommerce-&gt;cart-&gt;cart_contents_total + $woocommerce-&gt;cart-&gt;tax_total;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$cart_total;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else if ( is_order_received_page() ) {&nbsp;</div></li><li><div>        $order_id = empty( $_GET[ &quot;order&quot; ] ) ? ( $GLOBALS[ &quot;wp&quot; ]-&gt;query_vars[ &quot;order-received&quot; ] ? $GLOBALS[ &quot;wp&quot; ]-&gt;query_vars[ &quot;order-received&quot; ] : 0 ) : absint( $_GET[ &quot;order&quot; ] );&nbsp;</div></li><li><div>        $order_id_filtered = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/filters/woocommerce_thankyou_order_id/" data-id="1191703" title="woocommerce_thankyou_order_id" class="filter">'woocommerce_thankyou_order_id'</a>, $order_id );&nbsp;</div></li><li><div>        if ( &quot;&quot; != $order_id_filtered ) {&nbsp;</div></li><li><div>            $order_id = $order_id_filtered;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order_key = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/filters/woocommerce_thankyou_order_key/" data-id="1191704" title="woocommerce_thankyou_order_key" class="filter">'woocommerce_thankyou_order_key'</a>, empty( $_GET[ &quot;key&quot; ] ) ? &quot;&quot; : wc_clean( $_GET[ &quot;key&quot; ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $order_id &gt; 0 ) {&nbsp;</div></li><li><div>            $order = new WC_Order( $order_id );&nbsp;</div></li><li><div>            if ( $order-&gt;order_key != $order_key )&nbsp;</div></li><li><div>                unset( $order );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 1 == get_post_meta( $order_id, '_ga_tracked', true ) ) {&nbsp;</div></li><li><div>            unset( $order );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $order ) ) {&nbsp;</div></li><li><div>            if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackclassicec/" data-id="1191474" title="GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionId&quot;] = $order-&gt;get_order_number();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionDate&quot;] = date(&quot;c&quot;);&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionType&quot;] = &quot;sale&quot;;&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionAffiliation&quot;] = <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_html_entity_decode/" data-id="1191658" title="gtm4wp_woocommerce_html_entity_decode" class="function">gtm4wp_woocommerce_html_entity_decode</a>( get_bloginfo( 'name' ) );&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionTotal&quot;] = $order-&gt;get_total();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionShipping&quot;] = $order-&gt;get_total_shipping();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionTax&quot;] = $order-&gt;get_total_tax();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionPaymentType&quot;] = $order-&gt;payment_method_title;&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionCurrency&quot;] = get_woocommerce_currency();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionShippingMethod&quot;] = $order-&gt;get_shipping_method();&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionPromoCode&quot;] = implode( &quot;, &quot;, $order-&gt;get_used_coupons() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>                    &quot;currencyCode&quot; =&gt; get_woocommerce_currency(), &nbsp;</div></li><li><div>                    &quot;purchase&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;actionField&quot; =&gt; array(&nbsp;</div></li><li><div>                            &quot;id&quot; =&gt; $order-&gt;get_order_number(), &nbsp;</div></li><li><div>                            &quot;affiliation&quot; =&gt; <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_html_entity_decode/" data-id="1191658" title="gtm4wp_woocommerce_html_entity_decode" class="function">gtm4wp_woocommerce_html_entity_decode</a>( get_bloginfo( 'name' ) ), &nbsp;</div></li><li><div>                            &quot;revenue&quot; =&gt; $order-&gt;get_total(), &nbsp;</div></li><li><div>                            &quot;tax&quot; =&gt; $order-&gt;get_total_tax(), &nbsp;</div></li><li><div>                            &quot;shipping&quot; =&gt; $order-&gt;get_total_shipping(), &nbsp;</div></li><li><div>                            &quot;coupon&quot; =&gt; implode( &quot;, &quot;, $order-&gt;get_used_coupons() )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_products = array();&nbsp;</div></li><li><div>            $_sumprice = 0;&nbsp;</div></li><li><div>            $_product_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $order-&gt;get_items() ) {&nbsp;</div></li><li><div>                foreach ( $order-&gt;get_items() as $item ) {&nbsp;</div></li><li><div>                    $_product = $order-&gt;get_product_from_item( $item );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $variation_data = null;&nbsp;</div></li><li><div>          if (get_class($_product) == &quot;WC_Product_Variation&quot;) {&nbsp;</div></li><li><div>            $variation_data = $_product-&gt;get_variation_attributes();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $variation_data ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $_category = woocommerce_get_formatted_variation( $_product-&gt;variation_data, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $out = array();&nbsp;</div></li><li><div>                        $categories = get_the_terms( $_product-&gt;id, 'product_cat' );&nbsp;</div></li><li><div>                        if ( $categories ) {&nbsp;</div></li><li><div>                            foreach ( $categories as $category ) {&nbsp;</div></li><li><div>                                $out[] = $category-&gt;name;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $_category = implode( &quot; / &quot;, $out );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $remarketing_id = $_product-&gt;id;&nbsp;</div></li><li><div>                    $product_sku = $_product-&gt;get_sku();&nbsp;</div></li><li><div>                    if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcusesku/" data-id="1191479" title="GTM4WP_OPTION_INTEGRATE_WCUSESKU" class="constant">GTM4WP_OPTION_INTEGRATE_WCUSESKU</a> ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>                        $remarketing_id = $product_sku;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $_prodprice = $order-&gt;get_item_total( $item );&nbsp;</div></li><li><div>                    $_temp_productdata = array(&nbsp;</div></li><li><div>                      &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>                      &quot;name&quot; =&gt; $item['name'], &nbsp;</div></li><li><div>                      &quot;sku&quot; =&gt; $product_sku ? __( 'SKU:', 'duracelltomi-google-tag-manager' ) . ' ' . $product_sku : $_product-&gt;id, &nbsp;</div></li><li><div>                      &quot;category&quot; =&gt; $_category, &nbsp;</div></li><li><div>                      &quot;price&quot; =&gt; $_prodprice, &nbsp;</div></li><li><div>                      &quot;currency&quot; =&gt; get_woocommerce_currency(), &nbsp;</div></li><li><div>                      &quot;quantity&quot; =&gt; $item['qty']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $eec_product_array = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_wpfilter_eec_product_array/" data-id="1191644" title="GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY" class="constant">GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY</a>, $_temp_productdata, &quot;purchase&quot; );&nbsp;</div></li><li><div>                    $_products[] = $eec_product_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $_sumprice += $eec_product_array[ &quot;price&quot; ] * $eec_product_array[ &quot;quantity&quot; ];&nbsp;</div></li><li><div>                    $_product_ids[] = $remarketing_id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackclassicec/" data-id="1191474" title="GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;transactionProducts&quot;] = $_products;&nbsp;</div></li><li><div>                $dataLayer[&quot;event&quot;] = &quot;gtm4wp.orderCompleted&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;ecommerce&quot;][&quot;purchase&quot;][&quot;products&quot;] = $_products;&nbsp;</div></li><li><div>                $dataLayer[&quot;event&quot;] = &quot;gtm4wp.orderCompletedEEC&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_prodid&quot;] = $_product_ids;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;purchase&quot;;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$_sumprice;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            update_post_meta( $order_id, '_ga_tracked', 1 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else if ( is_checkout() ) {&nbsp;</div></li><li><div>        if ( ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) || ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) ) {&nbsp;</div></li><li><div>            $gtm4wp_checkout_products = array();&nbsp;</div></li><li><div>            $gtm4wp_checkout_products_remarketing = array();&nbsp;</div></li><li><div>            $gtm4wp_totalvalue = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach( $woocommerce-&gt;cart-&gt;get_cart() as $cart_item_id =&gt; $cart_item_data) {&nbsp;</div></li><li><div>                $product = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/filters/add_filter/woocommerce_cart_item_product/" data-id="1191722" title="woocommerce_cart_item_product" class="filter">'woocommerce_cart_item_product'</a>, $cart_item_data[&quot;data&quot;], $cart_item_data, $cart_item_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>                if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>                    $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>                    $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $remarketing_id = $product-&gt;id;&nbsp;</div></li><li><div>                $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>                if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcusesku/" data-id="1191479" title="GTM4WP_OPTION_INTEGRATE_WCUSESKU" class="constant">GTM4WP_OPTION_INTEGRATE_WCUSESKU</a> ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>                    $remarketing_id = $product_sku;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $_temp_productdata = array(&nbsp;</div></li><li><div>                    &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>                    &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>                    &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>                    &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>                    &quot;quantity&quot; =&gt; $cart_item_data[&quot;quantity&quot;]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $eec_product_array = apply_filters( <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_wpfilter_eec_product_array/" data-id="1191644" title="GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY" class="constant">GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY</a>, $_temp_productdata, &quot;checkout&quot; );&nbsp;</div></li><li><div>                $gtm4wp_checkout_products[] = $eec_product_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $gtm4wp_checkout_products_remarketing[] = $remarketing_id;&nbsp;</div></li><li><div>                $gtm4wp_totalvalue += $eec_product_array[ &quot;quantity&quot; ] * $eec_product_array[ &quot;price&quot; ];&nbsp;</div></li><li><div>            } // end foreach cart item&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_prodid&quot;] = $gtm4wp_checkout_products_remarketing;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;cart&quot;;&nbsp;</div></li><li><div>                $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$gtm4wp_totalvalue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>        $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>          &quot;checkout&quot; =&gt; array(&nbsp;</div></li><li><div>            &quot;actionField&quot; =&gt; array(&nbsp;</div></li><li><div>              &quot;step&quot; =&gt; 1&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            &quot;products&quot; =&gt; $gtm4wp_checkout_products&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_addjs/" data-id="1191655" title="gtm4wp_woocommerce_addjs" class="function">gtm4wp_woocommerce_addjs</a>(&quot;&nbsp;</div></li><li><div>          $( 'form[name=checkout]' ).on( 'submit', function() {&nbsp;</div></li><li><div>            var _checkout_option = [];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            var _shipping_el = $( '#shipping_method input:checked' );&nbsp;</div></li><li><div>            if ( _shipping_el.length &gt; 0 ) {&nbsp;</div></li><li><div>              _checkout_option.push( 'Shipping: ' + _shipping_el.val() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            var _payment_el = $( '.payment_methods input:checked' );&nbsp;</div></li><li><div>            if ( _payment_el.length &gt; 0 ) {&nbsp;</div></li><li><div>              _checkout_option.push( 'Payment: ' + _payment_el.val() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( _checkout_option.length &gt; 0 ) {&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                'event': 'gtm4wp.checkoutOptionECC', &nbsp;</div></li><li><div>                'ecommerce': {&nbsp;</div></li><li><div>                  'checkout_option': {&nbsp;</div></li><li><div>                    'actionField': {&nbsp;</div></li><li><div>                      'step': 1, &nbsp;</div></li><li><div>                      'option': _checkout_option.join( ', ' )&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>          });&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        if ( $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wcremarketing/" data-id="1191477" title="GTM4WP_OPTION_INTEGRATE_WCREMARKETING" class="constant">GTM4WP_OPTION_INTEGRATE_WCREMARKETING</a> ] ) {&nbsp;</div></li><li><div>            $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;other&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( true === $gtm4wp_options[ <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/constants/gtm4wp_option_integrate_wctrackenhancedec/" data-id="1191475" title="GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC" class="constant">GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC</a> ] ) {&nbsp;</div></li><li><div>        <a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_addjs/" data-id="1191655" title="gtm4wp_woocommerce_addjs" class="function">gtm4wp_woocommerce_addjs</a>(&quot;&nbsp;</div></li><li><div>    $( document ).on( 'click', '.mini_cart_item a.remove, .product-remove a.remove', function() {&nbsp;</div></li><li><div>        var productdata = $( this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        var qty = 0;&nbsp;</div></li><li><div>        var qty_element = $( this ).closest( '.cart_item' ).find( '.product-quantity input.qty' );&nbsp;</div></li><li><div>        if ( 0 == qty_element.length ) {&nbsp;</div></li><li><div>            qty_element = $( this ).closest( '.mini_cart_item' ).find( '.quantity' );&nbsp;</div></li><li><div>            if ( qty_element.length &gt; 0 ) {&nbsp;</div></li><li><div>                qty = parseInt( qty_element.text() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isNaN( qty ) ) {&nbsp;</div></li><li><div>                    qty = 0;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            qty = qty_element.val();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 == qty ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>            'event': 'gtm4wp.removeFromCartEEC', &nbsp;</div></li><li><div>            'ecommerce': {&nbsp;</div></li><li><div>                'remove': {&nbsp;</div></li><li><div>                    'products': [{&nbsp;</div></li><li><div>                        'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                        id       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                        'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                        'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                        'quantity': qty&nbsp;</div></li><li><div>                    }]&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        });&nbsp;</div></li><li><div>    });&nbsp;</div></li><li><div>        &quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $dataLayer;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/functions/gtm4wp_woocommerce_datalayer_filter_items/" class="">1.6.1</a></li><li><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6/functions/gtm4wp_woocommerce_datalayer_filter_items/" class="">1.6</a></li><li><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5.1/functions/gtm4wp_woocommerce_datalayer_filter_items/" class="">1.5.1</a></li><li><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.5/functions/gtm4wp_woocommerce_datalayer_filter_items/" class="active">1.5</a></li><li><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.4/functions/gtm4wp_woocommerce_datalayer_filter_items/" class="">1.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>function</li><li><span></span>gtm4wp_woocommerce_datalayer_filter_items</li><li><span></span>Google Tag Manager for Wordpress</li><li><span></span>1.6.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>