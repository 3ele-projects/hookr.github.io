<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.6.1" data-slug="google-tag-manager-for-wordpress" data-type="file" data-id="77789"><head xmlns="http://www.w3.org/1999/xhtml"><title> integration-woocommerce | file | Google Tag Manager For WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, google-tag-manager-for-wordpress, 1.6.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6ed7ac1e805062e404a7ec9f1d5bd98f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/integration-woocommerce/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fintegration-woocommerce%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fintegration-woocommerce%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-google-tag-manager-for-wordpress-1.6.1-file-integration-woocommerce","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="integration-woocommerce" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to google-tag-manager-for-wordpr&hellip;." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/" class="plugin"><span property="name">google-tag-manager-for-wordpr&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.6.1." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/" class="H_VERSION"><span property="name">1.6.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">integration-woocommerce</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="247"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/all/" title="All">All <span class="count badge">247</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="29"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/hooks/" title="Hooks">Hooks <span class="count badge">29</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="29"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/filters/" title="Filters">Filters <span class="count badge">29</span></a></li><li class="" data-id="class" data-count="60"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/classes/" title="Classes">Classes <span class="count badge">60</span></a></li><li class="" data-id="constant" data-count="109"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/constants/" title="Constants">Constants <span class="count badge">109</span></a></li><li class="" data-id="function" data-count="49"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/functions/" title="Functions">Functions <span class="count badge">49</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/google-tag-manager-for-wordpress/1.6.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/integration/woocommerce.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>define( 'GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY', 'gtm4wp_eec_product_array' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$gtm4wp_product_counter = 0;&nbsp;</div></li><li><div>$gtm4wp_last_widget_title = &quot;Sidebar Products&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_addjs( $js ) {&nbsp;</div></li><li><div>global $woocommerce;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( version_compare( $woocommerce-&gt;version, &quot;2.1&quot;, &quot;&gt;=&quot; ) ) {&nbsp;</div></li><li><div>      wc_enqueue_js( $js );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $woocommerce-&gt;add_inline_js( $js );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_html_entity_decode( $val ) {&nbsp;</div></li><li><div>  return html_entity_decode( $val, ENT_QUOTES, &quot;utf-8&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_datalayer_filter_items( $dataLayer ) {&nbsp;</div></li><li><div>  global $woocommerce, $gtm4wp_options, $wp_query, $gtm4wp_datalayer_name, $gtm4wp_product_counter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_product_category() || is_product_tag() || is_front_page() || is_shop() ) {&nbsp;</div></li><li><div>  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>    $dataLayer[&quot;ecomm_prodid&quot;] = array();&nbsp;</div></li><li><div>    $dataLayer[&quot;ecomm_pagetype&quot;] = ( is_front_page() ? &quot;home&quot; : &quot;category&quot; );&nbsp;</div></li><li><div>    $dataLayer[&quot;ecomm_totalvalue&quot;] = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  } else if ( is_product() ) {&nbsp;</div></li><li><div>      if ( ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) || ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) ) {&nbsp;</div></li><li><div>          $postid = get_the_ID();&nbsp;</div></li><li><div>          $product = wc_get_product( $postid );&nbsp;</div></li><li><div>          $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_product_cats = get_the_terms( $product-&gt;id, 'product_cat' );&nbsp;</div></li><li><div>          if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>              $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>              $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if ( &quot;variable&quot; != $product-&gt;product_type ) {&nbsp;</div></li><li><div>              $product_price = $product-&gt;get_price();&nbsp;</div></li><li><div>              if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] ) {&nbsp;</div></li><li><div>                  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>                  if ( &quot;&quot; != $product_sku ) {&nbsp;</div></li><li><div>                      $product_id = $product_sku;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $_temp_productdata = array(&nbsp;</div></li><li><div>                  &quot;name&quot; =&gt; gtm4wp_woocommerce_html_entity_decode( get_the_title() ), &nbsp;</div></li><li><div>                  &quot;id&quot; =&gt; $product_id, &nbsp;</div></li><li><div>                  &quot;price&quot; =&gt; $product_price, &nbsp;</div></li><li><div>                  &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;productdetail&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>                  $remarketing_id = (string)$product_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $dataLayer[&quot;ecomm_prodid&quot;] = $remarketing_id;&nbsp;</div></li><li><div>                  $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;product&quot;;&nbsp;</div></li><li><div>                  $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$eec_product_array[ &quot;price&quot; ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>                  $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>                      &quot;detail&quot; =&gt; array(&nbsp;</div></li><li><div>                          &quot;products&quot; =&gt; array($eec_product_array)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_prodid&quot;] = array();&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;product&quot;;&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_totalvalue&quot;] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>  var gtm4wp_product_detail_data = {&nbsp;</div></li><li><div>      name: '&quot; . gtm4wp_woocommerce_html_entity_decode( get_the_title() ) . &quot;', &nbsp;</div></li><li><div>      id: 0, &nbsp;</div></li><li><div>      price: 0, &nbsp;</div></li><li><div>      category: '&quot; . $product_cat . &quot;', &nbsp;</div></li><li><div>      variant: ''&nbsp;</div></li><li><div>  };&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  jQuery(document).on( 'found_variation', function( event, product_variation ) {&nbsp;</div></li><li><div>      var current_product_detail_data = gtm4wp_product_detail_data;&nbsp;</div></li><li><div>      current_product_detail_data.id = product_variation.variation_id;&nbsp;</div></li><li><div>      current_product_detail_data.price = product_variation.display_price;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      var _tmp = [];&nbsp;</div></li><li><div>      for( var attrib_key in product_variation.attributes ) {&nbsp;</div></li><li><div>          _tmp.push( product_variation.attributes[ attrib_key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      current_product_detail_data.variant = _tmp.join(', ');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>          'event': 'gtm4wp.changeDetailViewEEC', &nbsp;</div></li><li><div>          'ecommerce': {&nbsp;</div></li><li><div>              'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>              'detail': current_product_detail_data, &nbsp;</div></li><li><div>              'ecomm_prodid': current_product_detail_data.id, &nbsp;</div></li><li><div>              'ecomm_pagetype': 'product', &nbsp;</div></li><li><div>              'ecomm_totalvalue': 0&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  jQuery( '.variations select' ).trigger( 'change' );&nbsp;</div></li><li><div>&quot;);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else if ( is_cart() ) {&nbsp;</div></li><li><div>      if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>          gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>              $( document ).on( 'click', '[name=update_cart]', function() {&nbsp;</div></li><li><div>                  $( '.product-quantity input.qty' ).each(function() {&nbsp;</div></li><li><div>                      var _original_value = $( this ).prop( 'defaultValue' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      var _current_value = parseInt( $( this ).val() );&nbsp;</div></li><li><div>                      if ( isNaN( _current_value ) ) {&nbsp;</div></li><li><div>                          _current_value = _original_value;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( _original_value != _current_value ) {&nbsp;</div></li><li><div>                          var productdata = $( this ).closest( '.cart_item' ).find( '.remove' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( _original_value &lt; _current_value ) {&nbsp;</div></li><li><div>                              &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                                  'event': 'gtm4wp.addProductToCartEEC', &nbsp;</div></li><li><div>                                  'ecommerce': {&nbsp;</div></li><li><div>                                      'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                                      'add': {&nbsp;</div></li><li><div>                                          'products': [{&nbsp;</div></li><li><div>                                              'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                                              'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                                              'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                                              'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                                              'variant':  productdata.data( 'gtm4wp_product_variant' ), &nbsp;</div></li><li><div>                                              'quantity': _current_value - _original_value&nbsp;</div></li><li><div>                                          }]&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              });&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                                  'event': 'gtm4wp.removeFromCartEEC', &nbsp;</div></li><li><div>                                  'ecommerce': {&nbsp;</div></li><li><div>                                      'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                                      'remove': {&nbsp;</div></li><li><div>                                          'products': [{&nbsp;</div></li><li><div>                                              'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                                              'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                                              'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                                              'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                                              'variant':  productdata.data( 'gtm4wp_product_variant' ), &nbsp;</div></li><li><div>                                              'quantity': _original_value - _current_value&nbsp;</div></li><li><div>                                          }]&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              });&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  });&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>          &quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>          $products = $woocommerce-&gt;cart-&gt;get_cart();&nbsp;</div></li><li><div>          $product_ids = array();&nbsp;</div></li><li><div>          foreach( $products as $oneproduct ) {&nbsp;</div></li><li><div>              $remarketing_id = ( isset( $oneproduct[ &quot;variation_id&quot; ] ) && ($oneproduct[ &quot;variation_id&quot; ]&gt;0) ) ? $oneproduct[ &quot;variation_id&quot; ] : $oneproduct[ &quot;product_id&quot; ];&nbsp;</div></li><li><div>              $product_sku = $oneproduct[&quot;data&quot;]-&gt;get_sku();&nbsp;</div></li><li><div>              if ( ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] ) && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>                  $remarketing_id = $product_sku;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $product_ids[] = $remarketing_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $dataLayer[&quot;ecomm_prodid&quot;] = $product_ids;&nbsp;</div></li><li><div>          $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;cart&quot;;&nbsp;</div></li><li><div>          if ( ! $woocommerce-&gt;cart-&gt;prices_include_tax ) {&nbsp;</div></li><li><div>              $cart_total = $woocommerce-&gt;cart-&gt;cart_contents_total;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $cart_total = $woocommerce-&gt;cart-&gt;cart_contents_total + $woocommerce-&gt;cart-&gt;tax_total;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$cart_total;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else if ( is_order_received_page() ) {&nbsp;</div></li><li><div>      $order_id = empty( $_GET[ &quot;order&quot; ] ) ? ( $GLOBALS[ &quot;wp&quot; ]-&gt;query_vars[ &quot;order-received&quot; ] ? $GLOBALS[ &quot;wp&quot; ]-&gt;query_vars[ &quot;order-received&quot; ] : 0 ) : absint( $_GET[ &quot;order&quot; ] );&nbsp;</div></li><li><div>      $order_id_filtered = apply_filters( 'woocommerce_thankyou_order_id', $order_id );&nbsp;</div></li><li><div>      if ( &quot;&quot; != $order_id_filtered ) {&nbsp;</div></li><li><div>          $order_id = $order_id_filtered;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $order_key = apply_filters( 'woocommerce_thankyou_order_key', empty( $_GET[ &quot;key&quot; ] ) ? &quot;&quot; : wc_clean( $_GET[ &quot;key&quot; ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $order_id &gt; 0 ) {&nbsp;</div></li><li><div>          $order = new WC_Order( $order_id );&nbsp;</div></li><li><div>          if ( $order-&gt;order_key != $order_key )&nbsp;</div></li><li><div>              unset( $order );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 1 == get_post_meta( $order_id, '_ga_tracked', true ) ) {&nbsp;</div></li><li><div>          unset( $order );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $order ) ) {&nbsp;</div></li><li><div>          if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionId&quot;] = $order-&gt;get_order_number();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionDate&quot;] = date(&quot;c&quot;);&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionType&quot;] = &quot;sale&quot;;&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionAffiliation&quot;] = gtm4wp_woocommerce_html_entity_decode( get_bloginfo( 'name' ) );&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionTotal&quot;] = $order-&gt;get_total();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionShipping&quot;] = $order-&gt;get_total_shipping();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionTax&quot;] = $order-&gt;get_total_tax();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionPaymentType&quot;] = $order-&gt;payment_method_title;&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionCurrency&quot;] = get_woocommerce_currency();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionShippingMethod&quot;] = $order-&gt;get_shipping_method();&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionPromoCode&quot;] = implode( &quot;, &quot;, $order-&gt;get_used_coupons() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>                  &quot;currencyCode&quot; =&gt; get_woocommerce_currency(), &nbsp;</div></li><li><div>                  &quot;purchase&quot; =&gt; array(&nbsp;</div></li><li><div>                      &quot;actionField&quot; =&gt; array(&nbsp;</div></li><li><div>                          &quot;id&quot; =&gt; $order-&gt;get_order_number(), &nbsp;</div></li><li><div>                          &quot;affiliation&quot; =&gt; gtm4wp_woocommerce_html_entity_decode( get_bloginfo( 'name' ) ), &nbsp;</div></li><li><div>                          &quot;revenue&quot; =&gt; $order-&gt;get_total(), &nbsp;</div></li><li><div>                          &quot;tax&quot; =&gt; $order-&gt;get_total_tax(), &nbsp;</div></li><li><div>                          &quot;shipping&quot; =&gt; $order-&gt;get_total_shipping(), &nbsp;</div></li><li><div>                          &quot;coupon&quot; =&gt; implode( &quot;, &quot;, $order-&gt;get_used_coupons() )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_products = array();&nbsp;</div></li><li><div>          $_sumprice = 0;&nbsp;</div></li><li><div>          $_product_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $order-&gt;get_items() ) {&nbsp;</div></li><li><div>              foreach ( $order-&gt;get_items() as $item ) {&nbsp;</div></li><li><div>                  if ( version_compare( $woocommerce-&gt;version, &quot;3.0&quot;, &quot;&gt;=&quot; ) ) {&nbsp;</div></li><li><div>                      $product = $item-&gt;get_product();&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $product = $order-&gt;get_product_from_item( $item );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>                  $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>                  if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>                      $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>                      $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $remarketing_id = $product_id;&nbsp;</div></li><li><div>                  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>                  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>                      $remarketing_id = $product_sku;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $product_price = $order-&gt;get_item_total( $item );&nbsp;</div></li><li><div>                  $_temp_productdata = array(&nbsp;</div></li><li><div>                    &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>                    &quot;name&quot; =&gt; $item['name'], &nbsp;</div></li><li><div>                    &quot;sku&quot; =&gt; $product_sku ? __( 'SKU:', 'duracelltomi-google-tag-manager' ) . ' ' . $product_sku : $product_id, &nbsp;</div></li><li><div>                    &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>                    &quot;price&quot; =&gt; $product_price, &nbsp;</div></li><li><div>                    &quot;currency&quot; =&gt; get_woocommerce_currency(), &nbsp;</div></li><li><div>                    &quot;quantity&quot; =&gt; $item['qty']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>                  if ( &quot;variation&quot; == $product-&gt;get_type() ) {&nbsp;</div></li><li><div>                      $_temp_productdata[ &quot;variant&quot; ] = implode(&quot;, &quot;, $product-&gt;get_variation_attributes());&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;purchase&quot; );&nbsp;</div></li><li><div>                  $_products[] = $eec_product_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $_sumprice += $product_price * $eec_product_array[ &quot;quantity&quot; ];&nbsp;</div></li><li><div>                  $_product_ids[] = $remarketing_id;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;transactionProducts&quot;] = $_products;&nbsp;</div></li><li><div>              $dataLayer[&quot;event&quot;] = &quot;gtm4wp.orderCompleted&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;ecommerce&quot;][&quot;purchase&quot;][&quot;products&quot;] = $_products;&nbsp;</div></li><li><div>              $dataLayer[&quot;event&quot;] = &quot;gtm4wp.orderCompletedEEC&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_prodid&quot;] = $_product_ids;&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;purchase&quot;;&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$_sumprice;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $order_id, '_ga_tracked', 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else if ( is_checkout() ) {&nbsp;</div></li><li><div>      if ( ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) || ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) ) {&nbsp;</div></li><li><div>          $gtm4wp_checkout_products = array();&nbsp;</div></li><li><div>          $gtm4wp_checkout_products_remarketing = array();&nbsp;</div></li><li><div>          $gtm4wp_totalvalue = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach( $woocommerce-&gt;cart-&gt;get_cart() as $cart_item_id =&gt; $cart_item_data) {&nbsp;</div></li><li><div>              $product = apply_filters( 'woocommerce_cart_item_product', $cart_item_data[&quot;data&quot;], $cart_item_data, $cart_item_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>              $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>              if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>                  $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>                  $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $remarketing_id = $product_id;&nbsp;</div></li><li><div>              $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>              if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>                  $remarketing_id = $product_sku;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $_temp_productdata = array(&nbsp;</div></li><li><div>                  &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>                  &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>                  &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>                  &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>                  &quot;quantity&quot; =&gt; $cart_item_data[&quot;quantity&quot;]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( &quot;variation&quot; == $product-&gt;get_type() ) {&nbsp;</div></li><li><div>                  $_temp_productdata[ &quot;variant&quot; ] = implode(&quot;, &quot;, $product-&gt;get_variation_attributes());&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;checkout&quot; );&nbsp;</div></li><li><div>              $gtm4wp_checkout_products[] = $eec_product_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $gtm4wp_checkout_products_remarketing[] = $remarketing_id;&nbsp;</div></li><li><div>              $gtm4wp_totalvalue += $eec_product_array[ &quot;quantity&quot; ] * $eec_product_array[ &quot;price&quot; ];&nbsp;</div></li><li><div>          } <span class="comment">// end foreach cart item</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_prodid&quot;] = $gtm4wp_checkout_products_remarketing;&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;cart&quot;;&nbsp;</div></li><li><div>              $dataLayer[&quot;ecomm_totalvalue&quot;] = (float)$gtm4wp_totalvalue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>      $dataLayer[&quot;ecommerce&quot;] = array(&nbsp;</div></li><li><div>        &quot;checkout&quot; =&gt; array(&nbsp;</div></li><li><div>          &quot;actionField&quot; =&gt; array(&nbsp;</div></li><li><div>            &quot;step&quot; =&gt; 1&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          &quot;products&quot; =&gt; $gtm4wp_checkout_products&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>        $( 'form[name=checkout]' ).on( 'submit', function() {&nbsp;</div></li><li><div>          var _checkout_option = [];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          var _shipping_el = $( '#shipping_method input:checked' );&nbsp;</div></li><li><div>          if ( _shipping_el.length &gt; 0 ) {&nbsp;</div></li><li><div>            _checkout_option.push( 'Shipping: ' + _shipping_el.val() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          var _payment_el = $( '.payment_methods input:checked' );&nbsp;</div></li><li><div>          if ( _payment_el.length &gt; 0 ) {&nbsp;</div></li><li><div>            _checkout_option.push( 'Payment: ' + _payment_el.val() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( _checkout_option.length &gt; 0 ) {&nbsp;</div></li><li><div>            &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>              'event': 'gtm4wp.checkoutOptionECC', &nbsp;</div></li><li><div>              'ecommerce': {&nbsp;</div></li><li><div>                'checkout_option': {&nbsp;</div></li><li><div>                  'actionField': {&nbsp;</div></li><li><div>                    'step': 1, &nbsp;</div></li><li><div>                    'option': _checkout_option.join( ', ' )&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>            });&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        });&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) {&nbsp;</div></li><li><div>          $dataLayer[&quot;ecomm_pagetype&quot;] = &quot;other&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>  $( document ).on( 'click', '.mini_cart_item a.remove, .product-remove a.remove', function() {&nbsp;</div></li><li><div>      var productdata = $( this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      var qty = 0;&nbsp;</div></li><li><div>      var qty_element = $( this ).closest( '.cart_item' ).find( '.product-quantity input.qty' );&nbsp;</div></li><li><div>      if ( 0 == qty_element.length ) {&nbsp;</div></li><li><div>          qty_element = $( this ).closest( '.mini_cart_item' ).find( '.quantity' );&nbsp;</div></li><li><div>          if ( qty_element.length &gt; 0 ) {&nbsp;</div></li><li><div>              qty = parseInt( qty_element.text() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isNaN( qty ) ) {&nbsp;</div></li><li><div>                  qty = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          qty = qty_element.val();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 0 == qty ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>          'event': 'gtm4wp.removeFromCartEEC', &nbsp;</div></li><li><div>          'ecommerce': {&nbsp;</div></li><li><div>              'remove': {&nbsp;</div></li><li><div>                  'products': [{&nbsp;</div></li><li><div>                      'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                      'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                      'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                      'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                      'variant':  productdata.data( 'gtm4wp_product_variant' ), &nbsp;</div></li><li><div>                      'quantity': qty&nbsp;</div></li><li><div>                  }]&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>      &quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $dataLayer;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_single_add_to_cart_tracking() {&nbsp;</div></li><li><div>  global $product, $woocommerce, $gtm4wp_datalayer_name, $gtm4wp_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_single() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// exit early if there is nothing to do</span>&nbsp;</div></li><li><div>  if ( ( false === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC ] ) && ( false === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>  if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>      $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>      $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>  $remarketing_id = $product_id;&nbsp;</div></li><li><div>  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>      $remarketing_id = $product_sku;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_temp_productdata = array(&nbsp;</div></li><li><div>      &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>      &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>      &quot;sku&quot; =&gt; $product_sku ? __( 'SKU:', 'duracelltomi-google-tag-manager' ) . ' ' . $product_sku : $product_id, &nbsp;</div></li><li><div>      &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>      &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>      &quot;currency&quot; =&gt; get_woocommerce_currency()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;addtocartsingle&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC ] ) {&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>      $( '.single_add_to_cart_button' ).click(function() {&nbsp;</div></li><li><div>          &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>              'event': 'gtm4wp.addProductToCart', &nbsp;</div></li><li><div>              'productName': '&quot;. esc_js( $eec_product_array[ &quot;name&quot; ] ) .&quot;', &nbsp;</div></li><li><div>              'productSKU': '&quot;. esc_js( $eec_product_array[ &quot;sku&quot; ] ) .&quot;', &nbsp;</div></li><li><div>              'productID': '&quot;. esc_js( $eec_product_array[ &quot;id&quot; ] ) .&quot;'&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>      &quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>      $( '.single_add_to_cart_button' ).click(function() {&nbsp;</div></li><li><div>        var _product_form = jQuery( this ).closest( 'form.cart' );&nbsp;</div></li><li><div>        var _product_var_id = jQuery( '[name=variation_id]', _product_form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( _product_var_id.length &gt; 0 ) {&nbsp;</div></li><li><div>              _product_var_id_val = _product_var_id.val();&nbsp;</div></li><li><div>              _product_form_variations = _product_form.data( 'product_variations' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              _product_form_variations.forEach( function( product_var ) {&nbsp;</div></li><li><div>                  if ( product_var.variation_id == _product_var_id_val ) {&nbsp;</div></li><li><div>                      _product_var_sku = product_var.sku;&nbsp;</div></li><li><div>                      if ( ! _product_var_sku ) {&nbsp;</div></li><li><div>                          _product_var_sku = _product_var_id_val;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      var _tmp = [];&nbsp;</div></li><li><div>                      for( var attrib_key in product_var.attributes ) {&nbsp;</div></li><li><div>                          _tmp.push( product_var.attributes[ attrib_key ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                          'event': 'gtm4wp.addProductToCartEEC', &nbsp;</div></li><li><div>                          'ecommerce': {&nbsp;</div></li><li><div>                              'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                              'add': {&nbsp;</div></li><li><div>                                  'products': [{&nbsp;</div></li><li><div>                                      'id': &quot; . ($gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] ? &quot;_product_var_sku&quot; : &quot;_product_var_id_val&quot;) . &quot;, &nbsp;</div></li><li><div>                                      'name': '&quot;. esc_js( $eec_product_array[ &quot;name&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                                      'price': product_var.display_price, &nbsp;</div></li><li><div>                                      'category': '&quot;. esc_js( $eec_product_array[ &quot;category&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                                      'variant': _tmp.join(', '), &nbsp;</div></li><li><div>                                      'quantity': jQuery( 'form.cart:first input[name=quantity]' ).val()&nbsp;</div></li><li><div>                                  }]&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>                  'event': 'gtm4wp.addProductToCartEEC', &nbsp;</div></li><li><div>                  'ecommerce': {&nbsp;</div></li><li><div>                      'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                      'add': {&nbsp;</div></li><li><div>                          'products': [{&nbsp;</div></li><li><div>                              'id': '&quot;. esc_js( $eec_product_array[ &quot;id&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                              'name': '&quot;. esc_js( $eec_product_array[ &quot;name&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                              'price': '&quot;. esc_js( $eec_product_array[ &quot;price&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                              'category': '&quot;. esc_js( $eec_product_array[ &quot;category&quot; ] ) .&quot;', &nbsp;</div></li><li><div>                              'quantity': jQuery( 'form.cart:first input[name=quantity]' ).val()&nbsp;</div></li><li><div>                          }]&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>      &quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_wp_footer() {&nbsp;</div></li><li><div>  global $woocommerce, $gtm4wp_options, $gtm4wp_datalayer_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKCLASSICEC ] ) {&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>      $( '.add_to_cart_button:not(.product_type_variable, .product_type_grouped)' ).click(function() {&nbsp;</div></li><li><div>          var productdata = $( this ).closest( '.product' ).find( '.gtm4wp_productdata' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>              'event': 'gtm4wp.addProductToCart', &nbsp;</div></li><li><div>              'productName': productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>              'productSKU': $( this ).data( 'product_sku' ), &nbsp;</div></li><li><div>              'productID': $( this ).data( 'product_id' ), &nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>      &quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCREMARKETING ] ) && ( ! is_cart() ) ) {&nbsp;</div></li><li><div>      echo &quot;&nbsp;</div></li><li><div>&lt;script type='text/javascript'&gt;&nbsp;</div></li><li><div>  (function($) {&nbsp;</div></li><li><div>      if ( $( '.gtm4wp_productdata' ).length &gt; 0 ) {&nbsp;</div></li><li><div>          for( var i=0; i&lt;&quot;. $gtm4wp_datalayer_name .&quot;.length; i++ ) {&nbsp;</div></li><li><div>              if ( &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecomm_prodid' ] ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( i == &quot;. $gtm4wp_datalayer_name .&quot;.length ) {&nbsp;</div></li><li><div>              <span class="comment">// no existing dyn remarketing data found in the datalayer</span>&nbsp;</div></li><li><div>              i = 0;&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecomm_prodid' ] = [];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( typeof &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecomm_prodid' ].push == 'undefined' ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          var productdata;&nbsp;</div></li><li><div>          $( '.gtm4wp_productdata' ).each( function() {&nbsp;</div></li><li><div>              productdata = jQuery( this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecomm_prodid' ].push( productdata.data( 'gtm4wp_product_id' ) );&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  })(jQuery);&nbsp;</div></li><li><div>&lt;/script&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>      echo &quot;&nbsp;</div></li><li><div>&lt;script type='text/javascript'&gt;&nbsp;</div></li><li><div>  (function($) {&nbsp;</div></li><li><div>      if ( $( '.gtm4wp_productdata, .widget-product-item' ).length &gt; 0 ) {&nbsp;</div></li><li><div>          for( var i=0; i&lt;&quot;. $gtm4wp_datalayer_name .&quot;.length; i++ ) {&nbsp;</div></li><li><div>              if ( &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ][ 'impressions' ] ) {&nbsp;</div></li><li><div>                      &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ][ 'impressions' ] = [];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( i == &quot;. $gtm4wp_datalayer_name .&quot;.length ) {&nbsp;</div></li><li><div>              <span class="comment">// no existing ecommerce data found in the datalayer</span>&nbsp;</div></li><li><div>              i = 0;&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ] = {};&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ][ 'impressions' ] = [];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ][ 'currencyCode' ] = '&quot;.get_woocommerce_currency().&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          var productdata;&nbsp;</div></li><li><div>          $( '.gtm4wp_productdata, .widget-product-item' ).each( function() {&nbsp;</div></li><li><div>              productdata = jQuery( this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &quot;. $gtm4wp_datalayer_name .&quot;[ i ][ 'ecommerce' ][ 'impressions' ].push({&nbsp;</div></li><li><div>                  'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                  'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                  'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                  'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                  'position': productdata.data( 'gtm4wp_product_listposition' ), &nbsp;</div></li><li><div>                  'list':     productdata.data( 'gtm4wp_productlist_name' )&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>})(jQuery);&nbsp;</div></li><li><div>&lt;/script&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>      $( '.add_to_cart_button:not(.product_type_variable, .product_type_grouped)' ).click(function() {&nbsp;</div></li><li><div>          var productdata = $( this ).closest( '.product' ).find( '.gtm4wp_productdata' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>              'event': 'gtm4wp.addProductToCartEEC', &nbsp;</div></li><li><div>              'ecommerce': {&nbsp;</div></li><li><div>                  'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                  'add': {&nbsp;</div></li><li><div>                      'products': [{&nbsp;</div></li><li><div>                          'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                          'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                          'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                          'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                          'quantity': 1&nbsp;</div></li><li><div>                      }]&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>      &quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_enhanced_ecom_product_click() {&nbsp;</div></li><li><div>  global $woocommerce, $gtm4wp_datalayer_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  gtm4wp_woocommerce_addjs(&quot;&nbsp;</div></li><li><div>      $( '.products li:not(.product-category) a:not(.add_to_cart_button), .widget-product-item' ).click(function( event ) {&nbsp;</div></li><li><div>          if ( 'undefined' == typeof google_tag_manager ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>          var _productdata = $( this ).closest( '.product' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( _productdata.length &gt; 0 ) {&nbsp;</div></li><li><div>              var productdata = _productdata.find( '.gtm4wp_productdata' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              var _productdata = $( this ).closest( 'ul.products li' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( _productdata.length &gt; 0 ) {&nbsp;</div></li><li><div>                  var productdata = _productdata.find( '.gtm4wp_productdata' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  var productdata = jQuery( this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ( 'undefined' == typeof productdata.data( 'gtm4wp_product_id' ) ) || ( '' == productdata.data( 'gtm4wp_product_id' ) ) ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// only act on links pointing to the product detail page</span>&nbsp;</div></li><li><div>          if ( productdata.data( 'gtm4wp_product_url' ) != $( this ).attr( 'href' ) ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          var ctrl_key_pressed = event.ctrlKey;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          event.preventDefault();&nbsp;</div></li><li><div>          if ( ctrl_key_pressed ) {&nbsp;</div></li><li><div>              <span class="comment">// we need to open the new tab/page here so that popup blocker of the browser doesn't block our code</span>&nbsp;</div></li><li><div>              var _productpage = window.open( 'about:blank', '_blank' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &quot;. $gtm4wp_datalayer_name .&quot;.push({&nbsp;</div></li><li><div>              'event': 'gtm4wp.productClickEEC', &nbsp;</div></li><li><div>              'ecommerce': {&nbsp;</div></li><li><div>                  'currencyCode': '&quot;.get_woocommerce_currency().&quot;', &nbsp;</div></li><li><div>                  'click': {&nbsp;</div></li><li><div>                    'actionField': {'list': productdata.data( 'gtm4wp_productlist_name' )}, &nbsp;</div></li><li><div>                      'products': [{&nbsp;</div></li><li><div>                          'id':       productdata.data( 'gtm4wp_product_id' ), &nbsp;</div></li><li><div>                          'name':     productdata.data( 'gtm4wp_product_name' ), &nbsp;</div></li><li><div>                          'price':    productdata.data( 'gtm4wp_product_price' ), &nbsp;</div></li><li><div>                          'category': productdata.data( 'gtm4wp_product_cat' ), &nbsp;</div></li><li><div>                          'position': productdata.data( 'gtm4wp_product_listposition' )&nbsp;</div></li><li><div>                      }]&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }, &nbsp;</div></li><li><div>              'eventCallback': function() {&nbsp;</div></li><li><div>                  if ( ctrl_key_pressed && _productpage ) {&nbsp;</div></li><li><div>                      _productpage.location.href= productdata.data( 'gtm4wp_product_url' );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      document.location.href = productdata.data( 'gtm4wp_product_url' )&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }, &nbsp;</div></li><li><div>              'eventTimeout': 2000&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  &quot;);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_add_prod_data( $add_to_cart_link ) {&nbsp;</div></li><li><div>  global $product, $woocommerce_loop, $wp_query, $gtm4wp_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>  $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>  if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>      $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>      $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_search() ) {&nbsp;</div></li><li><div>      $list_name = __( &quot;Search Results&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>  } else if ( isset( $woocommerce_loop[ &quot;listtype&quot; ] ) && ( $woocommerce_loop[ &quot;listtype&quot; ] != '' ) ) {&nbsp;</div></li><li><div>      $list_name = $woocommerce_loop[ &quot;listtype&quot; ];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $list_name = __( &quot;General Product List&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;&nbsp;</div></li><li><div>  $posts_per_page = get_query_var('posts_per_page');&nbsp;</div></li><li><div>  if ( $posts_per_page &lt; 1 ) {&nbsp;</div></li><li><div>      $posts_per_page = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $remarketing_id = $product_id;&nbsp;</div></li><li><div>  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>      $remarketing_id = $product_sku;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_temp_productdata = array(&nbsp;</div></li><li><div>      &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>      &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>      &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>      &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>      &quot;productlink&quot; =&gt; apply_filters( 'the_permalink', get_permalink(), 0), &nbsp;</div></li><li><div>      &quot;listposition&quot; =&gt; $woocommerce_loop[ &quot;loop&quot; ] + ( $posts_per_page * ($paged-1) ), &nbsp;</div></li><li><div>      &quot;listname&quot; =&gt; $list_name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( &quot;variation&quot; == $product-&gt;product_type ) {&nbsp;</div></li><li><div>      $_temp_productdata[ &quot;variant&quot; ] = implode(&quot;, &quot;, $product-&gt;get_variation_attributes());&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_temp_productdata[ &quot;variant&quot; ] = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;addtocartproductlist&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cartlink_with_data = sprintf('data-gtm4wp_product_id=&quot;%s&quot; data-gtm4wp_product_name=&quot;%s&quot; data-gtm4wp_product_price=&quot;%s&quot; data-gtm4wp_product_cat=&quot;%s&quot; data-gtm4wp_product_url=&quot;%s&quot; data-gtm4wp_product_listposition=&quot;%s&quot; data-gtm4wp_productlist_name=&quot;%s&quot; data-gtm4wp_product_variant=&quot;%s&quot; href=&quot;', &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;id&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;name&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;price&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;category&quot; ] ), &nbsp;</div></li><li><div>      esc_url( $eec_product_array[ &quot;productlink&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;listposition&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;listname&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;variant&quot; ] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return str_replace( 'href=&quot;', $cartlink_with_data, $add_to_cart_link );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;] = '';&nbsp;</div></li><li><div>function gtm4wp_woocommerce_cart_item_product_filter( $product, $cart_item=&quot;&quot;, $cart_id=&quot;&quot; ) {&nbsp;</div></li><li><div>  global $gtm4wp_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>  $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>  if ( ( is_array( $_product_cats ) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>      $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>      $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $remarketing_id = $product_id;&nbsp;</div></li><li><div>  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>      $remarketing_id = $product_sku;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_temp_productdata = array(&nbsp;</div></li><li><div>      &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>      &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>      &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>      &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>      &quot;productlink&quot; =&gt; apply_filters( 'the_permalink', get_permalink(), 0)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( &quot;variation&quot; == $product-&gt;product_type ) {&nbsp;</div></li><li><div>      $_temp_productdata[ &quot;variant&quot; ] = implode(&quot;, &quot;, $product-&gt;get_variation_attributes());&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_temp_productdata[ &quot;variant&quot; ] = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;cart&quot; );&nbsp;</div></li><li><div>  $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;] = $eec_product_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $product;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_cart_item_remove_link_filter( $remove_from_cart_link ) {&nbsp;</div></li><li><div>if ( ! isset( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;] ) ) {&nbsp;</div></li><li><div>  return $remove_from_cart_link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! is_array( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;] ) ) {&nbsp;</div></li><li><div>  return $remove_from_cart_link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cartlink_with_data = sprintf('data-gtm4wp_product_id=&quot;%s&quot; data-gtm4wp_product_name=&quot;%s&quot; data-gtm4wp_product_price=&quot;%s&quot; data-gtm4wp_product_cat=&quot;%s&quot; data-gtm4wp_product_url=&quot;%s&quot; data-gtm4wp_product_variant=&quot;%s&quot; href=&quot;', &nbsp;</div></li><li><div>      esc_attr( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;id&quot;] ), &nbsp;</div></li><li><div>      esc_attr( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;name&quot;] ), &nbsp;</div></li><li><div>      esc_attr( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;price&quot;] ), &nbsp;</div></li><li><div>      esc_attr( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;category&quot;] ), &nbsp;</div></li><li><div>      esc_url( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;productlink&quot;] ), &nbsp;</div></li><li><div>      esc_attr( $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;][&quot;variant&quot;] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $GLOBALS[&quot;gtm4wp_cart_item_proddata&quot;] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return str_replace( 'href=&quot;', $cartlink_with_data, $remove_from_cart_link );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtp4wp_woocommerce_reset_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = &quot;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_add_related_to_loop( $arg ) {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Related Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $arg;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_before_template_part( $template_name ) {&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_after_template_part( $template_name ) {&nbsp;</div></li><li><div>  global $product, $gtm4wp_product_counter, $gtm4wp_last_widget_title, $gtm4wp_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $productitem = ob_get_contents();&nbsp;</div></li><li><div>  ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( &quot;content-widget-product.php&quot; == $template_name ) {&nbsp;</div></li><li><div>    $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>      $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>      if ( ( is_array( $_product_cats ) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>          $product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>          $product_cat = $product_cat-&gt;name;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $remarketing_id = $product_id;&nbsp;</div></li><li><div>      $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>      if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>          $remarketing_id = $product_sku;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $_temp_productdata = array(&nbsp;</div></li><li><div>          &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>          &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>          &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>          &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>          &quot;productlink&quot; =&gt; apply_filters( 'the_permalink', get_permalink(), 0), &nbsp;</div></li><li><div>          &quot;listname&quot; =&gt; $gtm4wp_last_widget_title, &nbsp;</div></li><li><div>          &quot;listposition&quot; =&gt; $gtm4wp_product_counter&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;widgetproduct&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $productlink_with_data = sprintf('data-gtm4wp_product_id=&quot;%s&quot; data-gtm4wp_product_name=&quot;%s&quot; data-gtm4wp_product_price=&quot;%s&quot; data-gtm4wp_product_cat=&quot;%s&quot; data-gtm4wp_product_url=&quot;%s&quot; data-gtm4wp_productlist_name=&quot;%s&quot; data-gtm4wp_product_listposition=&quot;%s&quot; class=&quot;widget-product-item&quot; href=&quot;', &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;id&quot; ] ), &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;name&quot; ] ), &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;price&quot; ] ), &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;category&quot; ] ), &nbsp;</div></li><li><div>          esc_url( $eec_product_array[ &quot;productlink&quot; ] ), &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;listname&quot; ] ), &nbsp;</div></li><li><div>          esc_attr( $eec_product_array[ &quot;listposition&quot; ] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $gtm4wp_product_counter++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $productitem = str_replace( 'href=&quot;', $productlink_with_data, $productitem );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $productitem;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_widget_title_filter( $widget_title ) {&nbsp;</div></li><li><div>  global $gtm4wp_product_counter, $gtm4wp_last_widget_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $gtm4wp_product_counter = 1;&nbsp;</div></li><li><div>  $gtm4wp_last_widget_title = $widget_title . __( &quot; (widget)&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $widget_title;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_recent_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Recent Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_sale_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Sale Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_best_selling_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Best Selling Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_top_rated_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Top Rated Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_featured_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Featured Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_before_related_products_loop() {&nbsp;</div></li><li><div>  global $woocommerce_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $woocommerce_loop[ &quot;listtype&quot; ] = __( &quot;Related Products&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gtm4wp_woocommerce_before_shop_loop_item() {&nbsp;</div></li><li><div>  global $product, $woocommerce_loop, $wp_query, $gtm4wp_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $product ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $product_id = $product-&gt;get_id();&nbsp;</div></li><li><div>  $product_cat = &quot;&quot;;&nbsp;</div></li><li><div>  if ( is_product_category() ) {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>      $cat_obj = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>      $product_cat = $cat_obj-&gt;name;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_product_cats = get_the_terms($product-&gt;id, 'product_cat');&nbsp;</div></li><li><div>      if ( ( is_array($_product_cats) ) && ( count( $_product_cats ) &gt; 0 ) ) {&nbsp;</div></li><li><div>          $last_product_cat = array_pop( $_product_cats );&nbsp;</div></li><li><div>          $product_cat = $last_product_cat-&gt;name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_search() ) {&nbsp;</div></li><li><div>      $list_name = __( &quot;Search Results&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>  } else if ( isset( $woocommerce_loop[ &quot;listtype&quot; ] ) && ( $woocommerce_loop[ &quot;listtype&quot; ] != '' ) ) {&nbsp;</div></li><li><div>      $list_name = $woocommerce_loop[ &quot;listtype&quot; ];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $list_name = __( &quot;General Product List&quot;, &quot;duracelltomi-google-tag-manager&quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;&nbsp;</div></li><li><div>  $posts_per_page = get_query_var('posts_per_page');&nbsp;</div></li><li><div>  if ( $posts_per_page &lt; 1 ) {&nbsp;</div></li><li><div>      $posts_per_page = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $remarketing_id = $product_id;&nbsp;</div></li><li><div>  $product_sku = $product-&gt;get_sku();&nbsp;</div></li><li><div>  if ( $gtm4wp_options[ GTM4WP_OPTION_INTEGRATE_WCUSESKU ] && ( &quot;&quot; != $product_sku ) ) {&nbsp;</div></li><li><div>      $remarketing_id = $product_sku;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_temp_productdata = array(&nbsp;</div></li><li><div>      &quot;id&quot; =&gt; $remarketing_id, &nbsp;</div></li><li><div>      &quot;name&quot; =&gt; $product-&gt;post-&gt;post_title, &nbsp;</div></li><li><div>      &quot;price&quot; =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div>      &quot;category&quot; =&gt; $product_cat, &nbsp;</div></li><li><div>      &quot;productlink&quot; =&gt; apply_filters( 'the_permalink', get_permalink(), 0), &nbsp;</div></li><li><div>      &quot;listname&quot; =&gt; $list_name, &nbsp;</div></li><li><div>      &quot;listposition&quot; =&gt; $woocommerce_loop[ &quot;loop&quot; ] + ( $posts_per_page * ($paged-1) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $eec_product_array = apply_filters( GTM4WP_WPFILTER_EEC_PRODUCT_ARRAY, $_temp_productdata, &quot;productlist&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  printf('&lt;span class=&quot;gtm4wp_productdata&quot; style=&quot;display:none; visibility:hidden;&quot; data-gtm4wp_product_id=&quot;%s&quot; data-gtm4wp_product_name=&quot;%s&quot; data-gtm4wp_product_price=&quot;%s&quot; data-gtm4wp_product_cat=&quot;%s&quot; data-gtm4wp_product_url=&quot;%s&quot; data-gtm4wp_product_listposition=&quot;%s&quot; data-gtm4wp_productlist_name=&quot;%s&quot;&gt;&lt;/span&gt;', &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;id&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;name&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;price&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;category&quot; ] ), &nbsp;</div></li><li><div>      esc_url( $eec_product_array[ &quot;productlink&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;listposition&quot; ] ), &nbsp;</div></li><li><div>      esc_attr( $eec_product_array[ &quot;listname&quot; ] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// do not add filter if someone enabled WooCommerce integration without an activated WooCommerce plugin</span>&nbsp;</div></li><li><div>if ( isset ( $GLOBALS[&quot;woocommerce&quot;] ) ) {&nbsp;</div></li><li><div>  add_filter( GTM4WP_WPFILTER_COMPILE_DATALAYER, &quot;gtm4wp_woocommerce_datalayer_filter_items&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_filter( 'loop_end', 'gtp4wp_woocommerce_reset_loop' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_action( &quot;woocommerce_before_shop_loop_item&quot;, &quot;gtm4wp_woocommerce_before_shop_loop_item&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//    add_filter( &quot;woocommerce_loop_add_to_cart_link&quot;, &quot;gtm4wp_woocommerce_add_prod_data&quot; );</span>&nbsp;</div></li><li><div>  add_action( &quot;woocommerce_after_add_to_cart_button&quot;, &quot;gtm4wp_woocommerce_single_add_to_cart_tracking&quot; );&nbsp;</div></li><li><div>  add_action( &quot;wp_footer&quot;, &quot;gtm4wp_woocommerce_wp_footer&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $GLOBALS[ &quot;gtm4wp_options&quot; ][ GTM4WP_OPTION_INTEGRATE_WCTRACKENHANCEDEC ] ) {&nbsp;</div></li><li><div>      add_action( 'wp_footer', 'gtm4wp_woocommerce_enhanced_ecom_product_click' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_before_template_part', 'gtm4wp_woocommerce_before_template_part' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_after_template_part', 'gtm4wp_woocommerce_after_template_part' );&nbsp;</div></li><li><div>      add_filter( 'widget_title', 'gtm4wp_widget_title_filter' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( &quot;woocommerce_cart_item_product&quot;, &quot;gtm4wp_woocommerce_cart_item_product_filter&quot; );&nbsp;</div></li><li><div>      add_filter( &quot;woocommerce_cart_item_remove_link&quot;, &quot;gtm4wp_woocommerce_cart_item_remove_link_filter&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( &quot;woocommerce_related_products_args&quot;, &quot;gtm4wp_woocommerce_add_related_to_loop&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_recent_products_loop', 'gtm4wp_before_recent_products_loop' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_sale_products_loop', 'gtm4wp_before_sale_products_loop' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_best_selling_products_loop', 'gtm4wp_before_best_selling_products_loop' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_top_rated_products_loop', 'gtm4wp_before_top_rated_products_loop' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_featured_products_loop', 'gtm4wp_before_featured_products_loop' );&nbsp;</div></li><li><div>      add_action( 'woocommerce_shortcode_before_related_products_loop', 'gtm4wp_before_related_products_loop' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Google Tag Manager for Wordpress</li><li><span></span>1.6.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>