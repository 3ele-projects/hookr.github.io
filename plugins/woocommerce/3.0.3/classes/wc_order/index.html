<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.0.3" data-slug="woocommerce" data-type="class" data-id="41445"><head xmlns="http://www.w3.org/1999/xhtml"><title> wc_order | class | Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WC_Order, class, plugin, woocommerce, 3.0.3" /><meta name="description" content="Order Class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=82fa8fb78b63f29ee37e49315479e973' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wc_order/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_order%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_order%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-3.0.3-class-wc_order","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wc_order" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce." href="http://hookr.io/plugins/woocommerce/" class="plugin"><span property="name">woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.0.3." href="http://hookr.io/plugins/woocommerce/3.0.3/" class="H_VERSION"><span property="name">3.0.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce/3.0.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wc_order</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="3113"><a href="http://hookr.io/plugins/woocommerce/3.0.3/all/" title="All">All <span class="count badge">3113</span></a></li><li class="" data-id="new" data-count="10"><a href="http://hookr.io/plugins/woocommerce/3.0.3/new/" title="New">New <span class="count badge">10</span></a></li><li class="" data-id="hooks" data-count="2106"><a href="http://hookr.io/plugins/woocommerce/3.0.3/hooks/" title="Hooks">Hooks <span class="count badge">2106</span></a></li><li class="" data-id="action" data-count="774"><a href="http://hookr.io/plugins/woocommerce/3.0.3/actions/" title="Actions">Actions <span class="count badge">774</span></a></li><li class="" data-id="filter" data-count="1332"><a href="http://hookr.io/plugins/woocommerce/3.0.3/filters/" title="Filters">Filters <span class="count badge">1332</span></a></li><li class="active" data-id="class" data-count="364"><a href="http://hookr.io/plugins/woocommerce/3.0.3/classes/" title="Classes">Classes <span class="count badge">364</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/woocommerce/3.0.3/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="625"><a href="http://hookr.io/plugins/woocommerce/3.0.3/functions/" title="Functions">Functions <span class="count badge">625</span></a></li><li class="" data-id="shortcode" data-count="4"><a href="http://hookr.io/plugins/woocommerce/3.0.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">4</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WC_Order</strong></h1><p>Order Class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce/3.0.3/files/includes-class-wc-order/" class="file">/includes/class-wc-order.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="18" class="block" start="18"><li><div>class WC_Order extends WC_Abstract_Order {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stores data about status changes so relevant hooks can be fired.&nbsp;</div></li><li><div>     * @var bool|array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $status_transition = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Order Data array. This is the core order data exposed in APIs since 3.0.0.&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $data = array(&nbsp;</div></li><li><div>        // Abstract order props&nbsp;</div></li><li><div>        'parent_id' =&gt; 0, &nbsp;</div></li><li><div>        'status' =&gt; '', &nbsp;</div></li><li><div>        'currency' =&gt; '', &nbsp;</div></li><li><div>        'version' =&gt; '', &nbsp;</div></li><li><div>        'prices_include_tax' =&gt; false, &nbsp;</div></li><li><div>        'date_created' =&gt; null, &nbsp;</div></li><li><div>        'date_modified' =&gt; null, &nbsp;</div></li><li><div>        'discount_total' =&gt; 0, &nbsp;</div></li><li><div>        'discount_tax' =&gt; 0, &nbsp;</div></li><li><div>        'shipping_total' =&gt; 0, &nbsp;</div></li><li><div>        'shipping_tax' =&gt; 0, &nbsp;</div></li><li><div>        'cart_tax' =&gt; 0, &nbsp;</div></li><li><div>        'total' =&gt; 0, &nbsp;</div></li><li><div>        'total_tax' =&gt; 0, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Order props&nbsp;</div></li><li><div>        'customer_id' =&gt; 0, &nbsp;</div></li><li><div>        'order_key' =&gt; '', &nbsp;</div></li><li><div>        'billing' =&gt; array(&nbsp;</div></li><li><div>            'first_name' =&gt; '', &nbsp;</div></li><li><div>            'last_name' =&gt; '', &nbsp;</div></li><li><div>            'company' =&gt; '', &nbsp;</div></li><li><div>            'address_1' =&gt; '', &nbsp;</div></li><li><div>            'address_2' =&gt; '', &nbsp;</div></li><li><div>            'city' =&gt; '', &nbsp;</div></li><li><div>            'state' =&gt; '', &nbsp;</div></li><li><div>            'postcode' =&gt; '', &nbsp;</div></li><li><div>            'country' =&gt; '', &nbsp;</div></li><li><div>            'email' =&gt; '', &nbsp;</div></li><li><div>            'phone' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'shipping' =&gt; array(&nbsp;</div></li><li><div>            'first_name' =&gt; '', &nbsp;</div></li><li><div>            'last_name' =&gt; '', &nbsp;</div></li><li><div>            'company' =&gt; '', &nbsp;</div></li><li><div>            'address_1' =&gt; '', &nbsp;</div></li><li><div>            'address_2' =&gt; '', &nbsp;</div></li><li><div>            'city' =&gt; '', &nbsp;</div></li><li><div>            'state' =&gt; '', &nbsp;</div></li><li><div>            'postcode' =&gt; '', &nbsp;</div></li><li><div>            'country' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'payment_method' =&gt; '', &nbsp;</div></li><li><div>        'payment_method_title' =&gt; '', &nbsp;</div></li><li><div>        'transaction_id' =&gt; '', &nbsp;</div></li><li><div>        'customer_ip_address' =&gt; '', &nbsp;</div></li><li><div>        'customer_user_agent' =&gt; '', &nbsp;</div></li><li><div>        'created_via' =&gt; '', &nbsp;</div></li><li><div>        'customer_note' =&gt; '', &nbsp;</div></li><li><div>        'date_completed' =&gt; null, &nbsp;</div></li><li><div>        'date_paid' =&gt; null, &nbsp;</div></li><li><div>        'cart_hash' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * When a payment is complete this function is called.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Most of the time this should mark an order as 'processing' so that admin can process/post the items.&nbsp;</div></li><li><div>     * If the cart contains only downloadable items then the order is 'completed' since the admin needs to take no action.&nbsp;</div></li><li><div>     * Stock levels are reduced at this point.&nbsp;</div></li><li><div>     * Sales are also recorded for products.&nbsp;</div></li><li><div>     * Finally, record the date of payment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Order must exist.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $transaction_id Optional transaction id to store in post meta.&nbsp;</div></li><li><div>     * @return bool success&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function payment_complete( $transaction_id = '' ) {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            if ( ! $this-&gt;get_id() ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            do_action( 'woocommerce_pre_payment_complete', $this-&gt;get_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( WC()-&gt;session ) ) {&nbsp;</div></li><li><div>                WC()-&gt;session-&gt;set( 'order_awaiting_payment', false );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $this-&gt;has_status( apply_filters( 'woocommerce_valid_order_statuses_for_payment_complete', array( 'on-hold', 'pending', 'failed', 'cancelled' ), $this ) ) ) {&nbsp;</div></li><li><div>                if ( ! empty( $transaction_id ) ) {&nbsp;</div></li><li><div>                    $this-&gt;set_transaction_id( $transaction_id );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! $this-&gt;get_date_paid( 'edit' ) ) {&nbsp;</div></li><li><div>                    $this-&gt;set_date_paid( current_time( 'timestamp', true ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;set_status( apply_filters( 'woocommerce_payment_complete_order_status', $this-&gt;needs_processing() ? 'processing' : 'completed', $this-&gt;get_id(), $this ) );&nbsp;</div></li><li><div>                $this-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                do_action( 'woocommerce_payment_complete', $this-&gt;get_id() );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                do_action( 'woocommerce_payment_complete_order_status_' . $this-&gt;get_status(), $this-&gt;get_id() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } catch ( Exception $e ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets order total - formatted for display.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $tax_display     Type of tax display.&nbsp;</div></li><li><div>     * @param  bool  $display_refunded If should include refunded value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_formatted_order_total( $tax_display = '', $display_refunded = true ) {&nbsp;</div></li><li><div>        $formatted_total = wc_price( $this-&gt;get_total(), array( 'currency' =&gt; $this-&gt;get_currency() ) );&nbsp;</div></li><li><div>        $order_total = $this-&gt;get_total();&nbsp;</div></li><li><div>        $total_refunded = $this-&gt;get_total_refunded();&nbsp;</div></li><li><div>        $tax_string = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Tax for inclusive prices.&nbsp;</div></li><li><div>        if ( wc_tax_enabled() && 'incl' == $tax_display ) {&nbsp;</div></li><li><div>            $tax_string_array = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'itemized' == get_option( 'woocommerce_tax_total_display' ) ) {&nbsp;</div></li><li><div>                foreach ( $this-&gt;get_tax_totals() as $code =&gt; $tax ) {&nbsp;</div></li><li><div>                    $tax_amount = ( $total_refunded && $display_refunded ) ? wc_price( WC_Tax::round( $tax-&gt;amount - $this-&gt;get_total_tax_refunded_by_rate_id( $tax-&gt;rate_id ) ), array( 'currency' =&gt; $this-&gt;get_currency() ) ) : $tax-&gt;formatted_amount;&nbsp;</div></li><li><div>                    $tax_string_array[] = sprintf( '%s %s', $tax_amount, $tax-&gt;label );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tax_amount = ( $total_refunded && $display_refunded ) ? $this-&gt;get_total_tax() - $this-&gt;get_total_tax_refunded() : $this-&gt;get_total_tax();&nbsp;</div></li><li><div>                $tax_string_array[] = sprintf( '%s %s', wc_price( $tax_amount, array( 'currency' =&gt; $this-&gt;get_currency() ) ), WC()-&gt;countries-&gt;tax_or_vat() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ! empty( $tax_string_array ) ) {&nbsp;</div></li><li><div>                $tax_string = ' &lt;small class=&quot;includes_tax&quot;&gt;' . sprintf( __( '(includes %s)', 'woocommerce' ), implode( ', ', $tax_string_array ) ) . '&lt;/small&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $total_refunded && $display_refunded ) {&nbsp;</div></li><li><div>            $formatted_total = '&lt;del&gt;' . strip_tags( $formatted_total ) . '&lt;/del&gt; &lt;ins&gt;' . wc_price( $order_total - $total_refunded, array( 'currency' =&gt; $this-&gt;get_currency() ) ) . $tax_string . '&lt;/ins&gt;';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $formatted_total .= $tax_string;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter WooCommerce formatted order total.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string   $formatted_total  Total to display.&nbsp;</div></li><li><div>         * @param WC_Order $order            Order data.&nbsp;</div></li><li><div>         * @param string   $tax_display      Type of tax display.&nbsp;</div></li><li><div>         * @param bool     $display_refunded If should include refunded value.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_formatted_order_total', $formatted_total, $this, $tax_display, $display_refunded );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | CRUD methods&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    | Methods which create, read, update and delete orders from the database.&nbsp;</div></li><li><div>    | Written in abstract fashion so that the way orders are stored can be&nbsp;</div></li><li><div>    | changed more easily in the future.&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    | A save method is included for convenience (chooses update or create based&nbsp;</div></li><li><div>    | on if the order exists yet).&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save data to the database.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @return int order ID&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save() {&nbsp;</div></li><li><div>        $this-&gt;maybe_set_user_billing_email();&nbsp;</div></li><li><div>        if ( $this-&gt;data_store ) {&nbsp;</div></li><li><div>            // Trigger action before saving to the DB. Allows you to adjust object props before save.&nbsp;</div></li><li><div>            do_action( 'woocommerce_before_' . $this-&gt;object_type . '_object_save', $this, $this-&gt;data_store );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $this-&gt;get_id() ) {&nbsp;</div></li><li><div>                $this-&gt;data_store-&gt;update( $this );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;data_store-&gt;create( $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;save_items();&nbsp;</div></li><li><div>        $this-&gt;status_transition();&nbsp;</div></li><li><div>        return $this-&gt;get_id();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set order status.&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @param string $new_status Status to change the order to. No internal wc- prefix is required.&nbsp;</div></li><li><div>     * @param string $note (default: '') Optional note to add.&nbsp;</div></li><li><div>     * @param bool $manual_update is this a manual order status change?&nbsp;</div></li><li><div>     * @param array details of change&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_status( $new_status, $note = '', $manual_update = false ) {&nbsp;</div></li><li><div>        $result = parent::set_status( $new_status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $this-&gt;object_read && ! empty( $result['from'] ) && $result['from'] !== $result['to'] ) {&nbsp;</div></li><li><div>            $this-&gt;status_transition = array(&nbsp;</div></li><li><div>                'from' =&gt; ! empty( $this-&gt;status_transition['from'] ) ? $this-&gt;status_transition['from'] : $result['from'], &nbsp;</div></li><li><div>                'to' =&gt; $result['to'], &nbsp;</div></li><li><div>                'note' =&gt; $note, &nbsp;</div></li><li><div>                'manual' =&gt; (bool) $manual_update, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;maybe_set_date_paid();&nbsp;</div></li><li><div>            $this-&gt;maybe_set_date_completed();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Maybe set date paid.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Sets the date paid variable when transitioning to the payment complete&nbsp;</div></li><li><div>     * order status. This is either processing or completed. This is not filtered&nbsp;</div></li><li><div>     * to avoid infinite loops e.g. if loading an order via the filter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Date paid is set once in this manner - only when it is not already set.&nbsp;</div></li><li><div>     * This ensures the data exists even if a gateway does not use the&nbsp;</div></li><li><div>     * `payment_complete` method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function maybe_set_date_paid() {&nbsp;</div></li><li><div>        if ( ! $this-&gt;get_date_paid( 'edit' ) && $this-&gt;has_status( apply_filters( 'woocommerce_payment_complete_order_status', $this-&gt;needs_processing() ? 'processing' : 'completed', $this-&gt;get_id() ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;set_date_paid( current_time( 'timestamp' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Maybe set date completed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Sets the date completed variable when transitioning to completed status.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function maybe_set_date_completed() {&nbsp;</div></li><li><div>        if ( $this-&gt;has_status( 'completed' ) ) {&nbsp;</div></li><li><div>            $this-&gt;set_date_completed( current_time( 'timestamp', true ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates status of order immediately. Order must exist.&nbsp;</div></li><li><div>     * @uses WC_Order::set_status()&nbsp;</div></li><li><div>     * @return bool success&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function update_status( $new_status, $note = '', $manual = false ) {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            if ( ! $this-&gt;get_id() ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;set_status( $new_status, $note, $manual );&nbsp;</div></li><li><div>            $this-&gt;save();&nbsp;</div></li><li><div>        } catch ( Exception $e ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle the status transition.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function status_transition() {&nbsp;</div></li><li><div>        if ( $this-&gt;status_transition ) {&nbsp;</div></li><li><div>            do_action( 'woocommerce_order_status_' . $this-&gt;status_transition['to'], $this-&gt;get_id(), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;status_transition['from'] ) ) {&nbsp;</div></li><li><div>                /** translators: 1: old order status 2: new order status */&nbsp;</div></li><li><div>                $transition_note = sprintf( __( 'Order status changed from %1$s to %2$s.', 'woocommerce' ), wc_get_order_status_name( $this-&gt;status_transition['from'] ), wc_get_order_status_name( $this-&gt;status_transition['to'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                do_action( 'woocommerce_order_status_' . $this-&gt;status_transition['from'] . '_to_' . $this-&gt;status_transition['to'], $this-&gt;get_id(), $this );&nbsp;</div></li><li><div>                do_action( 'woocommerce_order_status_changed', $this-&gt;get_id(), $this-&gt;status_transition['from'], $this-&gt;status_transition['to'], $this );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                /** translators: %s: new order status */&nbsp;</div></li><li><div>                $transition_note = sprintf( __( 'Order status set to %s.', 'woocommerce' ), wc_get_order_status_name( $this-&gt;status_transition['to'] ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Note the transition occurred&nbsp;</div></li><li><div>            $this-&gt;add_order_note( trim( $this-&gt;status_transition['note'] . ' ' . $transition_note ), 0, $this-&gt;status_transition['manual'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // This has ran, so reset status transition variable&nbsp;</div></li><li><div>            $this-&gt;status_transition = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | Getters&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    | Methods for getting data from the order object.&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get all class data in array format.&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_data() {&nbsp;</div></li><li><div>        return array_merge(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'id' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            $this-&gt;data, &nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'number' =&gt; $this-&gt;get_order_number(), &nbsp;</div></li><li><div>                'meta_data' =&gt; $this-&gt;get_meta_data(), &nbsp;</div></li><li><div>                'line_items' =&gt; $this-&gt;get_items( 'line_item' ), &nbsp;</div></li><li><div>                'tax_lines' =&gt; $this-&gt;get_items( 'tax' ), &nbsp;</div></li><li><div>                'shipping_lines' =&gt; $this-&gt;get_items( 'shipping' ), &nbsp;</div></li><li><div>                'fee_lines' =&gt; $this-&gt;get_items( 'fee' ), &nbsp;</div></li><li><div>                'coupon_lines' =&gt; $this-&gt;get_items( 'coupon' ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Expands the shipping and billing information in the changes array.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_changes() {&nbsp;</div></li><li><div>        $changed_props = parent::get_changes();&nbsp;</div></li><li><div>        $subs = array( 'shipping', 'billing' );&nbsp;</div></li><li><div>        foreach ( $subs as $sub ) {&nbsp;</div></li><li><div>            if ( ! empty( $changed_props[ $sub ] ) ) {&nbsp;</div></li><li><div>                foreach ( $changed_props[ $sub ] as $sub_prop =&gt; $value ) {&nbsp;</div></li><li><div>                    $changed_props[ $sub . '_' . $sub_prop ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $changed_props['customer_note'] ) ) {&nbsp;</div></li><li><div>            $changed_props['post_excerpt'] = $changed_props['customer_note'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $changed_props;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * get_order_number function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Gets the order number for display (by default, order ID).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_order_number() {&nbsp;</div></li><li><div>        return (string) apply_filters( 'woocommerce_order_number', $this-&gt;get_id(), $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get order key.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  3.0.0&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_order_key( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'order_key', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get customer_id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_customer_id( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'customer_id', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Alias for get_customer_id().&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_user_id( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_customer_id( $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the user associated with the order. False for guests.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_User|false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_user() {&nbsp;</div></li><li><div>        return $this-&gt;get_user_id() ? get_user_by( 'id', $this-&gt;get_user_id() ) : false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets a prop for a getter method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  3.0.0&nbsp;</div></li><li><div>     * @param  string $prop Name of prop to get.&nbsp;</div></li><li><div>     * @param  string $address billing or shipping.&nbsp;</div></li><li><div>     * @param  string $context What the value is for. Valid values are view and edit.&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function get_address_prop( $prop, $address = 'billing', $context = 'view' ) {&nbsp;</div></li><li><div>        $value = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( array_key_exists( $prop, $this-&gt;data[ $address ] ) ) {&nbsp;</div></li><li><div>            $value = isset( $this-&gt;changes[ $address ][ $prop ] ) ? $this-&gt;changes[ $address ][ $prop ] : $this-&gt;data[ $address ][ $prop ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'view' === $context ) {&nbsp;</div></li><li><div>                $value = apply_filters( $this-&gt;get_hook_prefix() . $address . '_' . $prop, $value, $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_first_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_first_name( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'first_name', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_last_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_last_name( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'last_name', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_company.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_company( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'company', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_address_1.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_address_1( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'address_1', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_address_2.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string $value&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_address_2( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'address_2', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_city.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string $value&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_city( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'city', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_state.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_state( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'state', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_postcode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_postcode( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'postcode', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_country.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_country( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'country', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_email.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_email( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'email', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get billing_phone.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_billing_phone( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'phone', 'billing', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_first_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_first_name( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'first_name', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_last_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_last_name( $context = 'view' ) {&nbsp;</div></li><li><div>         return $this-&gt;get_address_prop( 'last_name', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_company.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_company( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'company', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_address_1.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_address_1( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'address_1', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_address_2.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_address_2( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'address_2', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_city.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_city( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'city', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_state.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_state( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'state', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_postcode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_postcode( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'postcode', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get shipping_country.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_country( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_address_prop( 'country', 'shipping', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the payment method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_payment_method( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'payment_method', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get payment_method_title.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_payment_method_title( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'payment_method_title', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get transaction_id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_transaction_id( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'transaction_id', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get customer_ip_address.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_customer_ip_address( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'customer_ip_address', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get customer_user_agent.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_customer_user_agent( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'customer_user_agent', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get created_via.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_created_via( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'created_via', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get customer_note.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_customer_note( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'customer_note', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get date_completed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return WC_DateTime|NULL object if the date is set or null if there is no date.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_date_completed( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'date_completed', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get date_paid.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return WC_DateTime|NULL object if the date is set or null if there is no date.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_date_paid( $context = 'view' ) {&nbsp;</div></li><li><div>        $date_paid = $this-&gt;get_prop( 'date_paid', $context );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'view' === $context && ! $date_paid && version_compare( $this-&gt;get_version( 'edit' ), '3.0', '&lt;' ) && $this-&gt;has_status( apply_filters( 'woocommerce_payment_complete_order_status', $this-&gt;needs_processing() ? 'processing' : 'completed', $this-&gt;get_id() ) ) ) {&nbsp;</div></li><li><div>            // In view context, return a date if missing.&nbsp;</div></li><li><div>            $date_paid = $this-&gt;get_date_created( 'edit' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $date_paid;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get cart hash.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_cart_hash( $context = 'view' ) {&nbsp;</div></li><li><div>        return $this-&gt;get_prop( 'cart_hash', $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the requested address in raw, non-formatted way.&nbsp;</div></li><li><div>     * Note: Merges raw data with get_prop data so changes are returned too.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  2.4.0&nbsp;</div></li><li><div>     * @param  string $type Billing or shipping. Anything else besides 'billing' will return shipping address.&nbsp;</div></li><li><div>     * @return array The stored address after filter.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_address( $type = 'billing' ) {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_order_address', array_merge( $this-&gt;data[ $type ], $this-&gt;get_prop( $type, 'view' ) ), $type, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a formatted shipping address for the order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_shipping_address_map_url() {&nbsp;</div></li><li><div>        $address = apply_filters( 'woocommerce_shipping_address_map_url_parts', $this-&gt;get_address( 'shipping' ), $this );&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_shipping_address_map_url', 'https://maps.google.com/maps?&q=' . urlencode( implode( ', ', $address ) ) . '&z=16', $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a formatted billing full name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_formatted_billing_full_name() {&nbsp;</div></li><li><div>        /** translators: 1: first name 2: last name */&nbsp;</div></li><li><div>        return sprintf( _x( '%1$s %2$s', 'full name', 'woocommerce' ), $this-&gt;get_billing_first_name(), $this-&gt;get_billing_last_name() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a formatted shipping full name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_formatted_shipping_full_name() {&nbsp;</div></li><li><div>        /** translators: 1: first name 2: last name */&nbsp;</div></li><li><div>        return sprintf( _x( '%1$s %2$s', 'full name', 'woocommerce' ), $this-&gt;get_shipping_first_name(), $this-&gt;get_shipping_last_name() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a formatted billing address for the order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_formatted_billing_address() {&nbsp;</div></li><li><div>        return WC()-&gt;countries-&gt;get_formatted_address( apply_filters( 'woocommerce_order_formatted_billing_address', $this-&gt;get_address( 'billing' ), $this ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a formatted shipping address for the order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_formatted_shipping_address() {&nbsp;</div></li><li><div>        if ( $this-&gt;get_shipping_address_1() || $this-&gt;get_shipping_address_2() ) {&nbsp;</div></li><li><div>            return WC()-&gt;countries-&gt;get_formatted_address( apply_filters( 'woocommerce_order_formatted_shipping_address', $this-&gt;get_address( 'shipping' ), $this ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | Setters&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    | Functions for setting order data. These should not update anything in the&nbsp;</div></li><li><div>    | database itself and should only change what is stored in the class&nbsp;</div></li><li><div>    | object. However, for backwards compatibility pre 3.0.0 some of these&nbsp;</div></li><li><div>    | setters may handle both.&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets a prop for a setter method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @param string $prop Name of prop to set.&nbsp;</div></li><li><div>     * @param string $address Name of address to set. billing or shipping.&nbsp;</div></li><li><div>     * @param mixed  $value Value of the prop.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function set_address_prop( $prop, $address = 'billing', $value ) {&nbsp;</div></li><li><div>        if ( array_key_exists( $prop, $this-&gt;data[ $address ] ) ) {&nbsp;</div></li><li><div>            if ( true === $this-&gt;object_read ) {&nbsp;</div></li><li><div>                if ( $value !== $this-&gt;data[ $address ][ $prop ] || ( isset( $this-&gt;changes[ $address ] ) && array_key_exists( $prop, $this-&gt;changes[ $address ] ) ) ) {&nbsp;</div></li><li><div>                    $this-&gt;changes[ $address ][ $prop ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;data[ $address ][ $prop ] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set order_key.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Max length 22 chars.&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_order_key( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'order_key', substr( $value, 0, 22 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set customer_id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_customer_id( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'customer_id', absint( $value ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_first_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_first_name( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'first_name', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_last_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_last_name( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'last_name', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_company.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_company( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'company', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_address_1.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_address_1( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'address_1', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_address_2.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_address_2( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'address_2', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_city.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_city( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'city', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_state.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_state( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'state', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_postcode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_postcode( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'postcode', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_country.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_country( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'country', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Maybe set empty billing email to that of the user who owns the order.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function maybe_set_user_billing_email() {&nbsp;</div></li><li><div>        if ( ! $this-&gt;get_billing_email() && ( $user = $this-&gt;get_user() ) ) {&nbsp;</div></li><li><div>            try {&nbsp;</div></li><li><div>                $this-&gt;set_billing_email( $user-&gt;user_email );&nbsp;</div></li><li><div>            } catch( WC_Data_Exception $e ) {&nbsp;</div></li><li><div>                unset( $e );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_email.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_email( $value ) {&nbsp;</div></li><li><div>        if ( $value && ! is_email( $value ) ) {&nbsp;</div></li><li><div>            $this-&gt;error( 'order_invalid_billing_email', __( 'Invalid billing email address', 'woocommerce' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'email', 'billing', sanitize_email( $value ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set billing_phone.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_billing_phone( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'phone', 'billing', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_first_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_first_name( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'first_name', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_last_name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_last_name( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'last_name', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_company.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_company( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'company', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_address_1.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_address_1( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'address_1', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_address_2.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_address_2( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'address_2', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_city.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_city( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'city', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_state.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_state( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'state', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_postcode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_postcode( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'postcode', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set shipping_country.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_shipping_country( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_address_prop( 'country', 'shipping', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the payment method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $payment_method Supports WC_Payment_Gateway for bw compatibility with &lt; 3.0&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_payment_method( $payment_method = '' ) {&nbsp;</div></li><li><div>        if ( is_object( $payment_method ) ) {&nbsp;</div></li><li><div>            $this-&gt;set_payment_method( $payment_method-&gt;id );&nbsp;</div></li><li><div>            $this-&gt;set_payment_method_title( $payment_method-&gt;get_title() );&nbsp;</div></li><li><div>        } elseif ( '' === $payment_method ) {&nbsp;</div></li><li><div>            $this-&gt;set_prop( 'payment_method', '' );&nbsp;</div></li><li><div>            $this-&gt;set_prop( 'payment_method_title', '' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;set_prop( 'payment_method', $payment_method );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set payment_method_title.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_payment_method_title( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'payment_method_title', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set transaction_id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_transaction_id( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'transaction_id', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set customer_ip_address.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_customer_ip_address( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'customer_ip_address', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set customer_user_agent.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_customer_user_agent( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'customer_user_agent', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set created_via.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_created_via( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'created_via', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set customer_note.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_customer_note( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'customer_note', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set date_completed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string|integer|null $date UTC timestamp, or ISO 8601 DateTime. If the DateTime string has no timezone or offset, WordPress site timezone will be assumed. Null if their is no date.&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_date_completed( $date = null ) {&nbsp;</div></li><li><div>        $this-&gt;set_date_prop( 'date_completed', $date );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set date_paid.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string|integer|null $date UTC timestamp, or ISO 8601 DateTime. If the DateTime string has no timezone or offset, WordPress site timezone will be assumed. Null if their is no date.&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_date_paid( $date = null ) {&nbsp;</div></li><li><div>        $this-&gt;set_date_prop( 'date_paid', $date );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set cart hash.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @throws WC_Data_Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_cart_hash( $value ) {&nbsp;</div></li><li><div>        $this-&gt;set_prop( 'cart_hash', $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | Conditionals&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    | Checks if a condition is true or false.&nbsp;</div></li><li><div>    |&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if an order key is valid.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $key&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function key_is_valid( $key ) {&nbsp;</div></li><li><div>        return $key === $this-&gt;get_order_key();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * See if order matches cart_hash.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function has_cart_hash( $cart_hash = '' ) {&nbsp;</div></li><li><div>        return hash_equals( $this-&gt;get_cart_hash(), $cart_hash );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if an order can be edited, specifically for use on the Edit Order screen.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_editable() {&nbsp;</div></li><li><div>        return apply_filters( 'wc_order_is_editable', in_array( $this-&gt;get_status(), array( 'pending', 'on-hold', 'auto-draft' ) ), $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns if an order has been paid for based on the order status.&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_paid() {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_order_is_paid', $this-&gt;has_status( wc_get_is_paid_statuses() ), $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if product download is permitted.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_download_permitted() {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_order_is_download_permitted', $this-&gt;has_status( 'completed' ) || ( 'yes' === get_option( 'woocommerce_downloads_grant_access_after_payment' ) && $this-&gt;has_status( 'processing' ) ), $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if an order needs display the shipping address, based on shipping method.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function needs_shipping_address() {&nbsp;</div></li><li><div>        if ( 'no' === get_option( 'woocommerce_calc_shipping' ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $hide = apply_filters( 'woocommerce_order_hide_shipping_address', array( 'local_pickup' ), $this );&nbsp;</div></li><li><div>        $needs_address = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_shipping_methods() as $shipping_method ) {&nbsp;</div></li><li><div>            // Remove any instance IDs after :&nbsp;</div></li><li><div>            $shipping_method_id = current( explode( ':', $shipping_method['method_id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! in_array( $shipping_method_id, $hide ) ) {&nbsp;</div></li><li><div>                $needs_address = true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_order_needs_shipping_address', $needs_address, $hide, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns true if the order contains a downloadable product.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function has_downloadable_item() {&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_items() as $item ) {&nbsp;</div></li><li><div>            if ( $item-&gt;is_type( 'line_item' ) && ( $product = $item-&gt;get_product() ) && $product-&gt;is_downloadable() && $product-&gt;has_file() ) {&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if an order needs payment, based on status and order total.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function needs_payment() {&nbsp;</div></li><li><div>        $valid_order_statuses = apply_filters( 'woocommerce_valid_order_statuses_for_payment', array( 'pending', 'failed' ), $this );&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_order_needs_payment', ( $this-&gt;has_status( $valid_order_statuses ) && $this-&gt;get_total() &gt; 0 ), $this, $valid_order_statuses );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * See if the order needs processing before it can be completed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Orders which only contain virtual, downloadable items do not need admin&nbsp;</div></li><li><div>     * intervention.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function needs_processing() {&nbsp;</div></li><li><div>        $needs_processing = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( sizeof( $this-&gt;get_items() ) &gt; 0 ) {&nbsp;</div></li><li><div>            foreach ( $this-&gt;get_items() as $item ) {&nbsp;</div></li><li><div>                if ( $item-&gt;is_type( 'line_item' ) && ( $product = $item-&gt;get_product() ) ) {&nbsp;</div></li><li><div>                    $virtual_downloadable_item = $product-&gt;is_downloadable() && $product-&gt;is_virtual();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( apply_filters( 'woocommerce_order_item_needs_processing', ! $virtual_downloadable_item, $product, $this-&gt;get_id() ) ) {&nbsp;</div></li><li><div>                        $needs_processing = true;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $needs_processing;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | URLs and Endpoints&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generates a URL so that a customer can pay for their (unpaid - pending) order. Pass 'true' for the checkout version which doesn't offer gateway choices.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  bool $on_checkout&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_checkout_payment_url( $on_checkout = false ) {&nbsp;</div></li><li><div>        $pay_url = wc_get_endpoint_url( 'order-pay', $this-&gt;get_id(), wc_get_page_permalink( 'checkout' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'yes' == get_option( 'woocommerce_force_ssl_checkout' ) || is_ssl() ) {&nbsp;</div></li><li><div>            $pay_url = str_replace( 'http:', 'https:', $pay_url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $on_checkout ) {&nbsp;</div></li><li><div>            $pay_url = add_query_arg( 'key', $this-&gt;get_order_key(), $pay_url );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $pay_url = add_query_arg( array( 'pay_for_order' =&gt; 'true', 'key' =&gt; $this-&gt;get_order_key() ), $pay_url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_checkout_payment_url', $pay_url, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generates a URL for the thanks page (order received).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_checkout_order_received_url() {&nbsp;</div></li><li><div>        $order_received_url = wc_get_endpoint_url( 'order-received', $this-&gt;get_id(), wc_get_page_permalink( 'checkout' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'yes' === get_option( 'woocommerce_force_ssl_checkout' ) || is_ssl() ) {&nbsp;</div></li><li><div>            $order_received_url = str_replace( 'http:', 'https:', $order_received_url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order_received_url = add_query_arg( 'key', $this-&gt;get_order_key(), $order_received_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_checkout_order_received_url', $order_received_url, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generates a URL so that a customer can cancel their (unpaid - pending) order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $redirect&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_cancel_order_url( $redirect = '' ) {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_cancel_order_url', wp_nonce_url( add_query_arg( array(&nbsp;</div></li><li><div>            'cancel_order' =&gt; 'true', &nbsp;</div></li><li><div>            'order' =&gt; $this-&gt;get_order_key(), &nbsp;</div></li><li><div>            'order_id' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div>            'redirect' =&gt; $redirect, &nbsp;</div></li><li><div> ), $this-&gt;get_cancel_endpoint() ), 'woocommerce-cancel_order' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generates a raw (unescaped) cancel-order URL for use by payment gateways.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $redirect&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string The unescaped cancel-order URL.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_cancel_order_url_raw( $redirect = '' ) {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_cancel_order_url_raw', add_query_arg( array(&nbsp;</div></li><li><div>            'cancel_order' =&gt; 'true', &nbsp;</div></li><li><div>            'order' =&gt; $this-&gt;get_order_key(), &nbsp;</div></li><li><div>            'order_id' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div>            'redirect' =&gt; $redirect, &nbsp;</div></li><li><div>            '_wpnonce' =&gt; wp_create_nonce( 'woocommerce-cancel_order' ), &nbsp;</div></li><li><div> ), $this-&gt;get_cancel_endpoint() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helper method to return the cancel endpoint.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string the cancel endpoint; either the cart page or the home page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_cancel_endpoint() {&nbsp;</div></li><li><div>        $cancel_endpoint = wc_get_page_permalink( 'cart' );&nbsp;</div></li><li><div>        if ( ! $cancel_endpoint ) {&nbsp;</div></li><li><div>            $cancel_endpoint = home_url();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === strpos( $cancel_endpoint, '?' ) ) {&nbsp;</div></li><li><div>            $cancel_endpoint = trailingslashit( $cancel_endpoint );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $cancel_endpoint;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generates a URL to view an order from the my account page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_view_order_url() {&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_view_order_url', wc_get_endpoint_url( 'view-order', $this-&gt;get_id(), wc_get_page_permalink( 'myaccount' ) ), $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | Order notes.&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a note (comment) to the order. Order must exist.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $note Note to add.&nbsp;</div></li><li><div>     * @param int $is_customer_note (default: 0) Is this a note for the customer?&nbsp;</div></li><li><div>     * @param  bool added_by_user Was the note added by a user?&nbsp;</div></li><li><div>     * @return int Comment ID.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_order_note( $note, $is_customer_note = 0, $added_by_user = false ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;get_id() ) {&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_user_logged_in() && current_user_can( 'edit_shop_order', $this-&gt;get_id() ) && $added_by_user ) {&nbsp;</div></li><li><div>            $user = get_user_by( 'id', get_current_user_id() );&nbsp;</div></li><li><div>            $comment_author = $user-&gt;display_name;&nbsp;</div></li><li><div>            $comment_author_email = $user-&gt;user_email;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $comment_author = __( 'WooCommerce', 'woocommerce' );&nbsp;</div></li><li><div>            $comment_author_email = strtolower( __( 'WooCommerce', 'woocommerce' ) ) . '@';&nbsp;</div></li><li><div>            $comment_author_email .= isset( $_SERVER['HTTP_HOST'] ) ? str_replace( 'www.', '', $_SERVER['HTTP_HOST'] ) : 'noreply.com';&nbsp;</div></li><li><div>            $comment_author_email = sanitize_email( $comment_author_email );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $commentdata = apply_filters( 'woocommerce_new_order_note_data', array(&nbsp;</div></li><li><div>            'comment_post_ID' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div>            'comment_author' =&gt; $comment_author, &nbsp;</div></li><li><div>            'comment_author_email' =&gt; $comment_author_email, &nbsp;</div></li><li><div>            'comment_author_url' =&gt; '', &nbsp;</div></li><li><div>            'comment_content' =&gt; $note, &nbsp;</div></li><li><div>            'comment_agent' =&gt; 'WooCommerce', &nbsp;</div></li><li><div>            'comment_type' =&gt; 'order_note', &nbsp;</div></li><li><div>            'comment_parent' =&gt; 0, &nbsp;</div></li><li><div>            'comment_approved' =&gt; 1, &nbsp;</div></li><li><div> ), array( 'order_id' =&gt; $this-&gt;get_id(), 'is_customer_note' =&gt; $is_customer_note ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comment_id = wp_insert_comment( $commentdata );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $is_customer_note ) {&nbsp;</div></li><li><div>            add_comment_meta( $comment_id, 'is_customer_note', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            do_action( 'woocommerce_new_customer_note', array( 'order_id' =&gt; $this-&gt;get_id(), 'customer_note' =&gt; $commentdata['comment_content'] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $comment_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * List order notes (public) for the customer.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_customer_order_notes() {&nbsp;</div></li><li><div>        $notes = array();&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            'post_id' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div>            'approve' =&gt; 'approve', &nbsp;</div></li><li><div>            'type' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        remove_filter( 'comments_clauses', array( 'WC_Comments', 'exclude_order_comments' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comments = get_comments( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $comments as $comment ) {&nbsp;</div></li><li><div>            if ( ! get_comment_meta( $comment-&gt;comment_ID, 'is_customer_note', true ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $comment-&gt;comment_content = make_clickable( $comment-&gt;comment_content );&nbsp;</div></li><li><div>            $notes[] = $comment;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'comments_clauses', array( 'WC_Comments', 'exclude_order_comments' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $notes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    | Refunds&nbsp;</div></li><li><div>    |--------------------------------------------------------------------------&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get order refunds.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2&nbsp;</div></li><li><div>     * @return array of WC_Order_Refund objects&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_refunds() {&nbsp;</div></li><li><div>        $cache_key = WC_Cache_Helper::get_cache_prefix( 'orders' ) . 'refunds' . $this-&gt;get_id();&nbsp;</div></li><li><div>        $cached_data = wp_cache_get( $cache_key, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $cached_data ) {&nbsp;</div></li><li><div>            return $cached_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;refunds = wc_get_orders( array(&nbsp;</div></li><li><div>            'type' =&gt; 'shop_order_refund', &nbsp;</div></li><li><div>            'parent' =&gt; $this-&gt;get_id(), &nbsp;</div></li><li><div>            'limit' =&gt; -1, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_cache_set( $cache_key, $this-&gt;refunds, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;refunds;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get amount already refunded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_refunded() {&nbsp;</div></li><li><div>        $cache_key = WC_Cache_Helper::get_cache_prefix( 'orders' ) . 'total_refunded' . $this-&gt;get_id();&nbsp;</div></li><li><div>        $cached_data = wp_cache_get( $cache_key, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $cached_data ) {&nbsp;</div></li><li><div>            return $cached_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $total_refunded = $this-&gt;data_store-&gt;get_total_refunded( $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_cache_set( $cache_key, $total_refunded, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $total_refunded;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the total tax refunded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  2.3&nbsp;</div></li><li><div>     * @return float&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_tax_refunded() {&nbsp;</div></li><li><div>        $cache_key = WC_Cache_Helper::get_cache_prefix( 'orders' ) . 'total_tax_refunded' . $this-&gt;get_id();&nbsp;</div></li><li><div>        $cached_data = wp_cache_get( $cache_key, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $cached_data ) {&nbsp;</div></li><li><div>            return $cached_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $total_refunded = $this-&gt;data_store-&gt;get_total_tax_refunded( $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_cache_set( $cache_key, $total_refunded, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $total_refunded;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the total shipping refunded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  2.4&nbsp;</div></li><li><div>     * @return float&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_shipping_refunded() {&nbsp;</div></li><li><div>        $cache_key = WC_Cache_Helper::get_cache_prefix( 'orders' ) . 'total_shipping_refunded' . $this-&gt;get_id();&nbsp;</div></li><li><div>        $cached_data = wp_cache_get( $cache_key, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $cached_data ) {&nbsp;</div></li><li><div>            return $cached_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $total_refunded = $this-&gt;data_store-&gt;get_total_shipping_refunded( $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_cache_set( $cache_key, $total_refunded, $this-&gt;cache_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $total_refunded;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the count of order items of a certain type that have been refunded.&nbsp;</div></li><li><div>     * @since  2.4.0&nbsp;</div></li><li><div>     * @param string $item_type&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_item_count_refunded( $item_type = '' ) {&nbsp;</div></li><li><div>        if ( empty( $item_type ) ) {&nbsp;</div></li><li><div>            $item_type = array( 'line_item' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! is_array( $item_type ) ) {&nbsp;</div></li><li><div>            $item_type = array( $item_type );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( $item_type ) as $refunded_item ) {&nbsp;</div></li><li><div>                $count += abs( $refunded_item-&gt;get_quantity() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_item_count_refunded', $count, $item_type, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the total number of items refunded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  2.4.0&nbsp;</div></li><li><div>     * @param  string $item_type type of the item we're checking, if not a line_item&nbsp;</div></li><li><div>     * @return integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_qty_refunded( $item_type = 'line_item' ) {&nbsp;</div></li><li><div>        $qty = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( $item_type ) as $refunded_item ) {&nbsp;</div></li><li><div>                $qty += $refunded_item-&gt;get_quantity();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $qty;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the refunded amount for a line item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  int $item_id ID of the item we're checking&nbsp;</div></li><li><div>     * @param  string $item_type type of the item we're checking, if not a line_item&nbsp;</div></li><li><div>     * @return integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_qty_refunded_for_item( $item_id, $item_type = 'line_item' ) {&nbsp;</div></li><li><div>        $qty = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( $item_type ) as $refunded_item ) {&nbsp;</div></li><li><div>                if ( absint( $refunded_item-&gt;get_meta( '_refunded_item_id' ) ) === $item_id ) {&nbsp;</div></li><li><div>                    $qty += $refunded_item-&gt;get_quantity();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $qty;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the refunded amount for a line item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  int $item_id ID of the item we're checking&nbsp;</div></li><li><div>     * @param  string $item_type type of the item we're checking, if not a line_item&nbsp;</div></li><li><div>     * @return integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_refunded_for_item( $item_id, $item_type = 'line_item' ) {&nbsp;</div></li><li><div>        $total = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( $item_type ) as $refunded_item ) {&nbsp;</div></li><li><div>                if ( absint( $refunded_item-&gt;get_meta( '_refunded_item_id' ) ) === $item_id ) {&nbsp;</div></li><li><div>                    $total += $refunded_item-&gt;get_total();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $total * -1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the refunded tax amount for a line item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  int $item_id ID of the item we're checking&nbsp;</div></li><li><div>     * @param  int $tax_id ID of the tax we're checking&nbsp;</div></li><li><div>     * @param  string $item_type type of the item we're checking, if not a line_item&nbsp;</div></li><li><div>     * @return double&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_tax_refunded_for_item( $item_id, $tax_id, $item_type = 'line_item' ) {&nbsp;</div></li><li><div>        $total = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( $item_type ) as $refunded_item ) {&nbsp;</div></li><li><div>                $refunded_item_id = (int) $refunded_item-&gt;get_meta( '_refunded_item_id' );&nbsp;</div></li><li><div>                if ( $refunded_item_id === $item_id ) {&nbsp;</div></li><li><div>                    $taxes = $refunded_item-&gt;get_taxes();&nbsp;</div></li><li><div>                    $total += isset( $taxes['total'][ $tax_id ] ) ? $taxes['total'][ $tax_id ] : 0;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return wc_round_tax_total( $total ) * -1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get total tax refunded by rate ID.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  int $rate_id&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return float&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_total_tax_refunded_by_rate_id( $rate_id ) {&nbsp;</div></li><li><div>        $total = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_refunds() as $refund ) {&nbsp;</div></li><li><div>            foreach ( $refund-&gt;get_items( 'tax' ) as $refunded_item ) {&nbsp;</div></li><li><div>                if ( absint( $refunded_item-&gt;get_rate_id() ) === $rate_id ) {&nbsp;</div></li><li><div>                    $total += abs( $refunded_item-&gt;get_tax_total() ) + abs( $refunded_item-&gt;get_shipping_tax_total() );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $total;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * How much money is left to refund?&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_remaining_refund_amount() {&nbsp;</div></li><li><div>        return wc_format_decimal( $this-&gt;get_total() - $this-&gt;get_total_refunded(), wc_get_price_decimals() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * How many items are left to refund?&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_remaining_refund_items() {&nbsp;</div></li><li><div>        return absint( $this-&gt;get_item_count() - $this-&gt;get_item_count_refunded() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add total row for the payment method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $total_rows&nbsp;</div></li><li><div>     * @param string $tax_display&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function add_order_item_totals_payment_method_row( &$total_rows, $tax_display ) {&nbsp;</div></li><li><div>        if ( $this-&gt;get_total() &gt; 0 && $this-&gt;get_payment_method_title() ) {&nbsp;</div></li><li><div>            $total_rows['payment_method'] = array(&nbsp;</div></li><li><div>                'label' =&gt; __( 'Payment method:', 'woocommerce' ), &nbsp;</div></li><li><div>                'value' =&gt; $this-&gt;get_payment_method_title(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add total row for refunds.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $total_rows&nbsp;</div></li><li><div>     * @param string $tax_display&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function add_order_item_totals_refund_rows( &$total_rows, $tax_display ) {&nbsp;</div></li><li><div>        if ( $refunds = $this-&gt;get_refunds() ) {&nbsp;</div></li><li><div>            foreach ( $refunds as $id =&gt; $refund ) {&nbsp;</div></li><li><div>                $total_rows[ 'refund_' . $id ] = array(&nbsp;</div></li><li><div>                    'label' =&gt; $refund-&gt;get_reason() ? $refund-&gt;get_reason() : __( 'Refund', 'woocommerce' ) . ':', &nbsp;</div></li><li><div>                    'value' =&gt; wc_price( '-' . $refund-&gt;get_amount(), array( 'currency' =&gt; $this-&gt;get_currency() ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get totals for display on pages and in emails.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $tax_display&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_order_item_totals( $tax_display = '' ) {&nbsp;</div></li><li><div>        $tax_display = $tax_display ? $tax_display : get_option( 'woocommerce_tax_display_cart' );&nbsp;</div></li><li><div>        $total_rows = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_subtotal_row( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_discount_row( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_shipping_row( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_fee_rows( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_tax_rows( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_payment_method_row( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_refund_rows( $total_rows, $tax_display );&nbsp;</div></li><li><div>        $this-&gt;add_order_item_totals_total_row( $total_rows, $tax_display );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'woocommerce_get_order_item_totals', $total_rows, $this, $tax_display );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.0.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce/3.0.6/classes/wc_order/" class="">3.0.6</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.5/classes/wc_order/" class="">3.0.5</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.4/classes/wc_order/" class="">3.0.4</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.3/classes/wc_order/" class="active">3.0.3</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.2/classes/wc_order/" class="">3.0.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WC_Order</li><li><span></span>WooCommerce</li><li><span></span>3.0.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>