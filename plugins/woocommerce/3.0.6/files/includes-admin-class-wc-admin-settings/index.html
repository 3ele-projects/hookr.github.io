<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.0.6" data-slug="woocommerce" data-type="file" data-id="40356"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-admin-class-wc-admin-settings | file | Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, woocommerce, 3.0.6" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=1e273c9e421e5f34d757e1fdd076323b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-admin-class-wc-admin-settings/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-class-wc-admin-settings%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-class-wc-admin-settings%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-3.0.6-file-includes-admin-class-wc-admin-settings","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-admin-class-wc-admin-settings" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce." href="http://hookr.io/plugins/woocommerce/" class="plugin"><span property="name">woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.0.6." href="http://hookr.io/plugins/woocommerce/3.0.6/" class="H_VERSION"><span property="name">3.0.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/woocommerce/3.0.6/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-admin-class-wc-admin&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="3119"><a href="http://hookr.io/plugins/woocommerce/3.0.6/all/" title="All">All <span class="count badge">3119</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/woocommerce/3.0.6/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="2110"><a href="http://hookr.io/plugins/woocommerce/3.0.6/hooks/" title="Hooks">Hooks <span class="count badge">2110</span></a></li><li class="" data-id="action" data-count="774"><a href="http://hookr.io/plugins/woocommerce/3.0.6/actions/" title="Actions">Actions <span class="count badge">774</span></a></li><li class="" data-id="filter" data-count="1336"><a href="http://hookr.io/plugins/woocommerce/3.0.6/filters/" title="Filters">Filters <span class="count badge">1336</span></a></li><li class="" data-id="class" data-count="365"><a href="http://hookr.io/plugins/woocommerce/3.0.6/classes/" title="Classes">Classes <span class="count badge">365</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/woocommerce/3.0.6/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="626"><a href="http://hookr.io/plugins/woocommerce/3.0.6/functions/" title="Functions">Functions <span class="count badge">626</span></a></li><li class="" data-id="shortcode" data-count="4"><a href="http://hookr.io/plugins/woocommerce/3.0.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">4</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/admin/class-wc-admin-settings.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WooCommerce Admin Settings Class</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author   WooThemes</span>&nbsp;</div></li><li><div><span class="comment"> * @category Admin</span>&nbsp;</div></li><li><div><span class="comment"> * @package  WooCommerce/Admin</span>&nbsp;</div></li><li><div><span class="comment"> * @version  2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'WC_Admin_Settings', false ) ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WC_Admin_Settings Class.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WC_Admin_Settings {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Setting pages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private static $settings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Error messages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private static $errors = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Update messages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private static $messages = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Include the settings page classes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_settings_pages() {&nbsp;</div></li><li><div>      if ( empty( self::$settings ) ) {&nbsp;</div></li><li><div>          $settings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          include_once( dirname( __FILE__ ) . '/settings/class-wc-settings-page.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-general.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-products.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-tax.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-shipping.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-checkout.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-accounts.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-emails.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-integrations.php' );&nbsp;</div></li><li><div>          $settings[] = include( 'settings/class-wc-settings-api.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          self::$settings = apply_filters( 'woocommerce_get_settings_pages', $settings );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return self::$settings;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save the settings.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function save() {&nbsp;</div></li><li><div>      global $current_tab;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $_REQUEST['_wpnonce'] ) || ! wp_verify_nonce( $_REQUEST['_wpnonce'], 'woocommerce-settings' ) ) {&nbsp;</div></li><li><div>          die( __( 'Action failed. Please refresh the page and retry.', 'woocommerce' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Trigger actions</span>&nbsp;</div></li><li><div>      do_action( 'woocommerce_settings_save_' . $current_tab );&nbsp;</div></li><li><div>      do_action( 'woocommerce_update_options_' . $current_tab );&nbsp;</div></li><li><div>      do_action( 'woocommerce_update_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      self::add_message( __( 'Your settings have been saved.', 'woocommerce' ) );&nbsp;</div></li><li><div>      self::check_download_folder_protection();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Clear any unwanted data and flush rules</span>&nbsp;</div></li><li><div>      delete_transient( 'woocommerce_cache_excluded_uris' );&nbsp;</div></li><li><div>      WC()-&gt;query-&gt;init_query_vars();&nbsp;</div></li><li><div>      WC()-&gt;query-&gt;add_endpoints();&nbsp;</div></li><li><div>      wp_schedule_single_event( time(), 'woocommerce_flush_rewrite_rules' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'woocommerce_settings_saved' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a message.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $text</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function add_message( $text ) {&nbsp;</div></li><li><div>      self::$messages[] = $text;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an error.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $text</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function add_error( $text ) {&nbsp;</div></li><li><div>      self::$errors[] = $text;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output messages + errors.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function show_messages() {&nbsp;</div></li><li><div>      if ( sizeof( self::$errors ) &gt; 0 ) {&nbsp;</div></li><li><div>          foreach ( self::$errors as $error ) {&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;message&quot; class=&quot;error inline&quot;&gt;&lt;p&gt;&lt;strong&gt;' . esc_html( $error ) . '&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( sizeof( self::$messages ) &gt; 0 ) {&nbsp;</div></li><li><div>          foreach ( self::$messages as $message ) {&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;message&quot; class=&quot;updated inline&quot;&gt;&lt;p&gt;&lt;strong&gt;' . esc_html( $message ) . '&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Settings page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Handles the display of the main woocommerce settings page in admin.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function output() {&nbsp;</div></li><li><div>      global $current_section, $current_tab;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $suffix = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'woocommerce_settings_start' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_script( 'woocommerce_settings', WC()-&gt;plugin_url() . '/assets/js/admin/settings' . $suffix . '.js', array( 'jquery', 'jquery-ui-datepicker', 'jquery-ui-sortable', 'iris', 'select2' ), WC()-&gt;version, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'woocommerce_settings', 'woocommerce_settings_params', array(&nbsp;</div></li><li><div>          'i18n_nav_warning' =&gt; __( 'The changes you made will be lost if you navigate away from this page.', 'woocommerce' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Include settings pages</span>&nbsp;</div></li><li><div>      self::get_settings_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get current tab/section</span>&nbsp;</div></li><li><div>      $current_tab = empty( $_GET['tab'] ) ? 'general' : sanitize_title( $_GET['tab'] );&nbsp;</div></li><li><div>      $current_section = empty( $_REQUEST['section'] ) ? '' : sanitize_title( $_REQUEST['section'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Save settings if data has been posted</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST ) ) {&nbsp;</div></li><li><div>          self::save();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add any posted messages</span>&nbsp;</div></li><li><div>      if ( ! empty( $_GET['wc_error'] ) ) {&nbsp;</div></li><li><div>          self::add_error( stripslashes( $_GET['wc_error'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $_GET['wc_message'] ) ) {&nbsp;</div></li><li><div>          self::add_message( stripslashes( $_GET['wc_message'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get tabs for the settings page</span>&nbsp;</div></li><li><div>      $tabs = apply_filters( 'woocommerce_settings_tabs_array', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      include( dirname( __FILE__ ) . '/views/html-admin-settings.php' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a setting from the settings API.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $option_name</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_option( $option_name, $default = '' ) {&nbsp;</div></li><li><div>      <span class="comment">// Array value</span>&nbsp;</div></li><li><div>      if ( strstr( $option_name, '[' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          parse_str( $option_name, $option_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Option name is first key</span>&nbsp;</div></li><li><div>          $option_name = current( array_keys( $option_array ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get value</span>&nbsp;</div></li><li><div>          $option_values = get_option( $option_name, '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $key = key( $option_array[ $option_name ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $option_values[ $key ] ) ) {&nbsp;</div></li><li><div>              $option_value = $option_values[ $key ];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $option_value = null;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Single value</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $option_value = get_option( $option_name, null );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $option_value ) ) {&nbsp;</div></li><li><div>          $option_value = array_map( 'stripslashes', $option_value );&nbsp;</div></li><li><div>      } elseif ( ! is_null( $option_value ) ) {&nbsp;</div></li><li><div>          $option_value = stripslashes( $option_value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ( null === $option_value ) ? $default : $option_value;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output admin fields.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Loops though the woocommerce options array and outputs each field.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $options Opens array to output</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function output_fields( $options ) {&nbsp;</div></li><li><div>      foreach ( $options as $value ) {&nbsp;</div></li><li><div>          if ( ! isset( $value['type'] ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['id'] ) ) {&nbsp;</div></li><li><div>              $value['id'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['title'] ) ) {&nbsp;</div></li><li><div>              $value['title'] = isset( $value['name'] ) ? $value['name'] : '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['class'] ) ) {&nbsp;</div></li><li><div>              $value['class'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['css'] ) ) {&nbsp;</div></li><li><div>              $value['css'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['default'] ) ) {&nbsp;</div></li><li><div>              $value['default'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['desc'] ) ) {&nbsp;</div></li><li><div>              $value['desc'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['desc_tip'] ) ) {&nbsp;</div></li><li><div>              $value['desc_tip'] = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $value['placeholder'] ) ) {&nbsp;</div></li><li><div>              $value['placeholder'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Custom attribute handling</span>&nbsp;</div></li><li><div>          $custom_attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $value['custom_attributes'] ) && is_array( $value['custom_attributes'] ) ) {&nbsp;</div></li><li><div>              foreach ( $value['custom_attributes'] as $attribute =&gt; $attribute_value ) {&nbsp;</div></li><li><div>                  $custom_attributes[] = esc_attr( $attribute ) . '=&quot;' . esc_attr( $attribute_value ) . '&quot;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Description handling</span>&nbsp;</div></li><li><div>          $field_description = self::get_field_description( $value );&nbsp;</div></li><li><div>          extract( $field_description );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Switch based on type</span>&nbsp;</div></li><li><div>          switch ( $value['type'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Section Titles</span>&nbsp;</div></li><li><div>              case 'title':&nbsp;</div></li><li><div>                  if ( ! empty( $value['title'] ) ) {&nbsp;</div></li><li><div>                      echo '&lt;h2&gt;' . esc_html( $value['title'] ) . '&lt;/h2&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $value['desc'] ) ) {&nbsp;</div></li><li><div>                      echo wpautop( wptexturize( wp_kses_post( $value['desc'] ) ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  echo '&lt;table class=&quot;form-table&quot;&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>                  if ( ! empty( $value['id'] ) ) {&nbsp;</div></li><li><div>                      do_action( 'woocommerce_settings_' . sanitize_title( $value['id'] ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Section Ends</span>&nbsp;</div></li><li><div>              case 'sectionend':&nbsp;</div></li><li><div>                  if ( ! empty( $value['id'] ) ) {&nbsp;</div></li><li><div>                      do_action( 'woocommerce_settings_' . sanitize_title( $value['id'] ) . '_end' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  echo '&lt;/table&gt;';&nbsp;</div></li><li><div>                  if ( ! empty( $value['id'] ) ) {&nbsp;</div></li><li><div>                      do_action( 'woocommerce_settings_' . sanitize_title( $value['id'] ) . '_after' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Standard text inputs and subtypes like 'number'</span>&nbsp;</div></li><li><div>              case 'text':&nbsp;</div></li><li><div>              case 'email':&nbsp;</div></li><li><div>              case 'number':&nbsp;</div></li><li><div>              case 'password' :&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp forminp-&lt;?php echo sanitize_title( $value['type'] ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;input&nbsp;</div></li><li><div>                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              type=&quot;&lt;?php echo esc_attr( $value['type'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              value=&quot;&lt;?php echo esc_attr( $option_value ); ?&gt;&quot;&nbsp;</div></li><li><div>                              class=&quot;&lt;?php echo esc_attr( $value['class'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              placeholder=&quot;&lt;?php echo esc_attr( $value['placeholder'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                              /&gt; &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Color picker.</span>&nbsp;</div></li><li><div>              case 'color' :&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp forminp-&lt;?php echo sanitize_title( $value['type'] ) ?&gt;&quot;&gt;&lrm;&nbsp;</div></li><li><div>                          &lt;span class=&quot;colorpickpreview&quot; style=&quot;background: &lt;?php echo esc_attr( $option_value ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;input&nbsp;</div></li><li><div>                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              type=&quot;text&quot;&nbsp;</div></li><li><div>                              dir=&quot;ltr&quot;&nbsp;</div></li><li><div>                              style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              value=&quot;&lt;?php echo esc_attr( $option_value ); ?&gt;&quot;&nbsp;</div></li><li><div>                              class=&quot;&lt;?php echo esc_attr( $value['class'] ); ?&gt;colorpick&quot;&nbsp;</div></li><li><div>                              placeholder=&quot;&lt;?php echo esc_attr( $value['placeholder'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                              /&gt;&lrm; &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                              &lt;div id=&quot;colorPickerDiv_&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot; class=&quot;colorpickdiv&quot; style=&quot;z-index: 100;background:#eee;border:1px solid #ccc;position:absolute;display:none;&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Textarea</span>&nbsp;</div></li><li><div>              case 'textarea':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp forminp-&lt;?php echo sanitize_title( $value['type'] ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          &lt;textarea&nbsp;</div></li><li><div>                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              class=&quot;&lt;?php echo esc_attr( $value['class'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              placeholder=&quot;&lt;?php echo esc_attr( $value['placeholder'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                              &gt;&lt;?php echo esc_textarea( $option_value );  ?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Select boxes</span>&nbsp;</div></li><li><div>              case 'select' :&nbsp;</div></li><li><div>              case 'multiselect' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp forminp-&lt;?php echo sanitize_title( $value['type'] ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;select&nbsp;</div></li><li><div>                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&lt;?php echo ( 'multiselect' === $value['type'] ) ? '[]' : ''; ?&gt;&quot;&nbsp;</div></li><li><div>                              id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              class=&quot;&lt;?php echo esc_attr( $value['class'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                              &lt;?php echo ( 'multiselect' == $value['type'] ) ? 'multiple=&quot;multiple&quot;' : ''; ?&gt;&nbsp;</div></li><li><div>                              &gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                                  foreach ( $value['options'] as $key =&gt; $val ) {&nbsp;</div></li><li><div>                                      ?&gt;&nbsp;</div></li><li><div>                                      &lt;option value=&quot;&lt;?php echo esc_attr( $key ); ?&gt;&quot; &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                          if ( is_array( $option_value ) ) {&nbsp;</div></li><li><div>                                              selected( in_array( $key, $option_value ), true );&nbsp;</div></li><li><div>                                          } else {&nbsp;</div></li><li><div>                                              selected( $option_value, $key );&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                      ?&gt;&gt;&lt;?php echo $val ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                      &lt;?php&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/select&gt; &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Radio inputs</span>&nbsp;</div></li><li><div>              case 'radio' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp forminp-&lt;?php echo sanitize_title( $value['type'] ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;fieldset&gt;&nbsp;</div></li><li><div>                              &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                              &lt;ul&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                                  foreach ( $value['options'] as $key =&gt; $val ) {&nbsp;</div></li><li><div>                                      ?&gt;&nbsp;</div></li><li><div>                                      &lt;li&gt;&nbsp;</div></li><li><div>                                          &lt;label&gt;&lt;input&nbsp;</div></li><li><div>                                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                                              value=&quot;&lt;?php echo $key; ?&gt;&quot;&nbsp;</div></li><li><div>                                              type=&quot;radio&quot;&nbsp;</div></li><li><div>                                              style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                                              class=&quot;&lt;?php echo esc_attr( $value['class'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                                              &lt;?php checked( $key, $option_value ); ?&gt;&nbsp;</div></li><li><div>                                              /&gt; &lt;?php echo $val ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                                      &lt;/li&gt;&nbsp;</div></li><li><div>                                      &lt;?php&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                              &lt;/ul&gt;&nbsp;</div></li><li><div>                          &lt;/fieldset&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Checkbox input</span>&nbsp;</div></li><li><div>              case 'checkbox' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $option_value = self::get_option( $value['id'], $value['default'] );&nbsp;</div></li><li><div>                  $visbility_class = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! isset( $value['hide_if_checked'] ) ) {&nbsp;</div></li><li><div>                      $value['hide_if_checked'] = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! isset( $value['show_if_checked'] ) ) {&nbsp;</div></li><li><div>                      $value['show_if_checked'] = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( 'yes' == $value['hide_if_checked'] || 'yes' == $value['show_if_checked'] ) {&nbsp;</div></li><li><div>                      $visbility_class[] = 'hidden_option';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( 'option' == $value['hide_if_checked'] ) {&nbsp;</div></li><li><div>                      $visbility_class[] = 'hide_options_if_checked';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( 'option' == $value['show_if_checked'] ) {&nbsp;</div></li><li><div>                      $visbility_class[] = 'show_options_if_checked';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! isset( $value['checkboxgroup'] ) || 'start' == $value['checkboxgroup'] ) {&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                          &lt;tr valign=&quot;top&quot; class=&quot;&lt;?php echo esc_attr( implode( ' ', $visbility_class ) ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                              &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&lt;?php echo esc_html( $value['title'] ) ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                              &lt;td class=&quot;forminp forminp-checkbox&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;fieldset&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                          &lt;fieldset class=&quot;&lt;?php echo esc_attr( implode( ' ', $visbility_class ) ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $value['title'] ) ) {&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                          &lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php echo esc_html( $value['title'] ) ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;&lt;?php echo $value['id'] ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;input&nbsp;</div></li><li><div>                              name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&nbsp;</div></li><li><div>                              type=&quot;checkbox&quot;&nbsp;</div></li><li><div>                              class=&quot;&lt;?php echo esc_attr( isset( $value['class'] ) ? $value['class'] : '' ); ?&gt;&quot;&nbsp;</div></li><li><div>                              value=&quot;1&quot;&nbsp;</div></li><li><div>                              &lt;?php checked( $option_value, 'yes' ); ?&gt;&nbsp;</div></li><li><div>                              &lt;?php echo implode( ' ', $custom_attributes ); ?&gt;&nbsp;</div></li><li><div>                          /&gt; &lt;?php echo $description ?&gt;&nbsp;</div></li><li><div>                      &lt;/label&gt; &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! isset( $value['checkboxgroup'] ) || 'end' == $value['checkboxgroup'] ) {&nbsp;</div></li><li><div>                                  ?&gt;&nbsp;</div></li><li><div>                                  &lt;/fieldset&gt;&nbsp;</div></li><li><div>                              &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                          &lt;/fieldset&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Image width settings</span>&nbsp;</div></li><li><div>              case 'image_width' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $image_size = str_replace( '_image_size', '', $value['id'] );&nbsp;</div></li><li><div>                  $size = wc_get_image_size( $image_size );&nbsp;</div></li><li><div>                  $width = isset( $size['width'] ) ? $size['width'] : $value['default']['width'];&nbsp;</div></li><li><div>                  $height = isset( $size['height'] ) ? $size['height'] : $value['default']['height'];&nbsp;</div></li><li><div>                  $crop = isset( $size['crop'] ) ? $size['crop'] : $value['default']['crop'];&nbsp;</div></li><li><div>                  $disabled_attr = '';&nbsp;</div></li><li><div>                  $disabled_message = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( has_filter( 'woocommerce_get_image_size_' . $image_size ) ) {&nbsp;</div></li><li><div>                      $disabled_attr = 'disabled=&quot;disabled&quot;';&nbsp;</div></li><li><div>                      $disabled_message = &quot;&lt;p&gt;&lt;small&gt;&quot; . __( 'The settings of this image size have been disabled because its values are being overwritten by a filter.', 'woocommerce' ) . &quot;&lt;/small&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&lt;?php echo esc_html( $value['title'] ) ?&gt; &lt;?php echo $tooltip_html . $disabled_message; ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp image_width_settings&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          &lt;input name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;[width]&quot; &lt;?php echo $disabled_attr; ?&gt; id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;-width&quot; type=&quot;text&quot; size=&quot;3&quot; value=&quot;&lt;?php echo $width; ?&gt;&quot; /&gt; &times; &lt;input name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;[height]&quot; &lt;?php echo $disabled_attr; ?&gt; id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;-height&quot; type=&quot;text&quot; size=&quot;3&quot; value=&quot;&lt;?php echo $height; ?&gt;&quot; /&gt;px&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          &lt;label&gt;&lt;input name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;[crop]&quot; &lt;?php echo $disabled_attr; ?&gt; id=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;-crop&quot; type=&quot;checkbox&quot; value=&quot;1&quot; &lt;?php checked( 1, $crop ); ?&gt; /&gt; &lt;?php _e( 'Hard crop?', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Single page selects</span>&nbsp;</div></li><li><div>              case 'single_select_page' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $args = array(&nbsp;</div></li><li><div>                      'name' =&gt; $value['id'], &nbsp;</div></li><li><div>                      'id' =&gt; $value['id'], &nbsp;</div></li><li><div>                      'sort_column' =&gt; 'menu_order', &nbsp;</div></li><li><div>                      'sort_order' =&gt; 'ASC', &nbsp;</div></li><li><div>                      'show_option_none' =&gt; ' ', &nbsp;</div></li><li><div>                      'class' =&gt; $value['class'], &nbsp;</div></li><li><div>                      'echo' =&gt; false, &nbsp;</div></li><li><div>                      'selected' =&gt; absint( self::get_option( $value['id'] ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( isset( $value['args'] ) ) {&nbsp;</div></li><li><div>                      $args = wp_parse_args( $value['args'], $args );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot; class=&quot;single_select_page&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&lt;?php echo esc_html( $value['title'] ) ?&gt; &lt;?php echo $tooltip_html; ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php echo str_replace( ' id=', &quot; data-placeholder='&quot; . esc_attr__( 'Select a page&hellip;', 'woocommerce' ) . &quot;' style='&quot; . $value['css'] . &quot;' class='&quot; . $value['class'] . &quot;' id=&quot;, wp_dropdown_pages( $args ) ); ?&gt; &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Single country selects</span>&nbsp;</div></li><li><div>              case 'single_select_country' :&nbsp;</div></li><li><div>                  $country_setting = (string) self::get_option( $value['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( strstr( $country_setting, ':' ) ) {&nbsp;</div></li><li><div>                      $country_setting = explode( ':', $country_setting );&nbsp;</div></li><li><div>                      $country = current( $country_setting );&nbsp;</div></li><li><div>                      $state = end( $country_setting );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $country = $country_setting;&nbsp;</div></li><li><div>                      $state = '*';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp&quot;&gt;&lt;select name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot; style=&quot;&lt;?php echo esc_attr( $value['css'] ); ?&gt;&quot; data-placeholder=&quot;&lt;?php esc_attr_e( 'Choose a country&hellip;', 'woocommerce' ); ?&gt;&quot; aria-label=&quot;&lt;?php esc_attr_e( 'Country', 'woocommerce' ) ?&gt;&quot; class=&quot;wc-enhanced-select&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php WC()-&gt;countries-&gt;country_dropdown_options( $country, $state ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/select&gt; &lt;?php echo $description; ?&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Country multiselects</span>&nbsp;</div></li><li><div>              case 'multi_select_countries' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $selections = (array) self::get_option( $value['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $value['options'] ) ) {&nbsp;</div></li><li><div>                      $countries = $value['options'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $countries = WC()-&gt;countries-&gt;countries;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  asort( $countries );&nbsp;</div></li><li><div>                  ?&gt;&lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                      &lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $value['title'] ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $tooltip_html; ?&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;forminp&quot;&gt;&nbsp;</div></li><li><div>                          &lt;select multiple=&quot;multiple&quot; name=&quot;&lt;?php echo esc_attr( $value['id'] ); ?&gt;[]&quot; style=&quot;width:350px&quot; data-placeholder=&quot;&lt;?php esc_attr_e( 'Choose countries&hellip;', 'woocommerce' ); ?&gt;&quot; aria-label=&quot;&lt;?php esc_attr_e( 'Country', 'woocommerce' ) ?&gt;&quot; class=&quot;wc-enhanced-select&quot;&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                                  if ( ! empty( $countries ) ) {&nbsp;</div></li><li><div>                                      foreach ( $countries as $key =&gt; $val ) {&nbsp;</div></li><li><div>                                          echo '&lt;option value=&quot;' . esc_attr( $key ) . '&quot; ' . selected( in_array( $key, $selections ), true, false ) . '&gt;' . $val . '&lt;/option&gt;';&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/select&gt; &lt;?php echo ( $description ) ? $description : ''; ?&gt; &lt;br /&gt;&lt;a class=&quot;select_all button&quot; href=&quot;#&quot;&gt;&lt;?php _e( 'Select all', 'woocommerce' ); ?&gt;&lt;/a&gt; &lt;a class=&quot;select_none button&quot; href=&quot;#&quot;&gt;&lt;?php _e( 'Select none', 'woocommerce' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Default: run an action</span>&nbsp;</div></li><li><div>              default:&nbsp;</div></li><li><div>                  do_action( 'woocommerce_admin_field_' . $value['type'], $value );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Helper function to get the formatted description and tip HTML for a</span>&nbsp;</div></li><li><div><span class="comment">   * given form field. Plugins can call this when implementing their own custom</span>&nbsp;</div></li><li><div><span class="comment">   * settings types.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  array $value The form field value array</span>&nbsp;</div></li><li><div><span class="comment">   * @return array The description and tip as a 2 element array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_field_description( $value ) {&nbsp;</div></li><li><div>      $description = '';&nbsp;</div></li><li><div>      $tooltip_html = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( true === $value['desc_tip'] ) {&nbsp;</div></li><li><div>          $tooltip_html = $value['desc'];&nbsp;</div></li><li><div>      } elseif ( ! empty( $value['desc_tip'] ) ) {&nbsp;</div></li><li><div>          $description = $value['desc'];&nbsp;</div></li><li><div>          $tooltip_html = $value['desc_tip'];&nbsp;</div></li><li><div>      } elseif ( ! empty( $value['desc'] ) ) {&nbsp;</div></li><li><div>          $description = $value['desc'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $description && in_array( $value['type'], array( 'textarea', 'radio' ) ) ) {&nbsp;</div></li><li><div>          $description = '&lt;p style=&quot;margin-top:0&quot;&gt;' . wp_kses_post( $description ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      } elseif ( $description && in_array( $value['type'], array( 'checkbox' ) ) ) {&nbsp;</div></li><li><div>          $description = wp_kses_post( $description );&nbsp;</div></li><li><div>      } elseif ( $description ) {&nbsp;</div></li><li><div>          $description = '&lt;span class=&quot;description&quot;&gt;' . wp_kses_post( $description ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $tooltip_html && in_array( $value['type'], array( 'checkbox' ) ) ) {&nbsp;</div></li><li><div>          $tooltip_html = '&lt;p class=&quot;description&quot;&gt;' . $tooltip_html . '&lt;/p&gt;';&nbsp;</div></li><li><div>      } elseif ( $tooltip_html ) {&nbsp;</div></li><li><div>          $tooltip_html = wc_help_tip( $tooltip_html );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          'description' =&gt; $description, &nbsp;</div></li><li><div>          'tooltip_html' =&gt; $tooltip_html, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save admin fields.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Loops though the woocommerce options array and outputs each field.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $options Options array to output</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data Optional. Data to use for saving. Defaults to $_POST.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function save_fields( $options, $data = null ) {&nbsp;</div></li><li><div>      if ( is_null( $data ) ) {&nbsp;</div></li><li><div>          $data = $_POST;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( empty( $data ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Options to update will be stored here and saved later.</span>&nbsp;</div></li><li><div>      $update_options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Loop options and get values to save.</span>&nbsp;</div></li><li><div>      foreach ( $options as $option ) {&nbsp;</div></li><li><div>          if ( ! isset( $option['id'] ) || ! isset( $option['type'] ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get posted value.</span>&nbsp;</div></li><li><div>          if ( strstr( $option['id'], '[' ) ) {&nbsp;</div></li><li><div>              parse_str( $option['id'], $option_name_array );&nbsp;</div></li><li><div>              $option_name = current( array_keys( $option_name_array ) );&nbsp;</div></li><li><div>              $setting_name = key( $option_name_array[ $option_name ] );&nbsp;</div></li><li><div>              $raw_value = isset( $data[ $option_name ][ $setting_name ] ) ? wp_unslash( $data[ $option_name ][ $setting_name ] ) : null;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $option_name = $option['id'];&nbsp;</div></li><li><div>              $setting_name = '';&nbsp;</div></li><li><div>              $raw_value = isset( $data[ $option['id'] ] ) ? wp_unslash( $data[ $option['id'] ] ) : null;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Format the value based on option type.</span>&nbsp;</div></li><li><div>          switch ( $option['type'] ) {&nbsp;</div></li><li><div>              case 'checkbox' :&nbsp;</div></li><li><div>                  $value = '1' === $raw_value || 'yes' === $raw_value ? 'yes' : 'no';&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'textarea' :&nbsp;</div></li><li><div>                  $value = wp_kses_post( trim( $raw_value ) );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'multiselect' :&nbsp;</div></li><li><div>              case 'multi_select_countries' :&nbsp;</div></li><li><div>                  $value = array_filter( array_map( 'wc_clean', (array) $raw_value ) );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'image_width' :&nbsp;</div></li><li><div>                  $value = array();&nbsp;</div></li><li><div>                  if ( isset( $raw_value['width'] ) ) {&nbsp;</div></li><li><div>                      $value['width'] = wc_clean( $raw_value['width'] );&nbsp;</div></li><li><div>                      $value['height'] = wc_clean( $raw_value['height'] );&nbsp;</div></li><li><div>                      $value['crop'] = isset( $raw_value['crop'] ) ? 1 : 0;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $value['width'] = $option['default']['width'];&nbsp;</div></li><li><div>                      $value['height'] = $option['default']['height'];&nbsp;</div></li><li><div>                      $value['crop'] = $option['default']['crop'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'select':&nbsp;</div></li><li><div>                  $allowed_values = empty( $option['options'] ) ? array() : array_keys( $option['options'] );&nbsp;</div></li><li><div>                  if ( empty( $option['default'] ) && empty( $allowed_values ) ) {&nbsp;</div></li><li><div>                      $value = null;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $default = ( empty( $option['default'] ) ? $allowed_values[0] : $option['default'] );&nbsp;</div></li><li><div>                  $value = in_array( $raw_value, $allowed_values ) ? $raw_value : $default;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              default :&nbsp;</div></li><li><div>                  $value = wc_clean( $raw_value );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fire an action when a certain 'type' of field is being saved.</span>&nbsp;</div></li><li><div><span class="comment">           * @deprecated 2.4.0 - doesn't allow manipulation of values!</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( has_action( 'woocommerce_update_option_' . sanitize_title( $option['type'] ) ) ) {&nbsp;</div></li><li><div>              wc_deprecated_function( 'The woocommerce_update_option_X action', '2.4.0', 'woocommerce_admin_settings_sanitize_option filter' );&nbsp;</div></li><li><div>              do_action( 'woocommerce_update_option_' . sanitize_title( $option['type'] ), $option );&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Sanitize the value of an option.</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $value = apply_filters( 'woocommerce_admin_settings_sanitize_option', $value, $option, $raw_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Sanitize the value of an option by option name.</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $value = apply_filters( &quot;woocommerce_admin_settings_sanitize_option_$option_name&quot;, $value, $option, $raw_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_null( $value ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check if option is an array and handle that differently to single values.</span>&nbsp;</div></li><li><div>          if ( $option_name && $setting_name ) {&nbsp;</div></li><li><div>              if ( ! isset( $update_options[ $option_name ] ) ) {&nbsp;</div></li><li><div>                  $update_options[ $option_name ] = get_option( $option_name, array() );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! is_array( $update_options[ $option_name ] ) ) {&nbsp;</div></li><li><div>                  $update_options[ $option_name ] = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $update_options[ $option_name ][ $setting_name ] = $value;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $update_options[ $option_name ] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fire an action before saved.</span>&nbsp;</div></li><li><div><span class="comment">           * @deprecated 2.4.0 - doesn't allow manipulation of values!</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'woocommerce_update_option', $option );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Save all options in our array.</span>&nbsp;</div></li><li><div>      foreach ( $update_options as $name =&gt; $value ) {&nbsp;</div></li><li><div>          update_option( $name, $value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Checks which method we're using to serve downloads.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If using force or x-sendfile, this ensures the .htaccess is in place.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function check_download_folder_protection() {&nbsp;</div></li><li><div>      $upload_dir = wp_upload_dir();&nbsp;</div></li><li><div>      $downloads_url = $upload_dir['basedir'] . '/woocommerce_uploads';&nbsp;</div></li><li><div>      $download_method = get_option( 'woocommerce_file_download_method' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'redirect' == $download_method ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Redirect method - don't protect</span>&nbsp;</div></li><li><div>          if ( file_exists( $downloads_url . '/.htaccess' ) ) {&nbsp;</div></li><li><div>              unlink( $downloads_url . '/.htaccess' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Force method - protect, add rules to the htaccess file</span>&nbsp;</div></li><li><div>          if ( ! file_exists( $downloads_url . '/.htaccess' ) ) {&nbsp;</div></li><li><div>              if ( $file_handle = @fopen( $downloads_url . '/.htaccess', 'w' ) ) {&nbsp;</div></li><li><div>                  fwrite( $file_handle, 'deny from all' );&nbsp;</div></li><li><div>                  fclose( $file_handle );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>endif;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>WooCommerce</li><li><span></span>3.0.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>