<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.0.6" data-slug="woocommerce" data-type="file" data-id="40773"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-wc-product-functions | file | Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, woocommerce, 3.0.6" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=43a5e18db4a397412cee17e686b9dfa2' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-wc-product-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-wc-product-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-wc-product-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-3.0.6-file-includes-wc-product-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-wc-product-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce." href="http://hookr.io/plugins/woocommerce/" class="plugin"><span property="name">woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.0.6." href="http://hookr.io/plugins/woocommerce/3.0.6/" class="H_VERSION"><span property="name">3.0.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/woocommerce/3.0.6/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-wc-product-functions</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="3119"><a href="http://hookr.io/plugins/woocommerce/3.0.6/all/" title="All">All <span class="count badge">3119</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/woocommerce/3.0.6/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="2110"><a href="http://hookr.io/plugins/woocommerce/3.0.6/hooks/" title="Hooks">Hooks <span class="count badge">2110</span></a></li><li class="" data-id="action" data-count="774"><a href="http://hookr.io/plugins/woocommerce/3.0.6/actions/" title="Actions">Actions <span class="count badge">774</span></a></li><li class="" data-id="filter" data-count="1336"><a href="http://hookr.io/plugins/woocommerce/3.0.6/filters/" title="Filters">Filters <span class="count badge">1336</span></a></li><li class="" data-id="class" data-count="365"><a href="http://hookr.io/plugins/woocommerce/3.0.6/classes/" title="Classes">Classes <span class="count badge">365</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/woocommerce/3.0.6/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="626"><a href="http://hookr.io/plugins/woocommerce/3.0.6/functions/" title="Functions">Functions <span class="count badge">626</span></a></li><li class="" data-id="shortcode" data-count="4"><a href="http://hookr.io/plugins/woocommerce/3.0.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">4</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/wc-product-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WooCommerce Product Functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Functions for product specific things.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author   WooThemes</span>&nbsp;</div></li><li><div><span class="comment"> * @category Core</span>&nbsp;</div></li><li><div><span class="comment"> * @package  WooCommerce/Functions</span>&nbsp;</div></li><li><div><span class="comment"> * @version  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Products wrapper for get_posts.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function should be used for product retrieval so that we have a data agnostic</span>&nbsp;</div></li><li><div><span class="comment"> * way to get a list of products.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Args:</span>&nbsp;</div></li><li><div><span class="comment"> *      status array|string List of statuses to find. Default: any. Options: any, draft, pending, private and publish.</span>&nbsp;</div></li><li><div><span class="comment"> *      type array|string Product type, e.g. Default: all. Options: all, simple, external, variable, variation, grouped.</span>&nbsp;</div></li><li><div><span class="comment"> *      parent int post/product parent</span>&nbsp;</div></li><li><div><span class="comment"> *      sku string Limit result set to products with specific SKU.</span>&nbsp;</div></li><li><div><span class="comment"> *      category array Limit result set to products assigned to specific categories by slug</span>&nbsp;</div></li><li><div><span class="comment"> *                     e.g. array('hoodie', 'cap', 't-shirt').</span>&nbsp;</div></li><li><div><span class="comment"> *      tag array Limit result set to products assigned to specific tags (by slug)</span>&nbsp;</div></li><li><div><span class="comment"> *                e.g. array('funky', 'retro', 'designer')</span>&nbsp;</div></li><li><div><span class="comment"> *      shipping_class array Limit results set to products in specific shipping classes (by slug)</span>&nbsp;</div></li><li><div><span class="comment"> *                           e.g. array('standard', 'next-day')</span>&nbsp;</div></li><li><div><span class="comment"> *      limit int Maximum of products to retrieve.</span>&nbsp;</div></li><li><div><span class="comment"> *      offset int Offset of products to retrieve.</span>&nbsp;</div></li><li><div><span class="comment"> *      page int Page of products to retrieve. Ignored when using the 'offset' arg.</span>&nbsp;</div></li><li><div><span class="comment"> *      exclude array Product IDs to exclude from the query.</span>&nbsp;</div></li><li><div><span class="comment"> *      orderby string Order by date, title, id, modified, rand etc</span>&nbsp;</div></li><li><div><span class="comment"> *      order string ASC or DESC</span>&nbsp;</div></li><li><div><span class="comment"> *      return string Type of data to return. Allowed values:</span>&nbsp;</div></li><li><div><span class="comment"> *          ids array of Product ids</span>&nbsp;</div></li><li><div><span class="comment"> *          objects array of product objects (default)</span>&nbsp;</div></li><li><div><span class="comment"> *      paginate bool If true, the return value will be an array with values:</span>&nbsp;</div></li><li><div><span class="comment"> *          'products' =&gt; array of data (return value above), </span>&nbsp;</div></li><li><div><span class="comment"> *          'total' =&gt; total number of products matching the query</span>&nbsp;</div></li><li><div><span class="comment"> *          'max_num_pages' =&gt; max number of pages found</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $args Array of args (above)</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|stdClass Number of pages and an array of product objects if</span>&nbsp;</div></li><li><div><span class="comment"> *                             paginate is true, or just an array of values.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_products( $args ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'status' =&gt; array( 'draft', 'pending', 'private', 'publish' ), &nbsp;</div></li><li><div>      'type' =&gt; array_merge( array_keys( wc_get_product_types() ) ), &nbsp;</div></li><li><div>      'parent' =&gt; null, &nbsp;</div></li><li><div>      'sku' =&gt; '', &nbsp;</div></li><li><div>      'category' =&gt; array(), &nbsp;</div></li><li><div>      'tag' =&gt; array(), &nbsp;</div></li><li><div>      'limit' =&gt; get_option( 'posts_per_page' ), &nbsp;</div></li><li><div>      'offset' =&gt; null, &nbsp;</div></li><li><div>      'page' =&gt; 1, &nbsp;</div></li><li><div>      'include' =&gt; array(), &nbsp;</div></li><li><div>      'exclude' =&gt; array(), &nbsp;</div></li><li><div>      'orderby' =&gt; 'date', &nbsp;</div></li><li><div>      'order' =&gt; 'DESC', &nbsp;</div></li><li><div>      'return' =&gt; 'objects', &nbsp;</div></li><li><div>      'paginate' =&gt; false, &nbsp;</div></li><li><div>      'shipping_class' =&gt; array(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Handle some BW compatibility arg names where wp_query args differ in naming.</span>&nbsp;</div></li><li><div>  $map_legacy = array(&nbsp;</div></li><li><div>      'numberposts' =&gt; 'limit', &nbsp;</div></li><li><div>      'post_status' =&gt; 'status', &nbsp;</div></li><li><div>      'post_parent' =&gt; 'parent', &nbsp;</div></li><li><div>      'posts_per_page' =&gt; 'limit', &nbsp;</div></li><li><div>      'paged' =&gt; 'page', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $map_legacy as $from =&gt; $to ) {&nbsp;</div></li><li><div>      if ( isset( $args[ $from ] ) ) {&nbsp;</div></li><li><div>          $args[ $to ] = $args[ $from ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return WC_Data_Store::load( 'product' )-&gt;get_products( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Main function for returning products, uses the WC_Product_Factory class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $the_product Post object or post ID of the product.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $deprecated Previously used to pass arguments to the factory, e.g. to force a type.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WC_Product|null</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product( $the_product = false, $deprecated = array() ) {&nbsp;</div></li><li><div>  if ( ! did_action( 'woocommerce_init' ) ) {&nbsp;</div></li><li><div>      wc_doing_it_wrong( __FUNCTION__, __( 'wc_get_product should not be called before the woocommerce_init action.', 'woocommerce' ), '2.5' );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( ! empty( $deprecated ) ) {&nbsp;</div></li><li><div>      wc_deprecated_argument( 'args', '3.0', 'Passing args to wc_get_product is deprecated. If you need to force a type, construct the product class directly.' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return WC()-&gt;product_factory-&gt;get_product( $the_product, $deprecated );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns whether or not SKUS are enabled.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_sku_enabled() {&nbsp;</div></li><li><div>  return apply_filters( 'wc_product_sku_enabled', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns whether or not product weights are enabled.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_weight_enabled() {&nbsp;</div></li><li><div>  return apply_filters( 'wc_product_weight_enabled', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns whether or not product dimensions (HxWxD) are enabled.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_dimensions_enabled() {&nbsp;</div></li><li><div>  return apply_filters( 'wc_product_dimensions_enabled', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Clear all transients cache for product data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id (default: 0)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_delete_product_transients( $post_id = 0 ) {&nbsp;</div></li><li><div>  <span class="comment">// Core transients</span>&nbsp;</div></li><li><div>  $transients_to_clear = array(&nbsp;</div></li><li><div>      'wc_products_onsale', &nbsp;</div></li><li><div>      'wc_featured_products', &nbsp;</div></li><li><div>      'wc_outofstock_count', &nbsp;</div></li><li><div>      'wc_low_stock_count', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Transient names that include an ID</span>&nbsp;</div></li><li><div>  $post_transient_names = array(&nbsp;</div></li><li><div>      'wc_product_children_', &nbsp;</div></li><li><div>      'wc_var_prices_', &nbsp;</div></li><li><div>      'wc_related_', &nbsp;</div></li><li><div>      'wc_child_has_weight_', &nbsp;</div></li><li><div>      'wc_child_has_dimensions_', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $post_id &gt; 0 ) {&nbsp;</div></li><li><div>      foreach ( $post_transient_names as $transient ) {&nbsp;</div></li><li><div>          $transients_to_clear[] = $transient . $post_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Does this product have a parent?</span>&nbsp;</div></li><li><div>      $product = wc_get_product( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $product && $product-&gt;get_parent_id() &gt; 0 ) {&nbsp;</div></li><li><div>          wc_delete_product_transients( $product-&gt;get_parent_id() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Delete transients</span>&nbsp;</div></li><li><div>  foreach ( $transients_to_clear as $transient ) {&nbsp;</div></li><li><div>      delete_transient( $transient );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Increments the transient version to invalidate cache</span>&nbsp;</div></li><li><div>  WC_Cache_Helper::get_transient_version( 'product', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'woocommerce_delete_product_transients', $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Function that returns an array containing the IDs of the products that are on sale.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_ids_on_sale() {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Load from cache</span></span>&nbsp;</div></li><li><div>  $product_ids_on_sale = get_transient( 'wc_products_onsale' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Valid cache found</span></span>&nbsp;</div></li><li><div>  if ( false !== $product_ids_on_sale ) {&nbsp;</div></li><li><div>      return $product_ids_on_sale;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>  $on_sale_products = $data_store-&gt;get_on_sale_products();&nbsp;</div></li><li><div>  $product_ids_on_sale = wp_parse_id_list( array_merge( wp_list_pluck( $on_sale_products, 'id' ), array_diff( wp_list_pluck( $on_sale_products, 'parent_id' ), array( 0 ) ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  set_transient( 'wc_products_onsale', $product_ids_on_sale, DAY_IN_SECONDS * 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $product_ids_on_sale;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Function that returns an array containing the IDs of the featured products.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_featured_product_ids() {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Load from cache</span></span>&nbsp;</div></li><li><div>  $featured_product_ids = get_transient( 'wc_featured_products' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Valid cache found</span></span>&nbsp;</div></li><li><div>  if ( false !== $featured_product_ids )&nbsp;</div></li><li><div>      return $featured_product_ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>  $featured = $data_store-&gt;get_featured_product_ids();&nbsp;</div></li><li><div>  $product_ids = array_keys( $featured );&nbsp;</div></li><li><div>  $parent_ids = array_values( array_filter( $featured ) );&nbsp;</div></li><li><div>  $featured_product_ids = array_unique( array_merge( $product_ids, $parent_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  set_transient( 'wc_featured_products', $featured_product_ids, DAY_IN_SECONDS * 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $featured_product_ids;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filter to allow product_cat in the permalinks for products.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string  $permalink The existing permalink URL.</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_post_type_link( $permalink, $post ) {&nbsp;</div></li><li><div>  <span class="comment">// Abort if post is not a product.</span>&nbsp;</div></li><li><div>  if ( 'product' !== $post-&gt;post_type ) {&nbsp;</div></li><li><div>      return $permalink;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Abort early if the placeholder rewrite tag isn't in the generated URL.</span>&nbsp;</div></li><li><div>  if ( false === strpos( $permalink, '%' ) ) {&nbsp;</div></li><li><div>      return $permalink;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the custom taxonomy terms in use by this post.</span>&nbsp;</div></li><li><div>  $terms = get_the_terms( $post-&gt;ID, 'product_cat' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $terms ) ) {&nbsp;</div></li><li><div>      if ( function_exists( 'wp_list_sort' ) ) {&nbsp;</div></li><li><div>          $terms = wp_list_sort( $terms, 'term_id', 'ASC' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          usort( $terms, '_usort_terms_by_ID' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $category_object = apply_filters( 'wc_product_post_type_link_product_cat', $terms[0], $terms, $post );&nbsp;</div></li><li><div>      $category_object = get_term( $category_object, 'product_cat' );&nbsp;</div></li><li><div>      $product_cat = $category_object-&gt;slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $category_object-&gt;parent ) {&nbsp;</div></li><li><div>          $ancestors = get_ancestors( $category_object-&gt;term_id, 'product_cat' );&nbsp;</div></li><li><div>          foreach ( $ancestors as $ancestor ) {&nbsp;</div></li><li><div>              $ancestor_object = get_term( $ancestor, 'product_cat' );&nbsp;</div></li><li><div>              $product_cat = $ancestor_object-&gt;slug . '/' . $product_cat;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// If no terms are assigned to this post, use a string instead (can't leave the placeholder there)</span>&nbsp;</div></li><li><div>      $product_cat = _x( 'uncategorized', 'slug', 'woocommerce' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $find = array(&nbsp;</div></li><li><div>      '%year%', &nbsp;</div></li><li><div>      '%monthnum%', &nbsp;</div></li><li><div>      '%day%', &nbsp;</div></li><li><div>      '%hour%', &nbsp;</div></li><li><div>      '%minute%', &nbsp;</div></li><li><div>      '%second%', &nbsp;</div></li><li><div>      '%post_id%', &nbsp;</div></li><li><div>      '%category%', &nbsp;</div></li><li><div>      '%product_cat%', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $replace = array(&nbsp;</div></li><li><div>      date_i18n( 'Y', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      date_i18n( 'm', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      date_i18n( 'd', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      date_i18n( 'H', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      date_i18n( 'i', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      date_i18n( 's', strtotime( $post-&gt;post_date ) ), &nbsp;</div></li><li><div>      $post-&gt;ID, &nbsp;</div></li><li><div>      $product_cat, &nbsp;</div></li><li><div>      $product_cat, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $permalink = str_replace( $find, $replace, $permalink );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $permalink;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'post_type_link', 'wc_product_post_type_link', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the placeholder image URL for products etc.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_placeholder_img_src() {&nbsp;</div></li><li><div>  return apply_filters( 'woocommerce_placeholder_img_src', WC()-&gt;plugin_url() . '/assets/images/placeholder.png' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the placeholder image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_placeholder_img( $size = 'shop_thumbnail' ) {&nbsp;</div></li><li><div>  $dimensions = wc_get_image_size( $size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'woocommerce_placeholder_img', '&lt;img src=&quot;' . wc_placeholder_img_src() . '&quot; alt=&quot;' . esc_attr__( 'Placeholder', 'woocommerce' ) . '&quot; width=&quot;' . esc_attr( $dimensions['width'] ) . '&quot; class=&quot;woocommerce-placeholder wp-post-image&quot; height=&quot;' . esc_attr( $dimensions['height'] ) . '&quot; /&gt;', $size, $dimensions );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Variation Formatting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Gets a formatted version of variation data or item meta.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|WC_Product_Variation $variation</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $flat (default: false)</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $include_names include attribute names/labels</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_formatted_variation( $variation, $flat = false, $include_names = true ) {&nbsp;</div></li><li><div>  $return = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_a( $variation, 'WC_Product_Variation' ) ) {&nbsp;</div></li><li><div>      $variation_attributes = $variation-&gt;get_attributes();&nbsp;</div></li><li><div>      $product = $variation;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $product = false;&nbsp;</div></li><li><div>      <span class="comment">// Remove attribute_ prefix from names.</span>&nbsp;</div></li><li><div>      $variation_attributes = array();&nbsp;</div></li><li><div>      if ( is_array( $variation ) ) {&nbsp;</div></li><li><div>          foreach ( $variation as $key =&gt; $value ) {&nbsp;</div></li><li><div>              $variation_attributes[ str_replace( 'attribute_', '', $key ) ] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $list_type = $include_names ? 'dl' : 'ul';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $variation_attributes ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $flat ) {&nbsp;</div></li><li><div>          $return = '&lt;' . $list_type . ' class=&quot;variation&quot;&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $variation_list = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $variation_attributes as $name =&gt; $value ) {&nbsp;</div></li><li><div>          if ( ! $value ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If this is a term slug, get the term's nice name</span>&nbsp;</div></li><li><div>          if ( taxonomy_exists( $name ) ) {&nbsp;</div></li><li><div>              $term = get_term_by( 'slug', $value, $name );&nbsp;</div></li><li><div>              if ( ! is_wp_error( $term ) && ! empty( $term-&gt;name ) ) {&nbsp;</div></li><li><div>                  $value = $term-&gt;name;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $value = ucwords( str_replace( '-', ' ', $value ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $include_names ) {&nbsp;</div></li><li><div>              if ( $flat ) {&nbsp;</div></li><li><div>                  $variation_list[] = wc_attribute_label( $name, $product ) . ': ' . rawurldecode( $value );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $variation_list[] = '&lt;dt&gt;' . wc_attribute_label( $name, $product ) . ':&lt;/dt&gt;&lt;dd&gt;' . rawurldecode( $value ) . '&lt;/dd&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( $flat ) {&nbsp;</div></li><li><div>                  $variation_list[] = rawurldecode( $value );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $variation_list[] = '&lt;li&gt;' . rawurldecode( $value ) . '&lt;/li&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $flat ) {&nbsp;</div></li><li><div>          $return .= implode( ', ', $variation_list );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $return .= implode( '', $variation_list );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $flat ) {&nbsp;</div></li><li><div>          $return .= '&lt;/' . $list_type . '&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $return;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Function which handles the start and end of scheduled sales via cron.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_scheduled_sales() {&nbsp;</div></li><li><div>  $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sales which are due to start</span>&nbsp;</div></li><li><div>  $product_ids = $data_store-&gt;get_starting_sales();&nbsp;</div></li><li><div>  if ( $product_ids ) {&nbsp;</div></li><li><div>      foreach ( $product_ids as $product_id ) {&nbsp;</div></li><li><div>          $product = wc_get_product( $product_id );&nbsp;</div></li><li><div>          $sale_price = $product-&gt;get_sale_price();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $sale_price ) {&nbsp;</div></li><li><div>              $product-&gt;set_price( $sale_price );&nbsp;</div></li><li><div>              $product-&gt;set_date_on_sale_from( '' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $product-&gt;set_date_on_sale_to( '' );&nbsp;</div></li><li><div>              $product-&gt;set_date_on_sale_from( '' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $product-&gt;save();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      delete_transient( 'wc_products_onsale' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sales which are due to end</span>&nbsp;</div></li><li><div>  $product_ids = $data_store-&gt;get_ending_sales();&nbsp;</div></li><li><div>  if ( $product_ids ) {&nbsp;</div></li><li><div>      foreach ( $product_ids as $product_id ) {&nbsp;</div></li><li><div>          $product = wc_get_product( $product_id );&nbsp;</div></li><li><div>          $regular_price = $product-&gt;get_regular_price();&nbsp;</div></li><li><div>          $product-&gt;set_price( $regular_price );&nbsp;</div></li><li><div>          $product-&gt;set_sale_price( '' );&nbsp;</div></li><li><div>          $product-&gt;set_date_on_sale_to( '' );&nbsp;</div></li><li><div>          $product-&gt;set_date_on_sale_from( '' );&nbsp;</div></li><li><div>          $product-&gt;save();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      WC_Cache_Helper::get_transient_version( 'product', true );&nbsp;</div></li><li><div>      delete_transient( 'wc_products_onsale' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'woocommerce_scheduled_sales', 'wc_scheduled_sales' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get attachment image attributes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_attachment_image_attributes( $attr ) {&nbsp;</div></li><li><div>  if ( strstr( $attr['src'][0], 'woocommerce_uploads/' ) ) {&nbsp;</div></li><li><div>      $attr['src'][0] = wc_placeholder_img_src();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $attr;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'wp_get_attachment_image_attributes', 'wc_get_attachment_image_attributes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prepare attachment for JavaScript.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $response</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_prepare_attachment_for_js( $response ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $response['url'] ) && strstr( $response['url'], 'woocommerce_uploads/' ) ) {&nbsp;</div></li><li><div>      $response['full']['url'] = wc_placeholder_img_src();&nbsp;</div></li><li><div>      if ( isset( $response['sizes'] ) ) {&nbsp;</div></li><li><div>          foreach ( $response['sizes'] as $size =&gt; $value ) {&nbsp;</div></li><li><div>              $response['sizes'][ $size ]['url'] = wc_placeholder_img_src();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'wp_prepare_attachment_for_js', 'wc_prepare_attachment_for_js' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Track product views.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_track_product_view() {&nbsp;</div></li><li><div>  if ( ! is_singular( 'product' ) || ! is_active_widget( false, false, 'woocommerce_recently_viewed_products', true ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $_COOKIE['woocommerce_recently_viewed'] ) )&nbsp;</div></li><li><div>      $viewed_products = array();&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $viewed_products = (array) explode( '|', $_COOKIE['woocommerce_recently_viewed'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! in_array( $post-&gt;ID, $viewed_products ) ) {&nbsp;</div></li><li><div>      $viewed_products[] = $post-&gt;ID;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( sizeof( $viewed_products ) &gt; 15 ) {&nbsp;</div></li><li><div>      array_shift( $viewed_products );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Store for session only</span>&nbsp;</div></li><li><div>  wc_setcookie( 'woocommerce_recently_viewed', implode( '|', $viewed_products ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'template_redirect', 'wc_track_product_view', 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get product types.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_types() {&nbsp;</div></li><li><div>  return (array) apply_filters( 'product_type_selector', array(&nbsp;</div></li><li><div>      'simple' =&gt; __( 'Simple product', 'woocommerce' ), &nbsp;</div></li><li><div>      'grouped' =&gt; __( 'Grouped product', 'woocommerce' ), &nbsp;</div></li><li><div>      'external' =&gt; __( 'External/Affiliate product', 'woocommerce' ), &nbsp;</div></li><li><div>      'variable' =&gt; __( 'Variable product', 'woocommerce' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if product sku is unique.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $product_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $sku</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_has_unique_sku( $product_id, $sku ) {&nbsp;</div></li><li><div>  $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>  $sku_found = $data_store-&gt;is_existing_sku( $product_id, $sku );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( apply_filters( 'wc_product_has_unique_sku', $sku_found, $product_id, $sku ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Force a unique SKU.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  integer $product_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_force_unique_sku( $product_id ) {&nbsp;</div></li><li><div>  $product = wc_get_product( $product_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $product && ( $current_sku = $product-&gt;get_sku( 'edit' ) ) ) {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          $new_sku = wc_product_generate_unique_sku( $product_id, $current_sku );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $current_sku !== $new_sku ) {&nbsp;</div></li><li><div>              $product-&gt;set_sku( $new_sku );&nbsp;</div></li><li><div>              $product-&gt;save();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } catch ( Exception $e ) {}&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Recursively appends a suffix until a unique SKU is found.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  integer $product_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string  $sku</span>&nbsp;</div></li><li><div><span class="comment"> * @param  integer $index</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_product_generate_unique_sku( $product_id, $sku, $index = 0 ) {&nbsp;</div></li><li><div>  $generated_sku = 0 &lt; $index ? $sku . '-' . $index : $sku;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wc_product_has_unique_sku( $product_id, $generated_sku ) ) {&nbsp;</div></li><li><div>      $generated_sku = wc_product_generate_unique_sku( $product_id, $sku, ( $index + 1 ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $generated_sku;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get product ID by SKU.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string $sku</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_id_by_sku( $sku ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>  $product_id = $data_store-&gt;get_product_id_by_sku( $sku );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( $product_id ) ? intval( $product_id ) : 0;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get attibutes/data for an individual variation from the database and maintain it's integrity.</span>&nbsp;</div></li><li><div><span class="comment"> * @param revisit?</span>&nbsp;</div></li><li><div><span class="comment"> * @since  2.4.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int $variation_id</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_variation_attributes( $variation_id ) {&nbsp;</div></li><li><div>  <span class="comment">// Build variation data from meta</span>&nbsp;</div></li><li><div>  $all_meta = get_post_meta( $variation_id );&nbsp;</div></li><li><div>  $parent_id = wp_get_post_parent_id( $variation_id );&nbsp;</div></li><li><div>  $parent_attributes = array_filter( (array) get_post_meta( $parent_id, '_product_attributes', true ) );&nbsp;</div></li><li><div>  $found_parent_attributes = array();&nbsp;</div></li><li><div>  $variation_attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Compare to parent variable product attributes and ensure they match</span>&nbsp;</div></li><li><div>  foreach ( $parent_attributes as $attribute_name =&gt; $options ) {&nbsp;</div></li><li><div>      if ( ! empty( $options['is_variation'] ) ) {&nbsp;</div></li><li><div>          $attribute = 'attribute_' . sanitize_title( $attribute_name );&nbsp;</div></li><li><div>          $found_parent_attributes[] = $attribute;&nbsp;</div></li><li><div>          if ( ! array_key_exists( $attribute, $variation_attributes ) ) {&nbsp;</div></li><li><div>              $variation_attributes[ $attribute ] = ''; <span class="comment">// Add it - 'any' will be asumed</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the variation attributes from meta</span>&nbsp;</div></li><li><div>  foreach ( $all_meta as $name =&gt; $value ) {&nbsp;</div></li><li><div>      <span class="comment">// Only look at valid attribute meta, and also compare variation level attributes and remove any which do not exist at parent level</span>&nbsp;</div></li><li><div>      if ( 0 !== strpos( $name, 'attribute_' ) || ! in_array( $name, $found_parent_attributes ) ) {&nbsp;</div></li><li><div>          unset( $variation_attributes[ $name ] );&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Pre 2.4 handling where 'slugs' were saved instead of the full text attribute.</span>&nbsp;</div></li><li><div><span class="comment">       * Attempt to get full version of the text attribute from the parent.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( sanitize_title( $value[0] ) === $value[0] && version_compare( get_post_meta( $parent_id, '_product_version', true ), '2.4.0', '&lt;' ) ) {&nbsp;</div></li><li><div>          foreach ( $parent_attributes as $attribute ) {&nbsp;</div></li><li><div>              if ( 'attribute_' . sanitize_title( $attribute['name'] ) !== $name ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $text_attributes = wc_get_text_attributes( $attribute['value'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $text_attributes as $text_attribute ) {&nbsp;</div></li><li><div>                  if ( sanitize_title( $text_attribute ) === $value[0] ) {&nbsp;</div></li><li><div>                      $value[0] = $text_attribute;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $variation_attributes[ $name ] = $value[0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $variation_attributes;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get all product cats for a product by ID, including hierarchy</span>&nbsp;</div></li><li><div><span class="comment"> * @since  2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int $product_id</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_cat_ids( $product_id ) {&nbsp;</div></li><li><div>  $product_cats = wc_get_product_term_ids( $product_id, 'product_cat' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $product_cats as $product_cat ) {&nbsp;</div></li><li><div>      $product_cats = array_merge( $product_cats, get_ancestors( $product_cat, 'product_cat' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $product_cats;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets data about an attachment, such as alt text and captions.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param object|bool $product</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_attachment_props( $attachment_id = null, $product = false ) {&nbsp;</div></li><li><div>  $props = array(&nbsp;</div></li><li><div>      'title' =&gt; '', &nbsp;</div></li><li><div>      'caption' =&gt; '', &nbsp;</div></li><li><div>      'url' =&gt; '', &nbsp;</div></li><li><div>      'alt' =&gt; '', &nbsp;</div></li><li><div>      'src' =&gt; '', &nbsp;</div></li><li><div>      'srcset' =&gt; false, &nbsp;</div></li><li><div>      'sizes' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( $attachment = get_post( $attachment_id ) ) {&nbsp;</div></li><li><div>      $props['title'] = trim( strip_tags( $attachment-&gt;post_title ) );&nbsp;</div></li><li><div>      $props['caption'] = trim( strip_tags( $attachment-&gt;post_excerpt ) );&nbsp;</div></li><li><div>      $props['url'] = wp_get_attachment_url( $attachment_id );&nbsp;</div></li><li><div>      $props['alt'] = trim( strip_tags( get_post_meta( $attachment_id, '_wp_attachment_image_alt', true ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Large version.</span>&nbsp;</div></li><li><div>      $src = wp_get_attachment_image_src( $attachment_id, 'full' );&nbsp;</div></li><li><div>      $props['full_src'] = $src[0];&nbsp;</div></li><li><div>      $props['full_src_w'] = $src[1];&nbsp;</div></li><li><div>      $props['full_src_h'] = $src[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Thumbnail version.</span>&nbsp;</div></li><li><div>      $src = wp_get_attachment_image_src( $attachment_id, 'shop_thumbnail' );&nbsp;</div></li><li><div>      $props['thumb_src'] = $src[0];&nbsp;</div></li><li><div>      $props['thumb_src_w'] = $src[1];&nbsp;</div></li><li><div>      $props['thumb_src_h'] = $src[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Image source.</span>&nbsp;</div></li><li><div>      $src = wp_get_attachment_image_src( $attachment_id, 'shop_single' );&nbsp;</div></li><li><div>      $props['src'] = $src[0];&nbsp;</div></li><li><div>      $props['src_w'] = $src[1];&nbsp;</div></li><li><div>      $props['src_h'] = $src[2];&nbsp;</div></li><li><div>      $props['srcset'] = function_exists( 'wp_get_attachment_image_srcset' ) ? wp_get_attachment_image_srcset( $attachment_id, 'shop_single' ) : false;&nbsp;</div></li><li><div>      $props['sizes'] = function_exists( 'wp_get_attachment_image_sizes' ) ? wp_get_attachment_image_sizes( $attachment_id, 'shop_single' ) : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Alt text fallbacks</span>&nbsp;</div></li><li><div>      $props['alt'] = empty( $props['alt'] ) ? $props['caption']                                               : $props['alt'];&nbsp;</div></li><li><div>      $props['alt'] = empty( $props['alt'] ) ? trim( strip_tags( $attachment-&gt;post_title ) )                   : $props['alt'];&nbsp;</div></li><li><div>      $props['alt'] = empty( $props['alt'] ) && $product ? trim( strip_tags( get_the_title( $product-&gt;ID ) ) ) : $props['alt'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $props;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get product visibility options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_visibility_options() {&nbsp;</div></li><li><div>  return apply_filters( 'woocommerce_product_visibility_options', array(&nbsp;</div></li><li><div>      'visible' =&gt; __( 'Visible', 'woocommerce' ), &nbsp;</div></li><li><div>      'catalog' =&gt; __( 'Catalog', 'woocommerce' ), &nbsp;</div></li><li><div>      'search' =&gt; __( 'Search', 'woocommerce' ), &nbsp;</div></li><li><div>      'hidden' =&gt; __( 'Hidden', 'woocommerce' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get min/max price meta query args.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args Min price and max price arguments.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_min_max_price_meta_query( $args ) {&nbsp;</div></li><li><div>  $min = isset( $args['min_price'] ) ? floatval( $args['min_price'] ) : 0;&nbsp;</div></li><li><div>  $max = isset( $args['max_price'] ) ? floatval( $args['max_price'] ) : 9999999999;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adjust if the store taxes are not displayed how they are stored.</span>&nbsp;</div></li><li><div><span class="comment">   * Max is left alone because the filter was already increased.</span>&nbsp;</div></li><li><div><span class="comment">   * Kicks in when prices excluding tax are displayed including tax.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( wc_tax_enabled() && 'incl' === get_option( 'woocommerce_tax_display_shop' ) && ! wc_prices_include_tax() ) {&nbsp;</div></li><li><div>      $tax_classes = array_merge( array( '' ), WC_Tax::get_tax_classes() );&nbsp;</div></li><li><div>      $class_min = $min;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $tax_classes as $tax_class ) {&nbsp;</div></li><li><div>          if ( $tax_rates = WC_Tax::get_rates( $tax_class ) ) {&nbsp;</div></li><li><div>              $class_min = $min - WC_Tax::get_tax_total( WC_Tax::calc_exclusive_tax( $min, $tax_rates ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $min = $class_min;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return array(&nbsp;</div></li><li><div>      'key' =&gt; '_price', &nbsp;</div></li><li><div>      'value' =&gt; array( $min, $max ), &nbsp;</div></li><li><div>      'compare' =&gt; 'BETWEEN', &nbsp;</div></li><li><div>      'type' =&gt; 'NUMERIC', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get product tax class options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_tax_class_options() {&nbsp;</div></li><li><div>  $tax_classes = WC_Tax::get_tax_classes();&nbsp;</div></li><li><div>  $tax_class_options = array();&nbsp;</div></li><li><div>  $tax_class_options[''] = __( 'Standard', 'woocommerce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $tax_classes ) ) {&nbsp;</div></li><li><div>      foreach ( $tax_classes as $class ) {&nbsp;</div></li><li><div>          $tax_class_options[ sanitize_title( $class ) ] = $class;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $tax_class_options;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get stock status options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_stock_status_options() {&nbsp;</div></li><li><div>  return array(&nbsp;</div></li><li><div>      'instock' =&gt; __( 'In stock', 'woocommerce' ), &nbsp;</div></li><li><div>      'outofstock' =&gt; __( 'Out of stock', 'woocommerce' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get backorder options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_backorder_options() {&nbsp;</div></li><li><div>  return array(&nbsp;</div></li><li><div>      'no' =&gt; __( 'Do not allow', 'woocommerce' ), &nbsp;</div></li><li><div>      'notify' =&gt; __( 'Allow, but notify customer', 'woocommerce' ), &nbsp;</div></li><li><div>      'yes' =&gt; __( 'Allow', 'woocommerce' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get related products based on product category and tags.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int   $product_id  Product ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int   $limit       Limit of results.</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $exclude_ids Exclude IDs from the results.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_related_products( $product_id, $limit = 5, $exclude_ids = array() ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $product_id = absint( $product_id );&nbsp;</div></li><li><div>  $exclude_ids = array_merge( array( 0, $product_id ), $exclude_ids );&nbsp;</div></li><li><div>  $transient_name = 'wc_related_' . $product_id;&nbsp;</div></li><li><div>  $related_posts = get_transient( $transient_name );&nbsp;</div></li><li><div>  $limit = $limit &gt; 0 ? $limit : 5;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// We want to query related posts if they are not cached, or we don't have enough.</span>&nbsp;</div></li><li><div>  if ( false === $related_posts || count( $related_posts ) &lt; $limit ) {&nbsp;</div></li><li><div>      $cats_array = apply_filters( 'woocommerce_product_related_posts_relate_by_category', true, $product_id ) ? apply_filters( 'woocommerce_get_related_product_cat_terms', wc_get_product_term_ids( $product_id, 'product_cat' ), $product_id ) : array();&nbsp;</div></li><li><div>      $tags_array = apply_filters( 'woocommerce_product_related_posts_relate_by_tag', true, $product_id ) ? apply_filters( 'woocommerce_get_related_product_tag_terms', wc_get_product_term_ids( $product_id, 'product_tag' ), $product_id ) : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Don't bother if none are set, unless woocommerce_product_related_posts_force_display is set to true in which case all products are related.</span>&nbsp;</div></li><li><div>      if ( empty( $cats_array ) && empty( $tags_array ) && ! apply_filters( 'woocommerce_product_related_posts_force_display', false, $product_id ) ) {&nbsp;</div></li><li><div>          $related_posts = array();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $data_store = WC_Data_Store::load( 'product' );&nbsp;</div></li><li><div>          $related_posts = $data_store-&gt;get_related_products( $cats_array, $tags_array, $exclude_ids, $limit + 10, $product_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      set_transient( $transient_name, $related_posts, DAY_IN_SECONDS );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  shuffle( $related_posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return array_slice( $related_posts, 0, $limit );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves product term ids for a taxonomy.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int    $product_id Product ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string $taxonomy   Taxonomy slug.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_term_ids( $product_id, $taxonomy ) {&nbsp;</div></li><li><div>  $terms = get_the_terms( $product_id, $taxonomy );&nbsp;</div></li><li><div>  return ! empty( $terms ) ? wp_list_pluck( $terms, 'term_id' ) : array();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * For a given product, and optionally price/qty, work out the price with tax included, based on store settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product $product</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $args</span>&nbsp;</div></li><li><div><span class="comment"> * @return float</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_price_including_tax( $product, $args = array() ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'qty' =&gt; '', &nbsp;</div></li><li><div>      'price' =&gt; '', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $price = '' !== $args['price'] ? max( 0.0, (float) $args['price'] ) : $product-&gt;get_price();&nbsp;</div></li><li><div>  $qty = '' !== $args['qty'] ? max( 0.0, (float) $args['qty'] ) : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' === $price ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  } elseif ( empty( $qty ) ) {&nbsp;</div></li><li><div>      return 0.0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $line_price = $price * $qty;&nbsp;</div></li><li><div>  $return_price = $line_price;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $product-&gt;is_taxable() ) {&nbsp;</div></li><li><div>      if ( ! wc_prices_include_tax() ) {&nbsp;</div></li><li><div>          $tax_rates = WC_Tax::get_rates( $product-&gt;get_tax_class() );&nbsp;</div></li><li><div>          $taxes = WC_Tax::calc_tax( $line_price, $tax_rates, false );&nbsp;</div></li><li><div>          $tax_amount = WC_Tax::get_tax_total( $taxes );&nbsp;</div></li><li><div>          $return_price = round( $line_price + $tax_amount, wc_get_price_decimals() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tax_rates = WC_Tax::get_rates( $product-&gt;get_tax_class() );&nbsp;</div></li><li><div>          $base_tax_rates = WC_Tax::get_base_tax_rates( $product-&gt;get_tax_class( 'unfiltered' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * If the customer is excempt from VAT, remove the taxes here.</span>&nbsp;</div></li><li><div><span class="comment">           * Either remove the base or the user taxes depending on woocommerce_adjust_non_base_location_prices setting.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( ! empty( WC()-&gt;customer ) && WC()-&gt;customer-&gt;get_is_vat_exempt() ) {&nbsp;</div></li><li><div>              $remove_taxes = apply_filters( 'woocommerce_adjust_non_base_location_prices', true ) ? WC_Tax::calc_tax( $line_price, $base_tax_rates, true ) : WC_Tax::calc_tax( $line_price, $tax_rates, true );&nbsp;</div></li><li><div>              $remove_tax = array_sum( $remove_taxes );&nbsp;</div></li><li><div>              $return_price = round( $line_price - $remove_tax, wc_get_price_decimals() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * The woocommerce_adjust_non_base_location_prices filter can stop base taxes being taken off when dealing with out of base locations.</span>&nbsp;</div></li><li><div><span class="comment">           * e.g. If a product costs 10 including tax, all users will pay 10 regardless of location and taxes.</span>&nbsp;</div></li><li><div><span class="comment">           * This feature is experimental @since 2.4.7 and may change in the future. Use at your risk.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          } elseif ( $tax_rates !== $base_tax_rates && apply_filters( 'woocommerce_adjust_non_base_location_prices', true ) ) {&nbsp;</div></li><li><div>              $base_taxes = WC_Tax::calc_tax( $line_price, $base_tax_rates, true );&nbsp;</div></li><li><div>              $modded_taxes = WC_Tax::calc_tax( $line_price - array_sum( $base_taxes ), $tax_rates, false );&nbsp;</div></li><li><div>              $return_price = round( $line_price - array_sum( $base_taxes ) + array_sum( $modded_taxes ), wc_get_price_decimals() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'woocommerce_get_price_including_tax', $return_price, $qty, $product );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * For a given product, and optionally price/qty, work out the price with tax excluded, based on store settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product $product</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $args</span>&nbsp;</div></li><li><div><span class="comment"> * @return float</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_price_excluding_tax( $product, $args = array() ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'qty' =&gt; '', &nbsp;</div></li><li><div>      'price' =&gt; '', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $price = '' !== $args['price'] ? max( 0.0, (float) $args['price'] ) : $product-&gt;get_price();&nbsp;</div></li><li><div>  $qty = '' !== $args['qty'] ? max( 0.0, (float) $args['qty'] ) : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' === $price ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  } elseif ( empty( $qty ) ) {&nbsp;</div></li><li><div>      return 0.0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $product-&gt;is_taxable() && wc_prices_include_tax() ) {&nbsp;</div></li><li><div>      $tax_rates = WC_Tax::get_base_tax_rates( $product-&gt;get_tax_class( 'unfiltered' ) );&nbsp;</div></li><li><div>      $taxes = WC_Tax::calc_tax( $price * $qty, $tax_rates, true );&nbsp;</div></li><li><div>      $price = WC_Tax::round( $price * $qty - array_sum( $taxes ) );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $price = $price * $qty;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'woocommerce_get_price_excluding_tax', $price, $qty, $product );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the price including or excluding tax, based on the 'woocommerce_tax_display_shop' setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product $product</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $args</span>&nbsp;</div></li><li><div><span class="comment"> * @return float</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_price_to_display( $product, $args = array() ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'qty' =&gt; 1, &nbsp;</div></li><li><div>      'price' =&gt; $product-&gt;get_price(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $price = $args['price'];&nbsp;</div></li><li><div>  $qty = $args['qty'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return 'incl' === get_option( 'woocommerce_tax_display_shop' ) ? wc_get_price_including_tax( $product, array( 'qty' =&gt; $qty, 'price' =&gt; $price ) ) : wc_get_price_excluding_tax( $product, array( 'qty' =&gt; $qty, 'price' =&gt; $price ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the product categories in a list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $product_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $sep (default: ', ').</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $before (default: '').</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $after (default: '').</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_category_list( $product_id, $sep = ', ', $before = '', $after = '' ) {&nbsp;</div></li><li><div>  return get_the_term_list( $product_id, 'product_cat', $before, $sep, $after );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the product tags in a list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $product_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $sep (default: ', ').</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $before (default: '').</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $after (default: '').</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_get_product_tag_list( $product_id, $sep = ', ', $before = '', $after = '' ) {&nbsp;</div></li><li><div>  return get_the_term_list( $product_id, 'product_tag', $before, $sep, $after );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback for array filter to get visible only.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product $product</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_filter_visible( $product ) {&nbsp;</div></li><li><div>  return $product && is_a( $product, 'WC_Product' ) && $product-&gt;is_visible();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback for array filter to get products the user can edit only.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product $product</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_filter_editable( $product ) {&nbsp;</div></li><li><div>  return $product && is_a( $product, 'WC_Product' ) && current_user_can( 'edit_product', $product-&gt;get_id() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort an array of products by a value.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $products</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string $orderby</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby( $products, $orderby = 'date', $order = 'desc' ) {&nbsp;</div></li><li><div>  $orderby = strtolower( $orderby );&nbsp;</div></li><li><div>  $order = strtolower( $order );&nbsp;</div></li><li><div>  switch ( $orderby ) {&nbsp;</div></li><li><div>      case 'title' :&nbsp;</div></li><li><div>      case 'id' :&nbsp;</div></li><li><div>      case 'date' :&nbsp;</div></li><li><div>      case 'modified' :&nbsp;</div></li><li><div>      case 'menu_order' :&nbsp;</div></li><li><div>      case 'price' :&nbsp;</div></li><li><div>          usort( $products, 'wc_products_array_orderby_' . $orderby );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          shuffle( $products );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( 'desc' === $order ) {&nbsp;</div></li><li><div>      $products = array_reverse( $products );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $products;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by title.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_title( $a, $b ) {&nbsp;</div></li><li><div>  return strcasecmp( $a-&gt;get_name(), $b-&gt;get_name() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by id.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_id( $a, $b ) {&nbsp;</div></li><li><div>  if ( $a-&gt;get_id() === $b-&gt;get_id() ) {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return ( $a-&gt;get_id() &lt; $b-&gt;get_id() ) ? -1 : 1;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by date.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_date( $a, $b ) {&nbsp;</div></li><li><div>  if ( $a-&gt;get_date_created() === $b-&gt;get_date_created() ) {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return ( $a-&gt;get_date_created() &lt; $b-&gt;get_date_created() ) ? -1 : 1;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by modified.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_modified( $a, $b ) {&nbsp;</div></li><li><div>  if ( $a-&gt;get_date_modified() === $b-&gt;get_date_modified() ) {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return ( $a-&gt;get_date_modified() &lt; $b-&gt;get_date_modified() ) ? -1 : 1;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by menu order.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_menu_order( $a, $b ) {&nbsp;</div></li><li><div>  if ( $a-&gt;get_menu_order() === $b-&gt;get_menu_order() ) {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return ( $a-&gt;get_menu_order() &lt; $b-&gt;get_menu_order() ) ? -1 : 1;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sort by price low to high.</span>&nbsp;</div></li><li><div><span class="comment"> * @since  3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $a</span>&nbsp;</div></li><li><div><span class="comment"> * @param  WC_Product object $b</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_products_array_orderby_price( $a, $b ) {&nbsp;</div></li><li><div>  if ( $a-&gt;get_price() === $b-&gt;get_price() ) {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return ( $a-&gt;get_price() &lt; $b-&gt;get_price() ) ? -1 : 1;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Queue a product for syncing at the end of the request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int $product_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wc_deferred_product_sync( $product_id ) {&nbsp;</div></li><li><div>  global $wc_deferred_product_sync;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $wc_deferred_product_sync ) ) {&nbsp;</div></li><li><div>      $wc_deferred_product_sync = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wc_deferred_product_sync[] = $product_id;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>WooCommerce</li><li><span></span>3.0.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>