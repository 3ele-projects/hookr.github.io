<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.0.4" data-slug="woocommerce" data-type="class" data-id="41394"><head xmlns="http://www.w3.org/1999/xhtml"><title> wc_install | class | Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WC_Install, class, plugin, woocommerce, 3.0.4" /><meta name="description" content="WC_Install Class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b924b37bb6c3e8bc67947fcec4649a27' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wc_install/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_install%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_install%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-3.0.4-class-wc_install","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wc_install" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce." href="http://hookr.io/plugins/woocommerce/" class="plugin"><span property="name">woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.0.4." href="http://hookr.io/plugins/woocommerce/3.0.4/" class="H_VERSION"><span property="name">3.0.4</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce/3.0.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wc_install</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="3115"><a href="http://hookr.io/plugins/woocommerce/3.0.4/all/" title="All">All <span class="count badge">3115</span></a></li><li class="" data-id="new" data-count="2"><a href="http://hookr.io/plugins/woocommerce/3.0.4/new/" title="New">New <span class="count badge">2</span></a></li><li class="" data-id="hooks" data-count="2108"><a href="http://hookr.io/plugins/woocommerce/3.0.4/hooks/" title="Hooks">Hooks <span class="count badge">2108</span></a></li><li class="" data-id="action" data-count="774"><a href="http://hookr.io/plugins/woocommerce/3.0.4/actions/" title="Actions">Actions <span class="count badge">774</span></a></li><li class="" data-id="filter" data-count="1334"><a href="http://hookr.io/plugins/woocommerce/3.0.4/filters/" title="Filters">Filters <span class="count badge">1334</span></a></li><li class="active" data-id="class" data-count="364"><a href="http://hookr.io/plugins/woocommerce/3.0.4/classes/" title="Classes">Classes <span class="count badge">364</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/woocommerce/3.0.4/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="625"><a href="http://hookr.io/plugins/woocommerce/3.0.4/functions/" title="Functions">Functions <span class="count badge">625</span></a></li><li class="" data-id="shortcode" data-count="4"><a href="http://hookr.io/plugins/woocommerce/3.0.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">4</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WC_Install</strong></h1><p>WC_Install Class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce/3.0.4/files/includes-class-wc-install/" class="file">/includes/class-wc-install.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="18" class="block" start="18"><li><div>class WC_Install {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** @var array DB updates and callbacks that need to be run per version */&nbsp;</div></li><li><div>    private static $db_updates = array(&nbsp;</div></li><li><div>        '2.0.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_200_file_paths', &nbsp;</div></li><li><div>            'wc_update_200_permalinks', &nbsp;</div></li><li><div>            'wc_update_200_subcat_display', &nbsp;</div></li><li><div>            'wc_update_200_taxrates', &nbsp;</div></li><li><div>            'wc_update_200_line_items', &nbsp;</div></li><li><div>            'wc_update_200_images', &nbsp;</div></li><li><div>            'wc_update_200_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.0.9' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_209_brazillian_state', &nbsp;</div></li><li><div>            'wc_update_209_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.1.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_210_remove_pages', &nbsp;</div></li><li><div>            'wc_update_210_file_paths', &nbsp;</div></li><li><div>            'wc_update_210_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.2.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_220_shipping', &nbsp;</div></li><li><div>            'wc_update_220_order_status', &nbsp;</div></li><li><div>            'wc_update_220_variations', &nbsp;</div></li><li><div>            'wc_update_220_attributes', &nbsp;</div></li><li><div>            'wc_update_220_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.3.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_230_options', &nbsp;</div></li><li><div>            'wc_update_230_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.4.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_240_options', &nbsp;</div></li><li><div>            'wc_update_240_shipping_methods', &nbsp;</div></li><li><div>            'wc_update_240_api_keys', &nbsp;</div></li><li><div>            'wc_update_240_webhooks', &nbsp;</div></li><li><div>            'wc_update_240_refunds', &nbsp;</div></li><li><div>            'wc_update_240_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.4.1' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_241_variations', &nbsp;</div></li><li><div>            'wc_update_241_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.5.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_250_currency', &nbsp;</div></li><li><div>            'wc_update_250_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '2.6.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_260_options', &nbsp;</div></li><li><div>            'wc_update_260_termmeta', &nbsp;</div></li><li><div>            'wc_update_260_zones', &nbsp;</div></li><li><div>            'wc_update_260_zone_methods', &nbsp;</div></li><li><div>            'wc_update_260_refunds', &nbsp;</div></li><li><div>            'wc_update_260_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        '3.0.0' =&gt; array(&nbsp;</div></li><li><div>            'wc_update_300_webhooks', &nbsp;</div></li><li><div>            'wc_update_300_grouped_products', &nbsp;</div></li><li><div>            'wc_update_300_settings', &nbsp;</div></li><li><div>            'wc_update_300_product_visibility', &nbsp;</div></li><li><div>            'wc_update_300_db_version', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** @var object Background update class */&nbsp;</div></li><li><div>    private static $background_updater;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Hook in tabs.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init() {&nbsp;</div></li><li><div>        add_action( 'init', array( __CLASS__, 'check_version' ), 5 );&nbsp;</div></li><li><div>        add_action( 'init', array( __CLASS__, 'init_background_updater' ), 5 );&nbsp;</div></li><li><div>        add_action( 'admin_init', array( __CLASS__, 'install_actions' ) );&nbsp;</div></li><li><div>        add_action( 'in_plugin_update_message-woocommerce/woocommerce.php', array( __CLASS__, 'in_plugin_update_message' ) );&nbsp;</div></li><li><div>        add_filter( 'plugin_action_links_' . WC_PLUGIN_BASENAME, array( __CLASS__, 'plugin_action_links' ) );&nbsp;</div></li><li><div>        add_filter( 'plugin_row_meta', array( __CLASS__, 'plugin_row_meta' ), 10, 2 );&nbsp;</div></li><li><div>        add_filter( 'wpmu_drop_tables', array( __CLASS__, 'wpmu_drop_tables' ) );&nbsp;</div></li><li><div>        add_filter( 'cron_schedules', array( __CLASS__, 'cron_schedules' ) );&nbsp;</div></li><li><div>        add_action( 'woocommerce_plugin_background_installer', array( __CLASS__, 'background_installer' ), 10, 2 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Init background updates&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init_background_updater() {&nbsp;</div></li><li><div>        include_once( dirname( __FILE__ ) . '/class-wc-background-updater.php' );&nbsp;</div></li><li><div>        self::$background_updater = new WC_Background_Updater();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check WooCommerce version and run the updater is required.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This check is done on all requests and runs if he versions do not match.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function check_version() {&nbsp;</div></li><li><div>        if ( ! defined( 'IFRAME_REQUEST' ) && get_option( 'woocommerce_version' ) !== WC()-&gt;version ) {&nbsp;</div></li><li><div>            self::install();&nbsp;</div></li><li><div>            do_action( 'woocommerce_updated' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Install actions when a update button is clicked within the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function is hooked into admin_init to affect admin only.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function install_actions() {&nbsp;</div></li><li><div>        if ( ! empty( $_GET['do_update_woocommerce'] ) ) {&nbsp;</div></li><li><div>            self::update();&nbsp;</div></li><li><div>            WC_Admin_Notices::add_notice( 'update' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $_GET['force_update_woocommerce'] ) ) {&nbsp;</div></li><li><div>            do_action( 'wp_wc_updater_cron' );&nbsp;</div></li><li><div>            wp_safe_redirect( admin_url( 'admin.php?page=wc-settings' ) );&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Install WC.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function install() {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_blog_installed() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! defined( 'WC_INSTALLING' ) ) {&nbsp;</div></li><li><div>            define( 'WC_INSTALLING', true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Ensure needed classes are loaded&nbsp;</div></li><li><div>        include_once( dirname( __FILE__ ) . '/admin/class-wc-admin-notices.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::create_options();&nbsp;</div></li><li><div>        self::create_tables();&nbsp;</div></li><li><div>        self::create_roles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Register post types&nbsp;</div></li><li><div>        WC_Post_types::register_post_types();&nbsp;</div></li><li><div>        WC_Post_types::register_taxonomies();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Also register endpoints - this needs to be done prior to rewrite rule flush&nbsp;</div></li><li><div>        WC()-&gt;query-&gt;init_query_vars();&nbsp;</div></li><li><div>        WC()-&gt;query-&gt;add_endpoints();&nbsp;</div></li><li><div>        WC_API::add_endpoint();&nbsp;</div></li><li><div>        WC_Auth::add_endpoint();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::create_terms();&nbsp;</div></li><li><div>        self::create_cron_jobs();&nbsp;</div></li><li><div>        self::create_files();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Queue upgrades/setup wizard&nbsp;</div></li><li><div>        $current_wc_version = get_option( 'woocommerce_version', null );&nbsp;</div></li><li><div>        $current_db_version = get_option( 'woocommerce_db_version', null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        WC_Admin_Notices::remove_all_notices();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // No versions? This is a new install :)&nbsp;</div></li><li><div>        if ( is_null( $current_wc_version ) && is_null( $current_db_version ) && apply_filters( 'woocommerce_enable_setup_wizard', true ) ) {&nbsp;</div></li><li><div>            WC_Admin_Notices::add_notice( 'install' );&nbsp;</div></li><li><div>            set_transient( '_wc_activation_redirect', 1, 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // No page? Let user run wizard again..&nbsp;</div></li><li><div>        } elseif ( ! get_option( 'woocommerce_cart_page_id' ) ) {&nbsp;</div></li><li><div>            WC_Admin_Notices::add_notice( 'install' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_null( $current_db_version ) && version_compare( $current_db_version, max( array_keys( self::$db_updates ) ), '&lt;' ) ) {&nbsp;</div></li><li><div>            WC_Admin_Notices::add_notice( 'update' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            self::update_db_version();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::update_wc_version();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Flush rules after install&nbsp;</div></li><li><div>        do_action( 'woocommerce_flush_rewrite_rules' );&nbsp;</div></li><li><div>        delete_transient( 'wc_attribute_taxonomies' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Deletes all expired transients. The multi-table delete syntax is used&nbsp;</div></li><li><div>         * to delete the transient record from table a, and the corresponding&nbsp;</div></li><li><div>         * transient_timeout record from table b.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Based on code inside core's upgrade_network() function.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $sql = &quot;DELETE a, b FROM $wpdb-&gt;options a, $wpdb-&gt;options b&nbsp;</div></li><li><div>            WHERE a.option_name LIKE %s&nbsp;</div></li><li><div>            AND a.option_name NOT LIKE %s&nbsp;</div></li><li><div>            AND b.option_name = CONCAT( '_transient_timeout_', SUBSTRING( a.option_name, 12 ) )&nbsp;</div></li><li><div>            AND b.option_value &lt; %d&quot;;&nbsp;</div></li><li><div>        $wpdb-&gt;query( $wpdb-&gt;prepare( $sql, $wpdb-&gt;esc_like( '_transient_' ) . '%', $wpdb-&gt;esc_like( '_transient_timeout_' ) . '%', time() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Trigger action&nbsp;</div></li><li><div>        do_action( 'woocommerce_installed' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update WC version to current.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function update_wc_version() {&nbsp;</div></li><li><div>        delete_option( 'woocommerce_version' );&nbsp;</div></li><li><div>        add_option( 'woocommerce_version', WC()-&gt;version );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get list of DB update callbacks.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  3.0.0&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_db_update_callbacks() {&nbsp;</div></li><li><div>        return self::$db_updates;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Push all needed DB updates to the queue for processing.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function update() {&nbsp;</div></li><li><div>        $current_db_version = get_option( 'woocommerce_db_version' );&nbsp;</div></li><li><div>        $logger = wc_get_logger();&nbsp;</div></li><li><div>        $update_queued = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( self::get_db_update_callbacks() as $version =&gt; $update_callbacks ) {&nbsp;</div></li><li><div>            if ( version_compare( $current_db_version, $version, '&lt;' ) ) {&nbsp;</div></li><li><div>                foreach ( $update_callbacks as $update_callback ) {&nbsp;</div></li><li><div>                    $logger-&gt;info(&nbsp;</div></li><li><div>                        sprintf( 'Queuing %s - %s', $version, $update_callback ), &nbsp;</div></li><li><div>                        array( 'source' =&gt; 'wc_db_updates' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    self::$background_updater-&gt;push_to_queue( $update_callback );&nbsp;</div></li><li><div>                    $update_queued = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $update_queued ) {&nbsp;</div></li><li><div>            self::$background_updater-&gt;save()-&gt;dispatch();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update DB version to current.&nbsp;</div></li><li><div>     * @param string $version&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_db_version( $version = null ) {&nbsp;</div></li><li><div>        delete_option( 'woocommerce_db_version' );&nbsp;</div></li><li><div>        add_option( 'woocommerce_db_version', is_null( $version ) ? WC()-&gt;version : $version );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add more cron schedules.&nbsp;</div></li><li><div>     * @param  array $schedules&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function cron_schedules( $schedules ) {&nbsp;</div></li><li><div>        $schedules['monthly'] = array(&nbsp;</div></li><li><div>            'interval' =&gt; 2635200, &nbsp;</div></li><li><div>            'display' =&gt; __( 'Monthly', 'woocommerce' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return $schedules;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create cron jobs (clear them first).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function create_cron_jobs() {&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_scheduled_sales' );&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_cancel_unpaid_orders' );&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_cleanup_sessions' );&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_geoip_updater' );&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_tracker_send_event' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ve = get_option( 'gmt_offset' ) &gt; 0 ? '-' : '+';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_schedule_event( strtotime( '00:00 tomorrow ' . $ve . get_option( 'gmt_offset' ) . ' HOURS' ), 'daily', 'woocommerce_scheduled_sales' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $held_duration = get_option( 'woocommerce_hold_stock_minutes', '60' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( '' != $held_duration ) {&nbsp;</div></li><li><div>            wp_schedule_single_event( time() + ( absint( $held_duration ) * 60 ), 'woocommerce_cancel_unpaid_orders' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_schedule_event( time(), 'twicedaily', 'woocommerce_cleanup_sessions' );&nbsp;</div></li><li><div>        wp_schedule_event( strtotime( 'first tuesday of next month' ), 'monthly', 'woocommerce_geoip_updater' );&nbsp;</div></li><li><div>        wp_schedule_event( time(), apply_filters( 'woocommerce_tracker_event_recurrence', 'daily' ), 'woocommerce_tracker_send_event' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create pages that the plugin relies on, storing page IDs in variables.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function create_pages() {&nbsp;</div></li><li><div>        include_once( dirname( __FILE__ ) . '/admin/wc-admin-functions.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pages = apply_filters( 'woocommerce_create_pages', array(&nbsp;</div></li><li><div>            'shop' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; _x( 'shop', 'Page slug', 'woocommerce' ), &nbsp;</div></li><li><div>                'title' =&gt; _x( 'Shop', 'Page title', 'woocommerce' ), &nbsp;</div></li><li><div>                'content' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'cart' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; _x( 'cart', 'Page slug', 'woocommerce' ), &nbsp;</div></li><li><div>                'title' =&gt; _x( 'Cart', 'Page title', 'woocommerce' ), &nbsp;</div></li><li><div>                'content' =&gt; '[' . apply_filters( 'woocommerce_cart_shortcode_tag', 'woocommerce_cart' ) . ']', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'checkout' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; _x( 'checkout', 'Page slug', 'woocommerce' ), &nbsp;</div></li><li><div>                'title' =&gt; _x( 'Checkout', 'Page title', 'woocommerce' ), &nbsp;</div></li><li><div>                'content' =&gt; '[' . apply_filters( 'woocommerce_checkout_shortcode_tag', 'woocommerce_checkout' ) . ']', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'myaccount' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; _x( 'my-account', 'Page slug', 'woocommerce' ), &nbsp;</div></li><li><div>                'title' =&gt; _x( 'My account', 'Page title', 'woocommerce' ), &nbsp;</div></li><li><div>                'content' =&gt; '[' . apply_filters( 'woocommerce_my_account_shortcode_tag', 'woocommerce_my_account' ) . ']', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $pages as $key =&gt; $page ) {&nbsp;</div></li><li><div>            wc_create_page( esc_sql( $page['name'] ), 'woocommerce_' . $key . '_page_id', $page['title'], $page['content'], ! empty( $page['parent'] ) ? wc_get_page_id( $page['parent'] ) : '' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        delete_transient( 'woocommerce_cache_excluded_uris' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Default options.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Sets up the default options used on the settings page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function create_options() {&nbsp;</div></li><li><div>        // Include settings so that we can run through defaults&nbsp;</div></li><li><div>        include_once( dirname( __FILE__ ) . '/admin/class-wc-admin-settings.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $settings = WC_Admin_Settings::get_settings_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $settings as $section ) {&nbsp;</div></li><li><div>            if ( ! method_exists( $section, 'get_settings' ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $subsections = array_unique( array_merge( array( '' ), array_keys( $section-&gt;get_sections() ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $subsections as $subsection ) {&nbsp;</div></li><li><div>                foreach ( $section-&gt;get_settings( $subsection ) as $value ) {&nbsp;</div></li><li><div>                    if ( isset( $value['default'] ) && isset( $value['id'] ) ) {&nbsp;</div></li><li><div>                        $autoload = isset( $value['autoload'] ) ? (bool) $value['autoload'] : true;&nbsp;</div></li><li><div>                        add_option( $value['id'], $value['default'], '', ( $autoload ? 'yes' : 'no' ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add the default terms for WC taxonomies - product types and order statuses. Modify this at your own risk.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function create_terms() {&nbsp;</div></li><li><div>        $taxonomies = array(&nbsp;</div></li><li><div>            'product_type' =&gt; array(&nbsp;</div></li><li><div>                'simple', &nbsp;</div></li><li><div>                'grouped', &nbsp;</div></li><li><div>                'variable', &nbsp;</div></li><li><div>                'external', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'product_visibility' =&gt; array(&nbsp;</div></li><li><div>                'exclude-from-search', &nbsp;</div></li><li><div>                'exclude-from-catalog', &nbsp;</div></li><li><div>                'featured', &nbsp;</div></li><li><div>                'outofstock', &nbsp;</div></li><li><div>                'rated-1', &nbsp;</div></li><li><div>                'rated-2', &nbsp;</div></li><li><div>                'rated-3', &nbsp;</div></li><li><div>                'rated-4', &nbsp;</div></li><li><div>                'rated-5', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $taxonomies as $taxonomy =&gt; $terms ) {&nbsp;</div></li><li><div>            foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                if ( ! get_term_by( 'name', $term, $taxonomy ) ) {&nbsp;</div></li><li><div>                    wp_insert_term( $term, $taxonomy );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set up the database tables which the plugin needs to function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Tables:&nbsp;</div></li><li><div>     *        woocommerce_attribute_taxonomies - Table for storing attribute taxonomies - these are user defined&nbsp;</div></li><li><div>     *        woocommerce_termmeta - Term meta table - sadly WordPress does not have termmeta so we need our own&nbsp;</div></li><li><div>     *        woocommerce_downloadable_product_permissions - Table for storing user and guest download permissions.&nbsp;</div></li><li><div>     *            KEY(order_id, product_id, download_id) used for organizing downloads on the My Account page&nbsp;</div></li><li><div>     *        woocommerce_order_items - Order line items are stored in a table to make them easily queryable for reports&nbsp;</div></li><li><div>     *        woocommerce_order_itemmeta - Order line item meta is stored in a table for storing extra data.&nbsp;</div></li><li><div>     *        woocommerce_tax_rates - Tax Rates are stored inside 2 tables making tax queries simple and efficient.&nbsp;</div></li><li><div>     *        woocommerce_tax_rate_locations - Each rate can be applied to more than one postcode/city hence the second table.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function create_tables() {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wpdb-&gt;hide_errors();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Before updating with DBDELTA, remove any primary keys which could be&nbsp;</div></li><li><div>         * modified due to schema updates.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE '{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions';&quot; ) ) {&nbsp;</div></li><li><div>            if ( ! $wpdb-&gt;get_var( &quot;SHOW COLUMNS FROM `{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions` LIKE 'permission_id';&quot; ) ) {&nbsp;</div></li><li><div>                $wpdb-&gt;query( &quot;ALTER TABLE {$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions DROP PRIMARY KEY, ADD `permission_id` BIGINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT;&quot; );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        dbDelta( self::get_schema() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $index_exists = $wpdb-&gt;get_row( &quot;SHOW INDEX FROM {$wpdb-&gt;comments} WHERE column_name = 'comment_type' and key_name = 'woo_idx_comment_type'&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_null( $index_exists ) ) {&nbsp;</div></li><li><div>            // Add an index to the field comment_type to improve the response time of the query&nbsp;</div></li><li><div>            // used by WC_Comments::wp_count_comments() to get the number of comments by type.&nbsp;</div></li><li><div>            $wpdb-&gt;query( &quot;ALTER TABLE {$wpdb-&gt;comments} ADD INDEX woo_idx_comment_type (comment_type)&quot; );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get Table schema.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * https://github.com/woocommerce/woocommerce/wiki/Database-Description/&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * A note on indexes; Indexes have a maximum size of 767 bytes. Historically, we haven't need to be concerned about that.&nbsp;</div></li><li><div>     * As of WordPress 4.2, however, we moved to utf8mb4, which uses 4 bytes per character. This means that an index which&nbsp;</div></li><li><div>     * used to have room for floor(767/3) = 255 characters, now only has room for floor(767/4) = 191 characters.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Changing indexes may cause duplicate index notices in logs due to https://core.trac.wordpress.org/ticket/34870 but dropping&nbsp;</div></li><li><div>     * indexes first causes too much load on some servers/larger DB.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function get_schema() {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $collate = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $wpdb-&gt;has_cap( 'collation' ) ) {&nbsp;</div></li><li><div>            $collate = $wpdb-&gt;get_charset_collate();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tables = &quot;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_sessions (&nbsp;</div></li><li><div>  session_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT, &nbsp;</div></li><li><div>  session_key char(32) NOT NULL, &nbsp;</div></li><li><div>  session_value longtext NOT NULL, &nbsp;</div></li><li><div>  session_expiry BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (session_key), &nbsp;</div></li><li><div>  UNIQUE KEY session_id (session_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_api_keys (&nbsp;</div></li><li><div>  key_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  user_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  description varchar(200) NULL, &nbsp;</div></li><li><div>  permissions varchar(10) NOT NULL, &nbsp;</div></li><li><div>  consumer_key char(64) NOT NULL, &nbsp;</div></li><li><div>  consumer_secret char(43) NOT NULL, &nbsp;</div></li><li><div>  nonces longtext NULL, &nbsp;</div></li><li><div>  truncated_key char(7) NOT NULL, &nbsp;</div></li><li><div>  last_access datetime NULL default null, &nbsp;</div></li><li><div>  PRIMARY KEY  (key_id), &nbsp;</div></li><li><div>  KEY consumer_key (consumer_key), &nbsp;</div></li><li><div>  KEY consumer_secret (consumer_secret)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_attribute_taxonomies (&nbsp;</div></li><li><div>  attribute_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  attribute_name varchar(200) NOT NULL, &nbsp;</div></li><li><div>  attribute_label varchar(200) NULL, &nbsp;</div></li><li><div>  attribute_type varchar(20) NOT NULL, &nbsp;</div></li><li><div>  attribute_orderby varchar(20) NOT NULL, &nbsp;</div></li><li><div>  attribute_public int(1) NOT NULL DEFAULT 1, &nbsp;</div></li><li><div>  PRIMARY KEY  (attribute_id), &nbsp;</div></li><li><div>  KEY attribute_name (attribute_name(20))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions (&nbsp;</div></li><li><div>  permission_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  download_id varchar(32) NOT NULL, &nbsp;</div></li><li><div>  product_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  order_id BIGINT UNSIGNED NOT NULL DEFAULT 0, &nbsp;</div></li><li><div>  order_key varchar(200) NOT NULL, &nbsp;</div></li><li><div>  user_email varchar(200) NOT NULL, &nbsp;</div></li><li><div>  user_id BIGINT UNSIGNED NULL, &nbsp;</div></li><li><div>  downloads_remaining varchar(9) NULL, &nbsp;</div></li><li><div>  access_granted datetime NOT NULL default '0000-00-00 00:00:00', &nbsp;</div></li><li><div>  access_expires datetime NULL default null, &nbsp;</div></li><li><div>  download_count BIGINT UNSIGNED NOT NULL DEFAULT 0, &nbsp;</div></li><li><div>  PRIMARY KEY  (permission_id), &nbsp;</div></li><li><div>  KEY download_order_key_product (product_id, order_id, order_key(16), download_id), &nbsp;</div></li><li><div>  KEY download_order_product (download_id, order_id, product_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_order_items (&nbsp;</div></li><li><div>  order_item_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  order_item_name TEXT NOT NULL, &nbsp;</div></li><li><div>  order_item_type varchar(200) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  order_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (order_item_id), &nbsp;</div></li><li><div>  KEY order_id (order_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_order_itemmeta (&nbsp;</div></li><li><div>  meta_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  order_item_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  meta_key varchar(255) default NULL, &nbsp;</div></li><li><div>  meta_value longtext NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (meta_id), &nbsp;</div></li><li><div>  KEY order_item_id (order_item_id), &nbsp;</div></li><li><div>  KEY meta_key (meta_key(32))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_tax_rates (&nbsp;</div></li><li><div>  tax_rate_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  tax_rate_country varchar(2) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  tax_rate_state varchar(200) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  tax_rate varchar(8) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  tax_rate_name varchar(200) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  tax_rate_priority BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  tax_rate_compound int(1) NOT NULL DEFAULT 0, &nbsp;</div></li><li><div>  tax_rate_shipping int(1) NOT NULL DEFAULT 1, &nbsp;</div></li><li><div>  tax_rate_order BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  tax_rate_class varchar(200) NOT NULL DEFAULT '', &nbsp;</div></li><li><div>  PRIMARY KEY  (tax_rate_id), &nbsp;</div></li><li><div>  KEY tax_rate_country (tax_rate_country), &nbsp;</div></li><li><div>  KEY tax_rate_state (tax_rate_state(2)), &nbsp;</div></li><li><div>  KEY tax_rate_class (tax_rate_class(10)), &nbsp;</div></li><li><div>  KEY tax_rate_priority (tax_rate_priority)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_tax_rate_locations (&nbsp;</div></li><li><div>  location_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  location_code varchar(200) NOT NULL, &nbsp;</div></li><li><div>  tax_rate_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  location_type varchar(40) NOT NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (location_id), &nbsp;</div></li><li><div>  KEY tax_rate_id (tax_rate_id), &nbsp;</div></li><li><div>  KEY location_type_code (location_type(10), location_code(20))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zones (&nbsp;</div></li><li><div>  zone_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  zone_name varchar(200) NOT NULL, &nbsp;</div></li><li><div>  zone_order BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (zone_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zone_locations (&nbsp;</div></li><li><div>  location_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  zone_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  location_code varchar(200) NOT NULL, &nbsp;</div></li><li><div>  location_type varchar(40) NOT NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (location_id), &nbsp;</div></li><li><div>  KEY location_id (location_id), &nbsp;</div></li><li><div>  KEY location_type_code (location_type(10), location_code(20))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zone_methods (&nbsp;</div></li><li><div>  zone_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  instance_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  method_id varchar(200) NOT NULL, &nbsp;</div></li><li><div>  method_order BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  is_enabled tinyint(1) NOT NULL DEFAULT '1', &nbsp;</div></li><li><div>  PRIMARY KEY  (instance_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_payment_tokens (&nbsp;</div></li><li><div>  token_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  gateway_id varchar(200) NOT NULL, &nbsp;</div></li><li><div>  token text NOT NULL, &nbsp;</div></li><li><div>  user_id BIGINT UNSIGNED NOT NULL DEFAULT '0', &nbsp;</div></li><li><div>  type varchar(200) NOT NULL, &nbsp;</div></li><li><div>  is_default tinyint(1) NOT NULL DEFAULT '0', &nbsp;</div></li><li><div>  PRIMARY KEY  (token_id), &nbsp;</div></li><li><div>  KEY user_id (user_id)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_payment_tokenmeta (&nbsp;</div></li><li><div>  meta_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  payment_token_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  meta_key varchar(255) NULL, &nbsp;</div></li><li><div>  meta_value longtext NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (meta_id), &nbsp;</div></li><li><div>  KEY payment_token_id (payment_token_id), &nbsp;</div></li><li><div>  KEY meta_key (meta_key(32))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_log (&nbsp;</div></li><li><div>  log_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT, &nbsp;</div></li><li><div>  timestamp datetime NOT NULL, &nbsp;</div></li><li><div>  level smallint(4) NOT NULL, &nbsp;</div></li><li><div>  source varchar(200) NOT NULL, &nbsp;</div></li><li><div>  message longtext NOT NULL, &nbsp;</div></li><li><div>  context longtext NULL, &nbsp;</div></li><li><div>  PRIMARY KEY (log_id), &nbsp;</div></li><li><div>  KEY level (level)&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>        &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Term meta is only needed for old installs and is now @deprecated by WordPress term meta.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ! function_exists( 'get_term_meta' ) ) {&nbsp;</div></li><li><div>            $tables .= &quot;&nbsp;</div></li><li><div>CREATE TABLE {$wpdb-&gt;prefix}woocommerce_termmeta (&nbsp;</div></li><li><div>  meta_id BIGINT UNSIGNED NOT NULL auto_increment, &nbsp;</div></li><li><div>  woocommerce_term_id BIGINT UNSIGNED NOT NULL, &nbsp;</div></li><li><div>  meta_key varchar(255) default NULL, &nbsp;</div></li><li><div>  meta_value longtext NULL, &nbsp;</div></li><li><div>  PRIMARY KEY  (meta_id), &nbsp;</div></li><li><div>  KEY woocommerce_term_id (woocommerce_term_id), &nbsp;</div></li><li><div>  KEY meta_key (meta_key(32))&nbsp;</div></li><li><div>) $collate;&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $tables;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create roles and capabilities.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function create_roles() {&nbsp;</div></li><li><div>        global $wp_roles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! class_exists( 'WP_Roles' ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $wp_roles ) ) {&nbsp;</div></li><li><div>            $wp_roles = new WP_Roles();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Customer role&nbsp;</div></li><li><div>        add_role( 'customer', __( 'Customer', 'woocommerce' ), array(&nbsp;</div></li><li><div>            'read' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Shop manager role&nbsp;</div></li><li><div>        add_role( 'shop_manager', __( 'Shop manager', 'woocommerce' ), array(&nbsp;</div></li><li><div>            'level_9' =&gt; true, &nbsp;</div></li><li><div>            'level_8' =&gt; true, &nbsp;</div></li><li><div>            'level_7' =&gt; true, &nbsp;</div></li><li><div>            'level_6' =&gt; true, &nbsp;</div></li><li><div>            'level_5' =&gt; true, &nbsp;</div></li><li><div>            'level_4' =&gt; true, &nbsp;</div></li><li><div>            'level_3' =&gt; true, &nbsp;</div></li><li><div>            'level_2' =&gt; true, &nbsp;</div></li><li><div>            'level_1' =&gt; true, &nbsp;</div></li><li><div>            'level_0' =&gt; true, &nbsp;</div></li><li><div>            'read' =&gt; true, &nbsp;</div></li><li><div>            'read_private_pages' =&gt; true, &nbsp;</div></li><li><div>            'read_private_posts' =&gt; true, &nbsp;</div></li><li><div>            'edit_users' =&gt; true, &nbsp;</div></li><li><div>            'edit_posts' =&gt; true, &nbsp;</div></li><li><div>            'edit_pages' =&gt; true, &nbsp;</div></li><li><div>            'edit_published_posts' =&gt; true, &nbsp;</div></li><li><div>            'edit_published_pages' =&gt; true, &nbsp;</div></li><li><div>            'edit_private_pages' =&gt; true, &nbsp;</div></li><li><div>            'edit_private_posts' =&gt; true, &nbsp;</div></li><li><div>            'edit_others_posts' =&gt; true, &nbsp;</div></li><li><div>            'edit_others_pages' =&gt; true, &nbsp;</div></li><li><div>            'publish_posts' =&gt; true, &nbsp;</div></li><li><div>            'publish_pages' =&gt; true, &nbsp;</div></li><li><div>            'delete_posts' =&gt; true, &nbsp;</div></li><li><div>            'delete_pages' =&gt; true, &nbsp;</div></li><li><div>            'delete_private_pages' =&gt; true, &nbsp;</div></li><li><div>            'delete_private_posts' =&gt; true, &nbsp;</div></li><li><div>            'delete_published_pages' =&gt; true, &nbsp;</div></li><li><div>            'delete_published_posts' =&gt; true, &nbsp;</div></li><li><div>            'delete_others_posts' =&gt; true, &nbsp;</div></li><li><div>            'delete_others_pages' =&gt; true, &nbsp;</div></li><li><div>            'manage_categories' =&gt; true, &nbsp;</div></li><li><div>            'manage_links' =&gt; true, &nbsp;</div></li><li><div>            'moderate_comments' =&gt; true, &nbsp;</div></li><li><div>            'unfiltered_html' =&gt; true, &nbsp;</div></li><li><div>            'upload_files' =&gt; true, &nbsp;</div></li><li><div>            'export' =&gt; true, &nbsp;</div></li><li><div>            'import' =&gt; true, &nbsp;</div></li><li><div>            'list_users' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $capabilities = self::get_core_capabilities();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $capabilities as $cap_group ) {&nbsp;</div></li><li><div>            foreach ( $cap_group as $cap ) {&nbsp;</div></li><li><div>                $wp_roles-&gt;add_cap( 'shop_manager', $cap );&nbsp;</div></li><li><div>                $wp_roles-&gt;add_cap( 'administrator', $cap );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get capabilities for WooCommerce - these are assigned to admin/shop manager during installation or reset.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     private static function get_core_capabilities() {&nbsp;</div></li><li><div>        $capabilities = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $capabilities['core'] = array(&nbsp;</div></li><li><div>            'manage_woocommerce', &nbsp;</div></li><li><div>            'view_woocommerce_reports', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $capability_types = array( 'product', 'shop_order', 'shop_coupon', 'shop_webhook' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $capability_types as $capability_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $capabilities[ $capability_type ] = array(&nbsp;</div></li><li><div>                // Post type&nbsp;</div></li><li><div>                &quot;edit_{$capability_type}&quot;, &nbsp;</div></li><li><div>                &quot;read_{$capability_type}&quot;, &nbsp;</div></li><li><div>                &quot;delete_{$capability_type}&quot;, &nbsp;</div></li><li><div>                &quot;edit_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;edit_others_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;publish_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;read_private_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;delete_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;delete_private_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;delete_published_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;delete_others_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;edit_private_{$capability_type}s&quot;, &nbsp;</div></li><li><div>                &quot;edit_published_{$capability_type}s&quot;, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Terms&nbsp;</div></li><li><div>                &quot;manage_{$capability_type}_terms&quot;, &nbsp;</div></li><li><div>                &quot;edit_{$capability_type}_terms&quot;, &nbsp;</div></li><li><div>                &quot;delete_{$capability_type}_terms&quot;, &nbsp;</div></li><li><div>                &quot;assign_{$capability_type}_terms&quot;, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $capabilities;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * woocommerce_remove_roles function.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function remove_roles() {&nbsp;</div></li><li><div>        global $wp_roles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! class_exists( 'WP_Roles' ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $wp_roles ) ) {&nbsp;</div></li><li><div>            $wp_roles = new WP_Roles();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $capabilities = self::get_core_capabilities();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $capabilities as $cap_group ) {&nbsp;</div></li><li><div>            foreach ( $cap_group as $cap ) {&nbsp;</div></li><li><div>                $wp_roles-&gt;remove_cap( 'shop_manager', $cap );&nbsp;</div></li><li><div>                $wp_roles-&gt;remove_cap( 'administrator', $cap );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        remove_role( 'customer' );&nbsp;</div></li><li><div>        remove_role( 'shop_manager' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create files/directories.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function create_files() {&nbsp;</div></li><li><div>        // Install files and folders for uploading files and prevent hotlinking&nbsp;</div></li><li><div>        $upload_dir = wp_upload_dir();&nbsp;</div></li><li><div>        $download_method = get_option( 'woocommerce_file_download_method', 'force' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $files = array(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'base' =&gt; $upload_dir['basedir'] . '/woocommerce_uploads', &nbsp;</div></li><li><div>                'file' =&gt; 'index.html', &nbsp;</div></li><li><div>                'content' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'base' =&gt; WC_LOG_DIR, &nbsp;</div></li><li><div>                'file' =&gt; '.htaccess', &nbsp;</div></li><li><div>                'content' =&gt; 'deny from all', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'base' =&gt; WC_LOG_DIR, &nbsp;</div></li><li><div>                'file' =&gt; 'index.html', &nbsp;</div></li><li><div>                'content' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'redirect' !== $download_method ) {&nbsp;</div></li><li><div>            $files[] = array(&nbsp;</div></li><li><div>                'base' =&gt; $upload_dir['basedir'] . '/woocommerce_uploads', &nbsp;</div></li><li><div>                'file' =&gt; '.htaccess', &nbsp;</div></li><li><div>                'content' =&gt; 'deny from all', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $files as $file ) {&nbsp;</div></li><li><div>            if ( wp_mkdir_p( $file['base'] ) && ! file_exists( trailingslashit( $file['base'] ) . $file['file'] ) ) {&nbsp;</div></li><li><div>                if ( $file_handle = @fopen( trailingslashit( $file['base'] ) . $file['file'], 'w' ) ) {&nbsp;</div></li><li><div>                    fwrite( $file_handle, $file['content'] );&nbsp;</div></li><li><div>                    fclose( $file_handle );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Show plugin changes. Code adapted from W3 Total Cache.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function in_plugin_update_message( $args ) {&nbsp;</div></li><li><div>        $transient_name = 'wc_upgrade_notice_' . $args['Version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === ( $upgrade_notice = get_transient( $transient_name ) ) ) {&nbsp;</div></li><li><div>            $response = wp_safe_remote_get( 'https://plugins.svn.wordpress.org/woocommerce/trunk/readme.txt' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! is_wp_error( $response ) && ! empty( $response['body'] ) ) {&nbsp;</div></li><li><div>                $upgrade_notice = self::parse_update_notice( $response['body'], $args['new_version'] );&nbsp;</div></li><li><div>                set_transient( $transient_name, $upgrade_notice, DAY_IN_SECONDS );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo wp_kses_post( $upgrade_notice );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parse update notice from readme file.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $content&nbsp;</div></li><li><div>     * @param  string $new_version&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function parse_update_notice( $content, $new_version ) {&nbsp;</div></li><li><div>        // Output Upgrade Notice.&nbsp;</div></li><li><div>        $matches = null;&nbsp;</div></li><li><div>        $regexp = '~==\s*Upgrade Notice\s*==\s*=\s*(.*)\s*=(.*)(=\s*' . preg_quote( WC_VERSION ) . '\s*=|$)~Uis';&nbsp;</div></li><li><div>        $upgrade_notice = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( preg_match( $regexp, $content, $matches ) ) {&nbsp;</div></li><li><div>            $notices = (array) preg_split( '~[\r\n]+~', trim( $matches[2] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Convert the full version strings to minor versions.&nbsp;</div></li><li><div>            $notice_version_parts = explode( '.', trim( $matches[1] ) );&nbsp;</div></li><li><div>            $current_version_parts = explode( '.', WC_VERSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 3 !== sizeof( $notice_version_parts ) ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notice_version = $notice_version_parts[0] . '.' . $notice_version_parts[1];&nbsp;</div></li><li><div>            $current_version = $current_version_parts[0] . '.' . $current_version_parts[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check the latest stable version and ignore trunk.&nbsp;</div></li><li><div>            if ( version_compare( $current_version, $notice_version, '&lt;' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $upgrade_notice .= '&lt;/p&gt;&lt;p class=&quot;wc_plugin_upgrade_notice&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $notices as $index =&gt; $line ) {&nbsp;</div></li><li><div>                    $upgrade_notice .= preg_replace( '~\[([^\]]*)\]\(([^\)]*)\)~', '&lt;a href=&quot;${2}&quot;&gt;${1}&lt;/a&gt;', $line );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return wp_kses_post( $upgrade_notice );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Show action links on the plugin screen.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    mixed $links Plugin Action links&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function plugin_action_links( $links ) {&nbsp;</div></li><li><div>        $action_links = array(&nbsp;</div></li><li><div>            'settings' =&gt; '&lt;a href=&quot;' . admin_url( 'admin.php?page=wc-settings' ) . '&quot; aria-label=&quot;' . esc_attr__( 'View WooCommerce settings', 'woocommerce' ) . '&quot;&gt;' . esc_html__( 'Settings', 'woocommerce' ) . '&lt;/a&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_merge( $action_links, $links );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Show row meta on the plugin screen.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    mixed $links Plugin Row Meta&nbsp;</div></li><li><div>     * @param    mixed $file  Plugin Base file&nbsp;</div></li><li><div>     * @return    array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function plugin_row_meta( $links, $file ) {&nbsp;</div></li><li><div>        if ( WC_PLUGIN_BASENAME == $file ) {&nbsp;</div></li><li><div>            $row_meta = array(&nbsp;</div></li><li><div>                'docs' =&gt; '&lt;a href=&quot;' . esc_url( apply_filters( 'woocommerce_docs_url', 'https://docs.woocommerce.com/documentation/plugins/woocommerce/' ) ) . '&quot; aria-label=&quot;' . esc_attr__( 'View WooCommerce documentation', 'woocommerce' ) . '&quot;&gt;' . esc_html__( 'Docs', 'woocommerce' ) . '&lt;/a&gt;', &nbsp;</div></li><li><div>                'apidocs' =&gt; '&lt;a href=&quot;' . esc_url( apply_filters( 'woocommerce_apidocs_url', 'https://docs.woocommerce.com/wc-apidocs/' ) ) . '&quot; aria-label=&quot;' . esc_attr__( 'View WooCommerce API docs', 'woocommerce' ) . '&quot;&gt;' . esc_html__( 'API docs', 'woocommerce' ) . '&lt;/a&gt;', &nbsp;</div></li><li><div>                'support' =&gt; '&lt;a href=&quot;' . esc_url( apply_filters( 'woocommerce_support_url', 'https://woocommerce.com/my-account/tickets/' ) ) . '&quot; aria-label=&quot;' . esc_attr__( 'Visit premium customer support', 'woocommerce' ) . '&quot;&gt;' . esc_html__( 'Premium support', 'woocommerce' ) . '&lt;/a&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return array_merge( $links, $row_meta );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (array) $links;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Uninstall tables when MU blog is deleted.&nbsp;</div></li><li><div>     * @param  array $tables&nbsp;</div></li><li><div>     * @return string[]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function wpmu_drop_tables( $tables ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_sessions';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_api_keys';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_attribute_taxonomies';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_downloadable_product_permissions';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_termmeta';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_tax_rates';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_tax_rate_locations';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_order_items';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_order_itemmeta';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_payment_tokens';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_shipping_zones';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_shipping_zone_locations';&nbsp;</div></li><li><div>        $tables[] = $wpdb-&gt;prefix . 'woocommerce_shipping_zone_methods';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $tables;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get slug from path&nbsp;</div></li><li><div>     * @param  string $key&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function format_plugin_slug( $key ) {&nbsp;</div></li><li><div>        $slug = explode( '/', $key );&nbsp;</div></li><li><div>        $slug = explode( '.', end( $slug ) );&nbsp;</div></li><li><div>        return $slug[0];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Install a plugin from .org in the background via a cron job (used by&nbsp;</div></li><li><div>     * installer - opt in).&nbsp;</div></li><li><div>     * @param string $plugin_to_install_id&nbsp;</div></li><li><div>     * @param array $plugin_to_install&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function background_installer( $plugin_to_install_id, $plugin_to_install ) {&nbsp;</div></li><li><div>        // Explicitly clear the event.&nbsp;</div></li><li><div>        wp_clear_scheduled_hook( 'woocommerce_plugin_background_installer', func_get_args() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $plugin_to_install['repo-slug'] ) ) {&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/file.php' );&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/plugin-install.php' );&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/class-wp-upgrader.php' );&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/plugin.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            WP_Filesystem();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $skin = new Automatic_Upgrader_Skin;&nbsp;</div></li><li><div>            $upgrader = new WP_Upgrader( $skin );&nbsp;</div></li><li><div>            $installed_plugins = array_map( array( __CLASS__, 'format_plugin_slug' ), array_keys( get_plugins() ) );&nbsp;</div></li><li><div>            $plugin_slug = $plugin_to_install['repo-slug'];&nbsp;</div></li><li><div>            $plugin = $plugin_slug . '/' . $plugin_slug . '.php';&nbsp;</div></li><li><div>            $installed = false;&nbsp;</div></li><li><div>            $activate = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // See if the plugin is installed already&nbsp;</div></li><li><div>            if ( in_array( $plugin_to_install['repo-slug'], $installed_plugins ) ) {&nbsp;</div></li><li><div>                $installed = true;&nbsp;</div></li><li><div>                $activate = ! is_plugin_active( $plugin );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Install this thing!&nbsp;</div></li><li><div>            if ( ! $installed ) {&nbsp;</div></li><li><div>                // Suppress feedback&nbsp;</div></li><li><div>                ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                try {&nbsp;</div></li><li><div>                    $plugin_information = plugins_api( 'plugin_information', array(&nbsp;</div></li><li><div>                        'slug' =&gt; $plugin_to_install['repo-slug'], &nbsp;</div></li><li><div>                        'fields' =&gt; array(&nbsp;</div></li><li><div>                            'short_description' =&gt; false, &nbsp;</div></li><li><div>                            'sections' =&gt; false, &nbsp;</div></li><li><div>                            'requires' =&gt; false, &nbsp;</div></li><li><div>                            'rating' =&gt; false, &nbsp;</div></li><li><div>                            'ratings' =&gt; false, &nbsp;</div></li><li><div>                            'downloaded' =&gt; false, &nbsp;</div></li><li><div>                            'last_updated' =&gt; false, &nbsp;</div></li><li><div>                            'added' =&gt; false, &nbsp;</div></li><li><div>                            'tags' =&gt; false, &nbsp;</div></li><li><div>                            'homepage' =&gt; false, &nbsp;</div></li><li><div>                            'donate_link' =&gt; false, &nbsp;</div></li><li><div>                            'author_profile' =&gt; false, &nbsp;</div></li><li><div>                            'author' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_wp_error( $plugin_information ) ) {&nbsp;</div></li><li><div>                        throw new Exception( $plugin_information-&gt;get_error_message() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $package = $plugin_information-&gt;download_link;&nbsp;</div></li><li><div>                    $download = $upgrader-&gt;download_package( $package );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_wp_error( $download ) ) {&nbsp;</div></li><li><div>                        throw new Exception( $download-&gt;get_error_message() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $working_dir = $upgrader-&gt;unpack_package( $download, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_wp_error( $working_dir ) ) {&nbsp;</div></li><li><div>                        throw new Exception( $working_dir-&gt;get_error_message() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result = $upgrader-&gt;install_package( array(&nbsp;</div></li><li><div>                        'source' =&gt; $working_dir, &nbsp;</div></li><li><div>                        'destination' =&gt; WP_PLUGIN_DIR, &nbsp;</div></li><li><div>                        'clear_destination' =&gt; false, &nbsp;</div></li><li><div>                        'abort_if_destination_exists' =&gt; false, &nbsp;</div></li><li><div>                        'clear_working' =&gt; true, &nbsp;</div></li><li><div>                        'hook_extra' =&gt; array(&nbsp;</div></li><li><div>                            'type' =&gt; 'plugin', &nbsp;</div></li><li><div>                            'action' =&gt; 'install', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                        throw new Exception( $result-&gt;get_error_message() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $activate = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                } catch ( Exception $e ) {&nbsp;</div></li><li><div>                    WC_Admin_Notices::add_custom_notice(&nbsp;</div></li><li><div>                        $plugin_to_install_id . '_install_error', &nbsp;</div></li><li><div>                        sprintf(&nbsp;</div></li><li><div>                            __( '%1$s could not be installed (%2$s). &lt;a href=&quot;%3$s&quot;&gt;Please install it manually by clicking here.&lt;/a&gt;', 'woocommerce' ), &nbsp;</div></li><li><div>                            $plugin_to_install['name'], &nbsp;</div></li><li><div>                            $e-&gt;getMessage(), &nbsp;</div></li><li><div>                            esc_url( admin_url( 'index.php?wc-install-plugin-redirect=' . $plugin_to_install['repo-slug'] ) )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Discard feedback&nbsp;</div></li><li><div>                ob_end_clean();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_clean_plugins_cache();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Activate this thing&nbsp;</div></li><li><div>            if ( $activate ) {&nbsp;</div></li><li><div>                try {&nbsp;</div></li><li><div>                    $result = activate_plugin( $plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                        throw new Exception( $result-&gt;get_error_message() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } catch ( Exception $e ) {&nbsp;</div></li><li><div>                    WC_Admin_Notices::add_custom_notice(&nbsp;</div></li><li><div>                        $plugin_to_install_id . '_install_error', &nbsp;</div></li><li><div>                        sprintf(&nbsp;</div></li><li><div>                            __( '%1$s was installed but could not be activated. &lt;a href=&quot;%2$s&quot;&gt;Please activate it manually by clicking here.&lt;/a&gt;', 'woocommerce' ), &nbsp;</div></li><li><div>                            $plugin_to_install['name'], &nbsp;</div></li><li><div>                            admin_url( 'plugins.php' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.0.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce/3.0.6/classes/wc_install/" class="">3.0.6</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.5/classes/wc_install/" class="">3.0.5</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.4/classes/wc_install/" class="active">3.0.4</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.3/classes/wc_install/" class="">3.0.3</a></li><li><a href="http://hookr.io/plugins/woocommerce/3.0.2/classes/wc_install/" class="">3.0.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WC_Install</li><li><span></span>WooCommerce</li><li><span></span>3.0.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>