<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.6.4" data-slug="woocommerce" data-type="file" data-id="44575"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-admin-meta-boxes-class-wc-meta-box-product-data | file | Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, woocommerce, 2.6.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4"}};!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56806,55356,56826),0,0),c.toDataURL().length>3e3):("simple"===a?d.fillText(String.fromCharCode(55357,56835),0,0):d.fillText(String.fromCharCode(55356,57135),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=258f154fbb431e1f87640f47cfabf1be' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-admin-meta-boxes-class-wc-meta-box-product-data/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-meta-boxes-class-wc-meta-box-product-data%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-meta-boxes-class-wc-meta-box-product-data%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-2.6.4-file-includes-admin-meta-boxes-class-wc-meta-box-product-data","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-admin-meta-boxes-class-wc-meta-box-product-data" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce." href="http://hookr.io/plugins/woocommerce/" class="plugin"><span property="name">woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.6.4." href="http://hookr.io/plugins/woocommerce/2.6.4/" class="H_VERSION"><span property="name">2.6.4</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/woocommerce/2.6.4/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-admin-meta-boxes-cla&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="2840"><a href="http://hookr.io/plugins/woocommerce/2.6.4/all/" title="All">All <span class="count badge">2840</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/woocommerce/2.6.4/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="2002"><a href="http://hookr.io/plugins/woocommerce/2.6.4/hooks/" title="Hooks">Hooks <span class="count badge">2002</span></a></li><li class="" data-id="action" data-count="714"><a href="http://hookr.io/plugins/woocommerce/2.6.4/actions/" title="Actions">Actions <span class="count badge">714</span></a></li><li class="" data-id="filter" data-count="1288"><a href="http://hookr.io/plugins/woocommerce/2.6.4/filters/" title="Filters">Filters <span class="count badge">1288</span></a></li><li class="" data-id="class" data-count="281"><a href="http://hookr.io/plugins/woocommerce/2.6.4/classes/" title="Classes">Classes <span class="count badge">281</span></a></li><li class="" data-id="constant" data-count="21"><a href="http://hookr.io/plugins/woocommerce/2.6.4/constants/" title="Constants">Constants <span class="count badge">21</span></a></li><li class="" data-id="function" data-count="532"><a href="http://hookr.io/plugins/woocommerce/2.6.4/functions/" title="Functions">Functions <span class="count badge">532</span></a></li><li class="" data-id="shortcode" data-count="4"><a href="http://hookr.io/plugins/woocommerce/2.6.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">4</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/admin/meta-boxes/class-wc-meta-box-product-data.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Product Data</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Displays the product data box, tabbed, with several panels covering price, stock etc.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author   WooThemes</span>&nbsp;</div></li><li><div><span class="comment"> * @category Admin</span>&nbsp;</div></li><li><div><span class="comment"> * @package  WooCommerce/Admin/Meta Boxes</span>&nbsp;</div></li><li><div><span class="comment"> * @version  2.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  exit; <span class="comment">// Exit if accessed directly</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WC_Meta_Box_Product_Data Class.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WC_Meta_Box_Product_Data {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the metabox.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function output( $post ) {&nbsp;</div></li><li><div>      global $post, $thepostid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_nonce_field( 'woocommerce_save_data', 'woocommerce_meta_nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $thepostid = $post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $terms = wp_get_object_terms( $post-&gt;ID, 'product_type' ) ) {&nbsp;</div></li><li><div>          $product_type = sanitize_title( current( $terms )-&gt;name );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $product_type = apply_filters( 'default_product_type', 'simple' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $type_box = '&lt;label for=&quot;product-type&quot;&gt;&lt;select id=&quot;product-type&quot; name=&quot;product-type&quot;&gt;&lt;optgroup label=&quot;' . esc_attr__( 'Product Type', 'woocommerce' ) . '&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( wc_get_product_types() as $value =&gt; $label ) {&nbsp;</div></li><li><div>          $type_box .= '&lt;option value=&quot;' . esc_attr( $value ) . '&quot; ' . selected( $product_type, $value, false ) .'&gt;' . esc_html( $label ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $type_box .= '&lt;/optgroup&gt;&lt;/select&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $product_type_options = apply_filters( 'product_type_options', array(&nbsp;</div></li><li><div>          'virtual' =&gt; array(&nbsp;</div></li><li><div>              'id' =&gt; '_virtual', &nbsp;</div></li><li><div>              'wrapper_class' =&gt; 'show_if_simple', &nbsp;</div></li><li><div>              'label' =&gt; __( 'Virtual', 'woocommerce' ), &nbsp;</div></li><li><div>              'description' =&gt; __( 'Virtual products are intangible and aren\'t shipped.', 'woocommerce' ), &nbsp;</div></li><li><div>              'default' =&gt; 'no'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'downloadable' =&gt; array(&nbsp;</div></li><li><div>              'id' =&gt; '_downloadable', &nbsp;</div></li><li><div>              'wrapper_class' =&gt; 'show_if_simple', &nbsp;</div></li><li><div>              'label' =&gt; __( 'Downloadable', 'woocommerce' ), &nbsp;</div></li><li><div>              'description' =&gt; __( 'Downloadable products give access to a file upon purchase.', 'woocommerce' ), &nbsp;</div></li><li><div>              'default' =&gt; 'no'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $product_type_options as $key =&gt; $option ) {&nbsp;</div></li><li><div>          $selected_value = get_post_meta( $post-&gt;ID, '_' . $key, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' == $selected_value && isset( $option['default'] ) ) {&nbsp;</div></li><li><div>              $selected_value = $option['default'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $type_box .= '&lt;label for=&quot;' . esc_attr( $option['id'] ) . '&quot; class=&quot;'. esc_attr( $option['wrapper_class'] ) . ' tips&quot; data-tip=&quot;' . esc_attr( $option['description'] ) . '&quot;&gt;' . esc_html( $option['label'] ) . ': &lt;input type=&quot;checkbox&quot; name=&quot;' . esc_attr( $option['id'] ) . '&quot; id=&quot;' . esc_attr( $option['id'] ) . '&quot; ' . checked( $selected_value, 'yes', false ) .' /&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;panel-wrap product_data&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;span class=&quot;type_box hidden&quot;&gt; &mdash; &lt;?php echo $type_box; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;ul class=&quot;product_data_tabs wc-tabs&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  $product_data_tabs = apply_filters( 'woocommerce_product_data_tabs', array(&nbsp;</div></li><li><div>                      'general' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'General', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'general_product_data', &nbsp;</div></li><li><div>                          'class' =&gt; array( 'hide_if_grouped' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'inventory' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Inventory', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'inventory_product_data', &nbsp;</div></li><li><div>                          'class' =&gt; array( 'show_if_simple', 'show_if_variable', 'show_if_grouped', 'show_if_external' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'shipping' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Shipping', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'shipping_product_data', &nbsp;</div></li><li><div>                          'class' =&gt; array( 'hide_if_virtual', 'hide_if_grouped', 'hide_if_external' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'linked_product' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Linked Products', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'linked_product_data', &nbsp;</div></li><li><div>                          'class' =&gt; array(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'attribute' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Attributes', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'product_attributes', &nbsp;</div></li><li><div>                          'class' =&gt; array(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'variations' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Variations', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'variable_product_options', &nbsp;</div></li><li><div>                          'class' =&gt; array( 'variations_tab', 'show_if_variable' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'advanced' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Advanced', 'woocommerce' ), &nbsp;</div></li><li><div>                          'target' =&gt; 'advanced_product_data', &nbsp;</div></li><li><div>                          'class' =&gt; array(), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $product_data_tabs as $key =&gt; $tab ) {&nbsp;</div></li><li><div>                      ?&gt;&lt;li class=&quot;&lt;?php echo $key; ?&gt;_options &lt;?php echo $key; ?&gt;_tab &lt;?php echo implode( ' ' , (array) $tab['class'] ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;a href=&quot;#&lt;?php echo $tab['target']; ?&gt;&quot;&gt;&lt;?php echo esc_html( $tab['label'] ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;/li&gt;&lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_write_panel_tabs' );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;general_product_data&quot; class=&quot;panel woocommerce_options_panel&quot;&gt;&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group show_if_external&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// External URL</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_product_url', 'label' =&gt; __( 'Product URL', 'woocommerce' ), 'placeholder' =&gt; 'http:<span class="comment">//', 'description' =&gt; __( 'Enter the external URL to the product.', 'woocommerce' ) ) );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Button text</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_button_text', 'label' =&gt; __( 'Button text', 'woocommerce' ), 'placeholder' =&gt; _x('Buy product', 'placeholder', 'woocommerce'), 'description' =&gt; __( 'This text will be shown on the button linking to the external product.', 'woocommerce' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group pricing show_if_simple show_if_external hidden&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Price</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_regular_price', 'label' =&gt; __( 'Regular price', 'woocommerce' ) . ' (' . get_woocommerce_currency_symbol() . ')', 'data_type' =&gt; 'price' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Special Price</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_sale_price', 'data_type' =&gt; 'price', 'label' =&gt; __( 'Sale price', 'woocommerce' ) . ' ('.get_woocommerce_currency_symbol().')', 'description' =&gt; '&lt;a href=&quot;#&quot; class=&quot;sale_schedule&quot;&gt;' . __( 'Schedule', 'woocommerce' ) . '&lt;/a&gt;' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Special Price</span> date range&nbsp;</div></li><li><div>                  $sale_price_dates_from = ( $date = get_post_meta( $thepostid, '_sale_price_dates_from', true ) ) ? date_i18n( 'Y-m-d', $date ) : '';&nbsp;</div></li><li><div>                  $sale_price_dates_to = ( $date = get_post_meta( $thepostid, '_sale_price_dates_to', true ) ) ? date_i18n( 'Y-m-d', $date ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;p class=&quot;form-field sale_price_dates_fields&quot;&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;_sale_price_dates_from&quot;&gt;' . __( 'Sale price dates', 'woocommerce' ) . '&lt;/label&gt;&nbsp;</div></li><li><div>                              &lt;input type=&quot;text&quot; class=&quot;short&quot; name=&quot;_sale_price_dates_from&quot; id=&quot;_sale_price_dates_from&quot; value=&quot;' . esc_attr( $sale_price_dates_from ) . '&quot; placeholder=&quot;' . _x( 'From&hellip;', 'placeholder', 'woocommerce' ) . ' YYYY-MM-DD&quot; maxlength=&quot;10&quot; pattern=&quot;[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;input type=&quot;text&quot; class=&quot;short&quot; name=&quot;_sale_price_dates_to&quot; id=&quot;_sale_price_dates_to&quot; value=&quot;' . esc_attr( $sale_price_dates_to ) . '&quot; placeholder=&quot;' . _x( 'To&hellip;', 'placeholder', 'woocommerce' ) . '  YYYY-MM-DD&quot; maxlength=&quot;10&quot; pattern=&quot;[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;a href=&quot;#&quot; class=&quot;cancel_sale_schedule&quot;&gt;'. __( 'Cancel', 'woocommerce' ) . '&lt;/a&gt;' . wc_help_tip( __( 'The sale will end at the beginning of the set date.', 'woocommerce' ) ) . '&nbsp;</div></li><li><div>                          &lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_pricing' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group show_if_downloadable hidden&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;form-field downloadable_files&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label&gt;&lt;?php _e( 'Downloadable files', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;table class=&quot;widefat&quot;&gt;&nbsp;</div></li><li><div>                          &lt;thead&gt;&nbsp;</div></li><li><div>                              &lt;tr&gt;&nbsp;</div></li><li><div>                                  &lt;th class=&quot;sort&quot;&gt;&nbsp;&lt;/th&gt;&nbsp;</div></li><li><div>                                  &lt;th&gt;&lt;?php _e( 'Name', 'woocommerce' ); ?&gt; &lt;?php echo wc_help_tip( __( 'This is the name of the download shown to the customer.', 'woocommerce' ) ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                                  &lt;th colspan=&quot;2&quot;&gt;&lt;?php _e( 'File URL', 'woocommerce' ); ?&gt; &lt;?php echo wc_help_tip( __( 'This is the URL or absolute path to the file which customers will get access to. URLs entered here should already be encoded.', 'woocommerce' ) ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                                  &lt;th&gt;&nbsp;&lt;/th&gt;&nbsp;</div></li><li><div>                              &lt;/tr&gt;&nbsp;</div></li><li><div>                          &lt;/thead&gt;&nbsp;</div></li><li><div>                          &lt;tbody&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                              $downloadable_files = get_post_meta( $post-&gt;ID, '_downloadable_files', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( $downloadable_files ) {&nbsp;</div></li><li><div>                                  foreach ( $downloadable_files as $key =&gt; $file ) {&nbsp;</div></li><li><div>                                      include( 'views/html-product-download.php' );&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/tbody&gt;&nbsp;</div></li><li><div>                          &lt;tfoot&gt;&nbsp;</div></li><li><div>                              &lt;tr&gt;&nbsp;</div></li><li><div>                                  &lt;th colspan=&quot;5&quot;&gt;&nbsp;</div></li><li><div>                                      &lt;a href=&quot;#&quot; class=&quot;button insert&quot; data-row=&quot;&lt;?php&nbsp;</div></li><li><div>                                          $file = array(&nbsp;</div></li><li><div>                                              'file' =&gt; '', &nbsp;</div></li><li><div>                                              'name' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                                          ob_start();&nbsp;</div></li><li><div>                                          include( 'views/html-product-download.php' );&nbsp;</div></li><li><div>                                          echo esc_attr( ob_get_clean() );&nbsp;</div></li><li><div>                                      ?&gt;&quot;&gt;&lt;?php _e( 'Add File', 'woocommerce' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                  &lt;/th&gt;&nbsp;</div></li><li><div>                              &lt;/tr&gt;&nbsp;</div></li><li><div>                          &lt;/tfoot&gt;&nbsp;</div></li><li><div>                      &lt;/table&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Download Limit</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_download_limit', 'label' =&gt; __( 'Download limit', 'woocommerce' ), 'placeholder' =&gt; __( 'Unlimited', 'woocommerce' ), 'description' =&gt; __( 'Leave blank for unlimited re-downloads.', 'woocommerce' ), 'type' =&gt; 'number', 'custom_attributes' =&gt; array(&nbsp;</div></li><li><div>                      'step' =&gt; '1', &nbsp;</div></li><li><div>                      'min' =&gt; '0'&nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Expirey</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_download_expiry', 'label' =&gt; __( 'Download expiry', 'woocommerce' ), 'placeholder' =&gt; __( 'Never', 'woocommerce' ), 'description' =&gt; __( 'Enter the number of days before a download link expires, or leave blank.', 'woocommerce' ), 'type' =&gt; 'number', 'custom_attributes' =&gt; array(&nbsp;</div></li><li><div>                      'step' =&gt; '1', &nbsp;</div></li><li><div>                      'min' =&gt; '0'&nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                   <span class="comment">// Download Type</span>&nbsp;</div></li><li><div>                  woocommerce_wp_select( array( 'id' =&gt; '_download_type', 'label' =&gt; __( 'Download type', 'woocommerce' ), 'description' =&gt; sprintf( __( 'Choose a download type - this controls the &lt;a href=&quot;%s&quot;&gt;schema&lt;/a&gt;.', 'woocommerce' ), 'http:<span class="comment">//schema.org/' ), 'options' =&gt; array(</span>&nbsp;</div></li><li><div>                      '' =&gt; __( 'Standard Product', 'woocommerce' ), &nbsp;</div></li><li><div>                      'application' =&gt; __( 'Application/Software', 'woocommerce' ), &nbsp;</div></li><li><div>                      'music' =&gt; __( 'Music', 'woocommerce' ), &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_downloads' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( wc_tax_enabled() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;div class=&quot;options_group show_if_simple show_if_external show_if_variable&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Tax</span>&nbsp;</div></li><li><div>                      woocommerce_wp_select( array(&nbsp;</div></li><li><div>                          'id' =&gt; '_tax_status', &nbsp;</div></li><li><div>                          'label' =&gt; __( 'Tax status', 'woocommerce' ), &nbsp;</div></li><li><div>                          'options' =&gt; array(&nbsp;</div></li><li><div>                              'taxable' =&gt; __( 'Taxable', 'woocommerce' ), &nbsp;</div></li><li><div>                              'shipping' =&gt; __( 'Shipping only', 'woocommerce' ), &nbsp;</div></li><li><div>                              'none' =&gt; _x( 'None', 'Tax status', 'woocommerce' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                          'desc_tip' =&gt; 'true', &nbsp;</div></li><li><div>                          'description' =&gt; __( 'Define whether or not the entire product is taxable, or just the cost of shipping it.', 'woocommerce' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $tax_classes = WC_Tax::get_tax_classes();&nbsp;</div></li><li><div>                      $classes_options = array();&nbsp;</div></li><li><div>                      $classes_options[''] = __( 'Standard', 'woocommerce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! empty( $tax_classes ) ) {&nbsp;</div></li><li><div>                          foreach ( $tax_classes as $class ) {&nbsp;</div></li><li><div>                              $classes_options[ sanitize_title( $class ) ] = esc_html( $class );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      woocommerce_wp_select( array(&nbsp;</div></li><li><div>                          'id' =&gt; '_tax_class', &nbsp;</div></li><li><div>                          'label' =&gt; __( 'Tax class', 'woocommerce' ), &nbsp;</div></li><li><div>                          'options' =&gt; $classes_options, &nbsp;</div></li><li><div>                          'desc_tip' =&gt; 'true', &nbsp;</div></li><li><div>                          'description' =&gt; __( 'Choose a tax class for this product. Tax classes are used to apply different tax rates specific to certain types of product.', 'woocommerce' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      do_action( 'woocommerce_product_options_tax' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_options_general_product_data' );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;inventory_product_data&quot; class=&quot;panel woocommerce_options_panel hidden&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// SKU</span>&nbsp;</div></li><li><div>              if ( wc_product_sku_enabled() ) {&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array( 'id' =&gt; '_sku', 'label' =&gt; '&lt;abbr title=&quot;'. __( 'Stock Keeping Unit', 'woocommerce' ) .'&quot;&gt;' . __( 'SKU', 'woocommerce' ) . '&lt;/abbr&gt;', 'desc_tip' =&gt; 'true', 'description' =&gt; __( 'SKU refers to a Stock-keeping unit, a unique identifier for each distinct product and service that can be purchased.', 'woocommerce' ) ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  echo '&lt;input type=&quot;hidden&quot; name=&quot;_sku&quot; value=&quot;' . esc_attr( get_post_meta( $thepostid, '_sku', true ) ) . '&quot; /&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_options_sku' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'yes' === get_option( 'woocommerce_manage_stock' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// manage stock</span>&nbsp;</div></li><li><div>                  woocommerce_wp_checkbox( array( 'id' =&gt; '_manage_stock', 'wrapper_class' =&gt; 'show_if_simple show_if_variable', 'label' =&gt; __( 'Manage stock?', 'woocommerce' ), 'description' =&gt; __( 'Enable stock management at product level', 'woocommerce' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_stock' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;div class=&quot;stock_fields show_if_simple show_if_variable&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Stock</span>&nbsp;</div></li><li><div>                  woocommerce_wp_text_input( array(&nbsp;</div></li><li><div>                      'id' =&gt; '_stock', &nbsp;</div></li><li><div>                      'label' =&gt; __( 'Stock quantity', 'woocommerce' ), &nbsp;</div></li><li><div>                      'desc_tip' =&gt; true, &nbsp;</div></li><li><div>                      'description' =&gt; __( 'Stock quantity. If this is a variable product this value will be used to control stock for all variations, unless you define stock at variation level.', 'woocommerce' ), &nbsp;</div></li><li><div>                      'type' =&gt; 'number', &nbsp;</div></li><li><div>                      'custom_attributes' =&gt; array(&nbsp;</div></li><li><div>                          'step' =&gt; 'any'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      'data_type' =&gt; 'stock'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Backorders?</span>&nbsp;</div></li><li><div>                  woocommerce_wp_select( array( 'id' =&gt; '_backorders', 'label' =&gt; __( 'Allow backorders?', 'woocommerce' ), 'options' =&gt; array(&nbsp;</div></li><li><div>                      'no' =&gt; __( 'Do not allow', 'woocommerce' ), &nbsp;</div></li><li><div>                      'notify' =&gt; __( 'Allow, but notify customer', 'woocommerce' ), &nbsp;</div></li><li><div>                      'yes' =&gt; __( 'Allow', 'woocommerce' )&nbsp;</div></li><li><div> ), 'desc_tip' =&gt; true, 'description' =&gt; __( 'If managing stock, this controls whether or not backorders are allowed. If enabled, stock quantity can go below 0.', 'woocommerce' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_stock_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Stock</span> status&nbsp;</div></li><li><div>              woocommerce_wp_select( array( 'id' =&gt; '_stock_status', 'wrapper_class' =&gt; 'hide_if_variable hide_if_external', 'label' =&gt; __( 'Stock status', 'woocommerce' ), 'options' =&gt; array(&nbsp;</div></li><li><div>                  'instock' =&gt; __( 'In stock', 'woocommerce' ), &nbsp;</div></li><li><div>                  'outofstock' =&gt; __( 'Out of stock', 'woocommerce' )&nbsp;</div></li><li><div> ), 'desc_tip' =&gt; true, 'description' =&gt; __( 'Controls whether or not the product is listed as &quot;in stock&quot; or &quot;out of stock&quot; on the frontend.', 'woocommerce' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_options_stock_status' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group show_if_simple show_if_variable&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Individual product</span>&nbsp;</div></li><li><div>              woocommerce_wp_checkbox( array( 'id' =&gt; '_sold_individually', 'wrapper_class' =&gt; 'show_if_simple show_if_variable', 'label' =&gt; __( 'Sold individually', 'woocommerce' ), 'description' =&gt; __( 'Enable this to only allow one of this item to be bought in a single order', 'woocommerce' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_options_sold_individually' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_options_inventory_product_data' );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;shipping_product_data&quot; class=&quot;panel woocommerce_options_panel hidden&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Weight</span>&nbsp;</div></li><li><div>                  if ( wc_product_weight_enabled() ) {&nbsp;</div></li><li><div>                      woocommerce_wp_text_input( array( 'id' =&gt; '_weight', 'label' =&gt; __( 'Weight', 'woocommerce' ) . ' (' . get_option( 'woocommerce_weight_unit' ) . ')', 'placeholder' =&gt; wc_format_localized_decimal( 0 ), 'desc_tip' =&gt; 'true', 'description' =&gt; __( 'Weight in decimal form', 'woocommerce' ), 'type' =&gt; 'text', 'data_type' =&gt; 'decimal' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Size fields</span>&nbsp;</div></li><li><div>                  if ( wc_product_dimensions_enabled() ) {&nbsp;</div></li><li><div>                      ?&gt;&lt;p class=&quot;form-field dimensions_field&quot;&gt;&nbsp;</div></li><li><div>                          &lt;label for=&quot;product_length&quot;&gt;&lt;?php echo __( 'Dimensions', 'woocommerce' ) . ' (' . get_option( 'woocommerce_dimension_unit' ) . ')'; ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;product_length&quot; placeholder=&quot;&lt;?php esc_attr_e( 'Length', 'woocommerce' ); ?&gt;&quot; class=&quot;input-text wc_input_decimal&quot; size=&quot;6&quot; type=&quot;text&quot; name=&quot;_length&quot; value=&quot;&lt;?php echo esc_attr( wc_format_localized_decimal( get_post_meta( $thepostid, '_length', true ) ) ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;input placeholder=&quot;&lt;?php esc_attr_e( 'Width', 'woocommerce' ); ?&gt;&quot; class=&quot;input-text wc_input_decimal&quot; size=&quot;6&quot; type=&quot;text&quot; name=&quot;_width&quot; value=&quot;&lt;?php echo esc_attr( wc_format_localized_decimal( get_post_meta( $thepostid, '_width', true ) ) ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;input placeholder=&quot;&lt;?php esc_attr_e( 'Height', 'woocommerce' ); ?&gt;&quot; class=&quot;input-text wc_input_decimal last&quot; size=&quot;6&quot; type=&quot;text&quot; name=&quot;_height&quot; value=&quot;&lt;?php echo esc_attr( wc_format_localized_decimal( get_post_meta( $thepostid, '_height', true ) ) ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                          &lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;?php echo wc_help_tip( __( 'LxWxH in decimal form', 'woocommerce' ) ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/p&gt;&lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_dimensions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;options_group&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Shipping Class</span>&nbsp;</div></li><li><div>                  $classes = get_the_terms( $thepostid, 'product_shipping_class' );&nbsp;</div></li><li><div>                  if ( $classes && ! is_wp_error( $classes ) ) {&nbsp;</div></li><li><div>                      $current_shipping_class = current( $classes )-&gt;term_id;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $current_shipping_class = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $args = array(&nbsp;</div></li><li><div>                      'taxonomy' =&gt; 'product_shipping_class', &nbsp;</div></li><li><div>                      'hide_empty' =&gt; 0, &nbsp;</div></li><li><div>                      'show_option_none' =&gt; __( 'No shipping class', 'woocommerce' ), &nbsp;</div></li><li><div>                      'name' =&gt; 'product_shipping_class', &nbsp;</div></li><li><div>                      'id' =&gt; 'product_shipping_class', &nbsp;</div></li><li><div>                      'selected' =&gt; $current_shipping_class, &nbsp;</div></li><li><div>                      'class' =&gt; 'select short'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  ?&gt;&lt;p class=&quot;form-field dimensions_field&quot;&gt;&lt;label for=&quot;product_shipping_class&quot;&gt;&lt;?php _e( 'Shipping class', 'woocommerce' ); ?&gt;&lt;/label&gt; &lt;?php wp_dropdown_categories( $args ); ?&gt; &lt;?php echo wc_help_tip( __( 'Shipping classes are used by certain shipping methods to group similar products.', 'woocommerce' ) ); ?&gt;&lt;/p&gt;&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_product_options_shipping' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;product_attributes&quot; class=&quot;panel wc-metaboxes-wrapper hidden&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;toolbar toolbar-top&quot;&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;expand-close&quot;&gt;&nbsp;</div></li><li><div>                      &lt;a href=&quot;#&quot; class=&quot;expand_all&quot;&gt;&lt;?php _e( 'Expand', 'woocommerce' ); ?&gt;&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;close_all&quot;&gt;&lt;?php _e( 'Close', 'woocommerce' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                  &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;select name=&quot;attribute_taxonomy&quot; class=&quot;attribute_taxonomy&quot;&gt;&nbsp;</div></li><li><div>                      &lt;option value=&quot;&quot;&gt;&lt;?php _e( 'Custom product attribute', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                          global $wc_product_attributes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">// Array of defined attribute taxonomies</span>&nbsp;</div></li><li><div>                          $attribute_taxonomies = wc_get_attribute_taxonomies();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( ! empty( $attribute_taxonomies ) ) {&nbsp;</div></li><li><div>                              foreach ( $attribute_taxonomies as $tax ) {&nbsp;</div></li><li><div>                                  $attribute_taxonomy_name = wc_attribute_taxonomy_name( $tax-&gt;attribute_name );&nbsp;</div></li><li><div>                                  $label = $tax-&gt;attribute_label ? $tax-&gt;attribute_label : $tax-&gt;attribute_name;&nbsp;</div></li><li><div>                                  echo '&lt;option value=&quot;' . esc_attr( $attribute_taxonomy_name ) . '&quot;&gt;' . esc_html( $label ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                  &lt;/select&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button add_attribute&quot;&gt;&lt;?php _e( 'Add', 'woocommerce' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;product_attributes wc-metaboxes&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      <span class="comment">// Product attributes - taxonomies and custom, ordered, with visibility and variation attributes set</span>&nbsp;</div></li><li><div>                      $attributes = maybe_unserialize( get_post_meta( $thepostid, '_product_attributes', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Output All Set Attributes</span>&nbsp;</div></li><li><div>                      if ( ! empty( $attributes ) ) {&nbsp;</div></li><li><div>                          $attribute_keys = array_keys( $attributes );&nbsp;</div></li><li><div>                          $attribute_total = sizeof( $attribute_keys );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          for ( $i = 0; $i &lt; $attribute_total; $i ++ ) {&nbsp;</div></li><li><div>                              $attribute = $attributes[ $attribute_keys[ $i ] ];&nbsp;</div></li><li><div>                              $position = empty( $attribute['position'] ) ? 0 : absint( $attribute['position'] );&nbsp;</div></li><li><div>                              $taxonomy = '';&nbsp;</div></li><li><div>                              $metabox_class = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( $attribute['is_taxonomy'] ) {&nbsp;</div></li><li><div>                                  $taxonomy = $attribute['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  if ( ! taxonomy_exists( $taxonomy ) ) {&nbsp;</div></li><li><div>                                      continue;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  $attribute_taxonomy = $wc_product_attributes[ $taxonomy ];&nbsp;</div></li><li><div>                                  $metabox_class[] = 'taxonomy';&nbsp;</div></li><li><div>                                  $metabox_class[] = $taxonomy;&nbsp;</div></li><li><div>                                  $attribute_label = wc_attribute_label( $taxonomy );&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $attribute_label = apply_filters( 'woocommerce_attribute_label', $attribute['name'], $attribute['name'], false );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              include( 'views/html-product-attribute.php' );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;toolbar&quot;&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;expand-close&quot;&gt;&nbsp;</div></li><li><div>                      &lt;a href=&quot;#&quot; class=&quot;expand_all&quot;&gt;&lt;?php _e( 'Expand', 'woocommerce' ); ?&gt;&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;close_all&quot;&gt;&lt;?php _e( 'Close', 'woocommerce' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                  &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button save_attributes button-primary&quot;&gt;&lt;?php _e( 'Save attributes', 'woocommerce' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'woocommerce_product_options_attributes' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;linked_product_data&quot; class=&quot;panel woocommerce_options_panel hidden&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;options_group&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;p class=&quot;form-field&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;upsell_ids&quot;&gt;&lt;?php _e( 'Up-sells', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;input type=&quot;hidden&quot; class=&quot;wc-product-search&quot; style=&quot;width: 50%;&quot; id=&quot;upsell_ids&quot; name=&quot;upsell_ids&quot; data-placeholder=&quot;&lt;?php esc_attr_e( 'Search for a product&hellip;', 'woocommerce' ); ?&gt;&quot; data-action=&quot;woocommerce_json_search_products&quot; data-multiple=&quot;true&quot; data-exclude=&quot;&lt;?php echo intval( $post-&gt;ID ); ?&gt;&quot; data-selected=&quot;&lt;?php&nbsp;</div></li><li><div>                          $product_ids = array_filter( array_map( 'absint', (array) get_post_meta( $post-&gt;ID, '_upsell_ids', true ) ) );&nbsp;</div></li><li><div>                          $json_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          foreach ( $product_ids as $product_id ) {&nbsp;</div></li><li><div>                              $product = wc_get_product( $product_id );&nbsp;</div></li><li><div>                              if ( is_object( $product ) ) {&nbsp;</div></li><li><div>                                  $json_ids[ $product_id ] = wp_kses_post( html_entity_decode( $product-&gt;get_formatted_name(), ENT_QUOTES, get_bloginfo( 'charset' ) ) );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          echo esc_attr( json_encode( $json_ids ) );&nbsp;</div></li><li><div>                      ?&gt;&quot; value=&quot;&lt;?php echo implode( ', ', array_keys( $json_ids ) ); ?&gt;&quot; /&gt; &lt;?php echo wc_help_tip( __( 'Up-sells are products which you recommend instead of the currently viewed product, for example, products that are more profitable or better quality or more expensive.', 'woocommerce' ) ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;p class=&quot;form-field&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;crosssell_ids&quot;&gt;&lt;?php _e( 'Cross-sells', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;input type=&quot;hidden&quot; class=&quot;wc-product-search&quot; style=&quot;width: 50%;&quot; id=&quot;crosssell_ids&quot; name=&quot;crosssell_ids&quot; data-placeholder=&quot;&lt;?php esc_attr_e( 'Search for a product&hellip;', 'woocommerce' ); ?&gt;&quot; data-action=&quot;woocommerce_json_search_products&quot; data-multiple=&quot;true&quot; data-exclude=&quot;&lt;?php echo intval( $post-&gt;ID ); ?&gt;&quot; data-selected=&quot;&lt;?php&nbsp;</div></li><li><div>                          $product_ids = array_filter( array_map( 'absint', (array) get_post_meta( $post-&gt;ID, '_crosssell_ids', true ) ) );&nbsp;</div></li><li><div>                          $json_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          foreach ( $product_ids as $product_id ) {&nbsp;</div></li><li><div>                              $product = wc_get_product( $product_id );&nbsp;</div></li><li><div>                              if ( is_object( $product ) ) {&nbsp;</div></li><li><div>                                  $json_ids[ $product_id ] = wp_kses_post( html_entity_decode( $product-&gt;get_formatted_name(), ENT_QUOTES, get_bloginfo( 'charset' ) ) );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          echo esc_attr( json_encode( $json_ids ) );&nbsp;</div></li><li><div>                      ?&gt;&quot; value=&quot;&lt;?php echo implode( ', ', array_keys( $json_ids ) ); ?&gt;&quot; /&gt; &lt;?php echo wc_help_tip( __( 'Cross-sells are products which you promote in the cart, based on the current product.', 'woocommerce' ) ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;options_group grouping show_if_simple show_if_external&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;p class=&quot;form-field&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;parent_id&quot;&gt;&lt;?php _e( 'Grouping', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;input type=&quot;hidden&quot; class=&quot;wc-product-search&quot; style=&quot;width: 50%;&quot; id=&quot;parent_id&quot; name=&quot;parent_id&quot; data-placeholder=&quot;&lt;?php esc_attr_e( 'Search for a product&hellip;', 'woocommerce' ); ?&gt;&quot; data-action=&quot;woocommerce_json_search_grouped_products&quot; data-allow_clear=&quot;true&quot; data-multiple=&quot;false&quot; data-exclude=&quot;&lt;?php echo intval( $post-&gt;ID ); ?&gt;&quot; data-selected=&quot;&lt;?php&nbsp;</div></li><li><div>                          $parent_id = absint( $post-&gt;post_parent );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( $parent_id ) {&nbsp;</div></li><li><div>                              $parent = wc_get_product( $parent_id );&nbsp;</div></li><li><div>                              if ( is_object( $parent ) ) {&nbsp;</div></li><li><div>                                  $parent_title = wp_kses_post( html_entity_decode( $parent-&gt;get_formatted_name(), ENT_QUOTES, get_bloginfo( 'charset' ) ) );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              echo esc_attr( $parent_title );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      ?&gt;&quot; value=&quot;&lt;?php echo $parent_id ? $parent_id : ''; ?&gt;&quot; /&gt; &lt;?php echo wc_help_tip( __( 'Set this option to make this product part of a grouped product.', 'woocommerce' ) ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      woocommerce_wp_hidden_input( array( 'id' =&gt; 'previous_parent_id', 'value' =&gt; absint( $post-&gt;post_parent ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      do_action( 'woocommerce_product_options_grouping' );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php do_action( 'woocommerce_product_options_related' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;advanced_product_data&quot; class=&quot;panel woocommerce_options_panel hidden&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;options_group hide_if_external&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      <span class="comment">// Purchase note</span>&nbsp;</div></li><li><div>                      woocommerce_wp_textarea_input(  array( 'id' =&gt; '_purchase_note', 'label' =&gt; __( 'Purchase note', 'woocommerce' ), 'desc_tip' =&gt; 'true', 'description' =&gt; __( 'Enter an optional note to send the customer after purchase.', 'woocommerce' ) ) );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;options_group&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      <span class="comment">// menu_order</span>&nbsp;</div></li><li><div>                      woocommerce_wp_text_input(  array( 'id' =&gt; 'menu_order', 'label' =&gt; __( 'Menu order', 'woocommerce' ), 'desc_tip' =&gt; 'true', 'description' =&gt; __( 'Custom ordering position.', 'woocommerce' ), 'value' =&gt; intval( $post-&gt;menu_order ), 'type' =&gt; 'number', 'custom_attributes' =&gt; array(&nbsp;</div></li><li><div>                          'step' =&gt; '1'&nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;options_group reviews&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      woocommerce_wp_checkbox( array( 'id' =&gt; 'comment_status', 'label' =&gt; __( 'Enable reviews', 'woocommerce' ), 'cbvalue' =&gt; 'open', 'value' =&gt; esc_attr( $post-&gt;comment_status ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      do_action( 'woocommerce_product_options_reviews' );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php do_action( 'woocommerce_product_options_advanced' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              self::output_variations();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_data_panels' );&nbsp;</div></li><li><div>              do_action( 'woocommerce_product_write_panels' ); <span class="comment">// _deprecated</span>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Show options for the variable product type.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function output_variations() {&nbsp;</div></li><li><div>      global $post, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get attributes</span>&nbsp;</div></li><li><div>      $attributes = maybe_unserialize( get_post_meta( $post-&gt;ID, '_product_attributes', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// See if any are set</span>&nbsp;</div></li><li><div>      $variation_attribute_found = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $attributes ) {&nbsp;</div></li><li><div>          foreach ( $attributes as $attribute ) {&nbsp;</div></li><li><div>              if ( ! empty( $attribute['is_variation'] ) ) {&nbsp;</div></li><li><div>                  $variation_attribute_found = true;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $variations_count = absint( $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(ID) FROM $wpdb-&gt;posts WHERE post_parent = %d AND post_type = 'product_variation' AND post_status IN ('publish', 'private')&quot;, $post-&gt;ID ) ) );&nbsp;</div></li><li><div>      $variations_per_page = absint( apply_filters( 'woocommerce_admin_meta_boxes_variations_per_page', 15 ) );&nbsp;</div></li><li><div>      $variations_total_pages = ceil( $variations_count / $variations_per_page );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;variable_product_options&quot; class=&quot;panel wc-metaboxes-wrapper hidden&quot;&gt;&lt;div id=&quot;variable_product_options_inner&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( ! $variation_attribute_found ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div id=&quot;message&quot; class=&quot;inline notice woocommerce-message&quot;&gt;&nbsp;</div></li><li><div>                  &lt;p&gt;&lt;?php _e( 'Before you can add a variation you need to add some variation attributes on the &lt;strong&gt;Attributes&lt;/strong&gt; tab.', 'woocommerce' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                  &lt;p&gt;&nbsp;</div></li><li><div>                      &lt;a class=&quot;button-primary&quot; href=&quot;&lt;?php echo esc_url( apply_filters( 'woocommerce_docs_url', 'https:<span class="comment">//docs.woocommerce.com/document/variable-product/', 'product-variations' ) ); ?&gt;&quot; target=&quot;_blank&quot;&gt;&lt;?php _e( 'Learn more', 'woocommerce' ); ?&gt;&lt;/a&gt;</span>&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php else : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;toolbar toolbar-variations-defaults&quot;&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;variations-defaults&quot;&gt;&nbsp;</div></li><li><div>                      &lt;strong&gt;&lt;?php _e( 'Default Form Values', 'woocommerce' ); ?&gt;: &lt;?php echo wc_help_tip( __( 'These are the attributes that will be pre-selected on the frontend.', 'woocommerce' ) ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                          $default_attributes = maybe_unserialize( get_post_meta( $post-&gt;ID, '_default_attributes', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          foreach ( $attributes as $attribute ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Only deal with attributes that are variations</span>&nbsp;</div></li><li><div>                              if ( ! $attribute['is_variation'] ) {&nbsp;</div></li><li><div>                                  continue;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Get current value for variation (if set)</span>&nbsp;</div></li><li><div>                              $variation_selected_value = isset( $default_attributes[ sanitize_title( $attribute['name'] ) ] ) ? $default_attributes[ sanitize_title( $attribute['name'] ) ] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Name will be something like attribute_pa_color</span>&nbsp;</div></li><li><div>                              echo '&lt;select name=&quot;default_attribute_' . sanitize_title( $attribute['name'] ) . '&quot; data-current=&quot;' . esc_attr( $variation_selected_value ) . '&quot;&gt;&lt;option value=&quot;&quot;&gt;' . __( 'No default', 'woocommerce' ) . ' ' . esc_html( wc_attribute_label( $attribute['name'] ) ) . '&hellip;&lt;/option&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Get terms for attribute taxonomy or value if its a custom attribute</span>&nbsp;</div></li><li><div>                              if ( $attribute['is_taxonomy'] ) {&nbsp;</div></li><li><div>                                  $post_terms = wp_get_post_terms( $post-&gt;ID, $attribute['name'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  foreach ( $post_terms as $term ) {&nbsp;</div></li><li><div>                                      echo '&lt;option ' . selected( $variation_selected_value, $term-&gt;slug, false ) . ' value=&quot;' . esc_attr( $term-&gt;slug ) . '&quot;&gt;' . esc_html( apply_filters( 'woocommerce_variation_option_name', $term-&gt;name ) ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $options = wc_get_text_attributes( $attribute['value'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  foreach ( $options as $option ) {&nbsp;</div></li><li><div>                                      $selected = sanitize_title( $variation_selected_value ) === $variation_selected_value ? selected( $variation_selected_value, sanitize_title( $option ), false ) : selected( $variation_selected_value, $option, false );&nbsp;</div></li><li><div>                                      echo '&lt;option ' . $selected . ' value=&quot;' . esc_attr( $option ) . '&quot;&gt;' . esc_html( apply_filters( 'woocommerce_variation_option_name', $option ) )  . '&lt;/option&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              echo '&lt;/select&gt;';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;toolbar toolbar-top&quot;&gt;&nbsp;</div></li><li><div>                  &lt;select id=&quot;field_to_edit&quot; class=&quot;variation_actions&quot;&gt;&nbsp;</div></li><li><div>                      &lt;option data-global=&quot;true&quot; value=&quot;add_variation&quot;&gt;&lt;?php _e( 'Add variation', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option data-global=&quot;true&quot; value=&quot;link_all_variations&quot;&gt;&lt;?php _e( 'Create variations from all attributes', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option value=&quot;delete_all&quot;&gt;&lt;?php _e( 'Delete all variations', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;optgroup label=&quot;&lt;?php esc_attr_e( 'Status', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;toggle_enabled&quot;&gt;&lt;?php _e( 'Toggle &quot;Enabled&quot;', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;toggle_downloadable&quot;&gt;&lt;?php _e( 'Toggle &quot;Downloadable&quot;', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;toggle_virtual&quot;&gt;&lt;?php _e( 'Toggle &quot;Virtual&quot;', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/optgroup&gt;&nbsp;</div></li><li><div>                      &lt;optgroup label=&quot;&lt;?php esc_attr_e( 'Pricing', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_regular_price&quot;&gt;&lt;?php _e( 'Set regular prices', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_regular_price_increase&quot;&gt;&lt;?php _e( 'Increase regular prices (fixed amount or percentage)', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_regular_price_decrease&quot;&gt;&lt;?php _e( 'Decrease regular prices (fixed amount or percentage)', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_sale_price&quot;&gt;&lt;?php _e( 'Set sale prices', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_sale_price_increase&quot;&gt;&lt;?php _e( 'Increase sale prices (fixed amount or percentage)', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_sale_price_decrease&quot;&gt;&lt;?php _e( 'Decrease sale prices (fixed amount or percentage)', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_sale_schedule&quot;&gt;&lt;?php _e( 'Set scheduled sale dates', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/optgroup&gt;&nbsp;</div></li><li><div>                      &lt;optgroup label=&quot;&lt;?php esc_attr_e( 'Inventory', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;toggle_manage_stock&quot;&gt;&lt;?php _e( 'Toggle &quot;Manage stock&quot;', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_stock&quot;&gt;&lt;?php _e( 'Stock', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/optgroup&gt;&nbsp;</div></li><li><div>                      &lt;optgroup label=&quot;&lt;?php esc_attr_e( 'Shipping', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_length&quot;&gt;&lt;?php _e( 'Length', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_width&quot;&gt;&lt;?php _e( 'Width', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_height&quot;&gt;&lt;?php _e( 'Height', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_weight&quot;&gt;&lt;?php _e( 'Weight', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/optgroup&gt;&nbsp;</div></li><li><div>                      &lt;optgroup label=&quot;&lt;?php esc_attr_e( 'Downloadable products', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_download_limit&quot;&gt;&lt;?php _e( 'Download limit', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option value=&quot;variable_download_expiry&quot;&gt;&lt;?php _e( 'Download expiry', 'woocommerce' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/optgroup&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'woocommerce_variable_product_bulk_edit_actions' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/select&gt;&nbsp;</div></li><li><div>                  &lt;a class=&quot;button bulk_edit do_variation_action&quot;&gt;&lt;?php _e( 'Go', 'woocommerce' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;div class=&quot;variations-pagenav&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;displaying-num&quot;&gt;&lt;?php printf( _n( '%s item', '%s items', $variations_count, 'woocommerce' ), $variations_count ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;expand-close&quot;&gt;&nbsp;</div></li><li><div>                          (&lt;a href=&quot;#&quot; class=&quot;expand_all&quot;&gt;&lt;?php _e( 'Expand', 'woocommerce' ); ?&gt;&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;close_all&quot;&gt;&lt;?php _e( 'Close', 'woocommerce' ); ?&gt;&lt;/a&gt;)&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;pagination-links&quot;&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;first-page disabled&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the first page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&laquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;prev-page disabled&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the previous page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&lsaquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;paging-select&quot;&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;current-page-selector-1&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Select Page', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                              &lt;select class=&quot;page-selector&quot; id=&quot;current-page-selector-1&quot; title=&quot;&lt;?php esc_attr_e( 'Current page', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;?php for ( $i = 1; $i &lt;= $variations_total_pages; $i++ ) : ?&gt;&nbsp;</div></li><li><div>                                      &lt;option value=&quot;&lt;?php echo $i; ?&gt;&quot;&gt;&lt;?php echo $i; ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                  &lt;?php endfor; ?&gt;&nbsp;</div></li><li><div>                              &lt;/select&gt;&nbsp;</div></li><li><div>                               &lt;?php _ex( 'of', 'number of pages', 'woocommerce' ); ?&gt; &lt;span class=&quot;total-pages&quot;&gt;&lt;?php echo $variations_total_pages; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;next-page&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the next page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&rsaquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;last-page&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the last page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&raquo;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;woocommerce_variations wc-metaboxes&quot; data-attributes=&quot;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment">// esc_attr does not double encode - htmlspecialchars does</span>&nbsp;</div></li><li><div>                  echo htmlspecialchars( json_encode( $attributes ) );&nbsp;</div></li><li><div>              ?&gt;&quot; data-total=&quot;&lt;?php echo $variations_count; ?&gt;&quot; data-total_pages=&quot;&lt;?php echo $variations_total_pages; ?&gt;&quot; data-page=&quot;1&quot; data-edited=&quot;false&quot;&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;toolbar&quot;&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-primary save-variation-changes&quot; disabled=&quot;disabled&quot;&gt;&lt;?php _e( 'Save changes', 'woocommerce' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button cancel-variation-changes&quot; disabled=&quot;disabled&quot;&gt;&lt;?php _e( 'Cancel', 'woocommerce' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;div class=&quot;variations-pagenav&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;displaying-num&quot;&gt;&lt;?php printf( _n( '%s item', '%s items', $variations_count, 'woocommerce' ), $variations_count ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;expand-close&quot;&gt;&nbsp;</div></li><li><div>                          (&lt;a href=&quot;#&quot; class=&quot;expand_all&quot;&gt;&lt;?php _e( 'Expand', 'woocommerce' ); ?&gt;&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;close_all&quot;&gt;&lt;?php _e( 'Close', 'woocommerce' ); ?&gt;&lt;/a&gt;)&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;pagination-links&quot;&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;first-page disabled&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the first page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&laquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;prev-page disabled&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the previous page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&lsaquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;paging-select&quot;&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;current-page-selector-1&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Select Page', 'woocommerce' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                              &lt;select class=&quot;page-selector&quot; id=&quot;current-page-selector-1&quot; title=&quot;&lt;?php esc_attr_e( 'Current page', 'woocommerce' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;?php for ( $i = 1; $i &lt;= $variations_total_pages; $i++ ) : ?&gt;&nbsp;</div></li><li><div>                                      &lt;option value=&quot;&lt;?php echo $i; ?&gt;&quot;&gt;&lt;?php echo $i; ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                                  &lt;?php endfor; ?&gt;&nbsp;</div></li><li><div>                              &lt;/select&gt;&nbsp;</div></li><li><div>                               &lt;?php _ex( 'of', 'number of pages', 'woocommerce' ); ?&gt; &lt;span class=&quot;total-pages&quot;&gt;&lt;?php echo $variations_total_pages; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;next-page&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the next page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&rsaquo;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;a class=&quot;last-page&quot; title=&quot;&lt;?php esc_attr_e( 'Go to the last page', 'woocommerce' ); ?&gt;&quot; href=&quot;#&quot;&gt;&raquo;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save meta box data.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function save( $post_id, $post ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add any default post meta</span>&nbsp;</div></li><li><div>      add_post_meta( $post_id, 'total_sales', '0', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get types</span>&nbsp;</div></li><li><div>      $product_type = empty( $_POST['product-type'] ) ? 'simple' : sanitize_title( stripslashes( $_POST['product-type'] ) );&nbsp;</div></li><li><div>      $is_downloadable = isset( $_POST['_downloadable'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>      $is_virtual = isset( $_POST['_virtual'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Product type + Downloadable/Virtual</span>&nbsp;</div></li><li><div>      wp_set_object_terms( $post_id, $product_type, 'product_type' );&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_downloadable', $is_downloadable );&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_virtual', $is_virtual );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update post meta</span></span>&nbsp;</div></li><li><div>      if ( isset( $_POST['_tax_status'] ) ) {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_tax_status', wc_clean( $_POST['_tax_status'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['_tax_class'] ) ) {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_tax_class', wc_clean( $_POST['_tax_class'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['_purchase_note'] ) ) {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_purchase_note', wp_kses_post( stripslashes( $_POST['_purchase_note'] ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Featured</span>&nbsp;</div></li><li><div>      if ( update_post_meta( $post_id, '_featured', isset( $_POST['_featured'] ) ? 'yes' : 'no' ) ) {&nbsp;</div></li><li><div>          delete_transient( 'wc_featured_products' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Dimensions</span>&nbsp;</div></li><li><div>      if ( 'no' == $is_virtual ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_weight'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_weight', ( '' === $_POST['_weight'] ) ? '' : wc_format_decimal( $_POST['_weight'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_length'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_length', ( '' === $_POST['_length'] ) ? '' : wc_format_decimal( $_POST['_length'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_width'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_width', ( '' === $_POST['_width'] ) ? '' : wc_format_decimal( $_POST['_width'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_height'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_height', ( '' === $_POST['_height'] ) ? '' : wc_format_decimal( $_POST['_height'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_weight', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_length', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_width', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_height', '' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Save shipping class</span></span>&nbsp;</div></li><li><div>      $product_shipping_class = $_POST['product_shipping_class'] &gt; 0 && $product_type != 'external' ? absint( $_POST['product_shipping_class'] ) : '';&nbsp;</div></li><li><div>      wp_set_object_terms( $post_id, $product_shipping_class, 'product_shipping_class');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Unique SKU</span></span>&nbsp;</div></li><li><div>      $sku = get_post_meta( $post_id, '_sku', true );&nbsp;</div></li><li><div>      $new_sku = (string) wc_clean( $_POST['_sku'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' == $new_sku ) {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sku', '' );&nbsp;</div></li><li><div>      } elseif ( $new_sku !== $sku ) {&nbsp;</div></li><li><div>          if ( ! empty( $new_sku ) ) {&nbsp;</div></li><li><div>              $unique_sku = wc_product_has_unique_sku( $post_id, $new_sku );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! $unique_sku ) {&nbsp;</div></li><li><div>                  WC_Admin_Meta_Boxes::add_error( __( 'Product SKU must be unique.', 'woocommerce' ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  update_post_meta( $post_id, '_sku', $new_sku );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_sku', '' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Save Attributes</span>&nbsp;</div></li><li><div>      $attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['attribute_names'] ) && isset( $_POST['attribute_values'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $attribute_names = $_POST['attribute_names'];&nbsp;</div></li><li><div>          $attribute_values = $_POST['attribute_values'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['attribute_visibility'] ) ) {&nbsp;</div></li><li><div>              $attribute_visibility = $_POST['attribute_visibility'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['attribute_variation'] ) ) {&nbsp;</div></li><li><div>              $attribute_variation = $_POST['attribute_variation'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $attribute_is_taxonomy = $_POST['attribute_is_taxonomy'];&nbsp;</div></li><li><div>          $attribute_position = $_POST['attribute_position'];&nbsp;</div></li><li><div>          $attribute_names_max_key = max( array_keys( $attribute_names ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ( $i = 0; $i &lt;= $attribute_names_max_key; $i++ ) {&nbsp;</div></li><li><div>              if ( empty( $attribute_names[ $i ] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $is_visible = isset( $attribute_visibility[ $i ] ) ? 1 : 0;&nbsp;</div></li><li><div>              $is_variation = isset( $attribute_variation[ $i ] ) ? 1 : 0;&nbsp;</div></li><li><div>              $is_taxonomy = $attribute_is_taxonomy[ $i ] ? 1 : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $is_taxonomy ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $values_are_slugs = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( isset( $attribute_values[ $i ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Select based attributes - Format values (posted values are slugs)</span>&nbsp;</div></li><li><div>                      if ( is_array( $attribute_values[ $i ] ) ) {&nbsp;</div></li><li><div>                          $values = array_map( 'sanitize_title', $attribute_values[ $i ] );&nbsp;</div></li><li><div>                          $values_are_slugs = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Text based attributes - Posted values are term names - don't change to slugs</span>&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $values = array_map( 'stripslashes', array_map( 'strip_tags', explode( WC_DELIMITER, $attribute_values[ $i ] ) ) );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Remove empty items in the array</span>&nbsp;</div></li><li><div>                      $values = array_filter( $values, 'strlen' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $values = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Update post terms</span>&nbsp;</div></li><li><div>                  if ( taxonomy_exists( $attribute_names[ $i ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      foreach( $values as $key =&gt; $value ) {&nbsp;</div></li><li><div>                          $term = get_term_by( $values_are_slugs ? 'slug' : 'name', trim( $value ), $attribute_names[ $i ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( $term ) {&nbsp;</div></li><li><div>                              $values[ $key ] = intval( $term-&gt;term_id );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $term = wp_insert_term( trim( $value ), $attribute_names[ $i ] );&nbsp;</div></li><li><div>                              if ( isset( $term-&gt;term_id ) ) {&nbsp;</div></li><li><div>                                  $values[ $key ] = intval($term-&gt;term_id);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      wp_set_object_terms( $post_id, $values, $attribute_names[ $i ] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $values ) ) {&nbsp;</div></li><li><div>                      <span class="comment">// Add attribute to array, but don't set values</span>&nbsp;</div></li><li><div>                      $attributes[ sanitize_title( $attribute_names[ $i ] ) ] = array(&nbsp;</div></li><li><div>                          'name' =&gt; wc_clean( $attribute_names[ $i ] ), &nbsp;</div></li><li><div>                          'value' =&gt; '', &nbsp;</div></li><li><div>                          'position' =&gt; $attribute_position[ $i ], &nbsp;</div></li><li><div>                          'is_visible' =&gt; $is_visible, &nbsp;</div></li><li><div>                          'is_variation' =&gt; $is_variation, &nbsp;</div></li><li><div>                          'is_taxonomy' =&gt; $is_taxonomy&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( isset( $attribute_values[ $i ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Text based, possibly separated by pipes (WC_DELIMITER). Preserve line breaks in non-variation attributes.</span>&nbsp;</div></li><li><div>                  $values = $is_variation ? wc_clean( $attribute_values[ $i ] ) : implode( &quot;\n&quot;, array_map( 'wc_clean', explode( &quot;\n&quot;, $attribute_values[ $i ] ) ) );&nbsp;</div></li><li><div>                  $values = implode( ' ' . WC_DELIMITER . ' ', wc_get_text_attributes( $values ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Custom attribute - Add attribute to array and set the values</span>&nbsp;</div></li><li><div>                  $attributes[ sanitize_title( $attribute_names[ $i ] ) ] = array(&nbsp;</div></li><li><div>                      'name' =&gt; wc_clean( $attribute_names[ $i ] ), &nbsp;</div></li><li><div>                      'value' =&gt; $values, &nbsp;</div></li><li><div>                      'position' =&gt; $attribute_position[ $i ], &nbsp;</div></li><li><div>                      'is_visible' =&gt; $is_visible, &nbsp;</div></li><li><div>                      'is_variation' =&gt; $is_variation, &nbsp;</div></li><li><div>                      'is_taxonomy' =&gt; $is_taxonomy&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      uasort( $attributes, 'wc_product_attribute_uasort_comparison' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Unset removed attributes by looping over previous values and</span>&nbsp;</div></li><li><div><span class="comment">       * unsetting the terms.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $old_attributes = array_filter( (array) maybe_unserialize( get_post_meta( $post_id, '_product_attributes', true ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $old_attributes ) ) {&nbsp;</div></li><li><div>          foreach ( $old_attributes as $key =&gt; $value ) {&nbsp;</div></li><li><div>              if ( empty( $attributes[ $key ] ) && ! empty( $value['is_taxonomy'] ) && taxonomy_exists( $key ) ) {&nbsp;</div></li><li><div>                  wp_set_object_terms( $post_id, array(), $key );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * After removed attributes are unset, we can set the new attribute data.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_product_attributes', $attributes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sales and prices</span>&nbsp;</div></li><li><div>      if ( in_array( $product_type, array( 'variable', 'grouped' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Variable and grouped products have no prices</span>&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_regular_price', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price_dates_from', '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price_dates_to', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $date_from = (string) isset( $_POST['_sale_price_dates_from'] ) ? wc_clean( $_POST['_sale_price_dates_from'] ) : '';&nbsp;</div></li><li><div>          $date_to = (string) isset( $_POST['_sale_price_dates_to'] ) ? wc_clean( $_POST['_sale_price_dates_to'] )     : '';&nbsp;</div></li><li><div>          $regular_price = (string) isset( $_POST['_regular_price'] ) ? wc_clean( $_POST['_regular_price'] )                 : '';&nbsp;</div></li><li><div>          $sale_price = (string) isset( $_POST['_sale_price'] ) ? wc_clean( $_POST['_sale_price'] )                       : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_regular_price', '' === $regular_price ? '' : wc_format_decimal( $regular_price ) );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price', '' === $sale_price ? '' : wc_format_decimal( $sale_price ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Dates</span>&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price_dates_from', $date_from ? strtotime( $date_from ) : '' );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sale_price_dates_to', $date_to ? strtotime( $date_to ) : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $date_to && ! $date_from ) {&nbsp;</div></li><li><div>              $date_from = date( 'Y-m-d' );&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_sale_price_dates_from', strtotime( $date_from ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Update price if on sale</span></span>&nbsp;</div></li><li><div>          if ( '' !== $sale_price && '' === $date_to && '' === $date_from ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_price', wc_format_decimal( $sale_price ) );&nbsp;</div></li><li><div>          } elseif ( '' !== $sale_price && $date_from && strtotime( $date_from ) &lt;= strtotime( 'NOW', current_time( 'timestamp' ) ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_price', wc_format_decimal( $sale_price ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_price', '' === $regular_price ? '' : wc_format_decimal( $regular_price ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $date_to && strtotime( $date_to ) &lt; strtotime( 'NOW', current_time( 'timestamp' ) ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_price', '' === $regular_price ? '' : wc_format_decimal( $regular_price ) );&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_sale_price', '' );&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_sale_price_dates_from', '' );&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_sale_price_dates_to', '' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Update parent if grouped so price sorting works and stays in sync with the cheapest child</span>&nbsp;</div></li><li><div>      if ( $post-&gt;post_parent &gt; 0 || 'grouped' === $product_type || $_POST['previous_parent_id'] &gt; 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $clear_parent_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $post-&gt;post_parent &gt; 0 ) {&nbsp;</div></li><li><div>              $clear_parent_ids[] = $post-&gt;post_parent;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'grouped' === $product_type ) {&nbsp;</div></li><li><div>              $clear_parent_ids[] = $post_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $_POST['previous_parent_id'] &gt; 0 ) {&nbsp;</div></li><li><div>              $clear_parent_ids[] = absint( $_POST['previous_parent_id'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $clear_parent_ids ) ) {&nbsp;</div></li><li><div>              foreach ( $clear_parent_ids as $clear_id ) {&nbsp;</div></li><li><div>                  $children_by_price = get_posts( array(&nbsp;</div></li><li><div>                      'post_parent' =&gt; $clear_id, &nbsp;</div></li><li><div>                      'orderby' =&gt; 'meta_value_num', &nbsp;</div></li><li><div>                      'order' =&gt; 'asc', &nbsp;</div></li><li><div>                      'meta_key' =&gt; '_price', &nbsp;</div></li><li><div>                      'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                      'post_type' =&gt; 'product', &nbsp;</div></li><li><div>                      'fields' =&gt; 'ids'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( $children_by_price ) {&nbsp;</div></li><li><div>                      foreach ( $children_by_price as $child ) {&nbsp;</div></li><li><div>                          $child_price = get_post_meta( $child, '_price', true );&nbsp;</div></li><li><div>                          update_post_meta( $clear_id, '_price', $child_price );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  wc_delete_product_transients( $clear_id );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sold Individually</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['_sold_individually'] ) ) {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sold_individually', 'yes' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_sold_individually', '' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Stock</span> Data&nbsp;</div></li><li><div>      if ( 'yes' === get_option( 'woocommerce_manage_stock' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $manage_stock = 'no';&nbsp;</div></li><li><div>          $backorders = 'no';&nbsp;</div></li><li><div>          $stock_status = wc_clean( $_POST['_stock_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'external' === $product_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $stock_status = 'instock';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( 'variable' === $product_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Stock</span> status is always determined by children so sync later&nbsp;</div></li><li><div>              $stock_status = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $_POST['_manage_stock'] ) ) {&nbsp;</div></li><li><div>                  $manage_stock = 'yes';&nbsp;</div></li><li><div>                  $backorders = wc_clean( $_POST['_backorders'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( 'grouped' !== $product_type && ! empty( $_POST['_manage_stock'] ) ) {&nbsp;</div></li><li><div>              $manage_stock = 'yes';&nbsp;</div></li><li><div>              $backorders = wc_clean( $_POST['_backorders'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_manage_stock', $manage_stock );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_backorders', $backorders );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $stock_status ) {&nbsp;</div></li><li><div>              wc_update_product_stock_status( $post_id, $stock_status );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $_POST['_manage_stock'] ) ) {&nbsp;</div></li><li><div>              wc_update_product_stock( $post_id, wc_stock_amount( $_POST['_stock'] ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_stock', '' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } elseif ( 'variable' !== $product_type ) {&nbsp;</div></li><li><div>          wc_update_product_stock_status( $post_id, wc_clean( $_POST['_stock_status'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Cross sells and upsells</span>&nbsp;</div></li><li><div>      $upsells = isset( $_POST['upsell_ids'] ) ? array_filter( array_map( 'intval', explode( ', ', $_POST['upsell_ids'] ) ) ) : array();&nbsp;</div></li><li><div>      $crosssells = isset( $_POST['crosssell_ids'] ) ? array_filter( array_map( 'intval', explode( ', ', $_POST['crosssell_ids'] ) ) ) : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_upsell_ids', $upsells );&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_crosssell_ids', $crosssells );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Downloadable options</span>&nbsp;</div></li><li><div>      if ( 'yes' == $is_downloadable ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_download_limit = absint( $_POST['_download_limit'] );&nbsp;</div></li><li><div>          if ( ! $_download_limit ) {&nbsp;</div></li><li><div>              $_download_limit = ''; <span class="comment"><span class="comment">// 0 or blank = unlimited</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_download_expiry = absint( $_POST['_download_expiry'] );&nbsp;</div></li><li><div>          if ( ! $_download_expiry ) {&nbsp;</div></li><li><div>              $_download_expiry = ''; <span class="comment"><span class="comment">// 0 or blank = unlimited</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// file paths will be stored in an array keyed off md5(file path)</span>&nbsp;</div></li><li><div>          $files = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_wc_file_urls'] ) ) {&nbsp;</div></li><li><div>              $file_names = isset( $_POST['_wc_file_names'] ) ? $_POST['_wc_file_names'] : array();&nbsp;</div></li><li><div>              $file_urls = isset( $_POST['_wc_file_urls'] )  ? wp_unslash( array_map( 'trim', $_POST['_wc_file_urls'] ) ) : array();&nbsp;</div></li><li><div>              $file_url_size = sizeof( $file_urls );&nbsp;</div></li><li><div>              $allowed_file_types = apply_filters( 'woocommerce_downloadable_file_allowed_mime_types', get_allowed_mime_types() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              for ( $i = 0; $i &lt; $file_url_size; $i ++ ) {&nbsp;</div></li><li><div>                  if ( ! empty( $file_urls[ $i ] ) ) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Find type and file URL</span></span>&nbsp;</div></li><li><div>                      if ( 0 === strpos( $file_urls[ $i ], 'http' ) ) {&nbsp;</div></li><li><div>                          $file_is = 'absolute';&nbsp;</div></li><li><div>                          $file_url = esc_url_raw( $file_urls[ $i ] );&nbsp;</div></li><li><div>                      } elseif ( '[' === substr( $file_urls[ $i ], 0, 1 ) && ']' === substr( $file_urls[ $i ], -1 ) ) {&nbsp;</div></li><li><div>                          $file_is = 'shortcode';&nbsp;</div></li><li><div>                          $file_url = wc_clean( $file_urls[ $i ] );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $file_is = 'relative';&nbsp;</div></li><li><div>                          $file_url = wc_clean( $file_urls[ $i ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $file_name = wc_clean( $file_names[ $i ] );&nbsp;</div></li><li><div>                      $file_hash = md5( $file_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Validate the file extension</span></span>&nbsp;</div></li><li><div>                      if ( in_array( $file_is, array( 'absolute', 'relative' ) ) ) {&nbsp;</div></li><li><div>                          $file_type = wp_check_filetype( strtok( $file_url, '?' ), $allowed_file_types );&nbsp;</div></li><li><div>                          $parsed_url = parse_url( $file_url, PHP_URL_PATH );&nbsp;</div></li><li><div>                          $extension = pathinfo( $parsed_url, PATHINFO_EXTENSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( ! empty( $extension ) && ! in_array( $file_type['type'], $allowed_file_types ) ) {&nbsp;</div></li><li><div>                              WC_Admin_Meta_Boxes::add_error( sprintf( __( 'The downloadable file %s cannot be used as it does not have an allowed file type. Allowed types include: %s', 'woocommerce' ), '&lt;code&gt;' . basename( $file_url ) . '&lt;/code&gt;', '&lt;code&gt;' . implode( ', ', array_keys( $allowed_file_types ) ) . '&lt;/code&gt;' ) );&nbsp;</div></li><li><div>                              continue;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Validate the file exists</span></span>&nbsp;</div></li><li><div>                      if ( 'relative' === $file_is ) {&nbsp;</div></li><li><div>                          $_file_url = $file_url;&nbsp;</div></li><li><div>                          if ( '..' === substr( $file_url, 0, 2 ) || '/' !== substr( $file_url, 0, 1 ) ) {&nbsp;</div></li><li><div>                              $_file_url = realpath( ABSPATH . $file_url );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( ! apply_filters( 'woocommerce_downloadable_file_exists', file_exists( $_file_url ), $file_url ) ) {&nbsp;</div></li><li><div>                              WC_Admin_Meta_Boxes::add_error( sprintf( __( 'The downloadable file %s cannot be used as it does not exist on the server.', 'woocommerce' ), '&lt;code&gt;' . $file_url . '&lt;/code&gt;' ) );&nbsp;</div></li><li><div>                              continue;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $files[ $file_hash ] = array(&nbsp;</div></li><li><div>                          'name' =&gt; $file_name, &nbsp;</div></li><li><div>                          'file' =&gt; $file_url&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// grant permission to any newly added files on any existing orders for this product prior to saving</span></span>&nbsp;</div></li><li><div>          do_action( 'woocommerce_process_product_file_download_paths', $post_id, 0, $files );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_downloadable_files', $files );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_download_limit', $_download_limit );&nbsp;</div></li><li><div>          update_post_meta( $post_id, '_download_expiry', $_download_expiry );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_download_type'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_download_type', wc_clean( $_POST['_download_type'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Product url</span>&nbsp;</div></li><li><div>      if ( 'external' == $product_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_product_url'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_product_url', esc_url_raw( $_POST['_product_url'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['_button_text'] ) ) {&nbsp;</div></li><li><div>              update_post_meta( $post_id, '_button_text', wc_clean( $_POST['_button_text'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Save variations</span>&nbsp;</div></li><li><div>      if ( 'variable' == $product_type ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Update parent if variable so price sorting works and stays in sync with the cheapest child</span></span>&nbsp;</div></li><li><div>          WC_Product_Variable::sync( $post_id );&nbsp;</div></li><li><div>          WC_Product_Variable::sync_stock_status( $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Update version after saving</span>&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_product_version', WC_VERSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Do action for product type</span>&nbsp;</div></li><li><div>      do_action( 'woocommerce_process_product_meta_' . $product_type, $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Clear cache/transients</span>&nbsp;</div></li><li><div>      wc_delete_product_transients( $post_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save meta box data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $post_id</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function save_variations( $post_id, $post ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attributes = (array) maybe_unserialize( get_post_meta( $post_id, '_product_attributes', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['variable_sku'] ) ) {&nbsp;</div></li><li><div>          $variable_post_id = $_POST['variable_post_id'];&nbsp;</div></li><li><div>          $variable_sku = $_POST['variable_sku'];&nbsp;</div></li><li><div>          $variable_regular_price = $_POST['variable_regular_price'];&nbsp;</div></li><li><div>          $variable_sale_price = $_POST['variable_sale_price'];&nbsp;</div></li><li><div>          $upload_image_id = $_POST['upload_image_id'];&nbsp;</div></li><li><div>          $variable_download_limit = $_POST['variable_download_limit'];&nbsp;</div></li><li><div>          $variable_download_expiry = $_POST['variable_download_expiry'];&nbsp;</div></li><li><div>          $variable_shipping_class = $_POST['variable_shipping_class'];&nbsp;</div></li><li><div>          $variable_tax_class = isset( $_POST['variable_tax_class'] ) ? $_POST['variable_tax_class'] : array();&nbsp;</div></li><li><div>          $variable_menu_order = $_POST['variation_menu_order'];&nbsp;</div></li><li><div>          $variable_sale_price_dates_from = $_POST['variable_sale_price_dates_from'];&nbsp;</div></li><li><div>          $variable_sale_price_dates_to = $_POST['variable_sale_price_dates_to'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $variable_weight = isset( $_POST['variable_weight'] ) ? $_POST['variable_weight'] : array();&nbsp;</div></li><li><div>          $variable_length = isset( $_POST['variable_length'] ) ? $_POST['variable_length'] : array();&nbsp;</div></li><li><div>          $variable_width = isset( $_POST['variable_width'] ) ? $_POST['variable_width'] : array();&nbsp;</div></li><li><div>          $variable_height = isset( $_POST['variable_height'] ) ? $_POST['variable_height'] : array();&nbsp;</div></li><li><div>          $variable_enabled = isset( $_POST['variable_enabled'] ) ? $_POST['variable_enabled'] : array();&nbsp;</div></li><li><div>          $variable_is_virtual = isset( $_POST['variable_is_virtual'] ) ? $_POST['variable_is_virtual'] : array();&nbsp;</div></li><li><div>          $variable_is_downloadable = isset( $_POST['variable_is_downloadable'] ) ? $_POST['variable_is_downloadable'] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $variable_manage_stock = isset( $_POST['variable_manage_stock'] ) ? $_POST['variable_manage_stock'] : array();&nbsp;</div></li><li><div>          $variable_stock = isset( $_POST['variable_stock'] ) ? $_POST['variable_stock'] : array();&nbsp;</div></li><li><div>          $variable_backorders = isset( $_POST['variable_backorders'] ) ? $_POST['variable_backorders'] : array();&nbsp;</div></li><li><div>          $variable_stock_status = isset( $_POST['variable_stock_status'] ) ? $_POST['variable_stock_status'] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $variable_description = isset( $_POST['variable_description'] ) ? $_POST['variable_description'] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $max_loop = max( array_keys( $_POST['variable_post_id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ( $i = 0; $i &lt;= $max_loop; $i ++ ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! isset( $variable_post_id[ $i ] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $variation_id = absint( $variable_post_id[ $i ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Checkboxes</span>&nbsp;</div></li><li><div>              $is_virtual = isset( $variable_is_virtual[ $i ] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>              $is_downloadable = isset( $variable_is_downloadable[ $i ] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>              $post_status = isset( $variable_enabled[ $i ] ) ? 'publish' : 'private';&nbsp;</div></li><li><div>              $manage_stock = isset( $variable_manage_stock[ $i ] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Generate a useful post title</span>&nbsp;</div></li><li><div>              $variation_post_title = sprintf( __( 'Variation #%s of %s', 'woocommerce' ), absint( $variation_id ), esc_html( get_the_title( $post_id ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Update or Add post</span>&nbsp;</div></li><li><div>              if ( ! $variation_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $variation = array(&nbsp;</div></li><li><div>                      'post_title' =&gt; $variation_post_title, &nbsp;</div></li><li><div>                      'post_content' =&gt; '', &nbsp;</div></li><li><div>                      'post_status' =&gt; $post_status, &nbsp;</div></li><li><div>                      'post_author' =&gt; get_current_user_id(), &nbsp;</div></li><li><div>                      'post_parent' =&gt; $post_id, &nbsp;</div></li><li><div>                      'post_type' =&gt; 'product_variation', &nbsp;</div></li><li><div>                      'menu_order' =&gt; $variable_menu_order[ $i ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $variation_id = wp_insert_post( $variation );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_create_product_variation', $variation_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $modified_date = date_i18n( 'Y-m-d H:i:s', current_time( 'timestamp' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $wpdb-&gt;update( $wpdb-&gt;posts, array(&nbsp;</div></li><li><div>                          'post_status' =&gt; $post_status, &nbsp;</div></li><li><div>                          'post_title' =&gt; $variation_post_title, &nbsp;</div></li><li><div>                          'menu_order' =&gt; $variable_menu_order[ $i ], &nbsp;</div></li><li><div>                          'post_modified' =&gt; $modified_date, &nbsp;</div></li><li><div>                          'post_modified_gmt' =&gt; get_gmt_from_date( $modified_date )&nbsp;</div></li><li><div> ), array( 'ID' =&gt; $variation_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  clean_post_cache( $variation_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_update_product_variation', $variation_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Only continue if we have a variation ID</span>&nbsp;</div></li><li><div>              if ( ! $variation_id ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Unique SKU</span></span>&nbsp;</div></li><li><div>              $sku = get_post_meta( $variation_id, '_sku', true );&nbsp;</div></li><li><div>              $new_sku = wc_clean( $variable_sku[ $i ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( '' == $new_sku ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_sku', '' );&nbsp;</div></li><li><div>              } elseif ( $new_sku !== $sku ) {&nbsp;</div></li><li><div>                  if ( ! empty( $new_sku ) ) {&nbsp;</div></li><li><div>                      $unique_sku = wc_product_has_unique_sku( $variation_id, $new_sku );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! $unique_sku ) {&nbsp;</div></li><li><div>                          WC_Admin_Meta_Boxes::add_error( sprintf( __( '#%s &ndash; Variation SKU must be unique.', 'woocommerce' ), $variation_id ) );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          update_post_meta( $variation_id, '_sku', $new_sku );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      update_post_meta( $variation_id, '_sku', '' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Update post meta</span></span>&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_thumbnail_id', absint( $upload_image_id[ $i ] ) );&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_virtual', wc_clean( $is_virtual ) );&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_downloadable', wc_clean( $is_downloadable ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $variable_weight[ $i ] ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_weight', ( '' === $variable_weight[ $i ] ) ? '' : wc_format_decimal( $variable_weight[ $i ] ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $variable_length[ $i ] ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_length', ( '' === $variable_length[ $i ] ) ? '' : wc_format_decimal( $variable_length[ $i ] ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $variable_width[ $i ] ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_width', ( '' === $variable_width[ $i ] ) ? '' : wc_format_decimal( $variable_width[ $i ] ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $variable_height[ $i ] ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_height', ( '' === $variable_height[ $i ] ) ? '' : wc_format_decimal( $variable_height[ $i ] ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Stock</span> handling&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_manage_stock', $manage_stock );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'yes' === $manage_stock ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_backorders', wc_clean( $variable_backorders[ $i ] ) );&nbsp;</div></li><li><div>                  wc_update_product_stock( $variation_id, wc_stock_amount( $variable_stock[ $i ] ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  delete_post_meta( $variation_id, '_backorders' );&nbsp;</div></li><li><div>                  delete_post_meta( $variation_id, '_stock' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Only update stock status to user setting if changed by the user, but do so before looking at stock levels at variation level</span>&nbsp;</div></li><li><div>              if ( ! empty( $variable_stock_status[ $i ] ) ) {&nbsp;</div></li><li><div>                  wc_update_product_stock_status( $variation_id, $variable_stock_status[ $i ] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Price</span> handling&nbsp;</div></li><li><div>              $regular_price = wc_format_decimal( $variable_regular_price[ $i ] );&nbsp;</div></li><li><div>              $sale_price = $variable_sale_price[ $i ] === '' ? '' : wc_format_decimal( $variable_sale_price[ $i ] );&nbsp;</div></li><li><div>              $date_from = wc_clean( $variable_sale_price_dates_from[ $i ] );&nbsp;</div></li><li><div>              $date_to = wc_clean( $variable_sale_price_dates_to[ $i ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_regular_price', $regular_price );&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_sale_price', $sale_price );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Save Dates</span>&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_sale_price_dates_from', $date_from ? strtotime( $date_from ) : '' );&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_sale_price_dates_to', $date_to ? strtotime( $date_to ) : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $date_to && ! $date_from ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_sale_price_dates_from', strtotime( 'NOW', current_time( 'timestamp' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Update price if on sale</span></span>&nbsp;</div></li><li><div>              if ( '' !== $sale_price && '' === $date_to && '' === $date_from ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_price', $sale_price );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_price', $regular_price );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( '' !== $sale_price && $date_from && strtotime( $date_from ) &lt; strtotime( 'NOW', current_time( 'timestamp' ) ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_price', $sale_price );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $date_to && strtotime( $date_to ) &lt; strtotime( 'NOW', current_time( 'timestamp' ) ) ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_price', $regular_price );&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_sale_price_dates_from', '' );&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_sale_price_dates_to', '' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $variable_tax_class[ $i ] ) && $variable_tax_class[ $i ] !== 'parent' ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_tax_class', wc_clean( $variable_tax_class[ $i ] ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  delete_post_meta( $variation_id, '_tax_class' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'yes' == $is_downloadable ) {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_download_limit', wc_clean( $variable_download_limit[ $i ] ) );&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_download_expiry', wc_clean( $variable_download_expiry[ $i ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $files = array();&nbsp;</div></li><li><div>                  $file_names = isset( $_POST['_wc_variation_file_names'][ $variation_id ] ) ? array_map( 'wc_clean', $_POST['_wc_variation_file_names'][ $variation_id ] ) : array();&nbsp;</div></li><li><div>                  $file_urls = isset( $_POST['_wc_variation_file_urls'][ $variation_id ] ) ? array_map( 'wc_clean', $_POST['_wc_variation_file_urls'][ $variation_id ] ) : array();&nbsp;</div></li><li><div>                  $file_url_size = sizeof( $file_urls );&nbsp;</div></li><li><div>                  $allowed_file_types = get_allowed_mime_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  for ( $ii = 0; $ii &lt; $file_url_size; $ii ++ ) {&nbsp;</div></li><li><div>                      if ( ! empty( $file_urls[ $ii ] ) ) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Find type and file URL</span></span>&nbsp;</div></li><li><div>                          if ( 0 === strpos( $file_urls[ $ii ], 'http' ) ) {&nbsp;</div></li><li><div>                              $file_is = 'absolute';&nbsp;</div></li><li><div>                              $file_url = esc_url_raw( $file_urls[ $ii ] );&nbsp;</div></li><li><div>                          } elseif ( '[' === substr( $file_urls[ $ii ], 0, 1 ) && ']' === substr( $file_urls[ $ii ], -1 ) ) {&nbsp;</div></li><li><div>                              $file_is = 'shortcode';&nbsp;</div></li><li><div>                              $file_url = wc_clean( $file_urls[ $ii ] );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $file_is = 'relative';&nbsp;</div></li><li><div>                              $file_url = wc_clean( $file_urls[ $ii ] );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $file_name = wc_clean( $file_names[ $ii ] );&nbsp;</div></li><li><div>                          $file_hash = md5( $file_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Validate the file extension</span></span>&nbsp;</div></li><li><div>                          if ( in_array( $file_is, array( 'absolute', 'relative' ) ) ) {&nbsp;</div></li><li><div>                              $file_type = wp_check_filetype( strtok( $file_url, '?' ), $allowed_file_types );&nbsp;</div></li><li><div>                              $parsed_url = parse_url( $file_url, PHP_URL_PATH );&nbsp;</div></li><li><div>                              $extension = pathinfo( $parsed_url, PATHINFO_EXTENSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( ! empty( $extension ) && ! in_array( $file_type['type'], $allowed_file_types ) ) {&nbsp;</div></li><li><div>                                  WC_Admin_Meta_Boxes::add_error( sprintf( __( '#%s &ndash; The downloadable file %s cannot be used as it does not have an allowed file type. Allowed types include: %s', 'woocommerce' ), $variation_id, '&lt;code&gt;' . basename( $file_url ) . '&lt;/code&gt;', '&lt;code&gt;' . implode( ', ', array_keys( $allowed_file_types ) ) . '&lt;/code&gt;' ) );&nbsp;</div></li><li><div>                                  continue;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Validate the file exists</span></span>&nbsp;</div></li><li><div>                          if ( 'relative' === $file_is && ! apply_filters( 'woocommerce_downloadable_file_exists', file_exists( $file_url ), $file_url ) ) {&nbsp;</div></li><li><div>                              WC_Admin_Meta_Boxes::add_error( sprintf( __( '#%s &ndash; The downloadable file %s cannot be used as it does not exist on the server.', 'woocommerce' ), $variation_id, '&lt;code&gt;' . $file_url . '&lt;/code&gt;' ) );&nbsp;</div></li><li><div>                              continue;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $files[ $file_hash ] = array(&nbsp;</div></li><li><div>                              'name' =&gt; $file_name, &nbsp;</div></li><li><div>                              'file' =&gt; $file_url&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// grant permission to any newly added files on any existing orders for this product prior to saving</span></span>&nbsp;</div></li><li><div>                  do_action( 'woocommerce_process_product_file_download_paths', $post_id, $variation_id, $files );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_downloadable_files', $files );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_download_limit', '' );&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_download_expiry', '' );&nbsp;</div></li><li><div>                  update_post_meta( $variation_id, '_downloadable_files', '' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              update_post_meta( $variation_id, '_variation_description', wp_kses_post( $variable_description[ $i ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Save shipping class</span></span>&nbsp;</div></li><li><div>              $variable_shipping_class[ $i ] = ! empty( $variable_shipping_class[ $i ] ) ? (int) $variable_shipping_class[ $i ] : '';&nbsp;</div></li><li><div>              wp_set_object_terms( $variation_id, $variable_shipping_class[ $i ], 'product_shipping_class');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Update Attributes</span>&nbsp;</div></li><li><div>              $updated_attribute_keys = array();&nbsp;</div></li><li><div>              foreach ( $attributes as $attribute ) {&nbsp;</div></li><li><div>                  if ( $attribute['is_variation'] ) {&nbsp;</div></li><li><div>                      $attribute_key = 'attribute_' . sanitize_title( $attribute['name'] );&nbsp;</div></li><li><div>                      $updated_attribute_keys[] = $attribute_key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $attribute['is_taxonomy'] ) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Don't use wc_clean as it destroys sanitized characters</span></span>&nbsp;</div></li><li><div>                          $value = isset( $_POST[ $attribute_key ][ $i ] ) ? sanitize_title( stripslashes( $_POST[ $attribute_key ][ $i ] ) ) : '';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $value = isset( $_POST[ $attribute_key ][ $i ] ) ? wc_clean( stripslashes( $_POST[ $attribute_key ][ $i ] ) ) : '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      update_post_meta( $variation_id, $attribute_key, $value );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Remove old taxonomies attributes so data is kept up to date - first get attribute key names</span>&nbsp;</div></li><li><div>              $delete_attribute_keys = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT meta_key FROM {$wpdb-&gt;postmeta} WHERE meta_key LIKE 'attribute_%%' AND meta_key NOT IN ( '&quot; . implode( &quot;', '&quot;, $updated_attribute_keys ) . &quot;' ) AND post_id = %d;&quot;, $variation_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $delete_attribute_keys as $key ) {&nbsp;</div></li><li><div>                  delete_post_meta( $variation_id, $key );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_action( 'woocommerce_save_product_variation', $variation_id, $i );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update parent if variable so price sorting works and stays in sync with the cheapest child</span></span>&nbsp;</div></li><li><div>      WC_Product_Variable::sync( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Update default attribute options setting</span>&nbsp;</div></li><li><div>      $default_attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $attributes as $attribute ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $attribute['is_variation'] ) {&nbsp;</div></li><li><div>              $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $_POST[ 'default_attribute_' . sanitize_title( $attribute['name'] ) ] ) ) {&nbsp;</div></li><li><div>                  if ( $attribute['is_taxonomy'] ) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Don't use wc_clean as it destroys sanitized characters</span></span>&nbsp;</div></li><li><div>                      $value = sanitize_title( trim( stripslashes( $_POST[ 'default_attribute_' . sanitize_title( $attribute['name'] ) ] ) ) );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $value = wc_clean( trim( stripslashes( $_POST[ 'default_attribute_' . sanitize_title( $attribute['name'] ) ] ) ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $value ) {&nbsp;</div></li><li><div>                  $default_attributes[ sanitize_title( $attribute['name'] ) ] = $value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_post_meta( $post_id, '_default_attributes', $default_attributes );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>WooCommerce</li><li><span></span>2.6.4</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>