<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.1.0" data-slug="nextgen-gallery-image-chooser" data-type="file" data-id="89829"><head xmlns="http://www.w3.org/1999/xhtml"><title> nextgen-ic | file | Nextgen Gallery Image Chooser | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, nextgen-gallery-image-chooser, 1.1.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=d0db9a5798e875c05d83e8739a66063a' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/nextgen-ic/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fnextgen-ic%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fnextgen-ic%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-gallery-image-chooser-1.1.0-file-nextgen-ic","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="nextgen-ic" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-gallery-image-chooser." href="http://hookr.io/plugins/nextgen-gallery-image-chooser/" class="plugin"><span property="name">nextgen-gallery-image-chooser</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.1.0." href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/" class="H_VERSION"><span property="name">1.1.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">nextgen-ic</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="36"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/all/" title="All">All <span class="count badge">36</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="6"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/classes/" title="Classes">Classes <span class="count badge">6</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="30"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/functions/" title="Functions">Functions <span class="count badge">30</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery-image-chooser/1.1.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/nextgen-ic.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Plugin Name: NextGEN Gallery Image Chooser</span>&nbsp;</div></li><li><div><span class="comment"> * Plugin URI:</span>&nbsp;</div></li><li><div><span class="comment"> * Description: Comfortable image chooser for the NextGEN Gallery. Based on g2image.</span>&nbsp;</div></li><li><div><span class="comment"> * Version: 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> * Author: Ulrich Mertin</span>&nbsp;</div></li><li><div><span class="comment"> * Author URI: http://www.ulrich-mertin.de</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This plugin is based on g2image by Kirk Steffensen, </span>&nbsp;</div></li><li><div><span class="comment"> * see http://g2image.steffensenfamily.com/ for further contributors.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Released under the GPL version 2.</span>&nbsp;</div></li><li><div><span class="comment"> * A copy of the license is in the root folder of this plugin.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>global $wpdb, $ngg, $wp_version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ====( Version Info )</span>&nbsp;</div></li><li><div>$nggic_version_text = '1.1.0';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment">// Is this a TinyMCE window?</span></span>&nbsp;</div></li><li><div>if (! isset ( $_REQUEST ['nggic_tinymce'] ) && ! isset ( $_SESSION ['nggic_tinymce'] )) {&nbsp;</div></li><li><div>  <span class="comment">// Activate & Deactivate Plugin Functions</span>&nbsp;</div></li><li><div>  register_activation_hook ( __FILE__, 'nggic_pluginactivate' );&nbsp;</div></li><li><div>  register_deactivation_hook ( __FILE__, 'nggic_plugindeactivate' );&nbsp;</div></li><li><div>  <span class="comment">// Image Chooser Buttons - Visual Editor</span>&nbsp;</div></li><li><div>  add_action ( 'init', 'nggic_init' );&nbsp;</div></li><li><div>  add_action ( 'init', 'nggic_addbuttons' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Create admin menu</span>&nbsp;</div></li><li><div>  if (is_admin ()) {&nbsp;</div></li><li><div>      require_once (dirname ( __FILE__ ) . '/admin/admin.php');&nbsp;</div></li><li><div>      $nggicAdminPanel = new nggicAdminPanel ();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ====( Initialization Code )</span>&nbsp;</div></li><li><div>require_once ('../../../wp-load.php');&nbsp;</div></li><li><div>session_start ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// get the options</span>&nbsp;</div></li><li><div>$nggic_options = get_option ( 'nggic_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (! isset ( $nggic_options ['sortby'] )) {&nbsp;</div></li><li><div>  die ( 'Plugin was not activated - no options found!' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>nggic_init ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ====( NextGEN Gallery validation )</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (! function_exists ( 'nggShowGallery' )) {&nbsp;</div></li><li><div>  die ( __ ( 'Required NextGEN Gallery was not found!', 'nggic' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>nggic_get_request_and_session_options ();&nbsp;</div></li><li><div>$nggic_gallery_items = nggic_get_gallery_items ();&nbsp;</div></li><li><div>$nggic_imginsert_options = nggic_get_imginsert_selectoptions ();&nbsp;</div></li><li><div>$tree = nggic_get_album_tree ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ====( Main HTML Generation Code )</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo nggic_make_html_header ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo '        &lt;table&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '            &lt;tr&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '                &lt;td width=&quot;200px&quot; valign=&quot;top&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo nggic_make_html_album_tree ( $tree );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo '                &lt;/td&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '                &lt;td valign=&quot;top&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo '                    &lt;div class=&quot;main&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo nggic_make_html_ngg_album_insert_button ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (empty ( $nggic_gallery_items )) {&nbsp;</div></li><li><div>  echo nggic_make_html_empty_page ();&nbsp;</div></li><li><div>} else {&nbsp;</div></li><li><div>  $nggic_page_navigation = nggic_make_html_page_navigation ();&nbsp;</div></li><li><div>  echo nggic_make_html_display_options ();&nbsp;</div></li><li><div>  echo nggic_make_html_controls ();&nbsp;</div></li><li><div>  print_r ( $nggic_page_navigation );&nbsp;</div></li><li><div>  echo nggic_make_html_image_navigation ();&nbsp;</div></li><li><div>  print_r ( $nggic_page_navigation );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo nggic_make_html_about ( $nggic_version_text );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>echo '                    &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '                &lt;/td&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '            &lt;/tr&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '        &lt;/table&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '    &lt;/form&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>echo '&lt;/body&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>echo '&lt;/html&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$_SESSION ['nggic_last_album_visited'] = $nggic_options ['current_gallery'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ====( Functions - Alphabetical by Function Name)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds nggic to the TinyMCE button Toolbar</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param</span>&nbsp;</div></li><li><div><span class="comment"> *            null</span>&nbsp;</div></li><li><div><span class="comment"> * @return null</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_addbuttons() {&nbsp;</div></li><li><div>  <span class="comment">// Don't bother doing this stuff if the current user lacks permissions</span>&nbsp;</div></li><li><div>  if (! current_user_can ( 'edit_posts' ) && ! current_user_can ( 'edit_pages' ))&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Add only in Rich Editor mode</span>&nbsp;</div></li><li><div>  if (get_user_option ( 'rich_editing' ) == 'true') {&nbsp;</div></li><li><div>      add_filter ( &quot;mce_external_plugins&quot;, &quot;nggic_plugin&quot; );&nbsp;</div></li><li><div>      add_filter ( 'mce_buttons', 'nggic_wp_extended_editor_mce_buttons' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create tree of albums and galleries</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $tree The array of albums and galleries</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_album_tree() {&nbsp;</div></li><li><div>  global $wpdb, $ngg, $wp_version, $nggdb;&nbsp;</div></li><li><div>  global $albums, $galleries;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $galleries = array ();&nbsp;</div></li><li><div>  $albums = array ();&nbsp;</div></li><li><div>  $rootalbums = array ();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Get all galleries</span>&nbsp;</div></li><li><div>  $orphan_galleries = C_Gallery_Mapper::get_instance ()-&gt;find_all ();&nbsp;</div></li><li><div>  function find_index_by_gid($galleries, $gid) {&nbsp;</div></li><li><div>      foreach ( $galleries as $key =&gt; $gallery ) {&nbsp;</div></li><li><div>          if ($gallery-&gt;gid == $gid) {&nbsp;</div></li><li><div>              return $key;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return NULL;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Set up key-less arrays and get galleries for albums</span>&nbsp;</div></li><li><div>  <span class="comment">// Remove all attached galleries from $orphan_galleries</span>&nbsp;</div></li><li><div>  foreach ( C_Album_Mapper::get_instance ()-&gt;find_all () as $album ) {&nbsp;</div></li><li><div>      $albums [$album-&gt;{$album-&gt;id_field}] = $album;&nbsp;</div></li><li><div>      $rootalbums [$album-&gt;{$album-&gt;id_field}] = $album;&nbsp;</div></li><li><div>      foreach ( $album-&gt;sortorder as $value ) {&nbsp;</div></li><li><div>          if (! nggic_starts_with ( $value, 'a' )) {&nbsp;</div></li><li><div>              <span class="comment">// gallery</span>&nbsp;</div></li><li><div>              if (! key_exists ( $value, $galleries )) {&nbsp;</div></li><li><div>                  $id = find_index_by_gid ( $orphan_galleries, $value );&nbsp;</div></li><li><div>                  $galleries [$value] = $orphan_galleries [$id];&nbsp;</div></li><li><div>                  unset ( $orphan_galleries [$id] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Find root albums by removing all albums that are subalbums of other</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">// album</span>s</span> from the list</span>&nbsp;</div></li><li><div>  <span class="comment">// Find orphan galleries by removing all galleries that are attached to</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// album</span>s</span>&nbsp;</div></li><li><div>  foreach ( $albums as $id =&gt; $album ) {&nbsp;</div></li><li><div>      foreach ( $album-&gt;sortorder as $key =&gt; $value ) {&nbsp;</div></li><li><div>          if (nggic_starts_with ( $value, 'a' )) {&nbsp;</div></li><li><div>              <span class="comment">// album</span>&nbsp;</div></li><li><div>              $album_id = substr ( $value, 1 );&nbsp;</div></li><li><div>              unset ( $rootalbums [$album_id] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Build tree</span>&nbsp;</div></li><li><div>  $tree = array ();&nbsp;</div></li><li><div>  foreach ( $rootalbums as $id =&gt; $rootalbum ) {&nbsp;</div></li><li><div>      $rootalbum-&gt;type = 'album';&nbsp;</div></li><li><div>      $children = nggic_get_children ( $rootalbum );&nbsp;</div></li><li><div>      $rootalbum-&gt;children = $children;&nbsp;</div></li><li><div>      $tree [] = $rootalbum;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  foreach ( $orphan_galleries as $gid =&gt; $orphan_gallery ) {&nbsp;</div></li><li><div>      $orphan_gallery-&gt;type = 'gallery';&nbsp;</div></li><li><div>      $tree [] = $orphan_gallery;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $tree;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get child objects (albums and galleries) of an album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $children The recursive array of child albums and galleries</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_children($parent) {&nbsp;</div></li><li><div>  global $albums, $galleries;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $children = array ();&nbsp;</div></li><li><div>  foreach ( $parent-&gt;sortorder as $key =&gt; $value ) {&nbsp;</div></li><li><div>      if (nggic_starts_with ( $value, 'a' )) {&nbsp;</div></li><li><div>          <span class="comment">// album</span>, recurse&nbsp;</div></li><li><div>          $album_id = substr ( $value, 1 );&nbsp;</div></li><li><div>          $album = $albums [$album_id];&nbsp;</div></li><li><div>          $album-&gt;type = 'album';&nbsp;</div></li><li><div>          $subchildren = nggic_get_children ( $album );&nbsp;</div></li><li><div>          $album-&gt;children = $subchildren;&nbsp;</div></li><li><div>          $children [] = $album;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $gallery = $galleries [$value];&nbsp;</div></li><li><div>          $gallery-&gt;type = 'gallery';&nbsp;</div></li><li><div>          $children [] = $gallery;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $children;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get info about an item from NGG</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $item_id</span>&nbsp;</div></li><li><div><span class="comment"> *            The NGG ID of the item</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $item_info The array of information about the item</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_gallery_info($item_id) {&nbsp;</div></li><li><div>  global $nggdb;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $item_info ['id'] = $item_id;&nbsp;</div></li><li><div>  if (nggic_starts_with ( $item_id, 'a' )) {&nbsp;</div></li><li><div>      $gallery = $nggdb-&gt;find_album ( substr ( $item_id, 1 ) );&nbsp;</div></li><li><div>      $item_info ['title'] = $gallery-&gt;name;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $item_info ['thumbnail_src'] = plugins_url ( 'images/ngg_placeholder_album.jpg', __FILE__ );&nbsp;</div></li><li><div>      $item_info ['description'] = $gallery-&gt;albumdesc;&nbsp;</div></li><li><div>      $item_info ['summary'] = $gallery-&gt;albumdesc;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if (empty ( $item_info ['summary'] ))&nbsp;</div></li><li><div>          $item_info ['summary'] = $item_info ['title'];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $gallery = $nggdb-&gt;find_gallery ( $item_id );&nbsp;</div></li><li><div>      if (isset ( $gallery )) {&nbsp;</div></li><li><div>          $item_info ['title'] = $gallery-&gt;title;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          $thumbnail = $nggdb-&gt;find_image ( $gallery-&gt;previewpic );&nbsp;</div></li><li><div>          $item_info ['thumbnail_src'] = $thumbnail-&gt;thumbURL;&nbsp;</div></li><li><div>          $item_info ['description'] = $gallery-&gt;galdesc;&nbsp;</div></li><li><div>          $item_info ['summary'] = $gallery-&gt;galdesc;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if (empty ( $item_info ['summary'] ))&nbsp;</div></li><li><div>              $item_info ['summary'] = $item_info ['title'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $item_info ['title'] = 'uninitialized';&nbsp;</div></li><li><div>          $item_info ['thumbnail_src'] = 'uninitialized';&nbsp;</div></li><li><div>          $item_info ['description'] = 'uninitialized';&nbsp;</div></li><li><div>          $item_info ['summary'] = 'uninitialized';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $item_info;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get all of the Gallery2 items</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $album_info Album Title and URL for the current album</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $gallery_items Sorted array of IDs and Titles for all Gallery2 Data Items in the current album</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_gallery_items() {&nbsp;</div></li><li><div>  GLOBAL $nggdb, $nggic_options;&nbsp;</div></li><li><div>  global $nggRewrite;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $gallery_items = array ();&nbsp;</div></li><li><div>  $item_mod_times = array ();&nbsp;</div></li><li><div>  $item_orig_times = array ();&nbsp;</div></li><li><div>  $item_create_times = array ();&nbsp;</div></li><li><div>  $item_titles = array ();&nbsp;</div></li><li><div>  $item_ids = array ();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $gallery = $nggdb-&gt;find_gallery ( $nggic_options ['current_gallery'] );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (isset ( $gallery )) {&nbsp;</div></li><li><div>      $items = $nggdb-&gt;get_gallery ( $nggic_options ['current_gallery'] );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      foreach ( $items as $item ) {&nbsp;</div></li><li><div>          $item_ids [] = $item-&gt;pid;&nbsp;</div></li><li><div>          $item_titles [] = $item-&gt;alttext;&nbsp;</div></li><li><div>          $item_mod_times [] = $item-&gt;imagedate;&nbsp;</div></li><li><div>          $item_orig_times [] = $item-&gt;imagedate;&nbsp;</div></li><li><div>          $item_create_times [] = $item-&gt;imagedate;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Sort directories and files</span>&nbsp;</div></li><li><div>      $count_files = count ( $item_ids );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $count_files = - 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ($count_files &gt; 0) {&nbsp;</div></li><li><div>      switch ($nggic_options ['sortby']) {&nbsp;</div></li><li><div>          case 'gallery_order' :&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'title_asc' :&nbsp;</div></li><li><div>              array_multisort ( $item_titles, $item_ids );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'title_desc' :&nbsp;</div></li><li><div>              array_multisort ( $item_titles, SORT_DESC, $item_ids );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'orig_time_asc' :&nbsp;</div></li><li><div>              array_multisort ( $item_orig_times, $item_titles, $item_ids );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'orig_time_desc' :&nbsp;</div></li><li><div>              array_multisort ( $item_orig_times, SORT_DESC, $item_titles, $item_ids );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      for($i = 0; $i &lt; $count_files; $i ++) {&nbsp;</div></li><li><div>          $gallery_items [$i] = array (&nbsp;</div></li><li><div>                  'title' =&gt; $item_titles [$i], &nbsp;</div></li><li><div>                  'id' =&gt; $item_ids [$i] &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $gallery_items;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get info about an item from Gallery2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $item_id</span>&nbsp;</div></li><li><div><span class="comment"> *            The Gallery2 ID of the item</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $item_info The array of information about the item</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_image_info($item_id) {&nbsp;</div></li><li><div>  global $nggdb;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $image = $nggdb-&gt;find_image ( $item_id );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $item_info ['id'] = $item_id;&nbsp;</div></li><li><div>  $item_info ['title'] = $image-&gt;alttext;&nbsp;</div></li><li><div>  $item_info ['description'] = $image-&gt;description;&nbsp;</div></li><li><div>  $item_info ['summary'] = $image-&gt;description;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $item_info ['image_url'] = $image-&gt;imageURL;&nbsp;</div></li><li><div>  $item_info ['fullsize_img'] = $image-&gt;imageURL;&nbsp;</div></li><li><div>  $item_info ['thumbnail_src'] = $image-&gt;thumbURL;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $thumb_meta = $image-&gt;meta_data ['thumbnail'];&nbsp;</div></li><li><div>  $item_info ['thumbnail_width'] = $thumb_meta ['width'];&nbsp;</div></li><li><div>  $item_info ['thumbnail_height'] = $thumb_meta ['height'];&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (empty ( $item_info ['summary'] ))&nbsp;</div></li><li><div>      $item_info ['summary'] = $item_info ['title'];&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $item_info;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the array of selection options for the &quot;How to Insert?&quot; select element</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $imginsert_selectoptions The array of selection options for the &quot;How to Insert?&quot; select element</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_imginsert_selectoptions() {&nbsp;</div></li><li><div>  GLOBAL $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $message = array ();&nbsp;</div></li><li><div>  $imginsert_selectoptions = array ();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// These are the universal image insertion options</span>&nbsp;</div></li><li><div>  $message ['thumbnail_image'] = __ ( 'Thumbnail with link to image', 'nggic' );&nbsp;</div></li><li><div>  $message ['thumbnail_custom_url'] = __ ( 'Thumbnail with link to custom URL (from text box below)', 'nggic' );&nbsp;</div></li><li><div>  $message ['thumbnail_only'] = __ ( 'Thumbnail only - no link', 'nggic' );&nbsp;</div></li><li><div>  $message ['fullsize_only'] = __ ( 'Fullsized image only - no link', 'nggic' );&nbsp;</div></li><li><div>  $message ['link_image'] = __ ( 'Text link to image', 'nggic' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  foreach ( $message as $key =&gt; $text ) {&nbsp;</div></li><li><div>      $message [$key] = $text . ' (' . __ ( 'HTML', 'nggic' ) . ')';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// These are CMS-specific image insertion options</span>&nbsp;</div></li><li><div>  $message ['ngg_singlepic'] = __ ( 'NGG tag of image', 'nggic' );&nbsp;</div></li><li><div>  $message ['ngg_thumb'] = __ ( 'NGG tag of thumbnail', 'nggic' );&nbsp;</div></li><li><div>  $message ['ngg_thumb_multi'] = __ ( 'NGG tag of multiple thumbnails', 'nggic' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Make the universal message array</span>&nbsp;</div></li><li><div>  $imginsert_selectoptions = array (&nbsp;</div></li><li><div>          'thumbnail_image' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['thumbnail_image'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'thumbnail_custom_url' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['thumbnail_custom_url'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'thumbnail_only' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['thumbnail_only'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'fullsize_only' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['fullsize_only'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_image' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['link_image'] &nbsp;</div></li><li><div> ) &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $imginsert_selectoptions = array (&nbsp;</div></li><li><div>          'ngg_singlepic' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['ngg_singlepic'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'ngg_thumb' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['ngg_thumb'] &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'ngg_thumb_multi' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; $message ['ngg_thumb_multi'] &nbsp;</div></li><li><div> ) &nbsp;</div></li><li><div> ) + $imginsert_selectoptions;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $imginsert_selectoptions [$nggic_options ['default_action']] ['selected'] = TRUE;&nbsp;</div></li><li><div>  return $imginsert_selectoptions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get all of the options set in $_REQUEST and/or $_SESSION</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_get_request_and_session_options() {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $nggic_options ['root_album'] = - 1;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  nggic_magic_quotes_remove ( $_REQUEST );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Is this a TinyMCE window?</span></span>&nbsp;</div></li><li><div>  if (isset ( $_REQUEST ['nggic_tinymce'] )) {&nbsp;</div></li><li><div>      $nggic_options ['tinymce'] = $_REQUEST ['nggic_tinymce'];&nbsp;</div></li><li><div>      $_SESSION ['nggic_tinymce'] = $_REQUEST ['nggic_tinymce'];&nbsp;</div></li><li><div>  } else if (isset ( $_SESSION ['nggic_tinymce'] ))&nbsp;</div></li><li><div>      $nggic_options ['tinymce'] = $_SESSION ['nggic_tinymce'];&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $nggic_options ['tinymce'] = 0;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Get the form name (if set) for insertion (not TinyMCE or FCKEditor)</span>&nbsp;</div></li><li><div>  if (isset ( $_REQUEST ['nggic_form'] )) {&nbsp;</div></li><li><div>      $nggic_options ['form'] = $_REQUEST ['nggic_form'];&nbsp;</div></li><li><div>      $_SESSION ['nggic_form'] = $_REQUEST ['nggic_form'];&nbsp;</div></li><li><div>  } else if (isset ( $_SESSION ['nggic_form'] ))&nbsp;</div></li><li><div>      $nggic_options ['form'] = $_SESSION ['nggic_form'];&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $nggic_options ['form'] = '';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Get the field name (if set) for insertion (not TinyMCE or FCKEditor)</span>&nbsp;</div></li><li><div>  if (isset ( $_REQUEST ['nggic_field'] )) {&nbsp;</div></li><li><div>      $nggic_options ['field'] = $_REQUEST ['nggic_field'];&nbsp;</div></li><li><div>      $_SESSION ['nggic_field'] = $_REQUEST ['nggic_field'];&nbsp;</div></li><li><div>  } else if (isset ( $_SESSION ['nggic_field'] ))&nbsp;</div></li><li><div>      $nggic_options ['field'] = $_SESSION ['nggic_field'];&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $nggic_options ['field'] = '';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Get the last album visited</span>&nbsp;</div></li><li><div>  if (isset ( $_SESSION ['nggic_last_album_visited'] )) {&nbsp;</div></li><li><div>      $nggic_options ['last_album'] = $_SESSION ['nggic_last_album_visited'];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $nggic_options ['last_album'] = $nggic_options ['root_album'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Get the current album</span>&nbsp;</div></li><li><div>  if (IsSet ( $_REQUEST ['current_gallery'] )) {&nbsp;</div></li><li><div>      $nggic_options ['current_gallery'] = $_REQUEST ['current_gallery'];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $nggic_options ['current_gallery'] = $nggic_options ['last_album'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Get the current page</span>&nbsp;</div></li><li><div>  if (isset ( $_REQUEST ['nggic_page'] ) and is_numeric ( $_REQUEST ['nggic_page'] )) {&nbsp;</div></li><li><div>      $nggic_options ['current_page'] = floor ( $_REQUEST ['nggic_page'] );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $nggic_options ['current_page'] = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Get the current sort method</span>&nbsp;</div></li><li><div>  if (IsSet ( $_REQUEST ['sortby'] ))&nbsp;</div></li><li><div>      $nggic_options ['sortby'] = $_REQUEST ['sortby'];&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Determine whether to display the titles or keep them hidden</span>&nbsp;</div></li><li><div>  if (IsSet ( $_REQUEST ['display'] ))&nbsp;</div></li><li><div>      if ($_REQUEST ['display'] == 'filenames')&nbsp;</div></li><li><div>          $nggic_options ['display_filenames'] = TRUE;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Determine how many images to display per page</span>&nbsp;</div></li><li><div>  if (IsSet ( $_REQUEST ['images_per_page'] ))&nbsp;</div></li><li><div>      $nggic_options ['images_per_page'] = $_REQUEST ['images_per_page'];&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Initializes NextGEN Gallery Image Chooser</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param</span>&nbsp;</div></li><li><div><span class="comment"> *            null</span>&nbsp;</div></li><li><div><span class="comment"> * @return null</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_init() {&nbsp;</div></li><li><div>  <span class="comment">// load translation</span>&nbsp;</div></li><li><div>  load_plugin_textdomain ( 'nggic', false, dirname ( plugin_basename ( __FILE__ ) ) . '/langs/' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove &quot;Magic Quotes&quot;</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param</span>&nbsp;</div></li><li><div><span class="comment"> *            array &$array POST or GET with magic quotes</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_magic_quotes_remove(&$array) {&nbsp;</div></li><li><div>  if (! get_magic_quotes_gpc ())&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  foreach ( $array as $key =&gt; $elem ) {&nbsp;</div></li><li><div>      if (is_array ( $elem ))&nbsp;</div></li><li><div>          nggic_magic_quotes_remove ( $elem );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $array [$key] = stripslashes ( $elem );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the &quot;About&quot; alert HTML</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The &quot;About&quot; alert HTML</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_about($version) {&nbsp;</div></li><li><div>  $html = '&lt;div class=&quot;about_button&quot;&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;button&quot; onclick=&quot;alert(\'' . __ ( 'NextGEN Gallery Image Chooser', 'nggic' ) . '\n' . __ ( 'Version', 'nggic' ) . ' ' . $version . '\')&quot; ' . 'value=&quot;' . __ ( 'About NextGEN Gallery Image Chooser', 'nggic' ) . '&quot;/&gt;' . &quot;\n&quot; . '&lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the album tree HTML</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The album tree HTML</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_album_tree($tree) {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Album navigation</span>&nbsp;</div></li><li><div>  $html = '&lt;div class=&quot;dtree&quot;&gt;' . &quot;\n&quot; . '    &lt;p&gt;&lt;a href=&quot;javascript: d.openAll();&quot;&gt;' . __ ( 'Expand all', 'nggic' ) . '&lt;/a&gt; | &lt;a href=&quot;javascript: d.closeAll();&quot;&gt;' . __ ( 'Collapse all', 'nggic' ) . '&lt;/a&gt;&lt;/p&gt;' . &quot;\n&quot; . '    &lt;script type=&quot;text/javascript&quot;&gt;' . &quot;\n&quot; . '        &lt;!--' . &quot;\n&quot; . '        d = new dTree(&quot;d&quot;);' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $parent = - 1;&nbsp;</div></li><li><div>  $node = 0;&nbsp;</div></li><li><div>  $html .= '        d.add(' . $node . ', ' . $parent . ', &quot;' . __ ( 'Gallery', 'nggic' ) . '&quot;);' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $node ++;&nbsp;</div></li><li><div>  $parent ++;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  foreach ( $tree as $key =&gt; $root_album ) {&nbsp;</div></li><li><div>      $html .= nggic_make_html_album_tree_branches ( $root_album, $parent, $node );&nbsp;</div></li><li><div>      $node ++;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '        document.write(d);' . &quot;\n&quot; . '        <span class="comment">//--&gt;' . &quot;\n&quot; . '    &lt;/script&gt;' . &quot;\n&quot; . '&lt;/div&gt;' . &quot;\n\n&quot;;</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generates album hierarchy as d.add entites of dtree</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $current_node</span>&nbsp;</div></li><li><div><span class="comment"> *            id of current node (album or gallery)</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $parent</span>&nbsp;</div></li><li><div><span class="comment"> *            node of the parent album</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_album_tree_branches($current_node, $parent, &$node) {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (strcmp ( $current_node-&gt;type, 'album' ) == 0) {&nbsp;</div></li><li><div>      $album_title = $current_node-&gt;name;&nbsp;</div></li><li><div>      $album_title = preg_replace ( &quot;/(\n|\r)/&quot;, &quot; &quot;, $album_title );&nbsp;</div></li><li><div>      if (empty ( $album_title )) {&nbsp;</div></li><li><div>          $album_title = $current_node-&gt;slug;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $html = '        d.add(' . $node . ', ' . $parent . ', &quot;' . htmlspecialchars ( $album_title ) . '&quot;, &quot;' . '?nggic_tinymce=1&current_gallery=a' . $current_node-&gt;id . '&quot;);' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $sub_albums = $current_node-&gt;children;&nbsp;</div></li><li><div>      if (is_array ( $sub_albums )) {&nbsp;</div></li><li><div>          $albums = array_values ( $sub_albums );&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if (count ( $albums ) &gt; 0) {&nbsp;</div></li><li><div>              $parent = $node;&nbsp;</div></li><li><div>              foreach ( $albums as $album ) {&nbsp;</div></li><li><div>                  $node ++;&nbsp;</div></li><li><div>                  $html .= nggic_make_html_album_tree_branches ( $album, $parent, $node );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $album_title = $current_node-&gt;title;&nbsp;</div></li><li><div>      $album_title = preg_replace ( &quot;/(\n|\r)/&quot;, &quot; &quot;, $album_title );&nbsp;</div></li><li><div>      if (empty ( $album_title )) {&nbsp;</div></li><li><div>          $album_title = $current_node-&gt;slug;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $html = '        d.add(' . $node . ', ' . $parent . ', &quot;' . htmlspecialchars ( $album_title ) . '&quot;, &quot;' . '?nggic_tinymce=1&current_gallery=' . $current_node-&gt;gid . '&sortby=' . $nggic_options ['sortby'] . '&images_per_page=' . $nggic_options ['images_per_page'] . '&quot;);' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the alignment selection HTML</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The alignment selection HTML</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_alignment_select() {&nbsp;</div></li><li><div>  GLOBAL $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// array for output</span></span>&nbsp;</div></li><li><div>  $align_options = array (&nbsp;</div></li><li><div>          'none' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'None', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'left' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Float Left', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'right' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Float Right', 'nggic' ) &nbsp;</div></li><li><div> ) &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $align_options [$nggic_options ['default_alignment']] ['selected'] = TRUE;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html = nggic_make_html_select ( 'alignment', $align_options );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create the HTML for the image controls</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for the image controls</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_controls() {&nbsp;</div></li><li><div>  global $nggdb, $nggic_imginsert_options, $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// &quot;How to insert:&quot; radio buttons</span>&nbsp;</div></li><li><div>  $html = &quot;        &lt;fieldset&gt;\n&quot; . '            &lt;legend&gt;' . __ ( 'Insertion Options', 'nggic' ) . '&lt;/legend&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;alignment&quot;&gt;' . __ ( 'How to Insert Image', 'nggic' ) . '&lt;/label&gt;' . &quot;\n&quot; . nggic_make_html_select ( 'imginsert', $nggic_imginsert_options, 'toggleTextboxes();' ) . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . &nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// &quot;Custom URL&quot; textbox</span>&nbsp;</div></li><li><div>  '            &lt;div name=&quot;custom_url_textbox&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'thumbnail_custom_url') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;custom_url&quot;&gt;' . __ ( 'Custom URL', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;custom_url&quot; size=&quot;84&quot; maxlength=&quot;150&quot; value=&quot;' . $nggic_options ['custom_url'] . '&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot; . &nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// &quot;Link Text&quot; textbox</span>&nbsp;</div></li><li><div>  '            &lt;div name=&quot;link_text_textbox&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'link_image') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;link_text&quot;&gt;' . __ ( 'Text for text link', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;link_text&quot; size=&quot;84&quot; maxlength=&quot;150&quot; value=&quot;&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// singlepic tag &quot;h and w&quot; boxes</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '            &lt;div name=&quot;ngg_tag_size_textbox&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'ngg_singlepic') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;ngg_tag_width&quot;&gt;' . __ ( 'Image width x  height (Leave blank for the original size)', 'nggic' ) . '&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;ngg_tag_width&quot; size=&quot;10&quot; maxlength=&quot;5&quot; value=&quot;' . $nggic_options ['tag_width'] . '&quot; /&gt;' . &quot; x \n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;ngg_tag_height&quot; size=&quot;10&quot; maxlength=&quot;5&quot; value=&quot;' . $nggic_options ['tag_height'] . '&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Link and alignment selection</span>&nbsp;</div></li><li><div>  $html .= '            &lt;div name=&quot;ngg_tag_align_select&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'ngg_singlepic') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;ngg_tag_link&quot;&gt;' . __ ( 'Link (Leave blank for none)', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;ngg_tag_link&quot; size=&quot;84&quot; maxlength=&quot;150&quot; value=&quot;&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;alignment&quot;&gt;' . __ ( 'NGG Float Class', 'nggic' ) . '&lt;/label&gt;' . &quot;\n&quot; . nggic_make_html_alignment_select () . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Mode selection</span>&nbsp;</div></li><li><div>  $nggic_mode_options = array (&nbsp;</div></li><li><div>          'none' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Default', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'web20' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; 'Web 2.0' &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'watermark' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Watermark', 'nggic' ) &nbsp;</div></li><li><div> ) &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $nggic_mode_options [$nggic_options ['default_mode']] ['selected'] = TRUE;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '            &lt;div name=&quot;ngg_tag_mode_select&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'ngg_singlepic') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;alignment&quot;&gt;' . __ ( 'Mode', 'nggic' ) . '&lt;/label&gt;' . &quot;\n&quot; . nggic_make_html_select ( 'ngg_tag_mode_select', $nggic_mode_options ) . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// template box</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '            &lt;div name=&quot;ngg_tag_template_textbox&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['default_action'] == 'ngg_singlepic' || $nggic_options ['default_action'] == 'ngg_thumb' || $nggic_options ['default_action'] == 'ngg_thumb_multi') {&nbsp;</div></li><li><div>      $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;ngg_tag_template&quot;&gt;' . __ ( 'Template name (Leave blank for the default template)', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;ngg_tag_template&quot; size=&quot;84&quot; maxlength=&quot;150&quot; value=&quot;&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= &quot;        &lt;/fieldset&gt;\n\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// &quot;Insert&quot; button</span></span>&nbsp;</div></li><li><div>  $html .= &quot;        &lt;fieldset&gt;\n&quot; . '            &lt;legend&gt;' . __ ( 'Press button to insert checked image(s)', 'nggic' ) . '&lt;/legend&gt;' . &quot;\n&quot; . &quot;            &lt;input disabled type='button'\n&quot; . &quot;            name='insert_button'\n&quot; . '            onclick=&quot;insertItems();&quot;' . &quot;\n&quot; . '            value=&quot;' . __ ( 'Insert', 'nggic' ) . '&quot;' . &quot;\n&quot; . '            /&gt;' . &quot;\n&quot; . '            &lt;a href=&quot;javascript: checkAllImages();&quot;&gt;' . __ ( 'Check all', 'nggic' ) . '&lt;/a&gt; | &lt;a href=&quot;javascript: uncheckAllImages();&quot;&gt;' . __ ( 'Uncheck all', 'nggic' ) . '&lt;/a&gt;' . &quot;\n&quot; . &quot;        &lt;/fieldset&gt;\n\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the HTML for the &quot;Display Options&quot; box</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for the &quot;Display Options&quot; box</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_display_options() {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $images_per_page_options = array (&nbsp;</div></li><li><div>          10, &nbsp;</div></li><li><div>          20, &nbsp;</div></li><li><div>          30, &nbsp;</div></li><li><div>          40, &nbsp;</div></li><li><div>          50, &nbsp;</div></li><li><div>          60, &nbsp;</div></li><li><div>          9999 &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (! in_array ( $nggic_options ['images_per_page'], $images_per_page_options )) {&nbsp;</div></li><li><div>      array_push ( $images_per_page_options, $nggic_options ['images_per_page'] );&nbsp;</div></li><li><div>      sort ( $images_per_page_options );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// array for output</span></span>&nbsp;</div></li><li><div>  $sortoptions = array (&nbsp;</div></li><li><div>          'gallery_order' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'NextGEN Gallery order', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'title_asc' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'NextGEN Gallery Title (A-z)', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'title_desc' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'NextGEN Gallery Title (z-A)', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'orig_time_desc' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Origination Time (Newest First)', 'nggic' ) &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'orig_time_asc' =&gt; array (&nbsp;</div></li><li><div>                  'text' =&gt; __ ( 'Origination Time (Oldest First)', 'nggic' ) &nbsp;</div></li><li><div> ) &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $sortoptions [$nggic_options ['sortby']] ['selected'] = TRUE;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html = &quot;&lt;div&gt;\n&quot; . &quot;    &lt;fieldset&gt;\n&quot; . '        &lt;legend&gt;' . __ ( 'Display Options', 'nggic' ) . '&lt;/legend&gt;' . &quot;\n&quot; . '            ' . __ ( 'Sorted by:', 'nggic' ) . &quot;\n&quot; . nggic_make_html_select ( 'sortby', $sortoptions, 'document.forms[0].submit();' ) . '            ' . __ ( 'Per Page:', 'nggic' ) . &quot;\n&quot; . '            &lt;select name=&quot;images_per_page&quot; onchange=&quot;document.forms[0].submit();&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  for($i = 0; $i &lt; count ( $images_per_page_options ); $i ++) {&nbsp;</div></li><li><div>      $html .= '                &lt;option value=&quot;' . $images_per_page_options [$i] . '&quot;';&nbsp;</div></li><li><div>      if ($images_per_page_options [$i] == $nggic_options ['images_per_page'])&nbsp;</div></li><li><div>          $html .= &quot; selected='selected'&quot;;&nbsp;</div></li><li><div>      $html .= '&gt;';&nbsp;</div></li><li><div>      if ($images_per_page_options [$i] == 9999)&nbsp;</div></li><li><div>          $html .= __ ( 'All', 'nggic' );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $html .= $images_per_page_options [$i];&nbsp;</div></li><li><div>      $html .= &quot;&lt;/option&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= &quot;            &lt;/select&gt;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '            &lt;input type=&quot;radio&quot; name=&quot;display&quot; value=&quot;thumbnails&quot;';&nbsp;</div></li><li><div>  if (! $nggic_options ['display_filenames'])&nbsp;</div></li><li><div>      $html .= ' checked=&quot;checked&quot;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $html .= &quot;\n&quot;;&nbsp;</div></li><li><div>  $html .= &quot;            onclick='showThumbnails()'&quot; . '&gt;' . __ ( 'Thumbnails', 'nggic' ) . '&lt;/input&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '            &lt;input type=&quot;radio&quot; name=&quot;display&quot; value=&quot;filenames&quot;';&nbsp;</div></li><li><div>  if ($nggic_options ['display_filenames'])&nbsp;</div></li><li><div>      $html .= ' checked=&quot;checked&quot;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $html .= &quot;\n&quot;;&nbsp;</div></li><li><div>  $html .= &quot;            onclick='showFileNames()'&quot; . '&gt;' . __ ( 'Thumbnails with info', 'nggic' ) . '&lt;/input&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= &quot;    &lt;/fieldset&gt;\n&quot; . &quot;&lt;/div&gt;\n\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the HTML for the &quot;No photos in this album&quot; message</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for the &quot;No photos in this album&quot; message</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_empty_page() {&nbsp;</div></li><li><div>  $html = '&lt;p&gt;&lt;strong&gt;' . __ ( 'There are no photos in this album.&lt;br /&gt;&lt;br /&gt;Please pick another album from the navigation options above.', 'nggic' ) . '&lt;/strong&gt;&lt;/p&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the header</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for the header</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_header() {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  $html = '&lt;html xmlns=&quot;http:<span class="comment">//www.w3.org/1999/xhtml&quot;&gt;' . &quot;\n&quot; . '&lt;head&gt;' . &quot;\n&quot; . '    &lt;title&gt;' . __ ( 'NextGEN Gallery Image Chooser', 'nggic' ) . '&lt;/title&gt;' . &quot;\n&quot; . '    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/nggic.css&quot; type=&quot;text/css&quot; /&gt;' . &quot;\n&quot; . '    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/dtree.css&quot; type=&quot;text/css&quot; /&gt;' . &quot;\n&quot; . '    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/slimbox.css&quot; type=&quot;text/css&quot; /&gt;' . &quot;\n&quot; . '    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>  $html .= &quot;    &lt;script language='javascript' type='text/javascript' src='../../../wp-includes/js/tinymce/tiny_mce_popup.js'&gt;&lt;/script&gt;\n&quot;;&nbsp;</div></li><li><div>  $html .= '    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;jscripts/functions.js&quot;&gt;&lt;/script&gt;' . &quot;\n&quot; . '    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;jscripts/dtree.js&quot;&gt;&lt;/script&gt;' . &quot;\n&quot; . '    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;jscripts/mootools.js&quot;&gt;&lt;/script&gt;' . &quot;\n&quot; . '    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;jscripts/slimbox.js&quot;&gt;&lt;/script&gt;' . &quot;\n&quot; . '&lt;/head&gt;' . &quot;\n\n&quot; . '&lt;body id=&quot;nggic&quot;&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>  $html .= '    &lt;form method=&quot;post&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  if (isset ( $nggic_options ['current_gallery'] )) {&nbsp;</div></li><li><div>      $html .= '    &lt;input type=&quot;hidden&quot; name=&quot;current_gallery&quot; value=&quot;' . $nggic_options ['current_gallery'] . '&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $html .= '    &lt;input type=&quot;hidden&quot; name=&quot;nggic_page&quot; value=&quot;' . $nggic_options ['current_page'] . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $html .= '    &lt;input type=&quot;hidden&quot; name=&quot;nggic_form&quot; value=&quot;' . $nggic_options ['form'] . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $html .= '    &lt;input type=&quot;hidden&quot; name=&quot;nggic_field&quot; value=&quot;' . $nggic_options ['field'] . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the HTML for the image block</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for the image block</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_image_navigation() {&nbsp;</div></li><li><div>  global $nggic_gallery_items, $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  reset ( $nggic_gallery_items );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  foreach ( $nggic_gallery_items as $key =&gt; $item ) {&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $image_id = $item ['id'];&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if (! (($nggic_options ['current_page'] - 1) * $nggic_options ['images_per_page'] &lt;= $key)) <span class="comment">// Haven't gotten there yet</span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      else if (! ($key &lt; $nggic_options ['current_page'] * $nggic_options ['images_per_page']))&nbsp;</div></li><li><div>          break; <span class="comment">// Have gone past the range for this page</span>&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if ($nggic_options ['display_filenames']) {&nbsp;</div></li><li><div>          $html .= &quot;&lt;div class='title_imageblock'&gt;\n&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $html .= &quot;&lt;div class='thumbnail_imageblock'&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $item_info = nggic_get_image_info ( $image_id );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $html .= nggic_make_html_img ( $item_info ) . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if ($nggic_options ['display_filenames'])&nbsp;</div></li><li><div>          $html .= '    &lt;div class=&quot;displayed_title&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $html .= '    &lt;div class=&quot;hidden_title&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $html .= '        ' . __ ( 'Title:', 'nggic' ) . ' ' . htmlspecialchars ( $item_info ['title'] ) . '&lt;br /&gt;' . &quot;\n&quot; . '        ' . __ ( 'Summary:', 'nggic' ) . ' ' . htmlspecialchars ( $item_info ['summary'] ) . '&lt;br /&gt;' . &quot;\n&quot; . '        ' . __ ( 'Description:', 'nggic' ) . ' ' . htmlspecialchars ( $item_info ['description'] ) . '&lt;br /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $html .= &quot;    &lt;/div&gt;\n\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if ($nggic_options ['display_filenames']) {&nbsp;</div></li><li><div>          $html .= &quot;    &lt;div class='active_placeholder'&gt;\n&quot; . &quot;    &lt;/div&gt;\n\n&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $html .= &quot;    &lt;div class='inactive_placeholder'&gt;\n&quot; . &quot;    &lt;/div&gt;\n\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// hidden fields</span>&nbsp;</div></li><li><div>      $html .= '    &lt;input type=&quot;hidden&quot; name=&quot;thumbnail_src&quot; value=&quot;' . $item_info ['thumbnail_src'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;fullsize_img&quot; value=&quot;' . $item_info ['fullsize_img'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;item_title&quot; value=&quot;' . $item_info ['title'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;item_summary&quot; value=&quot;' . $item_info ['summary'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;item_description&quot; value=&quot;' . $item_info ['description'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;image_url&quot; value=&quot;' . $item_info ['image_url'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;image_id&quot; value=&quot;' . $image_id . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;thumbw&quot; value=&quot;' . $item_info ['thumbnail_width'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;input type=&quot;hidden&quot; name=&quot;thumbh&quot; value=&quot;' . $item_info ['thumbnail_height'] . '&quot; /&gt;' . &quot;\n&quot; . '&lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the HTML for an individual image</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $item_info</span>&nbsp;</div></li><li><div><span class="comment"> *            Information on the image</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for an individual image</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_img($item_info) {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// ---- image code</span>&nbsp;</div></li><li><div>  $html .= '    &lt;div style=&quot;background:#F0F0EE url(' . $item_info ['thumbnail_src'] . '); width:' . $item_info ['thumbnail_width'] . 'px; height:' . $item_info ['thumbnail_height'] . 'px; float: left;&quot;&gt;' . &quot;\n&quot; . '        &lt;input type=&quot;checkbox&quot; name=&quot;images&quot; onclick=&quot;activateInsertButton();&quot;/&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $html .= '        &lt;a title=&quot;' . $item_info ['title'] . '&quot; rel=&quot;lightbox[nggimage]&quot; href=&quot;' . $item_info ['fullsize_img'] . '&quot;&gt;' . &quot;\n&quot; . '        &lt;img src=&quot;images/magnifier.gif&quot; border=&quot;0&quot;&gt;&lt;/a&gt;' . &quot;\n&quot; . '    &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the HTML for inserting an album or gallery NGG Tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for for inserting an album or gallery NGG Tag</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_ngg_album_insert_button() {&nbsp;</div></li><li><div>  GLOBAL $nggic_options, $nggic_gallery_items;&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $album_info = nggic_get_gallery_info ( $nggic_options ['current_gallery'] );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ($album_info ['id'] != - 1) {&nbsp;</div></li><li><div>      <span class="comment">// Create the form</span>&nbsp;</div></li><li><div>      $html .= &quot;&lt;div&gt;\n&quot; . &quot;    &lt;fieldset&gt;\n&quot; . '        &lt;legend&gt;' . __ ( 'Insert a NGG tag for the current gallery:', 'nggic' ) . ' ' . $album_info ['title'] . '&lt;/legend&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if (empty ( $nggic_gallery_items )) {&nbsp;</div></li><li><div>          $html .= '            &lt;label for=&quot;ngg_tag_template&quot;&gt;' . __ ( 'Template name (Leave blank for the default template)', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;text&quot; name=&quot;ngg_tag_template&quot; size=&quot;84&quot; maxlength=&quot;150&quot; value=&quot;&quot; /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Imagebrowser checkbox</span>&nbsp;</div></li><li><div>      $html .= '            &lt;div name=&quot;ngg_tag_imagebrowser_checkbox&quot;';&nbsp;</div></li><li><div>      if (! nggic_starts_with ( $album_info ['id'], 'a' )) {&nbsp;</div></li><li><div>          $html .= ' class=&quot;displayed_textbox&quot;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $html .= ' class=&quot;hidden_textbox&quot;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;checkbox&quot; name=&quot;ngg_tag_imagebrowser&quot; /&gt;' . &quot;\n&quot; . '            &lt;label for=&quot;ngg_tag_imagebrowser&quot;&gt;' . __ ( 'Insert gallery as image browser', 'nggic' ) . '&lt;br /&gt;&lt;/label&gt;' . &quot;\n&quot; . '            &lt;br /&gt;' . &quot;\n&quot; . '            &lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// &quot;Insert&quot; button</span></span>&nbsp;</div></li><li><div>      $html .= '            &lt;input type=&quot;button&quot;' . &quot;\n&quot; . '            onclick=&quot;insertNggTag()&quot;' . &quot;\n&quot; . '            value=&quot;' . __ ( 'Insert', 'nggic' ) . '&quot;' . &quot;\n&quot; . '            /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if (! empty ( $nggic_gallery_items )) {&nbsp;</div></li><li><div>          $html .= '            ' . __ ( 'Set the template name in &quot;Insertion Options&quot; below', 'nggic' ) . ' ' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '            &lt;input type=&quot;hidden&quot; name=&quot;ngg_id&quot; value=&quot;' . $nggic_options ['current_gallery'] . '&quot; /&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;hidden&quot; name=&quot;ngg_summary&quot; value=&quot;' . $album_info ['summary'] . '&quot; /&gt;' . &quot;\n&quot; . '            &lt;input type=&quot;hidden&quot; name=&quot;ngg_thumbnail&quot; value=&quot;' . $album_info ['thumbnail_src'] . '&quot; /&gt;' . &quot;\n&quot; . '    &lt;/fieldset&gt;' . &quot;\n&quot; . '&lt;/div&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make the HTML for navigating multiple pages of images</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for navigating multiple pages of images</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_page_navigation() {&nbsp;</div></li><li><div>  global $nggic_gallery_items, $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// ---- navigation for pages of images</span>&nbsp;</div></li><li><div>  $pages = ceil ( count ( $nggic_gallery_items ) / $nggic_options ['images_per_page'] );&nbsp;</div></li><li><div>  if ($nggic_options ['current_page'] &gt; $pages)&nbsp;</div></li><li><div>      $nggic_options ['current_page'] = $pages;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $pagelinks = array ();&nbsp;</div></li><li><div>  for($count = 1; $count &lt;= $pages; $count ++) {&nbsp;</div></li><li><div>      if ($nggic_options ['current_page'] == $count) {&nbsp;</div></li><li><div>          $pagelinks [] = '        &lt;strong&gt;' . $count . '&lt;/strong&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $pagelinks [] = '        &lt;a href=&quot;?nggic_tinymce=1&nggic_page=' . $count . '&sortby=' . $nggic_options ['sortby'] . '&images_per_page=' . $nggic_options ['images_per_page'] . '&quot;&gt;' . $count . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (count ( $pagelinks ) &gt; 1) {&nbsp;</div></li><li><div>      $html = '&lt;div&gt;' . &quot;\n&quot; . '    &lt;fieldset&gt;' . &quot;\n&quot; . '        &lt;legend&gt;' . __ ( 'Page Navigation:', 'nggic' ) . '&lt;/legend&gt;' . &quot;\n&quot; . '        ' . __ ( 'Page:', 'nggic' ) . ' ' . &quot;\n&quot; . implode ( &quot;     - \n&quot;, $pagelinks ) . &quot;\n&quot; . '    &lt;/fieldset&gt;' . &quot;\n&quot; . '&lt;/div&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html = &quot;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates HTML for a select element</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The array $options should contain values and descriptions:</span>&nbsp;</div></li><li><div><span class="comment"> * array(</span>&nbsp;</div></li><li><div><span class="comment"> * 'value' =&gt; array(</span>&nbsp;</div></li><li><div><span class="comment"> * 'text' =&gt; 'Description', </span>&nbsp;</div></li><li><div><span class="comment"> * 'selected' =&gt; (TRUE|FALSE), </span>&nbsp;</div></li><li><div><span class="comment"> * ), </span>&nbsp;</div></li><li><div><span class="comment"> * ...</span>&nbsp;</div></li><li><div><span class="comment"> * )</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name</span>&nbsp;</div></li><li><div><span class="comment"> *            The name for the select element</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $options</span>&nbsp;</div></li><li><div><span class="comment"> *            The array of options attributes for the select element</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $onchange</span>&nbsp;</div></li><li><div><span class="comment"> *            (optional) The string that will be exectuted when the user changes options</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $html The HTML for for select element</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_make_html_select($name, $options, $onchange = null) {&nbsp;</div></li><li><div>  $html = '            &lt;select name=&quot;' . $name . '&quot; size=&quot;1&quot; ';&nbsp;</div></li><li><div>  if ($onchange) {&nbsp;</div></li><li><div>      $html .= 'onchange=&quot;' . $onchange . '&quot; ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  foreach ( $options as $value =&gt; $option ) {&nbsp;</div></li><li><div>      $html .= &quot;                &lt;option value='{$value}'&quot;;&nbsp;</div></li><li><div>      if (isset ( $option ['selected'] ) and $option ['selected'])&nbsp;</div></li><li><div>          $html .= &quot; selected='selected'&quot;;&nbsp;</div></li><li><div>      $html .= &quot;&gt;{$option['text']}&lt;/option&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= &quot;            &lt;/select&gt;\n&quot;;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds nggic to the TinyMCE plugins list</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $plugins</span>&nbsp;</div></li><li><div><span class="comment"> *            the buttons string from the WP filter</span>&nbsp;</div></li><li><div><span class="comment"> * @return string the appended plugins string</span>&nbsp;</div></li><li><div><span class="comment"> *        </span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_plugin($plugin_array) {&nbsp;</div></li><li><div>  $plugin_array ['nggic'] = plugins_url ( 'editor_plugin.js', __FILE__ );&nbsp;</div></li><li><div>  return $plugin_array;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sets up the NGGIC Plugin defaults</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param</span>&nbsp;</div></li><li><div><span class="comment"> *            NULL</span>&nbsp;</div></li><li><div><span class="comment"> * @return NULL</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_pluginactivate() {&nbsp;</div></li><li><div>  global $nggic_options;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (! is_plugin_active ( 'nextgen-gallery/nggallery.php' )) {&nbsp;</div></li><li><div>      die ( __ ( 'Required NextGEN Gallery was not found!', 'nggic' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Get NGGIC Option Settings</span>&nbsp;</div></li><li><div>  $nggic_options = get_option ( 'nggic_options' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Has NGGIC Plugin Not been correctly deactivated as Options should not yet exist.</span>&nbsp;</div></li><li><div>  if ($nggic_options ['sortby']) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Add BTEV Event Message</span></span></span>&nbsp;</div></li><li><div>      if (function_exists ( 'btev_trigger_error' )) {&nbsp;</div></li><li><div>          btev_trigger_error ( 'NextGEN Gallery Image Chooser PLUGIN WAS NOT DEACTIVATED', E_USER_NOTICE, __FILE__ );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      nggic_plugindeactivate ();&nbsp;</div></li><li><div>      $nggic_options = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  include_once (dirname ( __FILE__ ) . '/init.php'); <span class="comment">// default settings</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  update_option ( 'nggic_options', $nggic_options );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">// Add BTEV Event Message</span></span></span>&nbsp;</div></li><li><div>  if (function_exists ( 'btev_trigger_error' )) {&nbsp;</div></li><li><div>      btev_trigger_error ( 'NextGEN Gallery Image Chooser PLUGIN ACTIVATED', E_USER_NOTICE, __FILE__ );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes all the NGGIC settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param</span>&nbsp;</div></li><li><div><span class="comment"> *            NULL</span>&nbsp;</div></li><li><div><span class="comment"> * @return NULL</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_plugindeactivate() {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// Delete NGGIC Option Settings</span>&nbsp;</div></li><li><div>  delete_option ( 'nggic_options' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">// Add BTEV Event Message</span></span></span>&nbsp;</div></li><li><div>  if (function_exists ( 'btev_trigger_error' )) {&nbsp;</div></li><li><div>      btev_trigger_error ( 'NextGEN Gallery Image Chooser PLUGIN DEACTIVATED', E_USER_NOTICE, __FILE__ );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Helper function to determine if one text starts with another.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $haystack</span>&nbsp;</div></li><li><div><span class="comment"> *            the text to search in</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $needle</span>&nbsp;</div></li><li><div><span class="comment"> *            the text to search for</span>&nbsp;</div></li><li><div><span class="comment"> * @return true, if $haystack starts with $needle, else false</span>&nbsp;</div></li><li><div><span class="comment"> *        </span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_starts_with($haystack, $needle) {&nbsp;</div></li><li><div>  $length = strlen ( $needle );&nbsp;</div></li><li><div>  return (substr ( $haystack, 0, $length ) === $needle);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds nggic to the TinyMCE button bar</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $buttons</span>&nbsp;</div></li><li><div><span class="comment"> *            the buttons string from the WP filter</span>&nbsp;</div></li><li><div><span class="comment"> * @return string the appended buttons string</span>&nbsp;</div></li><li><div><span class="comment"> *        </span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function nggic_wp_extended_editor_mce_buttons($buttons) {&nbsp;</div></li><li><div>  array_push ( $buttons, 'separator', 'nggic' );&nbsp;</div></li><li><div>  return $buttons;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>NextGEN Gallery Image Chooser</li><li><span></span>1.1.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>